<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"><meta charset="utf-8">
<meta name="pluto-insertion-spot-meta">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#2a2928"><meta name="color-scheme" content="light dark"><link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/favicon-16x16.267aebbe.png"><link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/favicon-32x32.1b9d3e70.png"><link rel="icon" type="image/png" sizes="96x96" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/favicon-96x96.26e08763.png"><link rel="pluto-external-source" id="pluto-logo-big" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/logo.49a14041.svg"><link rel="pluto-external-source" id="pluto-logo-small" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/favicon_unsaturated.c11d4d33.svg"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/editor.b5bd8bc8.css"><script type="module" src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/index.e10141f8.js"></script><script type="module" src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/editor.runtime.99562e0b.js"></script><script defer>console.log("Pluto.jl, by Fons van der Plas (https://github.com/fonsp), Miko≈Çaj Bochenski (https://github.com/malyvsen), Michiel Dral (https://github.com/dralletje) and friends \uD83C\uDF08");</script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/index.65d5caa1.js" defer></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/index.2db9e182.js" defer></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/editor.21e3b1fd.js" defer></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/editor.97d6fa3c.js" defer></script><link rel="pluto-external-source" id="vmsg-wasm" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/vmsg.56bb9389.wasm"><link rel="pluto-external-source" id="arrow_up_circle_icon" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/arrow-up-circle-outline.3f146ffe.svg"><link rel="pluto-external-source" id="document_text_icon" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/document-text-outline.8d1e2333.svg"><link rel="pluto-external-source" id="help_circle_icon" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/help-circle-outline.a023036a.svg"><link rel="pluto-external-source" id="open_icon" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/open-outline.87533923.svg"><script id="iframe-resizer-content-window-script" src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/editor.69996afe.js" crossorigin defer></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/editor.fd8dcd31.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/editor.46c98966.css" type="text/css" media="all" data-pluto-file="hide-ui"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/editor.bf06bf57.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/editor.7a28f943.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/editor.d203a2fe.css" type="text/css"><script data-pluto-file="launch-parameters">
window.pluto_notebook_id = undefined;
window.pluto_isolated_cell_ids = undefined;
window.pluto_notebookfile = "data:text/julia;charset=utf-8;base64,IyMjIEEgUGx1dG8uamwgbm90ZWJvb2sgIyMjCiMgdjAuMjAuNQoKIz4gY3VzdG9tX2F0dHJzID0gWyJoaWRlLWVuYWJsZWQiXQoKdXNpbmcgTWFya2Rvd24KdXNpbmcgSW50ZXJhY3RpdmVVdGlscwoKIyBUaGlzIFBsdXRvIG5vdGVib29rIHVzZXMgQGJpbmQgZm9yIGludGVyYWN0aXZpdHkuIFdoZW4gcnVubmluZyB0aGlzIG5vdGVib29rIG91dHNpZGUgb2YgUGx1dG8sIHRoZSBmb2xsb3dpbmcgJ21vY2sgdmVyc2lvbicgb2YgQGJpbmQgZ2l2ZXMgYm91bmQgdmFyaWFibGVzIGEgZGVmYXVsdCB2YWx1ZSAoaW5zdGVhZCBvZiBhbiBlcnJvcikuCm1hY3JvIGJpbmQoZGVmLCBlbGVtZW50KQogICAgIyEgZm9ybWF0OiBvZmYKICAgIHJldHVybiBxdW90ZQogICAgICAgIGxvY2FsIGl2ID0gdHJ5IEJhc2UubG9hZGVkX21vZHVsZXNbQmFzZS5Qa2dJZChCYXNlLlVVSUQoIjZlNjk2YzcyLTY1NDItMjA2Ny03MjY1LTQyMjA2Yzc1NjE1MCIpLCAiQWJzdHJhY3RQbHV0b0RpbmdldGplcyIpXS5Cb25kcy5pbml0aWFsX3ZhbHVlIGNhdGNoOyBiIC0+IG1pc3Npbmc7IGVuZAogICAgICAgIGxvY2FsIGVsID0gJChlc2MoZWxlbWVudCkpCiAgICAgICAgZ2xvYmFsICQoZXNjKGRlZikpID0gQ29yZS5hcHBsaWNhYmxlKEJhc2UuZ2V0LCBlbCkgPyBCYXNlLmdldChlbCkgOiBpdihlbCkKICAgICAgICBlbAogICAgZW5kCiAgICAjISBmb3JtYXQ6IG9uCmVuZAoKIyDilZTilZDilaEgOTQ5YWMxZWYtYzUwMi00ZTI4LTgxZmYtZjk5YjBkMTlhYTAzCmJlZ2luCgl1c2luZyBQbHV0b0V4dHJhcy5TdHJ1Y3RCb25kTW9kdWxlCiAgICB1c2luZyBQbHV0b0V4dHJhcwoJdXNpbmcgUGx1dG9FeHRyYXM6IEV4dGVuZGVkVGFibGVPZkNvbnRlbnRzLCBFZGl0YWJsZQoJdXNpbmcgSHlwZXJ0ZXh0TGl0ZXJhbAoJdXNpbmcgUGx1dG9VSQplbmQKCiMg4pWU4pWQ4pWhIDlkNDQ1NWFmLTk2ZjEtNDZkNy1hNGYzLTQzNDQ5NWIxMWM4YQptZCIiIgojIFBhY2thZ2VzCiIiIgoKIyDilZTilZDilaEgNzA3MTc1YTktZDM1Ni00M2NmLTgwMzgtNjIwZWJjNDAxYzkzCkV4dGVuZGVkVGFibGVPZkNvbnRlbnRzKCkKCiMg4pWU4pWQ4pWhIGNiZmM2ZWVjLTg5OTEtNGE5Yy1hZGEwLTI5NWM4MDUyODU0ZAojIGh0bWwiIiIKIyA8c3R5bGU+CiMgbWFpbiB7CiMgCW1hcmdpbi1yaWdodDogMzUwcHggIWltcG9ydGFudDsKIyB9CiMgPC9zdHlsZT4KIyAiIiIKCiMg4pWU4pWQ4pWhIDQ4NDM5ODNjLWRmNjQtNGI5NC04NjM0LTdhMTBkOTQyM2E3MAptZCIiIgojIFN0cnVjdEJvbmQKIiIiCgojIOKVlOKVkOKVoSBhODk5NTIyNC04M2M2LTRmODItYjVhNS04N2E2Zjg2ZmM3YTAKbWQiIiIKR2VuZXJhdGluZyBhdXRvbWF0aWMgd2lkZ2V0cyBmb3IgY3VzdG9tIHN0cnVjdHMgaXMgcXVpdGUgc3RyYWlnaHRmb3J3YXJkIHdpdGggdGhlIGFpZCBvZiB0aGUgYEBmaWVsZGRhdGFgIG1hY3JvIGFuZCB0aGUgYFN0cnVjdEJvbmRgIHR5cGUuCgpUaGUgdG9wLWxlZnQgYXJyb3cgY2FuIGJlIHVzZWQgdG8gc2hvdy1oaWRlIHRoZSBmaWVsZCBlbGVtZW50cyAodXNlZnVsIGluc2lkZSBhIGBCb25kVGFibGVgLCBzaG93biBiZWxvdyksIHdoaWxlIHRoZSBncmVlbiB0b2dnbGUgb24gdGhlIHRvcC1yaWdodCBjYW4gYmUgdXNlZCB0byBkaXNhYmxlIHRlbXBvcmFyaWx5IHRoZSBzeW5jaCBiZXR3ZWVuIHRoZSBKUyB3aWRnZXRzIGFuZCB0aGUgYm9uZCB2YWx1ZXMgaW4gUGx1dG8uCiIiIgoKIyDilZTilZDilaEgOWUzNjAxZjUtZWZjMi00NGU5LTgzZDgtNWI2NWNlN2U5Y2NmCmJlZ2luCiIiIgoJc3RydWN0IEFTRAoiIiIKQmFzZS5Aa3dkZWYgc3RydWN0IEFTRAoJYTo6SW50IAoJYjo6SW50CgljOjpTdHJpbmcKCSJUaGlzIGZpZWxkIGlzIF9zcGVjaWFsXyIKCWQ6OlN0cmluZwoJZTo6SW50CmVuZApAdHlwZWFzZmllbGQgU3RyaW5nID0gVGV4dEZpZWxkKCkgIyBTdHJpbmcgZmllbGRzIHdpdGggbm8gc3RydWN0LXNwZWNpZmljIGRlZmF1bHQgd2lsbCB1c2UgdGhpcyAKQGZpZWxkZGF0YSBBU0QgYmVnaW4KCWEgPSAobWQiTWFya2Rvd24gZGVzY3JpcHRpb24sIGluY2x1ZGluZyBgYExhVGVYYGAiLCBTbGlkZXIoMToxMCkpCgliID0gKEBodGwoIjxzcGFuPkZpZWxkIHdpdGggPGI+SFRNTDwvYj4gZGVzY3JpcHRpb248L3NwYW4+IiksIFNjcnViYmFibGUoMToxMCkpCgljID0gKCJOb3JtYWwgU3RyaW5nIERlc2NyaXB0aW9uIiwgVGV4dEZpZWxkKCkpCgkjIGQgaGFzIG5vIEFTRC1zcGVjaWZpYyBjdXN0b20gYm9uZCwgc28gaXQgd2lsbCB1c2UgdGhlIGZpZWxkIGRvY3N0cmluZyBhcyBkZXNjcmlwdGlvbiBhbmQgdGhlIGRlZmF1bHQgU3RyaW5nIHdpZGdldCBhcyB3aWRnZXQKCWUgPSBTbGlkZXIoMjA6MjUpICMgTm8gZGVzY3JpcHRpb24sIGRlZmF1bHRzIHRvIHRoZSBmaWVsZG5hbWUgYXMgbm8gZG9jc3RyaW5nIGlzIHByZXNlbnQKZW5kCmFzZF9ib25kID0gQGJpbmQgYXNkIFN0cnVjdEJvbmQoQVNEOyBkZXNjcmlwdGlvbiA9ICJDdXN0b20gRGVzY3JpcHRpb24iKQplbmQKCiMg4pWU4pWQ4pWhIGNkYzBhN2FkLWEzYWMtNDI3MC1iNzA3LTM1YjE5MzlkYTI3Ngphc2QKCiMg4pWU4pWQ4pWhIGZlODkxYjRlLWY0NDAtNDgyMy1iNDNiLTcyNTcyZjZhNmMxMgptZCIiIgojIyBEZWZhdWx0IFR5cGUgV2lkZ2V0cwoiIiIKCiMg4pWU4pWQ4pWhIDg2YTgwMjI4LWY0OTUtNDNlOC1iMWQ0LWM5M2I3YjUyYzhkOApiZWdpbgoJQGt3ZGVmIHN0cnVjdCBNQUgKCQlhOjpJbnQKCWVuZAoJQGt3ZGVmIHN0cnVjdCBCT0gKCQltYWg6Ok1BSAoJZW5kCgkKCSMgVGhpcyB3aWxsIG1ha2UgdGhlIGRlZmF1bHQgd2lkZ2V0IGZvciBhbiBJbnQgYSBTbGlkZXIKCUB0eXBlYXNmaWVsZCBJbnQgPSBTbGlkZXIoMToxMCkKCSMgVGhpcyB3aWxsIG1ha2UgdGhlIGRlZmF1bHQgd2lkZ2V0IGZvciBmaWVsZHMgb2YgdHlwZSBBU0QgYSBwb3BvdXQgdGhhdCB3cmFwcyBhIFN0cnVjdEJvbmR7QVNEfQoJQHBvcG91dGFzZmllbGQgTUFICgkKCUBiaW5kIGJvaCBTdHJ1Y3RCb25kKEJPSCkKZW5kCgojIOKVlOKVkOKVoSAyMzU4ZjY4Ni0xOTUwLTQwZjktOWQ1Yy1kYWMyZDk4ZjRjMjQKYm9oCgojIOKVlOKVkOKVoSA0OTUxNjM3NC1mNjI1LTRhODQtYWM1Yy1mOTI0OTdkNDUwMjUKbWQiIiIKIyBATlRCb25kCiIiIgoKIyDilZTilZDilaEgOGNjNTNjZDItOTExNC00MDY3LWFiMGItMzdmZDhjZDc5MjQwCm1kIiIiClNvbWV0aW1lcyBjdXN0b20gc3RydWN0cyBhcmUgbm90IG5lZWRlZCBhbmQgaXQgd291bGQgYmUgdXNlZnVsIHRvIGp1c3QgdXNlIHRoZSBzYW1lIG5pY2UgYm9uZCBzdHJ1Y3R1cmUgb2YgYFN0cnVjdEJvbmRgIHRvIHNpbXBseSBjcmVhdGUgYXJiaXRyYXJ5IE5hbWVkVHVwbGVzLiAKClRoaXMgaXMgcG9zc2libGUgd2l0aCB0aGUgY29udmVuaWVuY2UgbWFjcm8gYEBOVEJvbmRgIHdoaWNoIGNhbiBiZSBjYWxsZWQgYXMgc2hvd24gYmVsb3cgdG8gY3JlYXRlIGEgbmljZSBkaXNwbGF5IGZvciBhbiBpbnRlcmFjdGl2ZSBib25kIGNyZWF0aW5nIGFuIGFyYml0cmFyeSBOYW1lZFR1cGxlLgoKVGhlIG1hY3JvIHNpbXBseSBjcmVhdGUgYSBgU3RydWN0Qm9uZGAgd3JhcHBpbmcgdGhlIGRlc2lyZWQgTmFtZWRUdXBsZSB0eXBlLgoiIiIKCiMg4pWU4pWQ4pWhIDBkYjUxZDM5LTdjMDUtNGUwMC1iOTUxLTdmZTc3NmE4ZTBmOQpudF9ib25kID0gQGJpbmQgbnQgQE5UQm9uZCAiTXkgRmFuY3kgTlR1cGxlIiBiZWdpbgoJYSA9ICgiRGVzY3JpcHRpb24iLCBTbGlkZXIoMToxMCkpCgliID0gKG1kIioqQm9sZCoqIGZpZWxkIiwgU2xpZGVyKDE6MTApKQoJYyA9IFNsaWRlcigxOjEwKSAjIE5vIGRlc2NyaXB0aW9uLCBkZWZhdWx0cyB0byB0aGUgbmFtZSBvZiB0aGUgZmllbGQKZW5kCgojIOKVlOKVkOKVoSBlMmI3OWE1OC1lNjZlLTRkNDAtODY3My00MTg4MjM3NTNiMzgKbnQKCiMg4pWU4pWQ4pWhIDQ2Njk5NWEyLWRmZDQtNDM3NC04MzM5LWJjMDIzMjAzOWIyNwptZCIiIgojIyB0cmFuc2Zvcm1lZF92YWx1ZQoiIiIKCiMg4pWU4pWQ4pWhIDRjYjEyOGFhLTdhZDgtNGQxNy1iY2VkLTM2ODQ1NzAzZTZhOAptZCIiIgpgQE5UQm9uZGAgaXMgYWxzbyBxdWl0ZSB1c2VmdWwgaW4gY29tYmluYXRpb24gd2l0aCBgdHJhbnNmb3JtZWRfdmFsdWVgIGZyb20gYFBsdXRvVUkuRXhwZXJpbWVudGFsYC4gRm9yIHRoaXMgcmVhc29uLCB0aGUgYEBOVEJvbmRgIG1hY3JvIHN1cHBvcnRzIGFuIG9wdGlvbmFsIHRoaXJkIGFyZ3VtZW50IHdoaWNoIHNoYWxsIGJlIGEgZnVuY3Rpb24gdGhhdCB3aGVuIHByb3ZpZGVkIGlzIGRpcmVjdGx5IHVzZWQgdG8gdHJhbnNmb3JtIHRoZSB2YWx1ZSBvZiB0aGUgd2lkZ2V0LgoiIiIKCiMg4pWU4pWQ4pWhIDc4NTU4MjZlLWNjYWEtNGMyNy1hMDYwLWY1Y2ViOTI3YmJlOApAYmluZCB0cmFuc2Zvcm1lZF92YWx1ZV9leGFtcGxlIEBOVEJvbmQgIlRyYW5zZm9ybWVkISIgYmVnaW4KCWEgPSBTbGlkZXIoMToxMCkKCWIgPSBTbGlkZXIoMToxMCkKZW5kIG50IC0+IG50LmEgKyBudC5iCgojIOKVlOKVkOKVoSAxZDU1NzNlZS04NzJlLTRkZmItYTc4NS0xYWM5ZTgzNmFkOTgKdHJhbnNmb3JtZWRfdmFsdWVfZXhhbXBsZQoKIyDilZTilZDilaEgZjY1YjMyMzEtZjJiMi00NWRjLWI3MmUtMWFkMzEwNzA4M2ZjCm1kIiIiCiMgU3RydWN0Qm9uZFNlbGVjdAoiIiIKCiMg4pWU4pWQ4pWhIDY3YzA4NjBiLWI0YzEtNDEyZC04NzBhLWE0Y2U0OTg3NDY1ZQptZCIiIgpTb21ldGltZXMsIG9uZSB3YW50cyB0byBjcmVhdGUgYSBtb3JlIGNvbXBsZXggYmluZGluZyB3aGVyZSB0aGUgbnVtYmVyIG9mIHBhcmFtZXRlcnMgdG8gY29udHJvbCBhIGJvbmQgY2FuIHZhcnkgZGVwZW5kaW5nIG9uIHNvbWUgb3RoZXIgdmFyaWFibGUuIFRoZSBgU3RydWN0Qm9uZFNlbGVjdGAgY2FuIGJlIG9mIGhlbHAgaW4gc29tZSBvZiB0aGVzZSBjYXNlcywgYnkgcHJvdmlkaW5nIGEgd2F5IHRvIHNlbGVjdCBvdXQgb2YgYSBudW1iZXIgb2YgYXJiaXRyYXJ5IGBTdHJ1Y3RCb25kc2AgKHdoaWNoIGluY2x1ZGUgYEBOVEJvbmRgKSBieSB1c2luZyBhIGRyb3Bkb3duIHRvIHNlbGVjdCB0aGUgb25lIHRvIGJlIGRpc3BsYXllZCBhbmQgdXNlZCBmb3IgZ2VuZXJhdGluZyB0aGUgYFN0cnVjdEJvbmRTZWxlY3RgIHdpZGdldCdzIG91dHB1dC4KClRoaXMgc3RydWN0dXJlIGNhbiBiZSBjb25zdHJ1Y3RlZCB3aXRoIGEgdmVjdG9yIG9mIGBTdHJ1Y3RCb25kYCBvciBgdHJhbnNmb3JtZWRfdmFsdWUoZiwgOjpTdHJ1Y3RCb25kKWAgZWxlbWVudHMsIGFuZCB3aWxsIHRha2UgY2FyZSBvZiBnZW5lcmF0aW5nIGFuIGFwcHJvcHJpYXRlIHdpZGdldCB0byBkaXNwbGF5IGFuZCBwcm9jZXNzIG9ubHkgdGhlIHNlbGVjdGVkIG9uZS4KClRoZSBtYWluIHNpZ25hdHVyZSBvZiB0aGUgY29uc3RydWN0b3IgaXMgdGhlIGZvbGxvd2luZzoKYGBganVsaWEKU3RydWN0Qm9uZFNlbGVjdChlbHM6OlZlY3RvcjsgZGVzY3JpcHRpb24gPSAiU3RydWN0Qm9uZFNlbGVjdCIsIGRlZmF1bHRfaWR4ID0gMSwgc2VsZWN0b3JfdGV4dCA9ICJTZWxlY3RvciIpCmBgYAoKVGhlIG5hbWVzIHRvIHNlbGVjdCB1cG9uIHdpbGwgYmUgdGFrZW4gZnJvbSB0aGUgYGRlc2NyaXB0aW9uYCBvZiB0aGUgcHJvdmlkZWQgYFN0cnVjdEJvbmRzYCwgd2hpbGUgdGhlIHRleHQgZGlzcGxheWVkIG5leHQgdG8gdGhlIF9zZWxlY3Rvcl8gd2lsbCBkZWZhdWx0IHRvIGBTZWxlY3RvcmAgYnV0IGNhbiBiZSBjdXN0b21pemVkIHdpdGggdGhlIGBzZWxlY3Rvcl90ZXh0YCBrd2FyZyB0byB0aGUgY29uc3RydWN0b3IuClRoZSBgZGVzY3JpcHRpb25gIGt3YXJnIGNhbiBiZSB1c2VkIHRvIGN1c3RvbWl6ZSB0aGUgdGV4dCBpbiB0aGUgd2lkZ2V0IGNvbnRhaW5lciAoc2ltaWxhciB0byB0aGUgc2FtZSBrd2FyZyBpbiBgU3RydWN0Qm9uZGAgYW5kIHRvIGBATlRCb25kYCkuIEZpbmFsbHksIHRoZSBgZGVmYXVsdF9pZHhgIHNob3VsZCBiZSBhbiBpbnRlZ2VyIGFuZCB3aWxsIHNlbGVjdCB3aGljaCBvZiB0aGUgcHJvdmlkZWQgYFN0cnVjdEJvbmRgcyB3aWxsIGJlIHNlbGVjdGVkIGFzIGRlZmF1bHQgd2hlbiBpbnN0YW50aWF0aW5nIHRoZSB3aWRnZXQuCiIiIgoKIyDilZTilZDilaEgYmQ1ZWMwODYtNTE1Ni00ZTdjLWE3MGItNWNhOWYwODliYjQ5CnNic19ib25kID0gQGJpbmQgc2JzIFN0cnVjdEJvbmRTZWxlY3QoWwoJQE5UQm9uZCAiY29zKGFyZykiIGJlZ2luCgkJYXJnID0gU2xpZGVyKHJhbmdlKDAsMSwxMDApKQoJZW5kIChudCAtPiBjb3MobnQuYXJnKSkgIyBXZSBuZWVkIHRvIHdyYXAgdGhlIGZ1bmN0aW9uIGdpdmVuIHRvIGBATlRCb25kYCBpbiAoKSB0byBhdm9pZCBwYXJzZSBwcm9ibGVtcyB3aGVuIHByb3ZpZGluZyBhIGZ1bmN0aW9uCglATlRCb25kICJhdGFuKHkseCkiIGJlZ2luCgkJeCA9IFNsaWRlcihyYW5nZSgwLDEwOyBzdGVwID0gMC4xKTsgZGVmYXVsdCA9IDMsIHNob3dfdmFsdWU9dHJ1ZSkKCQl5ID0gU2xpZGVyKHJhbmdlKDAsIDEwOyBzdGVwID0gMC4xKTsgZGVmYXVsdCA9IDUsIHNob3dfdmFsdWU9dHJ1ZSkKCWVuZCBudCAtPiBhdGFuKG50LnksIG50LngpCl07IGRlZmF1bHRfaWR4ID0gMiwgc2VsZWN0b3JfdGV4dCA9ICJPcHRpb25zOiIpCgojIOKVlOKVkOKVoSA3ODUzY2M3Zi00ZTU4LTQ0ZDEtOGQzYi1mOGQ0NzQ1NTY0ZTYKc2JzCgojIOKVlOKVkOKVoSA5ZDIzMzgyYy1jZjM1LTRiMjAtYTQ2Yy0wZjRlMmRlMTdmYzcKbWQiIiIKIyBAQm9uZHNMaXN0CiIiIgoKIyDilZTilZDilaEgOTU5YWNiNDAtMWZkNi00M2Y1LWExYTYtNzNhNmNlYWFlMWQ3Cm1kIiIiCkluIHNvbWUgY2FzZXMsIG9uZSBkb2VzIG5vdCB3YW50IHRvIGhhdmUgYSBzaW5nbGUgYm9uZCB3cmFwcGluZyBlaXRoZXIgYSBTdHJ1Y3R1cmUgb3IgYSBOYW1lZFR1cGxlIGJlY2F1c2Ugc2luZ2xlIGluZGVwZW5kZW50IGJvbmRzIGFyZSBtb3JlIGNvbnZlbmllbnQuCgpgQEJvbmRzTGlzdGAgaXMgYSBjb252ZW5pZW5jZSBtYWNybyB0byBjcmVhdGUgYW4gb2JqZWN0IG9mIHR5cGUgYEJvbmRzTGlzdGAgd2hpY2ggc2ltcGx5IGFsbG93IHRvIGFkZCBhIGRlc2NyaXB0aW9uIHRvIHNlcGFyYXRlIGJvbmRzIGFuZCBncm91cCB0aGVtIGFsbCB0b2dldGhlciBpbiBhIHRhYmxlLWxpa2UgZm9ybWF0IGVxdWl2YWxlbnQgdG8gdGhvc2Ugb2YgYFN0cnVjdEJvbmRgLgoKISEhIG5vdGUKCVVubGlrZSBgU3RydWN0Qm9uZGAsIGEgQm9uZHNMaXN0IGlzIGFscmVhZHkgY29tcG9zZWQgb2YgYm9uZCBjcmVhdGVkIHdpdGggYEBiaW5kYCBhbmQgaXQganVzdCBncm91cHMgdGhlbSB1cCB3aXRoIGEgZGVzY3JpcHRpb24uIFRoZSBvdXRwdXQgb2YgYEBCb25kc0xpc3RgIGlzIG5vdCBzdXBwb3NlZCB0byBiZSBib3VuZCB0byBhIHZhcmlhYmxlIHVzaW5nIGBAYmluZGAuXAoJVGhlIGJvbmRzIGdyb3VwZWQgaW4gYSBCb25kc0xpc3Qgc3RpbGwgYWN0IGFuZCB1cGRhdGUgaW5kZXBlbmRlbnRseSBmcm9tIG9uZSBhbm90aGVyLgoKU2VlIHRoZSBleGFtcGxlIGJlbG93IGZvciB1bmRlcnN0YW5kaW5nIHRoZSBzeW50aGF4LiBUaGUgaGVhZGVyIG9mIGEgQm9uZHNMaXN0IGlzIHNob3duIGluIGFuIG9yYW5nZSBiYWNrZ3JvdW5kIHRvIGVhc2lseSBkaWZmZXJlbnRpYXRlIGl0IGZyb20gYFN0cnVjdEJvbmRgLgoiIiIKCiMg4pWU4pWQ4pWhIDRkNjExNDI1LWM4ZTMtNGJjMy05MTJiLThiYzA0NjUzNjNiYwpibCA9IEBCb25kc0xpc3QgIk15IEdyb3VwIG9mIEJvbmRzIiBsZXQgdHYgPSBQbHV0b1VJLkV4cGVyaW1lbnRhbC50cmFuc2Zvcm1lZF92YWx1ZQoJICMgV2UgdXNlIHRyYW5zZm9ybWVkX3ZhbHVlIHRvIHRyYW5zbGF0ZSBHSHogdG8gSHogaW4gdGhlIGJvdW5kIHZhcmlhYmxlIGBmcmVxYAoJIkZyZXF1ZW5jeSBbR0h6XSIgPSBAYmluZCBmcmVxIHR2KHggLT4geCAqIDFlOSwgRWRpdGFibGUoMjA7IHN1ZmZpeCA9ICIgR0h6IikpCgltZCJBbHRpdHVkZSBgYGhgYCBbbV0iID0gQGJpbmQgYWx0IFNjcnViYmFibGUoMTAwOjEwOjIwMCkKZW5kCgojIOKVlOKVkOKVoSBhNTQ5MGE2Yi1kYzExLTQyYjctODdlMC1kMzg4NzBmYzU1ZTQKZnJlcQoKIyDilZTilZDilaEgNzA1ZTMwZmUtNzdhMy00YjA2LThiOTktMTgwNzI5MGVkZmZiCmFsdAoKIyDilZTilZDilaEgMmVlN2YyNmQtZjM4My00ZTdlLWE2OWEtOGZiNzI3MTc0NjdjCm1kIiIiCiMgUG9wb3V0CiIiIgoKIyDilZTilZDilaEgNzliZWJhODgtOTMyZi00MTQ3LWIzYTAtZDgyMWVmMWJjMWUyCm1kIiIiClRoZSBzdHJ1Y3R1cmVzIGFib3ZlIGNhbiBhbHNvIGJlIHVzZWQgbmVzdGVkIHdpdGhpbiBvbmUgYW5vdGhlci4gVG8gZmFjaWxpdGF0ZSBhY2Nlc3NpbmcgbmVzdGVkIHN0cnVjdHVyZXMsIG9uZSBjYW4gdXNlIHRoZSBgUG9wb3V0YCB0eXBlLgoKSW4gaXRzIHNpbXBsZSBmb3JtLCB5b3UgY2FuIGdpdmUgYW4gaW5zdGFuY2Ugb2YgYSBTdHJ1Y3RCb25kLCBhIGJvbmQgd3JhcHBpbmcgYSBTdHJ1Y3RCb25kIG9yIGEgQm9uZHNMaXN0IGFzIGlucHV0IHRvIFBvcG91dCB0byBjcmVhdGUgYSB0YWJsZSB0aGF0IGlzIGhpZGRlbiBiZWhpbmQgYSBwb3B1cCB3aW5kb3cuCklmIGFuIGluc3RhbmNlIHByZXNlbnQsIGJ1dCB5b3Ugd2FudCBhIGN1c3RvbSB0eXBlIGZvciB3aGljaCB5b3UgaGF2ZSBkZWZpbmVkIGN1c3RvbSBib25kcyBhbmQgZGVzY3JpcHRpb25zIHdpdGggYEBmaWVsZGRhdGFgIHRvIGFwcGVhciBhcyBwb3BvdXQsIHlvdSBjYW4gdXNlIHRoZSBmdW5jdGlvbiBgcG9wb3V0d3JhcChUWVBFKWAgdG8gZ2VuZXJhdGUgYSBzbWFsbCBpY29uIHdoaWNoIGhpZGVzIGEgcG9wdXAgY29udGFpbmluZyB0aGUgYFN0cnVjdEJvbmRgIG9mIHRoZSBwcm92aWRlZCB0eXBlIGBUWVBFYC4KClRoZSBTdHJ1Y3RCb25kIHRhYmxlIGFwcGVhcnMgb24gaG92ZXIgdXBvbiB0aGUgaWNvbiwgY2FuIGJlIG1hZGUgZml4ZWQgYnkgY2xpY2tpbmcgb24gdGhlIGljb24gYW5kIGNhbiB0aGVuIGJlIG1vdmVkIGFyb3VuZCBvciByZXNpemVkLgpBIGRvdWJsZSBjbGljayBvbiB0aGUgaGVhZGVyIG9mIHRoZSBwb3BvdXQgaGlkZXMgaXQgYWdhaW46CiIiIgoKIyDilZTilZDilaEgNjNkNmMyZGYtYTQxMS00MDdjLWFmMTEtNGY1ZDA5ZmJiMzIyCmJlZ2luCkJhc2UuQGt3ZGVmIHN0cnVjdCBMT0wKCWE6OkludCAKCWI6OkludAplbmQKQGZpZWxkZGF0YSBMT0wgYmVnaW4KCWEgPSAobWQiV29uZGVyISIsIFNsaWRlcigxOjEwKSkKCWIgPSAoQGh0bCgiPHNwYW4+RmllbGQgQjwvc3Bhbj4iKSwgU2NydWJiYWJsZSgxOjEwKSkKZW5kCmVuZAoKIyDilZTilZDilaEgNjMzMDI5YWYtOGNhYy00MjZlLWIzNWMtYzlmYjM5MzhiNzg0CkBiaW5kIGxvbF9wb3AgcG9wb3V0d3JhcChMT0wpCgojIOKVlOKVkOKVoSAwNjViYWQ3My01ZmE4LTQ0OTYtYmEzMy05ZTY2OTQwYjU4MDYKbG9sX3BvcAoKIyDilZTilZDilaEgMjA3M2YxMWUtODE5Ni00ZWJjLTkyMmYtNWZhNTg5ZTkxNzk3Cm1kIiIiClRoZSBhYmlsaXR5IHRvIGFsc28gd3JhcCBwcmUtZXhpc3RpbmcgYm9uZHMgYXJvdW5kIFN0cnVjdEJvbmRzIGlzIGNvbnZlbmllbnQgZm9yIG9yZ2FuaXppbmcgdGhlIHZhcmlvdXMgYm9uZHMgb25lIGhhdmUgaW4gYSBgQm9uZHNMaXN0YCBvciBgQm9uZFRhYmxlYAoKQXMgYW4gZXhhbXBsZSwgb25lIGNhbiBjcmVhdGUgYSBgQm9uZHNMaXN0YCBjb250YWluaW5nIHRoZSB0d28gYFN0cnVjdEJvbmRgIGJvbmRzIGdlbmVyYXRlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoaXMgbm90ZWJvb2sgd2l0aCB0aGUgZm9sbHdpbmcgY29kZS4KIiIiCgojIOKVlOKVkOKVoSA4MTFjZjc4Yi1lODcwLTQ1YmItOTE3My04OWEzYjNkNDk1ZjUKYmxjID0gQEJvbmRzTGlzdCAiUG9wb3V0IENvbnRhaW5lciIgYmVnaW4KCSJTdHJ1Y3R1cmUgQVNEIiA9IFBvcG91dChhc2RfYm9uZCkKCSJOYW1lZFR1cGxlIiA9IFBvcG91dChudF9ib25kKQoJIlN0cnVjdEJvbmRTZWxlY3QiID0gUG9wb3V0KHNic19ib25kKQplbmQKCiMg4pWU4pWQ4pWhIGU3ZDY3NjYyLTc3YjMtNDgyYS1iMDMyLThkYjRhZmJjMDFhNgphc2QKCiMg4pWU4pWQ4pWhIDk5NmI0MDg1LTExNGMtNDhmNC05ZjkwLThlNjM3ZjI5YzA2YQpudAoKIyDilZTilZDilaEgM2EwNjZiZjQtMzQ2Ni00NjllLTkwZDAtNmIxNGJlM2VkOGQ1Cm1kIiIiCiMgQm9uZFRhYmxlCiIiIgoKIyDilZTilZDilaEgMzIxM2Q5NzctN2I2NS00M2IwLWE4ODEtMTBmY2MyNTIzZjE0Cm1kIiIiClRoZSBmaW5hbCBjb252ZW5pZW5jZSBzdHJ1Y3R1cmUgcHJvdmlkZWQgYnkgdGhpcyBtb2R1bGUgaXMgdGhlIGBCb25kVGFibGVgLiBJdCBjYW4gYmUgY3JlYXRlZCB0byBncm91cCBhIGxpc3Qgb2YgYm9uZHMgaW4gYSBmbG9hdGluZyB0YWJsZSB0aGF0IHN0YXlzIG9uIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIG5vdGVib29rIChzaW1pbGFyIHRvIHRoZSBUYWJsZU9mQ29udGVudHMgb2YgUGx1dG9VSSkgYW5kIGNhbiBiZSBtb3ZlZCBhcm91bmQgYW5kIHJlc2l6ZWQgb3IgaGlkZGVuIGZvciBjb252ZW5pZW5jZS4KClRoZSBCb25kVGFibGUgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBlaXRoZXIgd2l0aCBib25kcyBjb250YWluaW5nIGBTdHJ1Y3RCb25kYCBvciB3aXRoIGBCb25kc0xpc3RgLiBGdXR1cmUgdHlwZXMgd2l0aCBzaW1pbGFyIHN0cnVjdHVyZSB3aWxsIGFsc28gYmUgYWRkZWQuCgpIZXJlIGlzIGFuIGV4YW1wbGUgb2YgYSBib25kdGFibGUgY29udGFpbmluZyBhbGwgdGhlIGV4YW1wbGVzIG9mIHRoaXMgbm90ZWJvb2suCiIiIgoKIyDilZTilZDilaEgOTAzZmVlNjctNmIyMy00MWRjLWEwM2QtZjEwNDBiNjk2YmU2CkJvbmRUYWJsZShbCglhc2RfYm9uZCwKCW50X2JvbmQsCglibCwKCWJsYwpdOyBkZXNjcmlwdGlvbiA9ICJNeSBCb25kcyIpCgojIOKVlOKVkOKVoSAwOGQ3MTFjMC1lMmNjLTQ0NDQtOTRjYS0wYzRjM2NmZTkwMWYKbnQKCiMg4pWU4pWQ4pWhIDAzZTlkNzVlLWU2YzktNDE5OS05MzNiLTJiZTMwNmRhZjk3OAphc2QKCiMg4pWU4pWQ4pWhIDI2ZDExNjAwLTI4MjctNGUwOC05MTk1LTEwOWM4YThiZGRjMwpmcmVxCgojIOKVlOKVkOKVoSBiZTJhNzgyMC1lMTk0LTQ0MTAtYjAwZC1hOTMzMmIyMzRhZDYKYWx0CgojIOKVlOKVkOKVoSAwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDEKUExVVE9fUFJPSkVDVF9UT01MX0NPTlRFTlRTID0gIiIiCltkZXBzXQpIeXBlcnRleHRMaXRlcmFsID0gImFjMTE5MmE4LWY0YjMtNGJmZS1iYTIyLWFmNWI5MmNkM2FiMiIKUGx1dG9FeHRyYXMgPSAiZWQ1ZDAzMDEtNDc3NS00Njc2LWI3ODgtY2Y3MWU2NmZmOGVkIgpQbHV0b1VJID0gIjdmOTA0ZGZlLWI4NWUtNGZmNi1iNDYzLWRhZTIyOTIzOTZhOCIKIiIiCgojIOKVlOKVkOKVoSAwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDIKUExVVE9fTUFOSUZFU1RfVE9NTF9DT05URU5UUyA9ICIiIgojIFRoaXMgZmlsZSBpcyBtYWNoaW5lLWdlbmVyYXRlZCAtIGVkaXRpbmcgaXQgZGlyZWN0bHkgaXMgbm90IGFkdmlzZWQKCmp1bGlhX3ZlcnNpb24gPSAiMS4xMS40IgptYW5pZmVzdF9mb3JtYXQgPSAiMi4wIgpwcm9qZWN0X2hhc2ggPSAiMGNhMDU2N2Y1ZjA2MjE0MzhmYzY5ODAwYzg1YmExODY3ZDNiNTZlNCIKCltbZGVwcy5BYnN0cmFjdFBsdXRvRGluZ2V0amVzXV0KZGVwcyA9IFsiUGtnIl0KZ2l0LXRyZWUtc2hhMSA9ICI2ZTFkMmEzNWYyZjkwYTRiYzdjMmVkOTgwNzliMmJhMDljMzViODNhIgp1dWlkID0gIjZlNjk2YzcyLTY1NDItMjA2Ny03MjY1LTQyMjA2Yzc1NjE1MCIKdmVyc2lvbiA9ICIxLjMuMiIKCltbZGVwcy5BcmdUb29sc11dCnV1aWQgPSAiMGRhZDg0YzUtZDExMi00MmU2LThkMjgtZWYxMmRhYmI3ODlmIgp2ZXJzaW9uID0gIjEuMS4yIgoKW1tkZXBzLkFydGlmYWN0c11dCnV1aWQgPSAiNTZmMjJkNzItZmQ2ZC05OGYxLTAyZjAtMDhkZGMwOTA3YzMzIgp2ZXJzaW9uID0gIjEuMTEuMCIKCltbZGVwcy5CYXNlNjRdXQp1dWlkID0gIjJhMGY0NGUzLTZjODMtNTViZC04N2U0LWIxOTc4ZDk4YmQ1ZiIKdmVyc2lvbiA9ICIxLjExLjAiCgpbW2RlcHMuQ29sb3JUeXBlc11dCmRlcHMgPSBbIkZpeGVkUG9pbnROdW1iZXJzIiwgIlJhbmRvbSJdCmdpdC10cmVlLXNoYTEgPSAiYjEwZDBiNjU2NDFkNTdiOGI0ZDVlMjM0NDQ2NTgyZGU1MDQ3MDUwZCIKdXVpZCA9ICIzZGEwMDJmNy01OTg0LTVhNjAtYjhhNi1jYmI2NmMwYjMzM2YiCnZlcnNpb24gPSAiMC4xMS41IgoKW1tkZXBzLkNvbXBpbGVyU3VwcG9ydExpYnJhcmllc19qbGxdXQpkZXBzID0gWyJBcnRpZmFjdHMiLCAiTGliZGwiXQp1dWlkID0gImU2NmUwMDc4LTcwMTUtNTQ1MC05MmY3LTE1ZmJkOTU3ZjJhZSIKdmVyc2lvbiA9ICIxLjEuMSswIgoKW1tkZXBzLkRhdGVzXV0KZGVwcyA9IFsiUHJpbnRmIl0KdXVpZCA9ICJhZGUyY2E3MC0zODkxLTU5NDUtOThmYi1kYzA5OTQzMmUwNmEiCnZlcnNpb24gPSAiMS4xMS4wIgoKW1tkZXBzLkRvY1N0cmluZ0V4dGVuc2lvbnNdXQpnaXQtdHJlZS1zaGExID0gImU3YjdlNmYxNzg1MjVkMTdjNzIwYWI5YzA4MWU0ZWYwNDQyOWY4NjAiCnV1aWQgPSAiZmZiZWQxNTQtNGVmNy01NDJkLWJiYjctYzA5ZDNhNzlmY2FlIgp2ZXJzaW9uID0gIjAuOS40IgoKW1tkZXBzLkRvd25sb2Fkc11dCmRlcHMgPSBbIkFyZ1Rvb2xzIiwgIkZpbGVXYXRjaGluZyIsICJMaWJDVVJMIiwgIk5ldHdvcmtPcHRpb25zIl0KdXVpZCA9ICJmNDNhMjQxZi1jMjBhLTRhZDQtODUyYy1mNmIxMjQ3ODYxYzYiCnZlcnNpb24gPSAiMS42LjAiCgpbW2RlcHMuRmlsZVdhdGNoaW5nXV0KdXVpZCA9ICI3YjFmNjA3OS03MzdhLTU4ZGMtYjhiYy03YTJjYTVjMWI1ZWUiCnZlcnNpb24gPSAiMS4xMS4wIgoKW1tkZXBzLkZpeGVkUG9pbnROdW1iZXJzXV0KZGVwcyA9IFsiU3RhdGlzdGljcyJdCmdpdC10cmVlLXNoYTEgPSAiMDU4ODJkNjk5NWFlNWMxMmJiNWYzNmRkMmVkM2Y2MWM5OGNiYjE3MiIKdXVpZCA9ICI1M2M0OGMxNy00YTdkLTVjYTItOTBjNS03OWI3ODk2ZWVhOTMiCnZlcnNpb24gPSAiMC44LjUiCgpbW2RlcHMuSHlwZXJzY3JpcHRdXQpkZXBzID0gWyJUZXN0Il0KZ2l0LXRyZWUtc2hhMSA9ICIxNzkyNjdjZmE1ZTcxMjc2MGNkNDNkY2FlMzg1ZDdlYTkwY2MyNWE0Igp1dWlkID0gIjQ3ZDJlZDJiLTM2ZGUtNTBjZi1iZjg3LTQ5YzJjZjRiOGI5MSIKdmVyc2lvbiA9ICIwLjAuNSIKCltbZGVwcy5IeXBlcnRleHRMaXRlcmFsXV0KZGVwcyA9IFsiVHJpY2tzIl0KZ2l0LXRyZWUtc2hhMSA9ICI3MTM0ODEwYjFhZmNlMDRiYmMxMDQ1Y2ExOTg1ZmJlODFjZTE3NjUzIgp1dWlkID0gImFjMTE5MmE4LWY0YjMtNGJmZS1iYTIyLWFmNWI5MmNkM2FiMiIKdmVyc2lvbiA9ICIwLjkuNSIKCltbZGVwcy5JT0NhcHR1cmVdXQpkZXBzID0gWyJMb2dnaW5nIiwgIlJhbmRvbSJdCmdpdC10cmVlLXNoYTEgPSAiYjZkNmJmZGQ3Y2UyNWIwZjliMmY2YjNkZDU2YjI2NzNhNjZjODc3MCIKdXVpZCA9ICJiNWY4MWU1OS02NTUyLTRkMzItYjFmMC1jMDcxYjAyMWJmODkiCnZlcnNpb24gPSAiMC4yLjUiCgpbW2RlcHMuSW50ZXJhY3RpdmVVdGlsc11dCmRlcHMgPSBbIk1hcmtkb3duIl0KdXVpZCA9ICJiNzdlMGE0Yy1kMjkxLTU3YTAtOTBlOC04ZGIyNWEyN2EyNDAiCnZlcnNpb24gPSAiMS4xMS4wIgoKW1tkZXBzLkpTT05dXQpkZXBzID0gWyJEYXRlcyIsICJNbWFwIiwgIlBhcnNlcnMiLCAiVW5pY29kZSJdCmdpdC10cmVlLXNoYTEgPSAiMzFlOTk2ZjBhMTVjN2IyODBiYTlmNzY2MzZiM2ZmOWUyYWU1OGM5YSIKdXVpZCA9ICI2ODJjMDZhMC1kZTZhLTU0YWItYTE0Mi1jOGIxY2Y3OWNkZTYiCnZlcnNpb24gPSAiMC4yMS40IgoKW1tkZXBzLkxpYkNVUkxdXQpkZXBzID0gWyJMaWJDVVJMX2psbCIsICJNb3ppbGxhQ0FDZXJ0c19qbGwiXQp1dWlkID0gImIyNzAzMmMyLWEzZTctNTBjOC04MGNkLTJkMzZkYmNiZmQyMSIKdmVyc2lvbiA9ICIwLjYuNCIKCltbZGVwcy5MaWJDVVJMX2psbF1dCmRlcHMgPSBbIkFydGlmYWN0cyIsICJMaWJTU0gyX2psbCIsICJMaWJkbCIsICJNYmVkVExTX2psbCIsICJabGliX2psbCIsICJuZ2h0dHAyX2psbCJdCnV1aWQgPSAiZGVhYzliNDctOGJjNy01OTA2LWEwZmUtMzVhYzU2ZGM4NGMwIgp2ZXJzaW9uID0gIjguNi4wKzAiCgpbW2RlcHMuTGliR2l0Ml1dCmRlcHMgPSBbIkJhc2U2NCIsICJMaWJHaXQyX2psbCIsICJOZXR3b3JrT3B0aW9ucyIsICJQcmludGYiLCAiU0hBIl0KdXVpZCA9ICI3NmY4NTQ1MC01MjI2LTViNWEtOGVhYS01MjlhZDA0NWI0MzMiCnZlcnNpb24gPSAiMS4xMS4wIgoKW1tkZXBzLkxpYkdpdDJfamxsXV0KZGVwcyA9IFsiQXJ0aWZhY3RzIiwgIkxpYlNTSDJfamxsIiwgIkxpYmRsIiwgIk1iZWRUTFNfamxsIl0KdXVpZCA9ICJlMzdkYWY2Ny01OGE0LTU5MGEtOGU5OS1iMDI0NWRkMmZmYzUiCnZlcnNpb24gPSAiMS43LjIrMCIKCltbZGVwcy5MaWJTU0gyX2psbF1dCmRlcHMgPSBbIkFydGlmYWN0cyIsICJMaWJkbCIsICJNYmVkVExTX2psbCJdCnV1aWQgPSAiMjk4MTZiNWEtYjlhYi01NDZmLTkzM2MtZWRhZDE4ODZkZmE4Igp2ZXJzaW9uID0gIjEuMTEuMCsxIgoKW1tkZXBzLkxpYmRsXV0KdXVpZCA9ICI4ZjM5OWRhMy0zNTU3LTU2NzUtYjVmZi1mYjgzMmM5N2NiZGIiCnZlcnNpb24gPSAiMS4xMS4wIgoKW1tkZXBzLkxpbmVhckFsZ2VicmFdXQpkZXBzID0gWyJMaWJkbCIsICJPcGVuQkxBU19qbGwiLCAibGliYmxhc3RyYW1wb2xpbmVfamxsIl0KdXVpZCA9ICIzN2UyZTQ2ZC1mODlkLTUzOWQtYjRlZS04MzhmY2NjYzljOGUiCnZlcnNpb24gPSAiMS4xMS4wIgoKW1tkZXBzLkxvZ2dpbmddXQp1dWlkID0gIjU2ZGRiMDE2LTg1N2ItNTRlMS1iODNkLWRiNGQ1OGRiNTU2OCIKdmVyc2lvbiA9ICIxLjExLjAiCgpbW2RlcHMuTUlNRXNdXQpnaXQtdHJlZS1zaGExID0gImM2NGQ5NDM1ODdmNzE4N2U3NTExNjJiM2I4NDQ0NWJiYmQ3OWY2OTEiCnV1aWQgPSAiNmM2ZTJlNmMtMzAzMC02MzJkLTczNjktMmQ2YzY5NjE2ZDY1Igp2ZXJzaW9uID0gIjEuMS4wIgoKW1tkZXBzLk1hcmtkb3duXV0KZGVwcyA9IFsiQmFzZTY0Il0KdXVpZCA9ICJkNmY0Mzc2ZS1hZWY1LTUwNWEtOTZjMS05YzAyNzM5NDYwN2EiCnZlcnNpb24gPSAiMS4xMS4wIgoKW1tkZXBzLk1iZWRUTFNfamxsXV0KZGVwcyA9IFsiQXJ0aWZhY3RzIiwgIkxpYmRsIl0KdXVpZCA9ICJjOGZmZDljMy0zMzBkLTU4NDEtYjc4ZS0wODE3ZDcxNDVmYTEiCnZlcnNpb24gPSAiMi4yOC42KzAiCgpbW2RlcHMuTW1hcF1dCnV1aWQgPSAiYTYzYWQxMTQtN2UxMy01MDg0LTk1NGYtZmUwMTJjNjc3ODA0Igp2ZXJzaW9uID0gIjEuMTEuMCIKCltbZGVwcy5Nb3ppbGxhQ0FDZXJ0c19qbGxdXQp1dWlkID0gIjE0YTM2MDZkLWY2MGQtNTYyZS05MTIxLTEyZDk3MmNkODE1OSIKdmVyc2lvbiA9ICIyMDIzLjEyLjEyIgoKW1tkZXBzLk5ldHdvcmtPcHRpb25zXV0KdXVpZCA9ICJjYTU3NTkzMC1jMmUzLTQzYTktYWNlNC0xZTk4OGIyYzE5MDgiCnZlcnNpb24gPSAiMS4yLjAiCgpbW2RlcHMuT3BlbkJMQVNfamxsXV0KZGVwcyA9IFsiQXJ0aWZhY3RzIiwgIkNvbXBpbGVyU3VwcG9ydExpYnJhcmllc19qbGwiLCAiTGliZGwiXQp1dWlkID0gIjQ1MzY2MjlhLWM1MjgtNWI4MC1iZDQ2LWY4MGQ1MWM1YjM2MyIKdmVyc2lvbiA9ICIwLjMuMjcrMSIKCltbZGVwcy5QYXJzZXJzXV0KZGVwcyA9IFsiRGF0ZXMiLCAiUHJlY29tcGlsZVRvb2xzIiwgIlVVSURzIl0KZ2l0LXRyZWUtc2hhMSA9ICI0NGY2YzFmMzhmNzdjYWZlZjk0NTBmZjkzOTQ2YzUzYmQ5Y2ExNmZmIgp1dWlkID0gIjY5ZGUwYTY5LTFkZGQtNTAxNy05MzU5LTJiZjBiMDJkYzlmMCIKdmVyc2lvbiA9ICIyLjguMiIKCltbZGVwcy5Qa2ddXQpkZXBzID0gWyJBcnRpZmFjdHMiLCAiRGF0ZXMiLCAiRG93bmxvYWRzIiwgIkZpbGVXYXRjaGluZyIsICJMaWJHaXQyIiwgIkxpYmRsIiwgIkxvZ2dpbmciLCAiTWFya2Rvd24iLCAiUHJpbnRmIiwgIlJhbmRvbSIsICJTSEEiLCAiVE9NTCIsICJUYXIiLCAiVVVJRHMiLCAicDd6aXBfamxsIl0KdXVpZCA9ICI0NGNmZTk1YS0xZWIyLTUyZWEtYjY3Mi1lMmFmZGY2OWI3OGYiCnZlcnNpb24gPSAiMS4xMS4wIgp3ZWFrZGVwcyA9IFsiUkVQTCJdCgogICAgW2RlcHMuUGtnLmV4dGVuc2lvbnNdCiAgICBSRVBMRXh0ID0gIlJFUEwiCgpbW2RlcHMuUGx1dG9FeHRyYXNdXQpkZXBzID0gWyJBYnN0cmFjdFBsdXRvRGluZ2V0amVzIiwgIkRvY1N0cmluZ0V4dGVuc2lvbnMiLCAiSHlwZXJ0ZXh0TGl0ZXJhbCIsICJJbnRlcmFjdGl2ZVV0aWxzIiwgIk1hcmtkb3duIiwgIlBsdXRvVUkiLCAiUkVQTCIsICJSYW5kb20iXQpnaXQtdHJlZS1zaGExID0gIjNkM2VjNDA4MjVkMjQ4YjA5NmZkNGFmZTc4MGRiNzI5MTljNGI5NzkiCnJlcG8tcmV2ID0gIjY5ODA1ZGFjYjM0MDA5NzI1NzQ2MmNlYjUzNWY4ZGRlYWM0MDZhOTAiCnJlcG8tdXJsID0gImh0dHBzOi8vZ2l0aHViLmNvbS9kaXNiZXJkL1BsdXRvRXh0cmFzLmpsLmdpdCIKdXVpZCA9ICJlZDVkMDMwMS00Nzc1LTQ2NzYtYjc4OC1jZjcxZTY2ZmY4ZWQiCnZlcnNpb24gPSAiMC43LjE0IgoKW1tkZXBzLlBsdXRvVUldXQpkZXBzID0gWyJBYnN0cmFjdFBsdXRvRGluZ2V0amVzIiwgIkJhc2U2NCIsICJDb2xvclR5cGVzIiwgIkRhdGVzIiwgIkZpeGVkUG9pbnROdW1iZXJzIiwgIkh5cGVyc2NyaXB0IiwgIkh5cGVydGV4dExpdGVyYWwiLCAiSU9DYXB0dXJlIiwgIkludGVyYWN0aXZlVXRpbHMiLCAiSlNPTiIsICJMb2dnaW5nIiwgIk1JTUVzIiwgIk1hcmtkb3duIiwgIlJhbmRvbSIsICJSZWV4cG9ydCIsICJVUklzIiwgIlVVSURzIl0KZ2l0LXRyZWUtc2hhMSA9ICJkM2RlMjY5NGI1MmEwMWNlNjFhMDM2ZjE4ZWE5YzBmNjFjNGE5MjMwIgp1dWlkID0gIjdmOTA0ZGZlLWI4NWUtNGZmNi1iNDYzLWRhZTIyOTIzOTZhOCIKdmVyc2lvbiA9ICIwLjcuNjIiCgpbW2RlcHMuUHJlY29tcGlsZVRvb2xzXV0KZGVwcyA9IFsiUHJlZmVyZW5jZXMiXQpnaXQtdHJlZS1zaGExID0gIjVhYTM2ZjcwNDlhNjNhMTUyOGZlOGY3YzNmMjExMzQxM2ZmZDRlMWYiCnV1aWQgPSAiYWVhN2JlMDEtNmE2YS00MDgzLTg4NTYtOGE2ZTY3MDRkODJhIgp2ZXJzaW9uID0gIjEuMi4xIgoKW1tkZXBzLlByZWZlcmVuY2VzXV0KZGVwcyA9IFsiVE9NTCJdCmdpdC10cmVlLXNoYTEgPSAiOTMwNmY2MDg1MTY1ZDI3MGY3ZTNkYjAyYWYyNmE0MDBkNTgwZjVjNiIKdXVpZCA9ICIyMTIxNmM2YS0yZTczLTY1NjMtNmU2NS03MjY1NjY2NTcyNTAiCnZlcnNpb24gPSAiMS40LjMiCgpbW2RlcHMuUHJpbnRmXV0KZGVwcyA9IFsiVW5pY29kZSJdCnV1aWQgPSAiZGUwODU4ZGEtNjMwMy01ZTY3LTg3NDQtNTFlZGRlZWViOGQ3Igp2ZXJzaW9uID0gIjEuMTEuMCIKCltbZGVwcy5SRVBMXV0KZGVwcyA9IFsiSW50ZXJhY3RpdmVVdGlscyIsICJNYXJrZG93biIsICJTb2NrZXRzIiwgIlN0eWxlZFN0cmluZ3MiLCAiVW5pY29kZSJdCnV1aWQgPSAiM2ZhMGNkOTYtZWVmMS01Njc2LThhNjEtYjNiODc1OGJiZmZiIgp2ZXJzaW9uID0gIjEuMTEuMCIKCltbZGVwcy5SYW5kb21dXQpkZXBzID0gWyJTSEEiXQp1dWlkID0gIjlhM2Y4Mjg0LWEyYzktNWYwMi05YTExLTg0NTk4MGExZmQ1YyIKdmVyc2lvbiA9ICIxLjExLjAiCgpbW2RlcHMuUmVleHBvcnRdXQpnaXQtdHJlZS1zaGExID0gIjQ1ZTQyODQyMTY2NjA3M2VhYjZmMmRhNWM5ZDMxMGQ5OWJiMTJmOWIiCnV1aWQgPSAiMTg5YTM4NjctMzA1MC01MmRhLWE4MzYtZTYzMGJhOTBhYjY5Igp2ZXJzaW9uID0gIjEuMi4yIgoKW1tkZXBzLlNIQV1dCnV1aWQgPSAiZWE4ZTkxOWMtMjQzYy01MWFmLTg4MjUtYWFhNjNjZDcyMWNlIgp2ZXJzaW9uID0gIjAuNy4wIgoKW1tkZXBzLlNlcmlhbGl6YXRpb25dXQp1dWlkID0gIjllODhiNDJhLWY4MjktNWIwYy1iYmU5LTllOTIzMTk4MTY2YiIKdmVyc2lvbiA9ICIxLjExLjAiCgpbW2RlcHMuU29ja2V0c11dCnV1aWQgPSAiNjQ2MmZlMGItMjRkZS01NjMxLTg2OTctZGQ5NDFmOTBkZWNjIgp2ZXJzaW9uID0gIjEuMTEuMCIKCltbZGVwcy5TdGF0aXN0aWNzXV0KZGVwcyA9IFsiTGluZWFyQWxnZWJyYSJdCmdpdC10cmVlLXNoYTEgPSAiYWUzYmIxZWIzYmJhMDc3Y2QyNzZiYzVjZmMzMzdjYzY1YzMwNzVjMCIKdXVpZCA9ICIxMDc0NWIxNi03OWNlLTExZTgtMTFmOS03ZDEzYWQzMmEzYjIiCnZlcnNpb24gPSAiMS4xMS4xIgoKICAgIFtkZXBzLlN0YXRpc3RpY3MuZXh0ZW5zaW9uc10KICAgIFNwYXJzZUFycmF5c0V4dCA9IFsiU3BhcnNlQXJyYXlzIl0KCiAgICBbZGVwcy5TdGF0aXN0aWNzLndlYWtkZXBzXQogICAgU3BhcnNlQXJyYXlzID0gIjJmMDExODRlLWUyMmItNWRmNS1hZTYzLWQ5M2ViYWI2OWVhZiIKCltbZGVwcy5TdHlsZWRTdHJpbmdzXV0KdXVpZCA9ICJmNDg5MzM0Yi1kYTNkLTRjMmUtYjhmMC1lNDc2ZTEyYzE2MmIiCnZlcnNpb24gPSAiMS4xMS4wIgoKW1tkZXBzLlRPTUxdXQpkZXBzID0gWyJEYXRlcyJdCnV1aWQgPSAiZmEyNjdmMWYtNjA0OS00ZjE0LWFhNTQtMzNiYWZhZTFlZDc2Igp2ZXJzaW9uID0gIjEuMC4zIgoKW1tkZXBzLlRhcl1dCmRlcHMgPSBbIkFyZ1Rvb2xzIiwgIlNIQSJdCnV1aWQgPSAiYTRlNTY5YTYtZTgwNC00ZmE0LWIwZjMtZWVmN2ExZDViMTNlIgp2ZXJzaW9uID0gIjEuMTAuMCIKCltbZGVwcy5UZXN0XV0KZGVwcyA9IFsiSW50ZXJhY3RpdmVVdGlscyIsICJMb2dnaW5nIiwgIlJhbmRvbSIsICJTZXJpYWxpemF0aW9uIl0KdXVpZCA9ICI4ZGZlZDYxNC1lMjJjLTVlMDgtODVlMS02NWM1MjM0ZjBiNDAiCnZlcnNpb24gPSAiMS4xMS4wIgoKW1tkZXBzLlRyaWNrc11dCmdpdC10cmVlLXNoYTEgPSAiNmNhZTc5NWE1YTkzMTNiYmI0ZjYwNjgzZjcyNjMzMThmYzdkMTUwNSIKdXVpZCA9ICI0MTBhNGI0ZC00OWU0LTRmYmMtYWI2ZC1jYjcxYjE3YjM3NzUiCnZlcnNpb24gPSAiMC4xLjEwIgoKW1tkZXBzLlVSSXNdXQpnaXQtdHJlZS1zaGExID0gImNiYmViYWRiY2M3NmM1Y2ExY2M0YjRmM2IwNjE0YjNlNjAzYjUwMDAiCnV1aWQgPSAiNWMyNzQ3ZjgtYjdlYS00ZmYyLWJhMmUtNTYzYmZkMzZiMWQ0Igp2ZXJzaW9uID0gIjEuNS4yIgoKW1tkZXBzLlVVSURzXV0KZGVwcyA9IFsiUmFuZG9tIiwgIlNIQSJdCnV1aWQgPSAiY2Y3MTE4YTctNjk3Ni01YjFhLTlhMzktN2FkYzcyZjU5MWE0Igp2ZXJzaW9uID0gIjEuMTEuMCIKCltbZGVwcy5Vbmljb2RlXV0KdXVpZCA9ICI0ZWMwYTgzZS00OTNlLTUwZTItYjlhYy04ZjcyYWNmNWE4ZjUiCnZlcnNpb24gPSAiMS4xMS4wIgoKW1tkZXBzLlpsaWJfamxsXV0KZGVwcyA9IFsiTGliZGwiXQp1dWlkID0gIjgzNzc1YTU4LTFmMWQtNTEzZi1iMTk3LWQ3MTM1NGFiMDA3YSIKdmVyc2lvbiA9ICIxLjIuMTMrMSIKCltbZGVwcy5saWJibGFzdHJhbXBvbGluZV9qbGxdXQpkZXBzID0gWyJBcnRpZmFjdHMiLCAiTGliZGwiXQp1dWlkID0gIjhlODUwYjkwLTg2ZGItNTM0Yy1hMGQzLTE0NzgxNzZjN2Q5MyIKdmVyc2lvbiA9ICI1LjExLjArMCIKCltbZGVwcy5uZ2h0dHAyX2psbF1dCmRlcHMgPSBbIkFydGlmYWN0cyIsICJMaWJkbCJdCnV1aWQgPSAiOGU4NTBlZGUtNzY4OC01MzM5LWEwN2MtMzAyYWNkMmFhZjhkIgp2ZXJzaW9uID0gIjEuNTkuMCswIgoKW1tkZXBzLnA3emlwX2psbF1dCmRlcHMgPSBbIkFydGlmYWN0cyIsICJMaWJkbCJdCnV1aWQgPSAiM2YxOWU5MzMtMzNkOC01M2IzLWFhYWItYmQ1MTEwYzNiN2EwIgp2ZXJzaW9uID0gIjE3LjQuMCsyIgoiIiIKCiMg4pWU4pWQ4pWhIENlbGwgb3JkZXI6CiMg4pWf4pSAOWQ0NDU1YWYtOTZmMS00NmQ3LWE0ZjMtNDM0NDk1YjExYzhhCiMg4pWg4pWQOTQ5YWMxZWYtYzUwMi00ZTI4LTgxZmYtZjk5YjBkMTlhYTAzCiMg4pWg4pWQNzA3MTc1YTktZDM1Ni00M2NmLTgwMzgtNjIwZWJjNDAxYzkzCiMg4pWg4pWQY2JmYzZlZWMtODk5MS00YTljLWFkYTAtMjk1YzgwNTI4NTRkCiMg4pWf4pSANDg0Mzk4M2MtZGY2NC00Yjk0LTg2MzQtN2ExMGQ5NDIzYTcwCiMg4pWf4pSAYTg5OTUyMjQtODNjNi00ZjgyLWI1YTUtODdhNmY4NmZjN2EwCiMg4pWg4pWQOWUzNjAxZjUtZWZjMi00NGU5LTgzZDgtNWI2NWNlN2U5Y2NmCiMg4pWg4pWQY2RjMGE3YWQtYTNhYy00MjcwLWI3MDctMzViMTkzOWRhMjc2CiMg4pWf4pSAZmU4OTFiNGUtZjQ0MC00ODIzLWI0M2ItNzI1NzJmNmE2YzEyCiMg4pWg4pWQODZhODAyMjgtZjQ5NS00M2U4LWIxZDQtYzkzYjdiNTJjOGQ4CiMg4pWg4pWQMjM1OGY2ODYtMTk1MC00MGY5LTlkNWMtZGFjMmQ5OGY0YzI0CiMg4pWf4pSANDk1MTYzNzQtZjYyNS00YTg0LWFjNWMtZjkyNDk3ZDQ1MDI1CiMg4pWf4pSAOGNjNTNjZDItOTExNC00MDY3LWFiMGItMzdmZDhjZDc5MjQwCiMg4pWg4pWQMGRiNTFkMzktN2MwNS00ZTAwLWI5NTEtN2ZlNzc2YThlMGY5CiMg4pWg4pWQZTJiNzlhNTgtZTY2ZS00ZDQwLTg2NzMtNDE4ODIzNzUzYjM4CiMg4pWf4pSANDY2OTk1YTItZGZkNC00Mzc0LTgzMzktYmMwMjMyMDM5YjI3CiMg4pWf4pSANGNiMTI4YWEtN2FkOC00ZDE3LWJjZWQtMzY4NDU3MDNlNmE4CiMg4pWg4pWQNzg1NTgyNmUtY2NhYS00YzI3LWEwNjAtZjVjZWI5MjdiYmU4CiMg4pWg4pWQMWQ1NTczZWUtODcyZS00ZGZiLWE3ODUtMWFjOWU4MzZhZDk4CiMg4pWf4pSAZjY1YjMyMzEtZjJiMi00NWRjLWI3MmUtMWFkMzEwNzA4M2ZjCiMg4pWf4pSANjdjMDg2MGItYjRjMS00MTJkLTg3MGEtYTRjZTQ5ODc0NjVlCiMg4pWg4pWQYmQ1ZWMwODYtNTE1Ni00ZTdjLWE3MGItNWNhOWYwODliYjQ5CiMg4pWg4pWQNzg1M2NjN2YtNGU1OC00NGQxLThkM2ItZjhkNDc0NTU2NGU2CiMg4pWf4pSAOWQyMzM4MmMtY2YzNS00YjIwLWE0NmMtMGY0ZTJkZTE3ZmM3CiMg4pWf4pSAOTU5YWNiNDAtMWZkNi00M2Y1LWExYTYtNzNhNmNlYWFlMWQ3CiMg4pWg4pWQNGQ2MTE0MjUtYzhlMy00YmMzLTkxMmItOGJjMDQ2NTM2M2JjCiMg4pWg4pWQYTU0OTBhNmItZGMxMS00MmI3LTg3ZTAtZDM4ODcwZmM1NWU0CiMg4pWg4pWQNzA1ZTMwZmUtNzdhMy00YjA2LThiOTktMTgwNzI5MGVkZmZiCiMg4pWf4pSAMmVlN2YyNmQtZjM4My00ZTdlLWE2OWEtOGZiNzI3MTc0NjdjCiMg4pWf4pSANzliZWJhODgtOTMyZi00MTQ3LWIzYTAtZDgyMWVmMWJjMWUyCiMg4pWg4pWQNjNkNmMyZGYtYTQxMS00MDdjLWFmMTEtNGY1ZDA5ZmJiMzIyCiMg4pWg4pWQNjMzMDI5YWYtOGNhYy00MjZlLWIzNWMtYzlmYjM5MzhiNzg0CiMg4pWg4pWQMDY1YmFkNzMtNWZhOC00NDk2LWJhMzMtOWU2Njk0MGI1ODA2CiMg4pWf4pSAMjA3M2YxMWUtODE5Ni00ZWJjLTkyMmYtNWZhNTg5ZTkxNzk3CiMg4pWg4pWQODExY2Y3OGItZTg3MC00NWJiLTkxNzMtODlhM2IzZDQ5NWY1CiMg4pWg4pWQZTdkNjc2NjItNzdiMy00ODJhLWIwMzItOGRiNGFmYmMwMWE2CiMg4pWg4pWQOTk2YjQwODUtMTE0Yy00OGY0LTlmOTAtOGU2MzdmMjljMDZhCiMg4pWf4pSAM2EwNjZiZjQtMzQ2Ni00NjllLTkwZDAtNmIxNGJlM2VkOGQ1CiMg4pWf4pSAMzIxM2Q5NzctN2I2NS00M2IwLWE4ODEtMTBmY2MyNTIzZjE0CiMg4pWg4pWQOTAzZmVlNjctNmIyMy00MWRjLWEwM2QtZjEwNDBiNjk2YmU2CiMg4pWg4pWQMDhkNzExYzAtZTJjYy00NDQ0LTk0Y2EtMGM0YzNjZmU5MDFmCiMg4pWg4pWQMDNlOWQ3NWUtZTZjOS00MTk5LTkzM2ItMmJlMzA2ZGFmOTc4CiMg4pWg4pWQMjZkMTE2MDAtMjgyNy00ZTA4LTkxOTUtMTA5YzhhOGJkZGMzCiMg4pWg4pWQYmUyYTc4MjAtZTE5NC00NDEwLWIwMGQtYTkzMzJiMjM0YWQ2CiMg4pWf4pSAMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAxCiMg4pWf4pSAMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAyCg==";
window.pluto_disable_ui = true;
window.pluto_slider_server_url = undefined;
window.pluto_binder_url = "https://mybinder.org/v2/gh/fonsp/pluto-on-binder/v0.20.5";
window.pluto_statefile = "data:;base64,3gASpWJvbmRziKRmcmVxgaV2YWx1ZRSjYWx0gaV2YWx1ZcyWom50gaV2YWx1ZZGTkQGRAZEBuXRyYW5zZm9ybWVkX3ZhbHVlX2V4YW1wbGWBpXZhbHVlkZKRAZEBo2FzZIGldmFsdWWRlZEBkQaRoJGgkQGjc2JzgaV2YWx1ZZGSApGSkR+RM6dsb2xfcG9wgaV2YWx1ZZGRkpEBkQajYm9ogaV2YWx1ZZGRkZGRkZEBrGNlbGxfcmVzdWx0c94ALNkkOTk2YjQwODUtMTE0Yy00OGY0LTlmOTAtOGU2MzdmMjljMDZhiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9keYOoZWxlbWVudHOTkqFhkqExqnRleHQvcGxhaW6SoWKSoTGqdGV4dC9wbGFpbpKhY5KhMap0ZXh0L3BsYWlupHR5cGWqTmFtZWRUdXBsZahvYmplY3RpZLAyYTljMTU2Y2E1NWU2N2M1pG1pbWXZIWFwcGxpY2F0aW9uL3ZuZC5wbHV0by50cmVlK29iamVjdKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVN7GY3bBwZXJzaXN0X2pzX3N0YXRlw7doYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkOTk2YjQwODUtMTE0Yy00OGY0LTlmOTAtOGU2MzdmMjljMDZhuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWUutXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkOGNjNTNjZDItOTExNC00MDY3LWFiMGItMzdmZDhjZDc5MjQwiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedoB7DxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5Tb21ldGltZXMgY3VzdG9tIHN0cnVjdHMgYXJlIG5vdCBuZWVkZWQgYW5kIGl0IHdvdWxkIGJlIHVzZWZ1bCB0byBqdXN0IHVzZSB0aGUgc2FtZSBuaWNlIGJvbmQgc3RydWN0dXJlIG9mIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+IHRvIHNpbXBseSBjcmVhdGUgYXJiaXRyYXJ5IE5hbWVkVHVwbGVzLiA8L3A+CjxwPlRoaXMgaXMgcG9zc2libGUgd2l0aCB0aGUgY29udmVuaWVuY2UgbWFjcm8gPGNvZGU+QE5UQm9uZDwvY29kZT4gd2hpY2ggY2FuIGJlIGNhbGxlZCBhcyBzaG93biBiZWxvdyB0byBjcmVhdGUgYSBuaWNlIGRpc3BsYXkgZm9yIGFuIGludGVyYWN0aXZlIGJvbmQgY3JlYXRpbmcgYW4gYXJiaXRyYXJ5IE5hbWVkVHVwbGUuPC9wPgo8cD5UaGUgbWFjcm8gc2ltcGx5IGNyZWF0ZSBhIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+IHdyYXBwaW5nIHRoZSBkZXNpcmVkIE5hbWVkVHVwbGUgdHlwZS48L3A+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVNZJbtLBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkOGNjNTNjZDItOTExNC00MDY3LWFiMGItMzdmZDhjZDc5MjQwuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAAewy7VwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDY3YzA4NjBiLWI0YzEtNDEyZC04NzBhLWE0Y2U0OTg3NDY1ZYqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaBps8ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+U29tZXRpbWVzLCBvbmUgd2FudHMgdG8gY3JlYXRlIGEgbW9yZSBjb21wbGV4IGJpbmRpbmcgd2hlcmUgdGhlIG51bWJlciBvZiBwYXJhbWV0ZXJzIHRvIGNvbnRyb2wgYSBib25kIGNhbiB2YXJ5IGRlcGVuZGluZyBvbiBzb21lIG90aGVyIHZhcmlhYmxlLiBUaGUgPGNvZGU+U3RydWN0Qm9uZFNlbGVjdDwvY29kZT4gY2FuIGJlIG9mIGhlbHAgaW4gc29tZSBvZiB0aGVzZSBjYXNlcywgYnkgcHJvdmlkaW5nIGEgd2F5IHRvIHNlbGVjdCBvdXQgb2YgYSBudW1iZXIgb2YgYXJiaXRyYXJ5IDxjb2RlPlN0cnVjdEJvbmRzPC9jb2RlPiAmIzQwO3doaWNoIGluY2x1ZGUgPGNvZGU+QE5UQm9uZDwvY29kZT4mIzQxOyBieSB1c2luZyBhIGRyb3Bkb3duIHRvIHNlbGVjdCB0aGUgb25lIHRvIGJlIGRpc3BsYXllZCBhbmQgdXNlZCBmb3IgZ2VuZXJhdGluZyB0aGUgPGNvZGU+U3RydWN0Qm9uZFNlbGVjdDwvY29kZT4gd2lkZ2V0JiMzOTtzIG91dHB1dC48L3A+CjxwPlRoaXMgc3RydWN0dXJlIGNhbiBiZSBjb25zdHJ1Y3RlZCB3aXRoIGEgdmVjdG9yIG9mIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+IG9yIDxjb2RlPnRyYW5zZm9ybWVkX3ZhbHVlJiM0MDtmLCA6OlN0cnVjdEJvbmQmIzQxOzwvY29kZT4gZWxlbWVudHMsIGFuZCB3aWxsIHRha2UgY2FyZSBvZiBnZW5lcmF0aW5nIGFuIGFwcHJvcHJpYXRlIHdpZGdldCB0byBkaXNwbGF5IGFuZCBwcm9jZXNzIG9ubHkgdGhlIHNlbGVjdGVkIG9uZS48L3A+CjxwPlRoZSBtYWluIHNpZ25hdHVyZSBvZiB0aGUgY29uc3RydWN0b3IgaXMgdGhlIGZvbGxvd2luZzo8L3A+CjxwcmU+PGNvZGUgY2xhc3M9Imxhbmd1YWdlLWp1bGlhIj5TdHJ1Y3RCb25kU2VsZWN0JiM0MDtlbHM6OlZlY3RvcjsgZGVzY3JpcHRpb24gJiM2MTsgJnF1b3Q7U3RydWN0Qm9uZFNlbGVjdCZxdW90OywgZGVmYXVsdF9pZHggJiM2MTsgMSwgc2VsZWN0b3JfdGV4dCAmIzYxOyAmcXVvdDtTZWxlY3RvciZxdW90OyYjNDE7PC9jb2RlPjwvcHJlPgo8cD5UaGUgbmFtZXMgdG8gc2VsZWN0IHVwb24gd2lsbCBiZSB0YWtlbiBmcm9tIHRoZSA8Y29kZT5kZXNjcmlwdGlvbjwvY29kZT4gb2YgdGhlIHByb3ZpZGVkIDxjb2RlPlN0cnVjdEJvbmRzPC9jb2RlPiwgd2hpbGUgdGhlIHRleHQgZGlzcGxheWVkIG5leHQgdG8gdGhlIDxlbT5zZWxlY3RvcjwvZW0+IHdpbGwgZGVmYXVsdCB0byA8Y29kZT5TZWxlY3RvcjwvY29kZT4gYnV0IGNhbiBiZSBjdXN0b21pemVkIHdpdGggdGhlIDxjb2RlPnNlbGVjdG9yX3RleHQ8L2NvZGU+IGt3YXJnIHRvIHRoZSBjb25zdHJ1Y3Rvci4gVGhlIDxjb2RlPmRlc2NyaXB0aW9uPC9jb2RlPiBrd2FyZyBjYW4gYmUgdXNlZCB0byBjdXN0b21pemUgdGhlIHRleHQgaW4gdGhlIHdpZGdldCBjb250YWluZXIgJiM0MDtzaW1pbGFyIHRvIHRoZSBzYW1lIGt3YXJnIGluIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+IGFuZCB0byA8Y29kZT5ATlRCb25kPC9jb2RlPiYjNDE7LiBGaW5hbGx5LCB0aGUgPGNvZGU+ZGVmYXVsdF9pZHg8L2NvZGU+IHNob3VsZCBiZSBhbiBpbnRlZ2VyIGFuZCB3aWxsIHNlbGVjdCB3aGljaCBvZiB0aGUgcHJvdmlkZWQgPGNvZGU+U3RydWN0Qm9uZDwvY29kZT5zIHdpbGwgYmUgc2VsZWN0ZWQgYXMgZGVmYXVsdCB3aGVuIGluc3RhbnRpYXRpbmcgdGhlIHdpZGdldC48L3A+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVNkmsVLBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkNjdjMDg2MGItYjRjMS00MTJkLTg3MGEtYTRjZTQ5ODc0NjVluWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAAmvgLVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDJlZTdmMjZkLWYzODMtNGU3ZS1hNjlhLThmYjcyNzE3NDY3Y4qmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnZLDxkaXYgY2xhc3M9Im1hcmtkb3duIj48aDE+UG9wb3V0PC9oMT4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU280VasHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQyZWU3ZjI2ZC1mMzgzLTRlN2UtYTY5YS04ZmI3MjcxNzQ2N2O5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AA8x6tXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkMzIxM2Q5NzctN2I2NS00M2IwLWE4ODEtMTBmY2MyNTIzZjE0iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedoCaDxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5UaGUgZmluYWwgY29udmVuaWVuY2Ugc3RydWN0dXJlIHByb3ZpZGVkIGJ5IHRoaXMgbW9kdWxlIGlzIHRoZSA8Y29kZT5Cb25kVGFibGU8L2NvZGU+LiBJdCBjYW4gYmUgY3JlYXRlZCB0byBncm91cCBhIGxpc3Qgb2YgYm9uZHMgaW4gYSBmbG9hdGluZyB0YWJsZSB0aGF0IHN0YXlzIG9uIHRoZSBsZWZ0IHNpZGUgb2YgdGhlIG5vdGVib29rICYjNDA7c2ltaWxhciB0byB0aGUgVGFibGVPZkNvbnRlbnRzIG9mIFBsdXRvVUkmIzQxOyBhbmQgY2FuIGJlIG1vdmVkIGFyb3VuZCBhbmQgcmVzaXplZCBvciBoaWRkZW4gZm9yIGNvbnZlbmllbmNlLjwvcD4KPHA+VGhlIEJvbmRUYWJsZSBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGVpdGhlciB3aXRoIGJvbmRzIGNvbnRhaW5pbmcgPGNvZGU+U3RydWN0Qm9uZDwvY29kZT4gb3Igd2l0aCA8Y29kZT5Cb25kc0xpc3Q8L2NvZGU+LiBGdXR1cmUgdHlwZXMgd2l0aCBzaW1pbGFyIHN0cnVjdHVyZSB3aWxsIGFsc28gYmUgYWRkZWQuPC9wPgo8cD5IZXJlIGlzIGFuIGV4YW1wbGUgb2YgYSBib25kdGFibGUgY29udGFpbmluZyBhbGwgdGhlIGV4YW1wbGVzIG9mIHRoaXMgbm90ZWJvb2suPC9wPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTcmcHqwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDMyMTNkOTc3LTdiNjUtNDNiMC1hODgxLTEwZmNjMjUyM2YxNLlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAHUIK1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ0Y2IxMjhhYS03YWQ4LTRkMTctYmNlZC0zNjg0NTcwM2U2YTiKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52gFgPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPjxjb2RlPkBOVEJvbmQ8L2NvZGU+IGlzIGFsc28gcXVpdGUgdXNlZnVsIGluIGNvbWJpbmF0aW9uIHdpdGggPGNvZGU+dHJhbnNmb3JtZWRfdmFsdWU8L2NvZGU+IGZyb20gPGNvZGU+UGx1dG9VSS5FeHBlcmltZW50YWw8L2NvZGU+LiBGb3IgdGhpcyByZWFzb24sIHRoZSA8Y29kZT5ATlRCb25kPC9jb2RlPiBtYWNybyBzdXBwb3J0cyBhbiBvcHRpb25hbCB0aGlyZCBhcmd1bWVudCB3aGljaCBzaGFsbCBiZSBhIGZ1bmN0aW9uIHRoYXQgd2hlbiBwcm92aWRlZCBpcyBkaXJlY3RseSB1c2VkIHRvIHRyYW5zZm9ybSB0aGUgdmFsdWUgb2YgdGhlIHdpZGdldC48L3A+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVNjL8XbBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkNGNiMTI4YWEtN2FkOC00ZDE3LWJjZWQtMzY4NDU3MDNlNmE4uWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAAU/hLVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJGJkNWVjMDg2LTUxNTYtNGU3Yy1hNzBiLTVjYTlmMDg5YmI0OYqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaqsc8Ym9uZCBkZWY9InNicyIgdW5pcXVlX2lkPSJYT1NkWi9FMy9SU0wiPjx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgY2xhc3M9J3N0cnVjdGJvbmQtc2VsZWN0Jz4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5TdHJ1Y3RCb25kU2VsZWN0PC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndm9mdHljYWVlZCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHN0cnVjdGJvbmQtc2VsZWN0PgogICAgPHNwYW4gY2xhc3M9InNlbGVjdG9yIj4KICAgICAgICA8c3BhbiBjbGFzcz0iZGVzY3JpcHRpb24iPk9wdGlvbnM6PC9zcGFuPgogICAgICAgIDxzZWxlY3Q+PG9wdGlvbiB2YWx1ZT0ncHVpc2VsZWN0LTEnPmNvcyhhcmcpPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0ncHVpc2VsZWN0LTInIHNlbGVjdGVkPScnPmF0YW4oeSx4KTwvb3B0aW9uPjwvc2VsZWN0PgogICAgPC9zcGFuPgogICAgPHN0cnVjdC1ib25kIGNsYXNzPSdOYW1lZFR1cGxleyhTeW1ib2woJnF1b3Q7IyMyMzYmcXVvdDspLCA6YXJnKX0nPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBjbGFzcz0nJz4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5OYW1lZFR1cGxlPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYmRodmNod3hybycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZGJyb29wdHB5Yicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYXJnJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhcmcnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGFyZ2AiPmFyZzwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhcmcnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3l1Z2V1ZmtxbWsnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3l1Z2V1ZmtxbWsnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ5dWdldWZrcW1rIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0nZGJyb29wdHB5Yic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImRicm9vcHRweWIiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIE5hbWVkVHVwbGUiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCQkJZmxleDogMTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYmRodmNod3hybyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImJkaHZjaHd4cm8iCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J3lneGN1ZnpqY3cnPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgogICAgICAgIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewogICAgY3Vyc29yOiBwb2ludGVyOwogICAgLS1zaXplOiAxNXB4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIGJhY2tncm91bmQ6ICNjNmM2YzY7CiAgICBvdXRsaW5lOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgbWFyZ2luOiAwIDEwcHg7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKICAgIGJhY2tncm91bmQ6ICM0QkQ4NjU7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewogICAgY29udGVudDogJyc7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgdG9wOiAwcHg7CiAgICBsZWZ0OiAwcHg7CiAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgdHJhbnNpdGlvbjogLjFzOwp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewogICAgbGVmdDogdmFyKC0tc2l6ZSkKfQkJCgk8L3N0eWxlPgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSdmd3ppeGNqanJiJz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiY29zKGFyZykiCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CjxzdHJ1Y3QtYm9uZCBjbGFzcz0nTmFtZWRUdXBsZXsoU3ltYm9sKCZxdW90OyMjMjM3JnF1b3Q7KSwgOngsIDp5KX0nPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBjbGFzcz0nJz4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5OYW1lZFR1cGxlPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0neGJodm51b3ViZycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHVmZ2x6enF0cicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0neCc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0neCcgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgeGAiPng8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0neCc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZnhwYmFsZmxtcycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAxJyB2YWx1ZT0nMzEnPjxzY3JpcHQ+CgkJCQkJY29uc3QgaW5wdXRfZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQkJCQljb25zdCBvdXRwdXRfZWwgPSBjdXJyZW50U2NyaXB0Lm5leHRFbGVtZW50U2libGluZwoJCQkJCWNvbnN0IGRpc3BsYXlzID0gWyIwLjAiLCAiMC4xIiwgIjAuMiIsICIwLjMiLCAiMC40IiwgIjAuNSIsICIwLjYiLCAiMC43IiwgIjAuOCIsICIwLjkiLCAiMS4wIiwgIjEuMSIsICIxLjIiLCAiMS4zIiwgIjEuNCIsICIxLjUiLCAiMS42IiwgIjEuNyIsICIxLjgiLCAiMS45IiwgIjIuMCIsICIyLjEiLCAiMi4yIiwgIjIuMyIsICIyLjQiLCAiMi41IiwgIjIuNiIsICIyLjciLCAiMi44IiwgIjIuOSIsICIzLjAiLCAiMy4xIiwgIjMuMiIsICIzLjMiLCAiMy40IiwgIjMuNSIsICIzLjYiLCAiMy43IiwgIjMuOCIsICIzLjkiLCAiNC4wIiwgIjQuMSIsICI0LjIiLCAiNC4zIiwgIjQuNCIsICI0LjUiLCAiNC42IiwgIjQuNyIsICI0LjgiLCAiNC45IiwgIjUuMCIsICI1LjEiLCAiNS4yIiwgIjUuMyIsICI1LjQiLCAiNS41IiwgIjUuNiIsICI1LjciLCAiNS44IiwgIjUuOSIsICI2LjAiLCAiNi4xIiwgIjYuMiIsICI2LjMiLCAiNi40IiwgIjYuNSIsICI2LjYiLCAiNi43IiwgIjYuOCIsICI2LjkiLCAiNy4wIiwgIjcuMSIsICI3LjIiLCAiNy4zIiwgIjcuNCIsICI3LjUiLCAiNy42IiwgIjcuNyIsICI3LjgiLCAiNy45IiwgIjguMCIsICI4LjEiLCAiOC4yIiwgIjguMyIsICI4LjQiLCAiOC41IiwgIjguNiIsICI4LjciLCAiOC44IiwgIjguOSIsICI5LjAiLCAiOS4xIiwgIjkuMiIsICI5LjMiLCAiOS40IiwgIjkuNSIsICI5LjYiLCAiOS43IiwgIjkuOCIsICI5LjkiLCAiMTAuMCJdCgoJCQkJCWxldCB1cGRhdGVfb3V0cHV0ID0gKCkgPT4gewoJCQkJCQlvdXRwdXRfZWwudmFsdWUgPSBkaXNwbGF5c1tpbnB1dF9lbC52YWx1ZUFzTnVtYmVyIC0gMV0KCQkJCQl9CgkJCQkJCgkJCQkJaW5wdXRfZWwuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCB1cGRhdGVfb3V0cHV0KQoJCQkJCS8vIFdlIGFsc28gcG9sbCBmb3IgY2hhbmdlcyBiZWNhdXNlIHRoZSBgaW5wdXRfZWwudmFsdWVgIGNhbiBjaGFuZ2UgZnJvbSB0aGUgb3V0c2lkZSwgZS5nLiBodHRwczovL2dpdGh1Yi5jb20vSnVsaWFQbHV0by9QbHV0b1VJLmpsL2lzc3Vlcy8yNzcKCQkJCQlsZXQgaWQgPSBzZXRJbnRlcnZhbCh1cGRhdGVfb3V0cHV0LCAyMDApCgkJCQkJaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJCQkJCQljbGVhckludGVydmFsKGlkKQoJCQkJCQlpbnB1dF9lbC5yZW1vdmVFdmVudExpc3RlbmVyKCJpbnB1dCIsIHVwZGF0ZV9vdXRwdXQpCgkJCQkJfSkKCQkJCQk8L3NjcmlwdD48b3V0cHV0IHN0eWxlPScKCQkJCQkJZm9udC1mYW1pbHk6IHN5c3RlbS11aTsKICAgIAkJCQkJZm9udC1zaXplOiAxNXB4OwogICAgCQkJCQltYXJnaW4tbGVmdDogM3B4OwogICAgCQkJCQl0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTRweCk7CiAgICAJCQkJCWRpc3BsYXk6IGlubGluZS1ibG9jazsnPjMuMDwvb3V0cHV0PjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2Z4cGJhbGZsbXMnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJmeHBiYWxmbG1zIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdsdWZnbHp6cXRyJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSd5Jz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSd5JyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGB5YCI+eTwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSd5Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdrZXdnd3Z1dGNmJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMDEnIHZhbHVlPSc1MSc+PHNjcmlwdD4KCQkJCQljb25zdCBpbnB1dF9lbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCQkJCWNvbnN0IG91dHB1dF9lbCA9IGN1cnJlbnRTY3JpcHQubmV4dEVsZW1lbnRTaWJsaW5nCgkJCQkJY29uc3QgZGlzcGxheXMgPSBbIjAuMCIsICIwLjEiLCAiMC4yIiwgIjAuMyIsICIwLjQiLCAiMC41IiwgIjAuNiIsICIwLjciLCAiMC44IiwgIjAuOSIsICIxLjAiLCAiMS4xIiwgIjEuMiIsICIxLjMiLCAiMS40IiwgIjEuNSIsICIxLjYiLCAiMS43IiwgIjEuOCIsICIxLjkiLCAiMi4wIiwgIjIuMSIsICIyLjIiLCAiMi4zIiwgIjIuNCIsICIyLjUiLCAiMi42IiwgIjIuNyIsICIyLjgiLCAiMi45IiwgIjMuMCIsICIzLjEiLCAiMy4yIiwgIjMuMyIsICIzLjQiLCAiMy41IiwgIjMuNiIsICIzLjciLCAiMy44IiwgIjMuOSIsICI0LjAiLCAiNC4xIiwgIjQuMiIsICI0LjMiLCAiNC40IiwgIjQuNSIsICI0LjYiLCAiNC43IiwgIjQuOCIsICI0LjkiLCAiNS4wIiwgIjUuMSIsICI1LjIiLCAiNS4zIiwgIjUuNCIsICI1LjUiLCAiNS42IiwgIjUuNyIsICI1LjgiLCAiNS45IiwgIjYuMCIsICI2LjEiLCAiNi4yIiwgIjYuMyIsICI2LjQiLCAiNi41IiwgIjYuNiIsICI2LjciLCAiNi44IiwgIjYuOSIsICI3LjAiLCAiNy4xIiwgIjcuMiIsICI3LjMiLCAiNy40IiwgIjcuNSIsICI3LjYiLCAiNy43IiwgIjcuOCIsICI3LjkiLCAiOC4wIiwgIjguMSIsICI4LjIiLCAiOC4zIiwgIjguNCIsICI4LjUiLCAiOC42IiwgIjguNyIsICI4LjgiLCAiOC45IiwgIjkuMCIsICI5LjEiLCAiOS4yIiwgIjkuMyIsICI5LjQiLCAiOS41IiwgIjkuNiIsICI5LjciLCAiOS44IiwgIjkuOSIsICIxMC4wIl0KCgkJCQkJbGV0IHVwZGF0ZV9vdXRwdXQgPSAoKSA9PiB7CgkJCQkJCW91dHB1dF9lbC52YWx1ZSA9IGRpc3BsYXlzW2lucHV0X2VsLnZhbHVlQXNOdW1iZXIgLSAxXQoJCQkJCX0KCQkJCQkKCQkJCQlpbnB1dF9lbC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIHVwZGF0ZV9vdXRwdXQpCgkJCQkJLy8gV2UgYWxzbyBwb2xsIGZvciBjaGFuZ2VzIGJlY2F1c2UgdGhlIGBpbnB1dF9lbC52YWx1ZWAgY2FuIGNoYW5nZSBmcm9tIHRoZSBvdXRzaWRlLCBlLmcuIGh0dHBzOi8vZ2l0aHViLmNvbS9KdWxpYVBsdXRvL1BsdXRvVUkuamwvaXNzdWVzLzI3NwoJCQkJCWxldCBpZCA9IHNldEludGVydmFsKHVwZGF0ZV9vdXRwdXQsIDIwMCkKCQkJCQlpbnZhbGlkYXRpb24udGhlbigoKSA9PiB7CgkJCQkJCWNsZWFySW50ZXJ2YWwoaWQpCgkJCQkJCWlucHV0X2VsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImlucHV0IiwgdXBkYXRlX291dHB1dCkKCQkJCQl9KQoJCQkJCTwvc2NyaXB0PjxvdXRwdXQgc3R5bGU9JwoJCQkJCQlmb250LWZhbWlseTogc3lzdGVtLXVpOwogICAgCQkJCQlmb250LXNpemU6IDE1cHg7CiAgICAJCQkJCW1hcmdpbi1sZWZ0OiAzcHg7CiAgICAJCQkJCXRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNHB4KTsKICAgIAkJCQkJZGlzcGxheTogaW5saW5lLWJsb2NrOyc+NS4wPC9vdXRwdXQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0na2V3Z3d2dXRjZic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImtld2d3dnV0Y2YiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdsdWZnbHp6cXRyJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibHVmZ2x6enF0ciIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CgkJCgk8c2NyaXB0PgoJCWNvbnN0IHRyYyA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgndG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyJykKCQljb25zdCBoZWFkZXIgPSB0cmMuZmlyc3RFbGVtZW50Q2hpbGQKCQljb25zdCBkZXNjID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgIlRoaXMgZ2VuZXJhdGVzIGEgc3RydWN0IG9mIHR5cGUgTmFtZWRUdXBsZSIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJCQlmbGV4OiAxOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd4Ymh2bnVvdWJnJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAieGJodm51b3ViZyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0nYXV0c3pjbG1tZSc+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+CiAgICAgICAgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAtLXNpemU6IDE1cHg7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBhcHBlYXJhbmNlOiBub25lOwogICAgYmFja2dyb3VuZDogI2M2YzZjNjsKICAgIG91dGxpbmU6IG5vbmU7CiAgICBib3JkZXItcmFkaXVzOiBjYWxjKHZhcigtLXNpemUpLzIpOwogICAgYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICBtYXJnaW46IDAgMTBweDsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewogICAgYmFja2dyb3VuZDogIzRCRDg2NTsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CiAgICBjb250ZW50OiAnJzsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB0b3A6IDBweDsKICAgIGxlZnQ6IDBweDsKICAgIGJhY2tncm91bmQ6ICNmZmY7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CiAgICBib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICB0cmFuc2l0aW9uOiAuMXM7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CiAgICBsZWZ0OiB2YXIoLS1zaXplKQp9CQkKCTwvc3R5bGU+CjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoKCTxzY3JpcHQgaWQ9J29nYXJhY2J4Y2snPgoJCQoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IHdpZGdldCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCgkJLy8gT3ZlcndyaXRlIHRoZSBkZXNjcmlwdGlvbgoJCWNvbnN0IGRlc2MgPSB3aWRnZXQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLmlubmVySFRNTCA9ICJhdGFuKHkseCkiCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CgogICAgPHNjcmlwdD4KICAgICAgICBjb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKICAgICAgICBjb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwogICAgICAgIGNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCiAgICAgICAgCiAgICAgICAgLy8gVGhpcyBpcyB0aGUgZWxlbWVudCBvZiB0aGUgc2VsZWN0IGRyb3Bkb3duCiAgICAgICAgY29uc3Qgc2VsZWN0ID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoInNlbGVjdCIpCgogICAgICAgIC8vIFRoaXMgd2lsbCBob2xkIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgc3RydWN0Ym9uZCBlbGVtZW50CiAgICAgICAgbGV0IHNlbGVjdGVkCgogICAgICAgIGNvbnN0IHVwZGF0ZSA9ICgpID0+IHsKICAgICAgICAgICAgcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0X3NlbGVjdF92YWx1ZSgpIHsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBnZXRfaW5wdXRfdmFsdWUoc2VsZWN0KQogICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodmFsdWUuc3Vic3RyaW5nKDEwKSkKICAgICAgICB9CgogICAgICAgIGNvbnN0IGNoYW5nZV9zZWxlY3Rpb24gPSAodmFsdWUsIHRyaWdnZXJfZXZlbnQgPSB0cnVlKSA9PiB7CiAgICAgICAgICAgIHNldF9pbnB1dF92YWx1ZShzZWxlY3QsIGBwdWlzZWxlY3QtJHt2YWx1ZX1gKQogICAgICAgICAgICBjb25zdCBib25kcyA9IHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKCJzdHJ1Y3QtYm9uZCIpCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9uZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChpICE9IHZhbHVlIC0gMSkgewogICAgICAgICAgICAgICAgICAgIGJvbmRzW2ldLmNsYXNzTGlzdC50b2dnbGUoImhpZGRlbiIsIHRydWUpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGJvbmRzW2ldLmNsYXNzTGlzdC50b2dnbGUoImhpZGRlbiIsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gYm9uZHNbaV0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHJpZ2dlcl9ldmVudCkgewogICAgICAgICAgICAgICAgdXBkYXRlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgY2hhbmdlX3NlbGVjdGlvbihnZXRfc2VsZWN0X3ZhbHVlKCksIGZhbHNlKQoKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAidmFsdWUiLCB7CiAgICAgICAgICAgIGdldDogKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBnZXRfc2VsZWN0X3ZhbHVlKCkKICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZ2V0X2lucHV0X3ZhbHVlKHNlbGVjdGVkKQogICAgICAgICAgICAgICAgcmV0dXJuIFtpbmRleCwgdmFsdWVdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldDogKG5ld3ZhbCkgPT4gewogICAgICAgICAgICAgICAgY2hhbmdlX3NlbGVjdGlvbihuZXd2YWxbMF0sIGZhbHNlKQogICAgICAgICAgICAgICAgc2V0X2lucHV0X3ZhbHVlKHNlbGVjdGVkLCBuZXd2YWxbMV0pCiAgICAgICAgICAgIH0sCiAgICAgICAgfSkKCiAgICAgICAgLy8gV2UgYWRkIGEgbGlzdGVuZXIgdGhhdCBleHRyYWN0IHRoZSBmb3J3YXJkIHRoZSBpbnB1dCBldmVudCBpbiBjYXNlIHRoZSB0YXJnZXQgb2YgdGhlIGV2ZW50IGlzIHRoZSBzZWxlY3RlZCBib25kCiAgICAgICAgZm9yIChsZXQgYm9uZCBvZiBwYXJlbnQucXVlcnlTZWxlY3RvckFsbCgic3RydWN0LWJvbmQiKSkgewogICAgICAgICAgICBib25kLmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgICAgIGlmIChib25kID09IHNlbGVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CgogICAgICAgIHNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIChlKSA9PiB7CiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgY2hhbmdlX3NlbGVjdGlvbihnZXRfc2VsZWN0X3ZhbHVlKCkpCiAgICAgICAgfSkKICAgIDwvc2NyaXB0PgogICAgPHN0eWxlPgogICAgICAgIHN0cnVjdGJvbmQtc2VsZWN0IHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcjpmaXJzdC1vZi10eXBlLm5vLXBvcG91dDpiZWZvcmUgewogIGRpc3BsYXk6IG5vbmU7Cn0KCnN0cnVjdGJvbmQtc2VsZWN0ID4gc3RydWN0LWJvbmQuaGlkZGVuIHsKICBkaXNwbGF5OiBub25lOwp9CgpzdHJ1Y3Rib25kLXNlbGVjdCwKc3RydWN0Ym9uZC1zZWxlY3QgPiBzdHJ1Y3QtYm9uZCwKc3RydWN0Ym9uZC1zZWxlY3QgdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKICBkaXNwbGF5OiBjb250ZW50czsKfQoKc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3IgewogIGRpc3BsYXk6IGNvbnRlbnRzOwp9CgpzdHJ1Y3Rib25kLXNlbGVjdCA+IC5zZWxlY3RvciAuZGVzY3JpcHRpb24gewogIGNvbG9yOiB2YXIoLS1wbHV0by1vdXRwdXQtY29sb3IsICM0MDQwNDApOwp9CgpzdHJ1Y3Rib25kLXNlbGVjdCA+c3RydWN0LWJvbmQ+dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPnRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CiAgZGlzcGxheTogbm9uZTsKfQoKc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3Igc2VsZWN0IHsKICAgIHBhZGRpbmc6IDZweCAxMnB4OwogICAgYm9yZGVyOiAycHggc29saWQgI2U3ZTdlNzsKICAgIGJvcmRlci1yYWRpdXM6IDZweDsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICAgIGNvbG9yOiB2YXIoLS1wbHV0by1vdXRwdXQtY29sb3IsICM0MDQwNDApOwogICAgZm9udC1mYW1pbHk6IGluaGVyaXQ7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICBvdXRsaW5lOiBub25lOwogICAgdHJhbnNpdGlvbjogYm9yZGVyLWNvbG9yIDAuMnM7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAKICAgIC8qIFNpemUgY29uc3RyYWludHMgKi8KICAgIG1heC13aWR0aDogNTBweDsgCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgCiAgICAvKiBDdXN0b20gYXJyb3cgc3R5bGluZyAqLwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsKICAgIC1tb3otYXBwZWFyYW5jZTogbm9uZTsKICAgIC8qIExpZ2h0IG1vZGUgYXJyb3cgLSAjNDA0MDQwICovCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoImRhdGE6aW1hZ2Uvc3ZnK3htbDtjaGFyc2V0PVVURi04LCUzY3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCcgZmlsbD0nbm9uZScgc3Ryb2tlPSclMjM0MDQwNDAnIHN0cm9rZS13aWR0aD0nMicgc3Ryb2tlLWxpbmVjYXA9J3JvdW5kJyBzdHJva2UtbGluZWpvaW49J3JvdW5kJyUzZSUzY3BvbHlsaW5lIHBvaW50cz0nNiA5IDEyIDE1IDE4IDknJTNlJTNjL3BvbHlsaW5lJTNlJTNjL3N2ZyUzZSIpOwogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IHJpZ2h0IDhweCBjZW50ZXI7CiAgICBiYWNrZ3JvdW5kLXNpemU6IDE2cHg7CiAgICBwYWRkaW5nLXJpZ2h0OiAzMnB4OwogICAgbWluLXdpZHRoOiAxMjBweDsKfQoKc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3Igc2VsZWN0OmhvdmVyIHsKICAgIGJvcmRlci1jb2xvcjogI2QwZDBkMDsKfQoKc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3Igc2VsZWN0OmZvY3VzIHsKICAgIGJvcmRlci1jb2xvcjogI2MwYzBjMDsKfQoKQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewogICAgc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3Igc2VsZWN0IHsKICAgICAgICBib3JkZXItY29sb3I6ICM3ZDdkN2Q7CiAgICAgICAgY29sb3I6IHZhcigtLXBsdXRvLW91dHB1dC1jb2xvciwgI2M0YzRjNCk7CiAgICAgICAgLyogRGFyayBtb2RlIGFycm93IC0gI2M0YzRjNCAqLwogICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiZGF0YTppbWFnZS9zdmcreG1sO2NoYXJzZXQ9VVRGLTgsJTNjc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDI0IDI0JyBmaWxsPSdub25lJyBzdHJva2U9JyUyM2M0YzRjNCcgc3Ryb2tlLXdpZHRoPScyJyBzdHJva2UtbGluZWNhcD0ncm91bmQnIHN0cm9rZS1saW5lam9pbj0ncm91bmQnJTNlJTNjcG9seWxpbmUgcG9pbnRzPSc2IDkgMTIgMTUgMTggOSclM2UlM2MvcG9seWxpbmUlM2UlM2Mvc3ZnJTNlIik7CiAgICB9CiAgICAKICAgIHN0cnVjdGJvbmQtc2VsZWN0ID4gLnNlbGVjdG9yIHNlbGVjdDpob3ZlciB7CiAgICAgICAgYm9yZGVyLWNvbG9yOiAjOGE4YThhOwogICAgfQogICAgCiAgICBzdHJ1Y3Rib25kLXNlbGVjdCA+IC5zZWxlY3RvciBzZWxlY3Q6Zm9jdXMgewogICAgICAgIGJvcmRlci1jb2xvcjogIzdkN2Q3ZDsKICAgIH0KfQoKLyogQWRkIHN0eWxpbmcgZm9yIGRyb3Bkb3duIG9wdGlvbnMgKi8Kc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3Igc2VsZWN0IG9wdGlvbiB7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KCnRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5zdHJ1Y3Rib25kLXNlbGVjdCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXI6YmVmb3JlIHsKICBjb250ZW50OiAiIjsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogMXB4OwogIGJvdHRvbTogMHB4OwogIGxlZnQ6IDBweDsKICByaWdodDogMHB4OwogIHotaW5kZXg6IC0xOwogIGJhY2tncm91bmQ6ICNjOGVkZDU7ICAKfQoKdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLnN0cnVjdGJvbmQtc2VsZWN0IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHotaW5kZXg6IDEwOwp9CgpAbWVkaWEgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKSB7CiAgdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLnN0cnVjdGJvbmQtc2VsZWN0IHRvZ2dsZXJlYWN0aXZlLWhlYWRlcjpiZWZvcmUgewogICAgYmFja2dyb3VuZDogIzI2NTgyZTsgIAogIH0KfQogICAgPC9zdHlsZT4KPC9zdHJ1Y3Rib25kLXNlbGVjdD4KPC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVXNlIHRoZSBzZWxlY3RvciB0byBjaG9vc2Ugd2hpY2ggU3RydWN0Qm9uZCB0byBkaXNwbGF5IGFuZCB1c2UuIikKCgkJLy8gYWRkIHRoZSBjb2xsYXBzZSBidXR0b24KCQljb25zdCBjb2xsYXBzZV9idG4gPSBodG1sYDxzcGFuIGNsYXNzPSdjb2xsYXBzZSc+YAoJCWhlYWRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBjb2xsYXBzZV9idG4pCgoJCXRyYy5jb2xsYXBzZSA9ICgpID0+IHsKICAJCQl0cmMuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJykKCQl9CgoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IHRyYy5jb2xsYXBzZSgpCgkJCgk8L3NjcmlwdD4KCQk8c3R5bGU+CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQkJCWZsZXg6IDE7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQktLXNpemU6IDE3cHg7CgkJCSAgICBkaXNwbGF5OiBibG9jazsKCQkJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQkJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJCWN1cnNvcjogcG9pbnRlcjsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkID4gdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJZmxleC1ncm93OiAxOwoJCQkJZm9udC1zaXplOiAxOHB4OwoJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyICsgKiB7CgkJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3ZvZnR5Y2FlZWQnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ2b2Z0eWNhZWVkIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSd6cGN0bHZ0Z2h1Jz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KICAgICAgICB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIC0tc2l6ZTogMTVweDsKICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgIHdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGFwcGVhcmFuY2U6IG5vbmU7CiAgICBiYWNrZ3JvdW5kOiAjYzZjNmM2OwogICAgb3V0bGluZTogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CiAgICBib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIG1hcmdpbjogMCAxMHB4Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CiAgICBiYWNrZ3JvdW5kOiAjNEJEODY1Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKICAgIGNvbnRlbnQ6ICcnOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgd2lkdGg6IHZhcigtLXNpemUpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIHRvcDogMHB4OwogICAgbGVmdDogMHB4OwogICAgYmFja2dyb3VuZDogI2ZmZjsKICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsKICAgIGJveC1zaGFkb3c6IDAgY2FsYyh2YXIoLS1zaXplKS8yMCkgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIHRyYW5zaXRpb246IC4xczsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQ6YmVmb3JlIHsKICAgIGxlZnQ6IHZhcigtLXNpemUpCn0JCQoJPC9zdHlsZT4KPC90b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+CjwvYm9uZD6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlqHNic19ib25ksmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVNsQvd7BwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkYmQ1ZWMwODYtNTE1Ni00ZTdjLWE3MGItNWNhOWYwODliYjQ5uWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXORGXNTbVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDIzNThmNjg2LTE5NTAtNDBmOS05ZDVjLWRhYzJkOThmNGMyNIqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHmFpnByZWZpeKNCT0ioZWxlbWVudHORkqNtYWiShaZwcmVmaXijTUFIqGVsZW1lbnRzkZKhYZKhMap0ZXh0L3BsYWlupHR5cGWmc3RydWN0rHByZWZpeF9zaG9ydKNNQUiob2JqZWN0aWSwNWJjYTdjNjk0Yjg4MTZhZNkhYXBwbGljYXRpb24vdm5kLnBsdXRvLnRyZWUrb2JqZWN0pHR5cGWmc3RydWN0rHByZWZpeF9zaG9ydKNCT0iob2JqZWN0aWSwNWJjYTdjNjk2N2YyNzJhY6RtaW1l2SFhcHBsaWNhdGlvbi92bmQucGx1dG8udHJlZStvYmplY3Sscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTWRa5CwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDIzNThmNjg2LTE5NTAtNDBmOS05ZDVjLWRhYzJkOThmNGMyNLlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzSYotXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkNDk1MTYzNzQtZjYyNS00YTg0LWFjNWMtZjkyNDk3ZDQ1MDI1iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedktPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxoMT5ATlRCb25kPC9oMT4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU1kglssHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ0OTUxNjM3NC1mNjI1LTRhODQtYWM1Yy1mOTI0OTdkNDUwMjW5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AA9IOtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkNzA3MTc1YTktZDM1Ni00M2NmLTgwMzgtNjIwZWJjNDAxYzkziqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedrTXzxzY3JpcHQ+CgkKLy8gTG9hZCB0aGUgbGlicmFyeSBmb3IgY29uc2lzdGVudCBzbW9vdGggc2Nyb2xsaW5nCmNvbnN0IHtkZWZhdWx0OiBzY3JvbGxJbnRvVmlld30gPSBhd2FpdCBpbXBvcnQoImRhdGE6dGV4dC9qYXZhc2NyaXB0O2Jhc2U2NCxkbUZ5SUZFOVpUMCtJbTlpYW1WamRDSTlQWFI1Y0dWdlppQmxKaVp1ZFd4c0lUMWxKaVl4UFQwOVpTNXViMlJsVkhsd1pTeFZQU2hsTEhRcFBUNG9JWFI4ZkNKb2FXUmtaVzRpSVQwOVpTa21KaUoyYVhOcFlteGxJaUU5UFdVbUppSmpiR2x3SWlFOVBXVXNRVDBvWlN4MEtUMCtlMmxtS0dVdVkyeHBaVzUwU0dWcFoyaDBQR1V1YzJOeWIyeHNTR1ZwWjJoMGZIeGxMbU5zYVdWdWRGZHBaSFJvUEdVdWMyTnliMnhzVjJsa2RHZ3BlMnhsZENCc1BXZGxkRU52YlhCMWRHVmtVM1I1YkdVb1pTeHVkV3hzS1R0eVpYUjFjbTRnVlNoc0xtOTJaWEptYkc5M1dTeDBLWHg4VlNoc0xtOTJaWEptYkc5M1dDeDBLWHg4S0dVOVBudHNaWFFnZEQwb1pUMCtlMmxtS0NGbExtOTNibVZ5Ukc5amRXMWxiblI4ZkNGbExtOTNibVZ5Ukc5amRXMWxiblF1WkdWbVlYVnNkRlpwWlhjcGNtVjBkWEp1SUc1MWJHdzdkSEo1ZTNKbGRIVnliaUJsTG05M2JtVnlSRzlqZFcxbGJuUXVaR1ZtWVhWc2RGWnBaWGN1Wm5KaGJXVkZiR1Z0Wlc1MGZXTmhkR05vZTNKbGRIVnliaUJ1ZFd4c2ZYMHBLR1VwTzNKbGRIVnliaUVoZENZbUtIUXVZMnhwWlc1MFNHVnBaMmgwUEdVdWMyTnliMnhzU0dWcFoyaDBmSHgwTG1Oc2FXVnVkRmRwWkhSb1BHVXVjMk55YjJ4c1YybGtkR2dwZlNrb1pTbDljbVYwZFhKdUlURjlMRmc5S0dVc2RDeHNMRzhzYml4eUxHa3NjeWs5UG5JOFpTWW1hVDUwZkh4eVBtVW1KbWs4ZEQ4d09uSThQV1VtSm5NOFBXeDhmR2srUFhRbUpuTStQV3cvY2kxbExXODZhVDUwSmlaelBHeDhmSEk4WlNZbWN6NXNQMmt0ZEN0dU9qQXNKRDFsUFQ1bExuQmhjbVZ1ZEVWc1pXMWxiblEvUHlobExtZGxkRkp2YjNST2IyUmxLQ2t1YUc5emRIeDhiblZzYkNrc2RIUTlLR1VzZENrOVBudDJZWElnYkN4dkxHNHNjanRwWmloMGVYQmxiMllnWkc5amRXMWxiblErSW5VaUtYSmxkSFZ5Ymx0ZE8yeGxkSHR6WTNKdmJHeE5iMlJsT21rc1lteHZZMnM2Y3l4cGJteHBibVU2WVN4aWIzVnVaR0Z5ZVRwb0xITnJhWEJQZG1WeVpteHZkMGhwWkdSbGJrVnNaVzFsYm5Sek9uVjlQWFFzWnowaVpuVnVZM1JwYjI0aVBUMTBlWEJsYjJZZ2FEOW9PbVU5UG1VaFBUMW9PMmxtS0NGUktHVXBLWFJvY205M0lGUjVjR1ZGY25KdmNpZ2lTVzUyWVd4cFpDQjBZWEpuWlhRaUtUdHNaWFFnZGoxa2IyTjFiV1Z1ZEM1elkzSnZiR3hwYm1kRmJHVnRaVzUwZkh4a2IyTjFiV1Z1ZEM1a2IyTjFiV1Z1ZEVWc1pXMWxiblFzYlQxYlhTeDNQV1U3Wm05eUtEdFJLSGNwSmlabktIY3BPeWw3YVdZb0tIYzlKQ2gzS1NrOVBUMTJLWHR0TG5CMWMyZ29keWs3WW5KbFlXdDliblZzYkNFOWR5WW1kejA5UFdSdlkzVnRaVzUwTG1KdlpIa21Ka0VvZHlrbUppRkJLR1J2WTNWdFpXNTBMbVJ2WTNWdFpXNTBSV3hsYldWdWRDbDhmRzUxYkd3aFBYY21Ka0VvZHl4MUtTWW1iUzV3ZFhOb0tIY3BmV3hsZENCWFBXNTFiR3doUFNodlBXNTFiR3c5UFNoc1BYZHBibVJ2ZHk1MmFYTjFZV3hXYVdWM2NHOXlkQ2svZG05cFpDQXdPbXd1ZDJsa2RHZ3BQMjg2YVc1dVpYSlhhV1IwYUN4SVBXNTFiR3doUFNoeVBXNTFiR3c5UFNodVBYZHBibVJ2ZHk1MmFYTjFZV3hXYVdWM2NHOXlkQ2svZG05cFpDQXdPbTR1YUdWcFoyaDBLVDl5T21sdWJtVnlTR1ZwWjJoMExIdHpZM0p2Ykd4WU9sOHNjMk55YjJ4c1dUcDRmVDEzYVc1a2IzY3NlMmhsYVdkb2REcEZMSGRwWkhSb09sUXNkRzl3T2s0c2NtbG5hSFE2VEN4aWIzUjBiMjA2V1N4c1pXWjBPa045UFdVdVoyVjBRbTkxYm1ScGJtZERiR2xsYm5SU1pXTjBLQ2tzVWowaWMzUmhjblFpUFQwOWMzeDhJbTVsWVhKbGMzUWlQVDA5Y3o5T09pSmxibVFpUFQwOWN6OVpPazRyUlM4eUxGWTlJbU5sYm5SbGNpSTlQVDFoUDBNclZDOHlPaUpsYm1RaVBUMDlZVDlNT2tNc1FqMWJYVHRtYjNJb2JHVjBJRVE5TUR0RVBHMHViR1Z1WjNSb08wUXJLeWw3YkdWMElFODliVnRFWFN4N2FHVnBaMmgwT21vc2QybGtkR2c2U1N4MGIzQTZVeXh5YVdkb2REcHhMR0p2ZEhSdmJUcDZMR3hsWm5RNlJuMDlUeTVuWlhSQ2IzVnVaR2x1WjBOc2FXVnVkRkpsWTNRb0tUdHBaaWdpYVdZdGJtVmxaR1ZrSWowOVBXa21KazQrUFRBbUprTStQVEFtSmxrOFBVZ21Ka3c4UFZjbUprNCtQVk1tSmxrOFBYb21Ka00rUFVZbUprdzhQWEVwWW5KbFlXczdiR1YwSUVjOVoyVjBRMjl0Y0hWMFpXUlRkSGxzWlNoUEtTeEtQWEJoY25ObFNXNTBLRWN1WW05eVpHVnlUR1ZtZEZkcFpIUm9MREV3S1N4TFBYQmhjbk5sU1c1MEtFY3VZbTl5WkdWeVZHOXdWMmxrZEdnc01UQXBMRkE5Y0dGeWMyVkpiblFvUnk1aWIzSmtaWEpTYVdkb2RGZHBaSFJvTERFd0tTeGFQWEJoY25ObFNXNTBLRWN1WW05eVpHVnlRbTkwZEc5dFYybGtkR2dzTVRBcExHVmxQVEFzWlhROU1DeGxiRDBpYjJabWMyVjBWMmxrZEdnaWFXNGdUejlQTG05bVpuTmxkRmRwWkhSb0xVOHVZMnhwWlc1MFYybGtkR2d0U2kxUU9qQXNaVzg5SW05bVpuTmxkRWhsYVdkb2RDSnBiaUJQUDA4dWIyWm1jMlYwU0dWcFoyaDBMVTh1WTJ4cFpXNTBTR1ZwWjJoMExVc3RXam93TEdWdVBTSnZabVp6WlhSWGFXUjBhQ0pwYmlCUFB6QTlQVDFQTG05bVpuTmxkRmRwWkhSb1B6QTZTUzlQTG05bVpuTmxkRmRwWkhSb09qQXNaWEk5SW05bVpuTmxkRWhsYVdkb2RDSnBiaUJQUHpBOVBUMVBMbTltWm5ObGRFaGxhV2RvZEQ4d09tb3ZUeTV2Wm1aelpYUklaV2xuYUhRNk1EdHBaaWgyUFQwOVR5bGxaVDBpYzNSaGNuUWlQVDA5Y3o5U09pSmxibVFpUFQwOWN6OVNMVWc2SW01bFlYSmxjM1FpUFQwOWN6OVlLSGdzZUN0SUxFZ3NTeXhhTEhnclVpeDRLMUlyUlN4RktUcFNMVWd2TWl4bGREMGljM1JoY25RaVBUMDlZVDlXT2lKalpXNTBaWElpUFQwOVlUOVdMVmN2TWpvaVpXNWtJajA5UFdFL1ZpMVhPbGdvWHl4ZksxY3NWeXhLTEZBc1h5dFdMRjhyVml0VUxGUXBMR1ZsUFUxaGRHZ3ViV0Y0S0RBc1pXVXJlQ2tzWlhROVRXRjBhQzV0WVhnb01DeGxkQ3RmS1R0bGJITmxlMlZsUFNKemRHRnlkQ0k5UFQxelAxSXRVeTFMT2lKbGJtUWlQVDA5Y3o5U0xYb3JXaXRsYnpvaWJtVmhjbVZ6ZENJOVBUMXpQMWdvVXl4NkxHb3NTeXhhSzJWdkxGSXNVaXRGTEVVcE9sSXRLRk1yYWk4eUtTdGxieTh5TEdWMFBTSnpkR0Z5ZENJOVBUMWhQMVl0UmkxS09pSmpaVzUwWlhJaVBUMDlZVDlXTFNoR0swa3ZNaWtyWld3dk1qb2laVzVrSWowOVBXRS9WaTF4SzFBclpXdzZXQ2hHTEhFc1NTeEtMRkFyWld3c1ZpeFdLMVFzVkNrN2JHVjBlM05qY205c2JFeGxablE2Wldrc2MyTnliMnhzVkc5d09tVmtmVDFQTzJWbFBVMWhkR2d1YldGNEtEQXNUV0YwYUM1dGFXNG9aV1FyWldVdlpYSXNUeTV6WTNKdmJHeElaV2xuYUhRdGFpOWxjaXRsYnlrcExHVjBQVTFoZEdndWJXRjRLREFzVFdGMGFDNXRhVzRvWldrclpYUXZaVzRzVHk1elkzSnZiR3hYYVdSMGFDMUpMMlZ1SzJWc0tTa3NVaXM5WldRdFpXVXNWaXM5WldrdFpYUjlRaTV3ZFhOb0tIdGxiRHBQTEhSdmNEcGxaU3hzWldaME9tVjBmU2w5Y21WMGRYSnVJRUo5TEdZOVpUMCtlM1poY2lCME8zSmxkSFZ5YmlFeFBUMDlaVDk3WW14dlkyczZJbVZ1WkNJc2FXNXNhVzVsT2lKdVpXRnlaWE4wSW4wNktIUTlaU2s5UFQxUFltcGxZM1FvZENrbUpqQWhQVDFQWW1wbFkzUXVhMlY1Y3loMEtTNXNaVzVuZEdnL1pUcDdZbXh2WTJzNkluTjBZWEowSWl4cGJteHBibVU2SW01bFlYSmxjM1FpZlgwN1puVnVZM1JwYjI0Z1l5aGxMSFFwZTNaaGNpQnNPMmxtS0NGbExtbHpRMjl1Ym1WamRHVmtmSHdoS0dVOVBudHNaWFFnZEQxbE8yWnZjaWc3ZENZbWRDNXdZWEpsYm5ST2IyUmxPeWw3YVdZb2RDNXdZWEpsYm5ST2IyUmxQVDA5Wkc5amRXMWxiblFwY21WMGRYSnVJVEE3ZEQxMExuQmhjbVZ1ZEU1dlpHVWdhVzV6ZEdGdVkyVnZaaUJUYUdGa2IzZFNiMjkwUDNRdWNHRnlaVzUwVG05a1pTNW9iM04wT25RdWNHRnlaVzUwVG05a1pYMXlaWFIxY200aE1YMHBLR1VwS1hKbGRIVnlianRwWmlnaWIySnFaV04wSWowOWRIbHdaVzltS0d3OWRDa21KaUptZFc1amRHbHZiaUk5UFhSNWNHVnZaaUJzTG1KbGFHRjJhVzl5S1hKbGRIVnliaUIwTG1KbGFHRjJhVzl5S0hSMEtHVXNkQ2twTzJ4bGRDQnZQU0ppYjI5c1pXRnVJajA5ZEhsd1pXOW1JSFI4Zkc1MWJHdzlQWFEvZG05cFpDQXdPblF1WW1Wb1lYWnBiM0k3Wm05eUtHeGxkSHRsYkRwdUxIUnZjRHB5TEd4bFpuUTZhWDF2WmlCMGRDaGxMR1lvZENrcEtXNHVjMk55YjJ4c0tIdDBiM0E2Y2l4c1pXWjBPbWtzWW1Wb1lYWnBiM0k2YjMwcGZYWmhjaUJrTEhBOUtDazlQaWhrZkh3b1pEMGljR1Z5Wm05eWJXRnVZMlVpYVc0Z2QybHVaRzkzUDNCbGNtWnZjbTFoYm1ObExtNXZkeTVpYVc1a0tIQmxjbVp2Y20xaGJtTmxLVHBFWVhSbExtNXZkeWtzWkNncEtUdG1kVzVqZEdsdmJpQmlLR1VwZTJ4bGRDQjBQVTFoZEdndWJXbHVLQ2h3S0NrdFpTNXpkR0Z5ZEZScGJXVXBMMlV1WkhWeVlYUnBiMjRzTVNrc2JEMWxMbVZoYzJVb2RDa3NiejFsTG5OMFlYSjBXQ3NvWlM1NExXVXVjM1JoY25SWUtTcHNMRzQ5WlM1emRHRnlkRmtyS0dVdWVTMWxMbk4wWVhKMFdTa3FiRHRsTG0xbGRHaHZaQ2h2TEc0c2RDeHNLU3h2SVQwOVpTNTRmSHh1SVQwOVpTNTVQM0psY1hWbGMzUkJibWx0WVhScGIyNUdjbUZ0WlNnb0tUMCtZaWhsS1NrNlpTNWpZaWdwZldaMWJtTjBhVzl1SUhrb1pTeDBMR3dwZTJ4bGRDQnZQV0Z5WjNWdFpXNTBjeTVzWlc1bmRHZytNeVltZG05cFpDQXdJVDA5WVhKbmRXMWxiblJ6V3pOZFAyRnlaM1Z0Wlc1MGMxc3pYVG8yTURBc2JqMWhjbWQxYldWdWRITXViR1Z1WjNSb1BqUW1Kblp2YVdRZ01DRTlQV0Z5WjNWdFpXNTBjMXMwWFQ5aGNtZDFiV1Z1ZEhOYk5GMDZaVDArTVNzdExXVXFaU3BsS21VcVpTeHlQV0Z5WjNWdFpXNTBjeTVzWlc1bmRHZytOVDloY21kMWJXVnVkSE5iTlYwNmRtOXBaQ0F3TEdrOVlYSm5kVzFsYm5SekxteGxibWQwYUQ0MlAyRnlaM1Z0Wlc1MGMxczJYVHAyYjJsa0lEQXNjejFsTG5OamNtOXNiRXhsWm5Rc1lUMWxMbk5qY205c2JGUnZjRHRpS0h0elkzSnZiR3hoWW14bE9tVXNiV1YwYUc5a0tIUXNiQ3h2TEc0cGUyeGxkQ0J5UFUxaGRHZ3VZMlZwYkNoMEtTeHpQVTFoZEdndVkyVnBiQ2hzS1R0bExuTmpjbTlzYkV4bFpuUTljaXhsTG5OamNtOXNiRlJ2Y0QxekxHay9MaWg3ZEdGeVoyVjBPbVVzWld4aGNITmxaRHB2TEhaaGJIVmxPbTRzYkdWbWREcHlMSFJ2Y0RwemZTbDlMSE4wWVhKMFZHbHRaVHB3S0Nrc2MzUmhjblJZT25Nc2MzUmhjblJaT21Fc2VEcDBMSGs2YkN4a2RYSmhkR2x2YmpwdkxHVmhjMlU2Yml4allqcHlmU2w5ZG1GeUlFMDlaVDArWlNZbUlXVXVZbVZvWVhacGIzSjhmQ0p6Ylc5dmRHZ2lQVDA5WlM1aVpXaGhkbWx2Y2l4clBXWjFibU4wYVc5dUtHVXNkQ2w3YkdWMElHdzlkSHg4ZTMwN2NtVjBkWEp1SUUwb2JDay9ZeWhsTEh0aWJHOWphenBzTG1Kc2IyTnJMR2x1YkdsdVpUcHNMbWx1YkdsdVpTeHpZM0p2Ykd4TmIyUmxPbXd1YzJOeWIyeHNUVzlrWlN4aWIzVnVaR0Z5ZVRwc0xtSnZkVzVrWVhKNUxITnJhWEJQZG1WeVpteHZkMGhwWkdSbGJrVnNaVzFsYm5Sek9td3VjMnRwY0U5MlpYSm1iRzkzU0dsa1pHVnVSV3hsYldWdWRITXNZbVZvWVhacGIzSTZaVDArVUhKdmJXbHpaUzVoYkd3b1pTNXlaV1IxWTJVb0tHVXNkQ2s5UG50c1pYUjdaV3c2Ynl4c1pXWjBPbTRzZEc5d09uSjlQWFFzYVQxdkxuTmpjbTlzYkV4bFpuUXNjejF2TG5OamNtOXNiRlJ2Y0R0eVpYUjFjbTRnYVQwOVBXNG1Kbk05UFQxeVAyVTZXeTR1TG1Vc2JtVjNJRkJ5YjIxcGMyVW9aVDArZVNodkxHNHNjaXhzTG1SMWNtRjBhVzl1TEd3dVpXRnpaU3dvS1QwK1pTaDdaV3c2Ynl4c1pXWjBPbHRwTEc1ZExIUnZjRHBiY3l4eVhYMHBMR3d1YjI1VFkzSnZiR3hEYUdGdVoyVXBLVjE5TEZ0ZEtTbDlLVHBRY205dGFYTmxMbkpsYzI5c2RtVW9ZeWhsTEhRcEtYMDdaWGh3YjNKMGUyc2dZWE1nWkdWbVlYVnNkSDA3IikKCmNvbnN0IGluZGVudCA9IHRydWUKY29uc3QgYXNpZGUgPSB0cnVlCmNvbnN0IHRpdGxlX3RleHQgPSAiVGFibGUgb2YgQ29udGVudHMiCmNvbnN0IGluY2x1ZGVfZGVmaW5pdGlvbnMgPSBmYWxzZQoKCmNvbnN0IHRvY05vZGUgPSBodG1sYDxuYXYgY2xhc3M9InBsdXRvdWktdG9jIj4KCTxoZWFkZXI+CgkgPHNwYW4gY2xhc3M9InRvYy10b2dnbGUgb3Blbi10b2MiPjwvc3Bhbj4KCSA8c3BhbiBjbGFzcz0idG9jLXRvZ2dsZSBjbG9zZWQtdG9jIj48L3NwYW4+CgkgJHt0aXRsZV90ZXh0fQoJPC9oZWFkZXI+Cgk8c2VjdGlvbj48L3NlY3Rpb24+CjwvbmF2PmAKCnRvY05vZGUuY2xhc3NMaXN0LnRvZ2dsZSgiYXNpZGUiLCBhc2lkZSkKdG9jTm9kZS5jbGFzc0xpc3QudG9nZ2xlKCJpbmRlbnQiLCBpbmRlbnQpCgoKY29uc3QgZ2V0UGFyZW50Q2VsbCA9IGVsID0+IGVsLmNsb3Nlc3QoInBsdXRvLWNlbGwiKQoKY29uc3QgZ2V0SGVhZGVycyA9ICgpID0+IHsKCWNvbnN0IGRlcHRoID0gTWF0aC5tYXgoMSwgTWF0aC5taW4oNiwgMykpIC8vIHNob3VsZCBiZSBpbiByYW5nZSAxOjYKCWNvbnN0IHJhbmdlID0gQXJyYXkuZnJvbSh7bGVuZ3RoOiBkZXB0aH0sICh4LCBpKSA9PiBpKzEpIC8vIFsxLCAuLi4sIGRlcHRoXQoJCgljb25zdCBzZWxlY3RvciA9IFsKCQkuLi4oaW5jbHVkZV9kZWZpbml0aW9ucyA/IFsKCQkJYHBsdXRvLW5vdGVib29rIHBsdXRvLWNlbGwgLnBsdXRvLWRvY3MtYmluZGluZ2AsIAoJCQlgcGx1dG8tbm90ZWJvb2sgcGx1dG8tY2VsbCBhc3NpZ25lZTpub3QoOmVtcHR5KWAsIAoJCV0gOiBbXSksCgkJLi4ucmFuZ2UubWFwKGkgPT4gYHBsdXRvLW5vdGVib29rIHBsdXRvLWNlbGwgaCR7aX1gKQoJXS5qb2luKCIsIikKCXJldHVybiBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpKS5maWx0ZXIoZWwgPT4gCgkJLy8gZXhjbHVkZSBoZWFkZXJzIGluc2lkZSBvZiBhIHBsdXRvLWRvY3MtYmluZGluZyBibG9jawoJCSEoZWwubm9kZU5hbWUuc3RhcnRzV2l0aCgiSCIpICYmIGVsLmNsb3Nlc3QoIi5wbHV0by1kb2NzLWJpbmRpbmciKSkKCSkKfQoKCmNvbnN0IGRvY3VtZW50X2NsaWNrX2hhbmRsZXIgPSAoZXZlbnQpID0+IHsKCWNvbnN0IHBhdGggPSAoZXZlbnQucGF0aCB8fCBldmVudC5jb21wb3NlZFBhdGgoKSkKCWNvbnN0IHRvYyA9IHBhdGguZmluZChlbGVtID0+IGVsZW0/LmNsYXNzTGlzdD8uY29udGFpbnM/LigidG9jLXRvZ2dsZSIpKQoJaWYgKHRvYykgewoJCWV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpCgkJdG9jLmNsb3Nlc3QoIi5wbHV0b3VpLXRvYyIpLmNsYXNzTGlzdC50b2dnbGUoImhpZGUiKQoJfQp9Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGRvY3VtZW50X2NsaWNrX2hhbmRsZXIpCgoKY29uc3QgaGVhZGVyX3RvX2luZGV4X2VudHJ5X21hcCA9IG5ldyBNYXAoKQpjb25zdCBjdXJyZW50bHlfaGlnaGxpZ2h0ZWRfc2V0ID0gbmV3IFNldCgpCgpjb25zdCBsYXN0X3RvY19lbGVtZW50X2NsaWNrX3RpbWUgPSB7IGN1cnJlbnQ6IDAgfQoKY29uc3QgaW50ZXJzZWN0aW9uX2NhbGxiYWNrID0gKGl4cykgPT4gewoJbGV0IG9uX3RvcCA9IGl4cy5maWx0ZXIoaXggPT4gaXguaW50ZXJzZWN0aW9uUmF0aW8gPiAwICYmIGl4LmludGVyc2VjdGlvblJlY3QueSA8IGl4LnJvb3RCb3VuZHMuaGVpZ2h0IC8gMikKCWlmKG9uX3RvcC5sZW5ndGggPiAwKXsKCQljdXJyZW50bHlfaGlnaGxpZ2h0ZWRfc2V0LmZvckVhY2goYSA9PiBhLmNsYXNzTGlzdC5yZW1vdmUoImluLXZpZXciKSkKCQljdXJyZW50bHlfaGlnaGxpZ2h0ZWRfc2V0LmNsZWFyKCkKCQlvbl90b3Auc2xpY2UoMCwxKS5mb3JFYWNoKGkgPT4gewoJCQlsZXQgZGl2ID0gaGVhZGVyX3RvX2luZGV4X2VudHJ5X21hcC5nZXQoaS50YXJnZXQpCgkJCWRpdi5jbGFzc0xpc3QuYWRkKCJpbi12aWV3IikKCQkJY3VycmVudGx5X2hpZ2hsaWdodGVkX3NldC5hZGQoZGl2KQoJCQkKCQkJLy8vIHNjcm9sbCBpbnRvIHZpZXcKCQkJLyoKCQkJY29uc3QgdG9jX2hlaWdodCA9IHRvY05vZGUub2Zmc2V0SGVpZ2h0CgkJCWNvbnN0IGRpdl9wb3MgPSBkaXYub2Zmc2V0VG9wCgkJCWNvbnN0IGRpdl9oZWlnaHQgPSBkaXYub2Zmc2V0SGVpZ2h0CgkJCWNvbnN0IGN1cnJlbnRfc2Nyb2xsID0gdG9jTm9kZS5zY3JvbGxUb3AKCQkJY29uc3QgaGVhZGVyX2hlaWdodCA9IHRvY05vZGUucXVlcnlTZWxlY3RvcigiaGVhZGVyIikub2Zmc2V0SGVpZ2h0CgkJCQoJCQljb25zdCBzY3JvbGxfdG9fdG9wID0gZGl2X3BvcyAtIGhlYWRlcl9oZWlnaHQKCQkJY29uc3Qgc2Nyb2xsX3RvX2JvdHRvbSA9IGRpdl9wb3MgKyBkaXZfaGVpZ2h0IC0gdG9jX2hlaWdodAoJCQkKCQkJLy8gaWYgd2Ugc2V0IGEgc2Nyb2xsVG9wLCB0aGVuIHRoZSBicm93c2VyIHdpbGwgc3RvcCBhbnkgY3VycmVudGx5IG9uZ29pbmcgc21vb3Roc2Nyb2xsIGFuaW1hdGlvbi4gU28gbGV0J3Mgb25seSBkbyB0aGlzIGlmIHlvdSBhcmUgbm90IGN1cnJlbnRseSBpbiBhIHNtb290aHNjcm9sbC4KCQkJaWYoRGF0ZS5ub3coKSAtIGxhc3RfdG9jX2VsZW1lbnRfY2xpY2tfdGltZS5jdXJyZW50ID49IDIwMDApCgkJCQlpZihjdXJyZW50X3Njcm9sbCA8IHNjcm9sbF90b19ib3R0b20pewoJCQkJCXRvY05vZGUuc2Nyb2xsVG9wID0gc2Nyb2xsX3RvX2JvdHRvbQoJCQkJfSBlbHNlIGlmKGN1cnJlbnRfc2Nyb2xsID4gc2Nyb2xsX3RvX3RvcCl7CgkJCQkJdG9jTm9kZS5zY3JvbGxUb3AgPSBzY3JvbGxfdG9fdG9wCgkJCQl9CgkJCSovCgkJfSkKCX0KfQpsZXQgaW50ZXJzZWN0aW9uX29ic2VydmVyXzEgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoaW50ZXJzZWN0aW9uX2NhbGxiYWNrLCB7Cglyb290OiBudWxsLCAvLyBpLmUuIHRoZSB2aWV3cG9ydAogIAl0aHJlc2hvbGQ6IDEsCglyb290TWFyZ2luOiAiLTE1cHgiLCAvLyBzbGlnaHRseSBzbWFsbGVyIHRoYW4gdGhlIHZpZXdwb3J0CgkvLyBkZWxheTogMTAwLAp9KQpsZXQgaW50ZXJzZWN0aW9uX29ic2VydmVyXzIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoaW50ZXJzZWN0aW9uX2NhbGxiYWNrLCB7Cglyb290OiBudWxsLCAvLyBpLmUuIHRoZSB2aWV3cG9ydAogIAl0aHJlc2hvbGQ6IDEsCglyb290TWFyZ2luOiAiMTVweCIsIC8vIHNsaWdodGx5IGxhcmdlciB0aGFuIHRoZSB2aWV3cG9ydAoJLy8gZGVsYXk6IDEwMCwKfSkKCmNvbnN0IHJlbmRlciA9IChlbGVtZW50cykgPT4gewoJaGVhZGVyX3RvX2luZGV4X2VudHJ5X21hcC5jbGVhcigpCgljdXJyZW50bHlfaGlnaGxpZ2h0ZWRfc2V0LmNsZWFyKCkKCWludGVyc2VjdGlvbl9vYnNlcnZlcl8xLmRpc2Nvbm5lY3QoKQoJaW50ZXJzZWN0aW9uX29ic2VydmVyXzIuZGlzY29ubmVjdCgpCgoJCWxldCBsYXN0X2xldmVsID0gYEgxYAoJcmV0dXJuIGh0bWxgJHtlbGVtZW50cy5tYXAoaCA9PiB7Cgljb25zdCBwYXJlbnRfY2VsbCA9IGdldFBhcmVudENlbGwoaCkKCgkJbGV0IFtjbGFzc05hbWUsIHRpdGxlX2VsXSA9IGgubWF0Y2hlcyhgLnBsdXRvLWRvY3MtYmluZGluZ2ApID8gWyJwbHV0by1kb2NzLWJpbmRpbmctZWwiLCBoLmZpcnN0RWxlbWVudENoaWxkXSA6IFtoLm5vZGVOYW1lLCBoXQoKCWNvbnN0IGEgPSBodG1sYDxhIAoJCWNsYXNzPSIke2NsYXNzTmFtZX0iIAoJCXRpdGxlPSIke3RpdGxlX2VsLmlubmVyVGV4dH0iCgkJaHJlZj0iIyR7cGFyZW50X2NlbGwuaWR9IgoJPiR7dGl0bGVfZWwuaW5uZXJIVE1MfTwvYT5gCgkvKiBhLm9ubW91c2VvdmVyPSgpPT57CgkJcGFyZW50X2NlbGwuZmlyc3RFbGVtZW50Q2hpbGQuY2xhc3NMaXN0LmFkZCgKCQkJJ2hpZ2hsaWdodC1wbHV0by1jZWxsLXNob3VsZGVyJwoJCSkKCX0KCWEub25tb3VzZW91dD0oKSA9PiB7CgkJcGFyZW50X2NlbGwuZmlyc3RFbGVtZW50Q2hpbGQuY2xhc3NMaXN0LnJlbW92ZSgKCQkJJ2hpZ2hsaWdodC1wbHV0by1jZWxsLXNob3VsZGVyJwoJCSkKCX0gKi8KCQkKCQkKCWEub25jbGljaz0oZSkgPT4gewoJCWUucHJldmVudERlZmF1bHQoKTsKCQlsYXN0X3RvY19lbGVtZW50X2NsaWNrX3RpbWUuY3VycmVudCA9IERhdGUubm93KCkKCQlzY3JvbGxJbnRvVmlldyhoLCB7CgkJCWJlaGF2aW9yOiAnc21vb3RoJywgCgkJCWJsb2NrOiAnc3RhcnQnLAoJCX0pLnRoZW4oKCkgPT4gCgkJCS8vIHNvbWV0aW1lcyBpdCBkb2Vzbid0IHNjcm9sbCB0byB0aGUgcmlnaHQgcGxhY2UKCQkJLy8gc29sdXRpb246IHRyeSBhIHNlY29uZCB0aW1lIQoJCQlzY3JvbGxJbnRvVmlldyhoLCB7CgkJCQliZWhhdmlvcjogJ3Ntb290aCcsIAoJCQkJYmxvY2s6ICdzdGFydCcsCgkJCX0pCgkgICApCgl9CgoJY29uc3Qgcm93ID0gIGh0bWxgPGRpdiBjbGFzcz0idG9jLXJvdyAke2NsYXNzTmFtZX0gYWZ0ZXItJHtsYXN0X2xldmVsfSI+JHthfTwvZGl2PmAKCQlpbnRlcnNlY3Rpb25fb2JzZXJ2ZXJfMS5vYnNlcnZlKHRpdGxlX2VsKQoJCWludGVyc2VjdGlvbl9vYnNlcnZlcl8yLm9ic2VydmUodGl0bGVfZWwpCgkJaGVhZGVyX3RvX2luZGV4X2VudHJ5X21hcC5zZXQodGl0bGVfZWwsIHJvdykKCglpZihjbGFzc05hbWUuc3RhcnRzV2l0aCgiSCIpKQoJCWxhc3RfbGV2ZWwgPSBjbGFzc05hbWUKCQkKCXJldHVybiByb3cKfSl9YAp9Cgpjb25zdCBpbnZhbGlkYXRlZCA9IHsgY3VycmVudDogZmFsc2UgfQoKY29uc3QgdXBkYXRlQ2FsbGJhY2sgPSAoKSA9PiB7CglpZiAoIWludmFsaWRhdGVkLmN1cnJlbnQpIHsKCQl0b2NOb2RlLnF1ZXJ5U2VsZWN0b3IoInNlY3Rpb24iKS5yZXBsYWNlV2l0aCgKCQkJaHRtbGA8c2VjdGlvbj4ke3JlbmRlcihnZXRIZWFkZXJzKCkpfTwvc2VjdGlvbj5gCgkJKQoJfQp9CnVwZGF0ZUNhbGxiYWNrKCkKc2V0VGltZW91dCh1cGRhdGVDYWxsYmFjaywgMTAwKQpzZXRUaW1lb3V0KHVwZGF0ZUNhbGxiYWNrLCAxMDAwKQpzZXRUaW1lb3V0KHVwZGF0ZUNhbGxiYWNrLCA1MDAwKQoKY29uc3Qgbm90ZWJvb2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJwbHV0by1ub3RlYm9vayIpCgoKLy8gV2UgaGF2ZSBhIG11dGF0aW9ub2JzZXJ2ZXIgZm9yIGVhY2ggY2VsbDoKY29uc3QgbXV0X29ic2VydmVycyA9IHsKCWN1cnJlbnQ6IFtdLAp9Cgpjb25zdCBjcmVhdGVDZWxsT2JzZXJ2ZXJzID0gKCkgPT4gewoJbXV0X29ic2VydmVycy5jdXJyZW50LmZvckVhY2goKG8pID0+IG8uZGlzY29ubmVjdCgpKQoJbXV0X29ic2VydmVycy5jdXJyZW50ID0gQXJyYXkuZnJvbShub3RlYm9vay5xdWVyeVNlbGVjdG9yQWxsKCJwbHV0by1jZWxsIikpLm1hcChlbCA9PiB7CgkJY29uc3QgbyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHVwZGF0ZUNhbGxiYWNrKQoJCW8ub2JzZXJ2ZShlbCwge2F0dHJpYnV0ZUZpbHRlcjogWyJjbGFzcyJdfSkKCQlyZXR1cm4gbwoJfSkKfQpjcmVhdGVDZWxsT2JzZXJ2ZXJzKCkKCi8vIEFuZCBvbmUgZm9yIHRoZSBub3RlYm9vaydzIGNoaWxkIGxpc3QsIHdoaWNoIHVwZGF0ZXMgb3VyIGNlbGwgb2JzZXJ2ZXJzOgpjb25zdCBub3RlYm9va09ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4gewoJdXBkYXRlQ2FsbGJhY2soKQoJY3JlYXRlQ2VsbE9ic2VydmVycygpCn0pCm5vdGVib29rT2JzZXJ2ZXIub2JzZXJ2ZShub3RlYm9vaywge2NoaWxkTGlzdDogdHJ1ZX0pCgovLyBBbmQgZmluYWxseSwgYW4gb2JzZXJ2ZXIgZm9yIHRoZSBkb2N1bWVudC5ib2R5IGNsYXNzTGlzdCwgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHRvYyBhbHNvIHdvcmtzIHdoZW4gaXQgaXMgbG9hZGVkIGR1cmluZyBub3RlYm9vayBpbml0aWFsaXphdGlvbgpjb25zdCBib2R5Q2xhc3NPYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHVwZGF0ZUNhbGxiYWNrKQpib2R5Q2xhc3NPYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHthdHRyaWJ1dGVGaWx0ZXI6IFsiY2xhc3MiXX0pCgovLyBIaWRlL3Nob3cgdGhlIFRvQyB3aGVuIHRoZSBzY3JlZW4gZ2V0cyBzbWFsbApsZXQgbWF0Y2hfbGlzdGVuZXIgPSAoKSA9PiAKCXRvY05vZGUuY2xhc3NMaXN0LnRvZ2dsZSgiaGlkZSIsICh0b2NOb2RlLmNsb3Nlc3QoInBsdXRvLWVkaXRvciIpID8/IGRvY3VtZW50LmJvZHkpLnNjcm9sbFdpZHRoIDwgMTAwMCkKZm9yKGxldCBzIG9mIFsxMDAwLCAxMTAwLCAxMjAwLCAxMzAwLCAxNDAwLCAxNTAwLCAxNjAwLCAxNzAwLCAxODAwLCAxOTAwLCAyMDAwXSkgewoJbGV0IG0gPSBtYXRjaE1lZGlhKGAobWF4LXdpZHRoOiAke3N9cHgpYCkKCW0uYWRkTGlzdGVuZXIobWF0Y2hfbGlzdGVuZXIpCglpbnZhbGlkYXRpb24udGhlbigoKSA9PiBtLnJlbW92ZUxpc3RlbmVyKG1hdGNoX2xpc3RlbmVyKSkKfQptYXRjaF9saXN0ZW5lcigpCgppbnZhbGlkYXRpb24udGhlbigoKSA9PiB7CglpbnZhbGlkYXRlZC5jdXJyZW50ID0gdHJ1ZQoJaW50ZXJzZWN0aW9uX29ic2VydmVyXzEuZGlzY29ubmVjdCgpCglpbnRlcnNlY3Rpb25fb2JzZXJ2ZXJfMi5kaXNjb25uZWN0KCkKCW5vdGVib29rT2JzZXJ2ZXIuZGlzY29ubmVjdCgpCglib2R5Q2xhc3NPYnNlcnZlci5kaXNjb25uZWN0KCkKCW11dF9vYnNlcnZlcnMuY3VycmVudC5mb3JFYWNoKChvKSA9PiBvLmRpc2Nvbm5lY3QoKSkKCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZG9jdW1lbnRfY2xpY2tfaGFuZGxlcikKfSkKCnJldHVybiB0b2NOb2RlCjwvc2NyaXB0Pgo8c3R5bGU+CkBtZWRpYSBub3QgcHJpbnQgewoKLnBsdXRvdWktdG9jIHsKCWZvbnQtZmFtaWx5OiAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICJTZWdvZSBVSSIsIFJvYm90bywgT3h5Z2VuLVNhbnMsIENhbnRhcmVsbCwgIkFwcGxlIENvbG9yIEVtb2ppIiwKCQkiU2Vnb2UgVUkgRW1vamkiLCAiU2Vnb2UgVUkgU3ltYm9sIiwgc3lzdGVtLXVpLCBzYW5zLXNlcmlmOwoJLS1tYWluLWJnLWNvbG9yOiAjZmFmYWZhOwoJLS1wbHV0by1vdXRwdXQtY29sb3I6IGhzbCgwLCAwJSwgMzYlKTsKCS0tcGx1dG8tb3V0cHV0LWgtY29sb3I6IGhzbCgwLCAwJSwgMjElKTsKCS0tc2lkZWJhci1saS1hY3RpdmUtYmc6IHJnYigyMzUsIDIzNSwgMjM1KTsKCS0taWNvbi1maWx0ZXI6IHVuc2V0Owp9CgpAbWVkaWEgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKSB7CgkucGx1dG91aS10b2MgewoJCS0tbWFpbi1iZy1jb2xvcjogIzMwMzAzMDsKCQktLXBsdXRvLW91dHB1dC1jb2xvcjogaHNsKDAsIDAlLCA5MCUpOwoJCS0tcGx1dG8tb3V0cHV0LWgtY29sb3I6IGhzbCgwLCAwJSwgOTclKTsKCQktLXNpZGViYXItbGktYWN0aXZlLWJnOiByZ2IoODIsIDgyLCA4Mik7CgkJLS1pY29uLWZpbHRlcjogaW52ZXJ0KDEpOwoJfQp9CgoucGx1dG91aS10b2MuYXNpZGUgewoJY29sb3I6IHZhcigtLXBsdXRvLW91dHB1dC1jb2xvcik7Cglwb3NpdGlvbjogZml4ZWQ7CglyaWdodDogMXJlbTsKCXRvcDogNXJlbTsKCXdpZHRoOiBtaW4oODB2dywgMzAwcHgpOwoJcGFkZGluZzogMC41cmVtOwoJcGFkZGluZy10b3A6IDBlbTsKCS8qIGJvcmRlcjogM3B4IHNvbGlkIHJnYmEoMCwgMCwgMCwgMC4xNSk7ICovCglib3JkZXItcmFkaXVzOiAxMHB4OwoJLyogYm94LXNoYWRvdzogMCAwIDExcHggMHB4ICMwMDAwMDAxMDsgKi8KCW1heC1oZWlnaHQ6IGNhbGMoMTAwdmggLSA1cmVtIC0gOTBweCk7CglvdmVyZmxvdzogYXV0bzsKCXotaW5kZXg6IDQwOwoJYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbWFpbi1iZy1jb2xvcik7Cgl0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMzAwbXMgY3ViaWMtYmV6aWVyKDAuMTgsIDAuODksIDAuNDUsIDEuMTIpOwp9CgoucGx1dG91aS10b2MuYXNpZGUuaGlkZSB7Cgl0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoY2FsYygxMDAlIC0gMjhweCkpOwp9Ci5wbHV0b3VpLXRvYy5hc2lkZS5oaWRlIHNlY3Rpb24gewoJZGlzcGxheTogbm9uZTsKfQoucGx1dG91aS10b2MuYXNpZGUuaGlkZSBoZWFkZXIgewoJbWFyZ2luLWJvdHRvbTogMGVtOwoJcGFkZGluZy1ib3R0b206IDBlbTsKCWJvcmRlci1ib3R0b206IG5vbmU7Cn0KfSAgLyogRW5kIG9mIE1lZGlhIHByaW50IHF1ZXJ5ICovCi5wbHV0b3VpLXRvYy5hc2lkZS5oaWRlIC5vcGVuLXRvYywKLnBsdXRvdWktdG9jLmFzaWRlOm5vdCguaGlkZSkgLmNsb3NlZC10b2MsCi5wbHV0b3VpLXRvYzpub3QoLmFzaWRlKSAuY2xvc2VkLXRvYyB7CglkaXNwbGF5OiBub25lOwp9CgpAbWVkaWEgKHByZWZlcnMtcmVkdWNlZC1tb3Rpb24pIHsKICAucGx1dG91aS10b2MuYXNpZGUgewoJdHJhbnNpdGlvbi1kdXJhdGlvbjogMHM7CiAgfQp9CgoudG9jLXRvZ2dsZSB7CgljdXJzb3I6IHBvaW50ZXI7CiAgICBwYWRkaW5nOiAxZW07CiAgICBtYXJnaW46IC0xZW07CiAgICBtYXJnaW4tcmlnaHQ6IC0wLjdlbTsKICAgIGxpbmUtaGVpZ2h0OiAxZW07CiAgICBkaXNwbGF5OiBmbGV4Owp9CgoudG9jLXRvZ2dsZTo6YmVmb3JlIHsKICAgIGNvbnRlbnQ6ICIiOwogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgaGVpZ2h0OiAxZW07CiAgICB3aWR0aDogMWVtOwogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2xpc3Qtb3V0bGluZS5zdmciKTsKCS8qIGdlbmVyYXRlZCB1c2luZyBodHRwczovL2RvcGlhemEub3JnL3Rvb2xzL2RhdGF1cmkvaW5kZXgucGhwICovCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJMU1USWlJR2hsYVdkb2REMGlOVEV5SWlCMmFXVjNRbTk0UFNJd0lEQWdOVEV5SURVeE1pSStQSFJwZEd4bFBtbHZibWxqYjI1ekxYWTFMVzg4TDNScGRHeGxQanhzYVc1bElIZ3hQU0l4TmpBaUlIa3hQU0l4TkRRaUlIZ3lQU0kwTkRnaUlIa3lQU0l4TkRRaUlITjBlV3hsUFNKbWFXeHNPbTV2Ym1VN2MzUnliMnRsT2lNd01EQTdjM1J5YjJ0bExXeHBibVZqWVhBNmNtOTFibVE3YzNSeWIydGxMV3hwYm1WcWIybHVPbkp2ZFc1a08zTjBjbTlyWlMxM2FXUjBhRG96TW5CNElpOCtQR3hwYm1VZ2VERTlJakUyTUNJZ2VURTlJakkxTmlJZ2VESTlJalEwT0NJZ2VUSTlJakkxTmlJZ2MzUjViR1U5SW1acGJHdzZibTl1WlR0emRISnZhMlU2SXpBd01EdHpkSEp2YTJVdGJHbHVaV05oY0RweWIzVnVaRHR6ZEhKdmEyVXRiR2x1WldwdmFXNDZjbTkxYm1RN2MzUnliMnRsTFhkcFpIUm9Pak15Y0hnaUx6NDhiR2x1WlNCNE1UMGlNVFl3SWlCNU1UMGlNelk0SWlCNE1qMGlORFE0SWlCNU1qMGlNelk0SWlCemRIbHNaVDBpWm1sc2JEcHViMjVsTzNOMGNtOXJaVG9qTURBd08zTjBjbTlyWlMxc2FXNWxZMkZ3T25KdmRXNWtPM04wY205clpTMXNhVzVsYW05cGJqcHliM1Z1WkR0emRISnZhMlV0ZDJsa2RHZzZNekp3ZUNJdlBqeGphWEpqYkdVZ1kzZzlJamd3SWlCamVUMGlNVFEwSWlCeVBTSXhOaUlnYzNSNWJHVTlJbVpwYkd3NmJtOXVaVHR6ZEhKdmEyVTZJekF3TUR0emRISnZhMlV0YkdsdVpXTmhjRHB5YjNWdVpEdHpkSEp2YTJVdGJHbHVaV3B2YVc0NmNtOTFibVE3YzNSeWIydGxMWGRwWkhSb09qTXljSGdpTHo0OFkybHlZMnhsSUdONFBTSTRNQ0lnWTNrOUlqSTFOaUlnY2owaU1UWWlJSE4wZVd4bFBTSm1hV3hzT201dmJtVTdjM1J5YjJ0bE9pTXdNREE3YzNSeWIydGxMV3hwYm1WallYQTZjbTkxYm1RN2MzUnliMnRsTFd4cGJtVnFiMmx1T25KdmRXNWtPM04wY205clpTMTNhV1IwYURvek1uQjRJaTgrUEdOcGNtTnNaU0JqZUQwaU9EQWlJR041UFNJek5qZ2lJSEk5SWpFMklpQnpkSGxzWlQwaVptbHNiRHB1YjI1bE8zTjBjbTlyWlRvak1EQXdPM04wY205clpTMXNhVzVsWTJGd09uSnZkVzVrTzNOMGNtOXJaUzFzYVc1bGFtOXBianB5YjNWdVpEdHpkSEp2YTJVdGQybGtkR2c2TXpKd2VDSXZQand2YzNablBnPT0iKTsKICAgIGJhY2tncm91bmQtc2l6ZTogMWVtOwoJZmlsdGVyOiB2YXIoLS1pY29uLWZpbHRlcik7Cn0KCi5hc2lkZSAudG9jLXRvZ2dsZS5vcGVuLXRvYzpob3Zlcjo6YmVmb3JlIHsKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9hcnJvdy1mb3J3YXJkLW91dGxpbmUuc3ZnIik7CgkvKiBnZW5lcmF0ZWQgdXNpbmcgaHR0cHM6Ly9kb3BpYXphLm9yZy90b29scy9kYXRhdXJpL2luZGV4LnBocCAqLwogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSTFNVElpSUdobGFXZG9kRDBpTlRFeUlpQjJhV1YzUW05NFBTSXdJREFnTlRFeUlEVXhNaUkrUEhScGRHeGxQbWx2Ym1samIyNXpMWFkxTFdFOEwzUnBkR3hsUGp4d2IyeDViR2x1WlNCd2IybHVkSE05SWpJMk9DQXhNVElnTkRFeUlESTFOaUF5TmpnZ05EQXdJaUJ6ZEhsc1pUMGlabWxzYkRwdWIyNWxPM04wY205clpUb2pNREF3TzNOMGNtOXJaUzFzYVc1bFkyRndPbkp2ZFc1a08zTjBjbTlyWlMxc2FXNWxhbTlwYmpweWIzVnVaRHR6ZEhKdmEyVXRkMmxrZEdnNk5EaHdlQ0l2UGp4c2FXNWxJSGd4UFNJek9USWlJSGt4UFNJeU5UWWlJSGd5UFNJeE1EQWlJSGt5UFNJeU5UWWlJSE4wZVd4bFBTSm1hV3hzT201dmJtVTdjM1J5YjJ0bE9pTXdNREE3YzNSeWIydGxMV3hwYm1WallYQTZjbTkxYm1RN2MzUnliMnRsTFd4cGJtVnFiMmx1T25KdmRXNWtPM04wY205clpTMTNhV1IwYURvME9IQjRJaTgrUEM5emRtYysiKTsKfQouYXNpZGUgLnRvYy10b2dnbGUuY2xvc2VkLXRvYzpob3Zlcjo6YmVmb3JlIHsKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9hcnJvdy1iYWNrLW91dGxpbmUuc3ZnIik7CgkvKiBnZW5lcmF0ZWQgdXNpbmcgaHR0cHM6Ly9kb3BpYXphLm9yZy90b29scy9kYXRhdXJpL2luZGV4LnBocCAqLwogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSTFNVElpSUdobGFXZG9kRDBpTlRFeUlpQjJhV1YzUW05NFBTSXdJREFnTlRFeUlEVXhNaUkrUEhScGRHeGxQbWx2Ym1samIyNXpMWFkxTFdFOEwzUnBkR3hsUGp4d2IyeDViR2x1WlNCd2IybHVkSE05SWpJME5DQTBNREFnTVRBd0lESTFOaUF5TkRRZ01URXlJaUJ6ZEhsc1pUMGlabWxzYkRwdWIyNWxPM04wY205clpUb2pNREF3TzNOMGNtOXJaUzFzYVc1bFkyRndPbkp2ZFc1a08zTjBjbTlyWlMxc2FXNWxhbTlwYmpweWIzVnVaRHR6ZEhKdmEyVXRkMmxrZEdnNk5EaHdlQ0l2UGp4c2FXNWxJSGd4UFNJeE1qQWlJSGt4UFNJeU5UWWlJSGd5UFNJME1USWlJSGt5UFNJeU5UWWlJSE4wZVd4bFBTSm1hV3hzT201dmJtVTdjM1J5YjJ0bE9pTXdNREE3YzNSeWIydGxMV3hwYm1WallYQTZjbTkxYm1RN2MzUnliMnRsTFd4cGJtVnFiMmx1T25KdmRXNWtPM04wY205clpTMTNhV1IwYURvME9IQjRJaTgrUEM5emRtYysiKTsKfQoKCgoucGx1dG91aS10b2MgaGVhZGVyIHsKCWRpc3BsYXk6IGZsZXg7CglhbGlnbi1pdGVtczogY2VudGVyOwoJZ2FwOiAuM2VtOwoJZm9udC1zaXplOiAxLjVlbTsKCS8qIG1hcmdpbi10b3A6IC0wLjFlbTsgKi8KCW1hcmdpbi1ib3R0b206IDAuNGVtOwoJcGFkZGluZzogMC41cmVtOwoJbWFyZ2luLWxlZnQ6IDA7CgltYXJnaW4tcmlnaHQ6IDA7Cglmb250LXdlaWdodDogYm9sZDsKCS8qIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCByZ2JhKDAsIDAsIDAsIDAuMTUpOyAqLwoJcG9zaXRpb246IHN0aWNreTsKCXRvcDogMHB4OwoJYmFja2dyb3VuZDogdmFyKC0tbWFpbi1iZy1jb2xvcik7Cgl6LWluZGV4OiA0MTsKfQoucGx1dG91aS10b2MuYXNpZGUgaGVhZGVyIHsKCXBhZGRpbmctbGVmdDogMDsKCXBhZGRpbmctcmlnaHQ6IDA7Cn0KCi5wbHV0b3VpLXRvYyBzZWN0aW9uIC50b2Mtcm93IHsKCXdoaXRlLXNwYWNlOiBub3dyYXA7CglvdmVyZmxvdzogaGlkZGVuOwoJdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CglwYWRkaW5nOiAuMWVtOwoJYm9yZGVyLXJhZGl1czogLjJlbTsKfQoKLnBsdXRvdWktdG9jIHNlY3Rpb24gLnRvYy1yb3cuSDEgewoJbWFyZ2luLXRvcDogMWVtOwp9CgoKLnBsdXRvdWktdG9jLmFzaWRlIHNlY3Rpb24gLnRvYy1yb3cuaW4tdmlldyB7CgliYWNrZ3JvdW5kOiB2YXIoLS1zaWRlYmFyLWxpLWFjdGl2ZS1iZyk7Cn0KCgoJCi5oaWdobGlnaHQtcGx1dG8tY2VsbC1zaG91bGRlciB7CgliYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMDUpOwoJYmFja2dyb3VuZC1jbGlwOiBwYWRkaW5nLWJveDsKfQoKLnBsdXRvdWktdG9jIHNlY3Rpb24gYSB7Cgl0ZXh0LWRlY29yYXRpb246IG5vbmU7Cglmb250LXdlaWdodDogbm9ybWFsOwoJY29sb3I6IHZhcigtLXBsdXRvLW91dHB1dC1jb2xvcik7Cn0KLnBsdXRvdWktdG9jIHNlY3Rpb24gYTpob3ZlciB7Cgljb2xvcjogdmFyKC0tcGx1dG8tb3V0cHV0LWgtY29sb3IpOwp9CgoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gYS5IMSB7Cglmb250LXdlaWdodDogNzAwOwoJbGluZS1oZWlnaHQ6IDFlbTsKfQoKLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIC5hZnRlci1IMiBhIHsgcGFkZGluZy1sZWZ0OiAxMHB4OyB9Ci5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiAuYWZ0ZXItSDMgYSB7IHBhZGRpbmctbGVmdDogMjBweDsgfQoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gLmFmdGVyLUg0IGEgeyBwYWRkaW5nLWxlZnQ6IDMwcHg7IH0KLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIC5hZnRlci1INSBhIHsgcGFkZGluZy1sZWZ0OiA0MHB4OyB9Ci5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiAuYWZ0ZXItSDYgYSB7IHBhZGRpbmctbGVmdDogNTBweDsgfQoKLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIGEuSDEgeyBwYWRkaW5nLWxlZnQ6IDBweDsgfQoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gYS5IMiB7IHBhZGRpbmctbGVmdDogMTBweDsgfQoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gYS5IMyB7IHBhZGRpbmctbGVmdDogMjBweDsgfQoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gYS5INCB7IHBhZGRpbmctbGVmdDogMzBweDsgfQoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gYS5INSB7IHBhZGRpbmctbGVmdDogNDBweDsgfQoucGx1dG91aS10b2MuaW5kZW50IHNlY3Rpb24gYS5INiB7IHBhZGRpbmctbGVmdDogNTBweDsgfQoKCi5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiBhLnBsdXRvLWRvY3MtYmluZGluZy1lbCwKLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIGEuQVNTSUdORUUKCXsKCWZvbnQtZmFtaWx5OiBKdWxpYU1vbm8sIG1vbm9zcGFjZTsKCWZvbnQtc2l6ZTogLjhlbTsKCS8qIGJhY2tncm91bmQ6IGJsYWNrOyAqLwoJZm9udC13ZWlnaHQ6IDcwMDsKICAgIGZvbnQtc3R5bGU6IGl0YWxpYzsKCWNvbG9yOiB2YXIoLS1jbS12YXItY29sb3IpOyAvKiB0aGlzIGlzIHN0ZWFsaW5nIGEgdmFyaWFibGUgZnJvbSBQbHV0bywgYnV0IGl0J3MgZmluZSBpZiB0aGF0IGRvZXNudCB3b3JrICovCn0KLnBsdXRvdWktdG9jLmluZGVudCBzZWN0aW9uIGEucGx1dG8tZG9jcy1iaW5kaW5nLWVsOjpiZWZvcmUsCi5wbHV0b3VpLXRvYy5pbmRlbnQgc2VjdGlvbiBhLkFTU0lHTkVFOjpiZWZvcmUKCXsKCWNvbnRlbnQ6ICI+ICI7CglvcGFjaXR5OiAuMzsKfQo8L3N0eWxlPgoKPHNjcmlwdCBpZD0nQnFVdHJlJz4KCS8qICMgSlMgTGlzdGVuZXJzIFByZWFtYmxlIGFkZGVkIGJ5IFBsdXRvRXh0cmFzICovCgkvLyBBcnJheSB3aGVyZSBhbGwgdGhlIGV2ZW50IGxpc3RlbmVycyBhcmUgc3RvcmVkCgljb25zdCBfZXZlbnRzX2xpc3RlbmVyc18gPSBbXQoKCS8vIEZ1bmN0aW9uIHRoYXQgY2FuIGJlIGNhbGxlZCB0byBhZGQgZXZlbnRzIGxpc3RlbmVycyB3aXRoaW4gdGhlIHNjcmlwdAoJZnVuY3Rpb24gYWRkU2NyaXB0RXZlbnRMaXN0ZW5lcnMoZWxlbWVudCwgbGlzdGVuZXJzKSB7CgkJaWYgKGxpc3RlbmVycy5jb25zdHJ1Y3RvciAhPSBPYmplY3QpIHsKCQkJZXJyb3IoJ09ubHkgb2JqZWN0cyB3aXRoIGtleXMgYXMgZXZlbnQgbmFtZXMgYW5kIHZhbHVlcyBhcyBsaXN0ZW5lciBmdW5jdGlvbnMgYXJlIHN1cHBvcnRlZCcpCgkJfQoJCV9ldmVudHNfbGlzdGVuZXJzXy5wdXNoKHtlbGVtZW50LCBsaXN0ZW5lcnN9KQoJfQoJLyogIyBKUyBMaXN0ZW5lcnMgUHJlYW1ibGUgYWRkZWQgYnkgUGx1dG9FeHRyYXMgKi8KCmNvbnN0IGhpZGVfcHJlYW1ibGUgPSB0cnVlCmNvbnN0IGZvcmNlX2hpZGVfZW5hYmxlZCA9IHRydWUKLy8gTG9hZCB0aGUgbGlicmFyeSBmb3IgY29uc2lzdGVudCBzbW9vdGggc2Nyb2xsaW5nCmNvbnN0IHtkZWZhdWx0OiBzY3JvbGxJbnRvVmlld30gPSBhd2FpdCBpbXBvcnQoJ2RhdGE6dGV4dC9qYXZhc2NyaXB0O2Jhc2U2NCxkbUZ5SUZFOVpUMCtJbTlpYW1WamRDSTlQWFI1Y0dWdlppQmxKaVp1ZFd4c0lUMWxKaVl4UFQwOVpTNXViMlJsVkhsd1pTeFZQU2hsTEhRcFBUNG9JWFI4ZkNKb2FXUmtaVzRpSVQwOVpTa21KaUoyYVhOcFlteGxJaUU5UFdVbUppSmpiR2x3SWlFOVBXVXNRVDBvWlN4MEtUMCtlMmxtS0dVdVkyeHBaVzUwU0dWcFoyaDBQR1V1YzJOeWIyeHNTR1ZwWjJoMGZIeGxMbU5zYVdWdWRGZHBaSFJvUEdVdWMyTnliMnhzVjJsa2RHZ3BlMnhsZENCc1BXZGxkRU52YlhCMWRHVmtVM1I1YkdVb1pTeHVkV3hzS1R0eVpYUjFjbTRnVlNoc0xtOTJaWEptYkc5M1dTeDBLWHg4VlNoc0xtOTJaWEptYkc5M1dDeDBLWHg4S0dVOVBudHNaWFFnZEQwb1pUMCtlMmxtS0NGbExtOTNibVZ5Ukc5amRXMWxiblI4ZkNGbExtOTNibVZ5Ukc5amRXMWxiblF1WkdWbVlYVnNkRlpwWlhjcGNtVjBkWEp1SUc1MWJHdzdkSEo1ZTNKbGRIVnliaUJsTG05M2JtVnlSRzlqZFcxbGJuUXVaR1ZtWVhWc2RGWnBaWGN1Wm5KaGJXVkZiR1Z0Wlc1MGZXTmhkR05vZTNKbGRIVnliaUJ1ZFd4c2ZYMHBLR1VwTzNKbGRIVnliaUVoZENZbUtIUXVZMnhwWlc1MFNHVnBaMmgwUEdVdWMyTnliMnhzU0dWcFoyaDBmSHgwTG1Oc2FXVnVkRmRwWkhSb1BHVXVjMk55YjJ4c1YybGtkR2dwZlNrb1pTbDljbVYwZFhKdUlURjlMRmc5S0dVc2RDeHNMRzhzYml4eUxHa3NjeWs5UG5JOFpTWW1hVDUwZkh4eVBtVW1KbWs4ZEQ4d09uSThQV1VtSm5NOFBXeDhmR2srUFhRbUpuTStQV3cvY2kxbExXODZhVDUwSmlaelBHeDhmSEk4WlNZbWN6NXNQMmt0ZEN0dU9qQXNKRDFsUFQ1bExuQmhjbVZ1ZEVWc1pXMWxiblEvUHlobExtZGxkRkp2YjNST2IyUmxLQ2t1YUc5emRIeDhiblZzYkNrc2RIUTlLR1VzZENrOVBudDJZWElnYkN4dkxHNHNjanRwWmloMGVYQmxiMllnWkc5amRXMWxiblErSW5VaUtYSmxkSFZ5Ymx0ZE8yeGxkSHR6WTNKdmJHeE5iMlJsT21rc1lteHZZMnM2Y3l4cGJteHBibVU2WVN4aWIzVnVaR0Z5ZVRwb0xITnJhWEJQZG1WeVpteHZkMGhwWkdSbGJrVnNaVzFsYm5Sek9uVjlQWFFzWnowaVpuVnVZM1JwYjI0aVBUMTBlWEJsYjJZZ2FEOW9PbVU5UG1VaFBUMW9PMmxtS0NGUktHVXBLWFJvY205M0lGUjVjR1ZGY25KdmNpZ2lTVzUyWVd4cFpDQjBZWEpuWlhRaUtUdHNaWFFnZGoxa2IyTjFiV1Z1ZEM1elkzSnZiR3hwYm1kRmJHVnRaVzUwZkh4a2IyTjFiV1Z1ZEM1a2IyTjFiV1Z1ZEVWc1pXMWxiblFzYlQxYlhTeDNQV1U3Wm05eUtEdFJLSGNwSmlabktIY3BPeWw3YVdZb0tIYzlKQ2gzS1NrOVBUMTJLWHR0TG5CMWMyZ29keWs3WW5KbFlXdDliblZzYkNFOWR5WW1kejA5UFdSdlkzVnRaVzUwTG1KdlpIa21Ka0VvZHlrbUppRkJLR1J2WTNWdFpXNTBMbVJ2WTNWdFpXNTBSV3hsYldWdWRDbDhmRzUxYkd3aFBYY21Ka0VvZHl4MUtTWW1iUzV3ZFhOb0tIY3BmV3hsZENCWFBXNTFiR3doUFNodlBXNTFiR3c5UFNoc1BYZHBibVJ2ZHk1MmFYTjFZV3hXYVdWM2NHOXlkQ2svZG05cFpDQXdPbXd1ZDJsa2RHZ3BQMjg2YVc1dVpYSlhhV1IwYUN4SVBXNTFiR3doUFNoeVBXNTFiR3c5UFNodVBYZHBibVJ2ZHk1MmFYTjFZV3hXYVdWM2NHOXlkQ2svZG05cFpDQXdPbTR1YUdWcFoyaDBLVDl5T21sdWJtVnlTR1ZwWjJoMExIdHpZM0p2Ykd4WU9sOHNjMk55YjJ4c1dUcDRmVDEzYVc1a2IzY3NlMmhsYVdkb2REcEZMSGRwWkhSb09sUXNkRzl3T2s0c2NtbG5hSFE2VEN4aWIzUjBiMjA2V1N4c1pXWjBPa045UFdVdVoyVjBRbTkxYm1ScGJtZERiR2xsYm5SU1pXTjBLQ2tzVWowaWMzUmhjblFpUFQwOWMzeDhJbTVsWVhKbGMzUWlQVDA5Y3o5T09pSmxibVFpUFQwOWN6OVpPazRyUlM4eUxGWTlJbU5sYm5SbGNpSTlQVDFoUDBNclZDOHlPaUpsYm1RaVBUMDlZVDlNT2tNc1FqMWJYVHRtYjNJb2JHVjBJRVE5TUR0RVBHMHViR1Z1WjNSb08wUXJLeWw3YkdWMElFODliVnRFWFN4N2FHVnBaMmgwT21vc2QybGtkR2c2U1N4MGIzQTZVeXh5YVdkb2REcHhMR0p2ZEhSdmJUcDZMR3hsWm5RNlJuMDlUeTVuWlhSQ2IzVnVaR2x1WjBOc2FXVnVkRkpsWTNRb0tUdHBaaWdpYVdZdGJtVmxaR1ZrSWowOVBXa21KazQrUFRBbUprTStQVEFtSmxrOFBVZ21Ka3c4UFZjbUprNCtQVk1tSmxrOFBYb21Ka00rUFVZbUprdzhQWEVwWW5KbFlXczdiR1YwSUVjOVoyVjBRMjl0Y0hWMFpXUlRkSGxzWlNoUEtTeEtQWEJoY25ObFNXNTBLRWN1WW05eVpHVnlUR1ZtZEZkcFpIUm9MREV3S1N4TFBYQmhjbk5sU1c1MEtFY3VZbTl5WkdWeVZHOXdWMmxrZEdnc01UQXBMRkE5Y0dGeWMyVkpiblFvUnk1aWIzSmtaWEpTYVdkb2RGZHBaSFJvTERFd0tTeGFQWEJoY25ObFNXNTBLRWN1WW05eVpHVnlRbTkwZEc5dFYybGtkR2dzTVRBcExHVmxQVEFzWlhROU1DeGxiRDBpYjJabWMyVjBWMmxrZEdnaWFXNGdUejlQTG05bVpuTmxkRmRwWkhSb0xVOHVZMnhwWlc1MFYybGtkR2d0U2kxUU9qQXNaVzg5SW05bVpuTmxkRWhsYVdkb2RDSnBiaUJQUDA4dWIyWm1jMlYwU0dWcFoyaDBMVTh1WTJ4cFpXNTBTR1ZwWjJoMExVc3RXam93TEdWdVBTSnZabVp6WlhSWGFXUjBhQ0pwYmlCUFB6QTlQVDFQTG05bVpuTmxkRmRwWkhSb1B6QTZTUzlQTG05bVpuTmxkRmRwWkhSb09qQXNaWEk5SW05bVpuTmxkRWhsYVdkb2RDSnBiaUJQUHpBOVBUMVBMbTltWm5ObGRFaGxhV2RvZEQ4d09tb3ZUeTV2Wm1aelpYUklaV2xuYUhRNk1EdHBaaWgyUFQwOVR5bGxaVDBpYzNSaGNuUWlQVDA5Y3o5U09pSmxibVFpUFQwOWN6OVNMVWc2SW01bFlYSmxjM1FpUFQwOWN6OVlLSGdzZUN0SUxFZ3NTeXhhTEhnclVpeDRLMUlyUlN4RktUcFNMVWd2TWl4bGREMGljM1JoY25RaVBUMDlZVDlXT2lKalpXNTBaWElpUFQwOVlUOVdMVmN2TWpvaVpXNWtJajA5UFdFL1ZpMVhPbGdvWHl4ZksxY3NWeXhLTEZBc1h5dFdMRjhyVml0VUxGUXBMR1ZsUFUxaGRHZ3ViV0Y0S0RBc1pXVXJlQ2tzWlhROVRXRjBhQzV0WVhnb01DeGxkQ3RmS1R0bGJITmxlMlZsUFNKemRHRnlkQ0k5UFQxelAxSXRVeTFMT2lKbGJtUWlQVDA5Y3o5U0xYb3JXaXRsYnpvaWJtVmhjbVZ6ZENJOVBUMXpQMWdvVXl4NkxHb3NTeXhhSzJWdkxGSXNVaXRGTEVVcE9sSXRLRk1yYWk4eUtTdGxieTh5TEdWMFBTSnpkR0Z5ZENJOVBUMWhQMVl0UmkxS09pSmpaVzUwWlhJaVBUMDlZVDlXTFNoR0swa3ZNaWtyWld3dk1qb2laVzVrSWowOVBXRS9WaTF4SzFBclpXdzZXQ2hHTEhFc1NTeEtMRkFyWld3c1ZpeFdLMVFzVkNrN2JHVjBlM05qY205c2JFeGxablE2Wldrc2MyTnliMnhzVkc5d09tVmtmVDFQTzJWbFBVMWhkR2d1YldGNEtEQXNUV0YwYUM1dGFXNG9aV1FyWldVdlpYSXNUeTV6WTNKdmJHeElaV2xuYUhRdGFpOWxjaXRsYnlrcExHVjBQVTFoZEdndWJXRjRLREFzVFdGMGFDNXRhVzRvWldrclpYUXZaVzRzVHk1elkzSnZiR3hYYVdSMGFDMUpMMlZ1SzJWc0tTa3NVaXM5WldRdFpXVXNWaXM5WldrdFpYUjlRaTV3ZFhOb0tIdGxiRHBQTEhSdmNEcGxaU3hzWldaME9tVjBmU2w5Y21WMGRYSnVJRUo5TEdZOVpUMCtlM1poY2lCME8zSmxkSFZ5YmlFeFBUMDlaVDk3WW14dlkyczZJbVZ1WkNJc2FXNXNhVzVsT2lKdVpXRnlaWE4wSW4wNktIUTlaU2s5UFQxUFltcGxZM1FvZENrbUpqQWhQVDFQWW1wbFkzUXVhMlY1Y3loMEtTNXNaVzVuZEdnL1pUcDdZbXh2WTJzNkluTjBZWEowSWl4cGJteHBibVU2SW01bFlYSmxjM1FpZlgwN1puVnVZM1JwYjI0Z1l5aGxMSFFwZTNaaGNpQnNPMmxtS0NGbExtbHpRMjl1Ym1WamRHVmtmSHdoS0dVOVBudHNaWFFnZEQxbE8yWnZjaWc3ZENZbWRDNXdZWEpsYm5ST2IyUmxPeWw3YVdZb2RDNXdZWEpsYm5ST2IyUmxQVDA5Wkc5amRXMWxiblFwY21WMGRYSnVJVEE3ZEQxMExuQmhjbVZ1ZEU1dlpHVWdhVzV6ZEdGdVkyVnZaaUJUYUdGa2IzZFNiMjkwUDNRdWNHRnlaVzUwVG05a1pTNW9iM04wT25RdWNHRnlaVzUwVG05a1pYMXlaWFIxY200aE1YMHBLR1VwS1hKbGRIVnlianRwWmlnaWIySnFaV04wSWowOWRIbHdaVzltS0d3OWRDa21KaUptZFc1amRHbHZiaUk5UFhSNWNHVnZaaUJzTG1KbGFHRjJhVzl5S1hKbGRIVnliaUIwTG1KbGFHRjJhVzl5S0hSMEtHVXNkQ2twTzJ4bGRDQnZQU0ppYjI5c1pXRnVJajA5ZEhsd1pXOW1JSFI4Zkc1MWJHdzlQWFEvZG05cFpDQXdPblF1WW1Wb1lYWnBiM0k3Wm05eUtHeGxkSHRsYkRwdUxIUnZjRHB5TEd4bFpuUTZhWDF2WmlCMGRDaGxMR1lvZENrcEtXNHVjMk55YjJ4c0tIdDBiM0E2Y2l4c1pXWjBPbWtzWW1Wb1lYWnBiM0k2YjMwcGZYWmhjaUJrTEhBOUtDazlQaWhrZkh3b1pEMGljR1Z5Wm05eWJXRnVZMlVpYVc0Z2QybHVaRzkzUDNCbGNtWnZjbTFoYm1ObExtNXZkeTVpYVc1a0tIQmxjbVp2Y20xaGJtTmxLVHBFWVhSbExtNXZkeWtzWkNncEtUdG1kVzVqZEdsdmJpQmlLR1VwZTJ4bGRDQjBQVTFoZEdndWJXbHVLQ2h3S0NrdFpTNXpkR0Z5ZEZScGJXVXBMMlV1WkhWeVlYUnBiMjRzTVNrc2JEMWxMbVZoYzJVb2RDa3NiejFsTG5OMFlYSjBXQ3NvWlM1NExXVXVjM1JoY25SWUtTcHNMRzQ5WlM1emRHRnlkRmtyS0dVdWVTMWxMbk4wWVhKMFdTa3FiRHRsTG0xbGRHaHZaQ2h2TEc0c2RDeHNLU3h2SVQwOVpTNTRmSHh1SVQwOVpTNTVQM0psY1hWbGMzUkJibWx0WVhScGIyNUdjbUZ0WlNnb0tUMCtZaWhsS1NrNlpTNWpZaWdwZldaMWJtTjBhVzl1SUhrb1pTeDBMR3dwZTJ4bGRDQnZQV0Z5WjNWdFpXNTBjeTVzWlc1bmRHZytNeVltZG05cFpDQXdJVDA5WVhKbmRXMWxiblJ6V3pOZFAyRnlaM1Z0Wlc1MGMxc3pYVG8yTURBc2JqMWhjbWQxYldWdWRITXViR1Z1WjNSb1BqUW1Kblp2YVdRZ01DRTlQV0Z5WjNWdFpXNTBjMXMwWFQ5aGNtZDFiV1Z1ZEhOYk5GMDZaVDArTVNzdExXVXFaU3BsS21VcVpTeHlQV0Z5WjNWdFpXNTBjeTVzWlc1bmRHZytOVDloY21kMWJXVnVkSE5iTlYwNmRtOXBaQ0F3TEdrOVlYSm5kVzFsYm5SekxteGxibWQwYUQ0MlAyRnlaM1Z0Wlc1MGMxczJYVHAyYjJsa0lEQXNjejFsTG5OamNtOXNiRXhsWm5Rc1lUMWxMbk5qY205c2JGUnZjRHRpS0h0elkzSnZiR3hoWW14bE9tVXNiV1YwYUc5a0tIUXNiQ3h2TEc0cGUyeGxkQ0J5UFUxaGRHZ3VZMlZwYkNoMEtTeHpQVTFoZEdndVkyVnBiQ2hzS1R0bExuTmpjbTlzYkV4bFpuUTljaXhsTG5OamNtOXNiRlJ2Y0QxekxHay9MaWg3ZEdGeVoyVjBPbVVzWld4aGNITmxaRHB2TEhaaGJIVmxPbTRzYkdWbWREcHlMSFJ2Y0RwemZTbDlMSE4wWVhKMFZHbHRaVHB3S0Nrc2MzUmhjblJZT25Nc2MzUmhjblJaT21Fc2VEcDBMSGs2YkN4a2RYSmhkR2x2YmpwdkxHVmhjMlU2Yml4allqcHlmU2w5ZG1GeUlFMDlaVDArWlNZbUlXVXVZbVZvWVhacGIzSjhmQ0p6Ylc5dmRHZ2lQVDA5WlM1aVpXaGhkbWx2Y2l4clBXWjFibU4wYVc5dUtHVXNkQ2w3YkdWMElHdzlkSHg4ZTMwN2NtVjBkWEp1SUUwb2JDay9ZeWhsTEh0aWJHOWphenBzTG1Kc2IyTnJMR2x1YkdsdVpUcHNMbWx1YkdsdVpTeHpZM0p2Ykd4TmIyUmxPbXd1YzJOeWIyeHNUVzlrWlN4aWIzVnVaR0Z5ZVRwc0xtSnZkVzVrWVhKNUxITnJhWEJQZG1WeVpteHZkMGhwWkdSbGJrVnNaVzFsYm5Sek9td3VjMnRwY0U5MlpYSm1iRzkzU0dsa1pHVnVSV3hsYldWdWRITXNZbVZvWVhacGIzSTZaVDArVUhKdmJXbHpaUzVoYkd3b1pTNXlaV1IxWTJVb0tHVXNkQ2s5UG50c1pYUjdaV3c2Ynl4c1pXWjBPbTRzZEc5d09uSjlQWFFzYVQxdkxuTmpjbTlzYkV4bFpuUXNjejF2TG5OamNtOXNiRlJ2Y0R0eVpYUjFjbTRnYVQwOVBXNG1Kbk05UFQxeVAyVTZXeTR1TG1Vc2JtVjNJRkJ5YjIxcGMyVW9aVDArZVNodkxHNHNjaXhzTG1SMWNtRjBhVzl1TEd3dVpXRnpaU3dvS1QwK1pTaDdaV3c2Ynl4c1pXWjBPbHRwTEc1ZExIUnZjRHBiY3l4eVhYMHBMR3d1YjI1VFkzSnZiR3hEYUdGdVoyVXBLVjE5TEZ0ZEtTbDlLVHBRY205dGFYTmxMbkpsYzI5c2RtVW9ZeWhsTEhRcEtYMDdaWGh3YjNKMGUyc2dZWE1nWkdWbVlYVnNkSDA3JykKCmZ1bmN0aW9uIHNjcm9sbF90byhoLCBjb25maWcgPSB7CgkJCWJlaGF2aW9yOiAnc21vb3RoJywgCgkJCWJsb2NrOiAnc3RhcnQnLAoJCX0pIHsKCXNjcm9sbEludG9WaWV3KGgsIGNvbmZpZykudGhlbigoKSA9PiAKCQkJLy8gc29tZXRpbWVzIGl0IGRvZXNuJ3Qgc2Nyb2xsIHRvIHRoZSByaWdodCBwbGFjZQoJCQkvLyBzb2x1dGlvbjogdHJ5IGEgc2Vjb25kIHRpbWUhCgkJCXNjcm9sbEludG9WaWV3KGgsIGNvbmZpZykKCSAgICkKCX0KCWxldCBjZWxsID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCdwbHV0by1jZWxsJykKCWxldCBwbHV0b19hY3Rpb25zID0gY2VsbC5faW50ZXJuYWxfcGx1dG9fYWN0aW9ucwoJbGV0IHRvYyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ25hdi5wbHV0b3VpLXRvYycpCgoJZnVuY3Rpb24gZ2V0Um93KGVsKSB7CgkJY29uc3Qgcm93ID0gZWw/LmNsb3Nlc3QoJy50b2Mtcm93JykKCQlyZXR1cm4gcm93Cgl9CgkJCglmdW5jdGlvbiBnZXRfbGlua19pZChlbCkgewoJCWNvbnN0IHJvdyA9IGdldFJvdyhlbCkKCQlpZiAoXy5pc05pbChyb3cpKSB7IHJldHVybiBudWxsIH0KCQljb25zdCBhID0gcm93LnF1ZXJ5U2VsZWN0b3IoJ2EnKQoJCXJldHVybiBhLmhyZWYuc2xpY2UoLTM2KSAvLyBleHRyYWN0IHRoZSBsYXN0IDM2IGNoYXJhY3RlcnMsIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGNlbGwgaWQKCX0KCglmdW5jdGlvbiBnZXRIZWFkaW5nTGV2ZWwocm93KSB7CgkJY29uc3QgYSA9IHJvdy5xdWVyeVNlbGVjdG9yKCdhJykKCQkvLyBXZSByZXR1cm4gdGhlIGxpbmsgY2xhc3Mgd2l0aG91dCB0aGUgZmlyc3QgSAoJCXJldHVybiBOdW1iZXIoYS5jbGFzc0xpc3RbMF0uc2xpY2UoMSkpCgl9CgoJZnVuY3Rpb24gZ2VuZXJhdGVDaGVja2VyKHNlbGVjdG9yKSB7CgkJc3dpdGNoICh0eXBlb2Ygc2VsZWN0b3IpIHsKCQkJY2FzZSAnc3RyaW5nJzoKCQkJCWNvbnN0IGZ1bmMgPSBlbCA9PiB7CgkJCQkJcmV0dXJuIGVsLm1hdGNoZXMoc2VsZWN0b3IpCgkJCQl9CgkJCQlyZXR1cm4gZnVuYwoJCQljYXNlICdmdW5jdGlvbic6CgkJCQlyZXR1cm4gc2VsZWN0b3IKCQkJZGVmYXVsdDoKCQkJCWNvbnNvbGUuZXJyb3IoYFRoZSB0eXBlICgke3R5cGVvZiBzZWxlY3Rvcn0pIG9mIHRoZSBwcm92aWRlZCBhcmd1bWVudCBpcyBub3QgdmFsaWRgKQoJCX0KCX0KCgkvLyBHZXQgbmV4dCBhbmQgcHJldmlvdXMgc2libGluZywgYWRhcHRlZCBmcm9tOgoJLy8gaHR0cHM6Ly9nb21ha2V0aGluZ3MuY29tL2ZpbmRpbmctdGhlLW5leHQtYW5kLXByZXZpb3VzLXNpYmxpbmctZWxlbWVudHMtdGhhdC1tYXRjaC1hLXNlbGVjdG9yLXdpdGgtdmFuaWxsYS1qcy8KCXZhciBnZXROZXh0U2libGluZyA9IGZ1bmN0aW9uIChlbGVtLCBzZWxlY3RvcikgewoKCQkvLyBBZGRlZCB0byByZXR1cm4gdW5kZWZpbmVkIGlzIGNhbGxlZCB3aXRoIHVuZGVmaW5lZAoJCWlmIChfLmlzTmlsKGVsZW0pKSB7cmV0dXJuIHVuZGVmaW5lZH0KCgkJLy8gR2V0IHRoZSBuZXh0IHNpYmxpbmcgZWxlbWVudAoJCXZhciBzaWJsaW5nID0gZWxlbS5uZXh0RWxlbWVudFNpYmxpbmc7CgkKCQkvLyBJZiB0aGVyZSdzIG5vIHNlbGVjdG9yLCByZXR1cm4gdGhlIGZpcnN0IHNpYmxpbmcKCQlpZiAoIXNlbGVjdG9yKSByZXR1cm4gc2libGluZzsKCgkJY29uc3QgY2hlY2tlciA9IGdlbmVyYXRlQ2hlY2tlcihzZWxlY3RvcikKCQoJCS8vIElmIHRoZSBzaWJsaW5nIG1hdGNoZXMgb3VyIHNlbGVjdG9yLCB1c2UgaXQKCQkvLyBJZiBub3QsIGp1bXAgdG8gdGhlIG5leHQgc2libGluZyBhbmQgY29udGludWUgdGhlIGxvb3AKCQl3aGlsZSAoc2libGluZykgewoJCQlpZiAoY2hlY2tlcihzaWJsaW5nKSkgcmV0dXJuIHNpYmxpbmc7CgkJCXNpYmxpbmcgPSBzaWJsaW5nLm5leHRFbGVtZW50U2libGluZwoJCX0KCQoJfTsKCXZhciBnZXRQcmV2aW91c1NpYmxpbmcgPSBmdW5jdGlvbiAoZWxlbSwgc2VsZWN0b3IpIHsKCgkJLy8gQWRkZWQgdG8gcmV0dXJuIHVuZGVmaW5lZCBpcyBjYWxsZWQgd2l0aCB1bmRlZmluZWQKCQlpZiAoXy5pc05pbChlbGVtKSkge3JldHVybiB1bmRlZmluZWR9CgkJCgkJLy8gR2V0IHRoZSBuZXh0IHNpYmxpbmcgZWxlbWVudAoJCXZhciBzaWJsaW5nID0gZWxlbS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwoJCgkJLy8gSWYgdGhlcmUncyBubyBzZWxlY3RvciwgcmV0dXJuIHRoZSBmaXJzdCBzaWJsaW5nCgkJaWYgKCFzZWxlY3RvcikgcmV0dXJuIHNpYmxpbmc7CgoJCWNvbnN0IGNoZWNrZXIgPSBnZW5lcmF0ZUNoZWNrZXIoc2VsZWN0b3IpCgkKCQkvLyBJZiB0aGUgc2libGluZyBtYXRjaGVzIG91ciBzZWxlY3RvciwgdXNlIGl0CgkJLy8gSWYgbm90LCBqdW1wIHRvIHRoZSBuZXh0IHNpYmxpbmcgYW5kIGNvbnRpbnVlIHRoZSBsb29wCgkJd2hpbGUgKHNpYmxpbmcpIHsKCQkJaWYgKGNoZWNrZXIoc2libGluZykpIHJldHVybiBzaWJsaW5nOwoJCQlzaWJsaW5nID0gc2libGluZy5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwoJCX0KCQoJfTsKCgoJLy8gR2V0IHRoZSBsYXN0IHRvYyBlbnRyeSBkZXNjZW5kYW50IGZyb20gdGhlIHByb3ZpZGVkIG9uZQoJZnVuY3Rpb24gZ2V0TGFzdERlc2NlbmRhbnQoZWwpIHsKCQljb25zdCByb3cgPSBnZXRSb3coZWwpCgkJaWYgKF8uaXNOaWwocm93KSkge3JldHVybn0KCQljb25zdCBjaGlsZHJlbiA9IHJvdy5kaXJlY3RDaGlsZHJlbgoJCWlmIChfLmlzRW1wdHkoY2hpbGRyZW4pKSB7CgkJCXJldHVybiByb3cKCQl9IGVsc2UgewoJCQlyZXR1cm4gZ2V0TGFzdERlc2NlbmRhbnQoXy5sYXN0KGNoaWxkcmVuKSkKCQl9Cgl9CgoJLy8gRmluZCBhbGwgdGhlIGNlbGwgaWRzIGNvbnRhaW5lZCB3aXRoaW4gdGhlIHRhcmdldCB0b2Mgcm93cyBhbmQgYWxsIGl0cyBkZXNjZW5kYW50cwoJZnVuY3Rpb24gZ2V0QmxvY2tJZHMoZWwpIHsKCQljb25zdCByb3cgPSBnZXRSb3coZWwpCgkJaWYgKF8uaXNOaWwocm93KSkge3JldHVybn0KCQlmdW5jdGlvbiBnZXRJbmRleChyb3cpIHsKCQkJcmV0dXJuIGVkaXRvcl9zdGF0ZS5ub3RlYm9vay5jZWxsX29yZGVyLmluZGV4T2YoZ2V0X2xpbmtfaWQocm93KSkKCQl9CgkJY29uc3Qgc3RhcnQgPSBnZXRJbmRleChyb3cpCgoJCWNvbnN0IGxhc3RDaGlsZCA9IGdldExhc3REZXNjZW5kYW50KHJvdykKCQljb25zdCBlbmQgPSBnZXRJbmRleChnZXROZXh0U2libGluZyhsYXN0Q2hpbGQsICcudG9jLXJvdycpKQoKCQlyZXR1cm4gZWRpdG9yX3N0YXRlLm5vdGVib29rLmNlbGxfb3JkZXIuc2xpY2Uoc3RhcnQsIGVuZCA8IDAgPyBJbmZpbml0eSA6IGVuZCkKCX0KCQkKCXdpbmRvdy50b2NfdXRpbHMgPSB7CgkJZ2V0TmV4dFNpYmxpbmcsCgkJZ2V0UHJldmlvdXNTaWJsaW5nLAoJCWdldExhc3REZXNjZW5kYW50LAoJCWdldEJsb2NrSWRzLAoJfQoKCS8vIEZ1bmN0aW9ucyB0byBzZXQgYW5kIHByb3BhZ2F0ZSBoaWRkZW4gYW5kIGNvbGxhcHNlZCBzdGF0ZXMKCglmdW5jdGlvbiBwcm9wYWdhdGVfcGFyZW50KGRpdiwgcGFyZW50PW51bGwpIHsKCQlpZiAocGFyZW50ICE9IG51bGwpIHsKCQkJZGl2LmFsbFBhcmVudHMgPSBfLnVuaW9uKGRpdi5hbGxQYXJlbnRzLCBbcGFyZW50XSkJCgkJfQoJCWlmIChfLmlzRW1wdHkoZGl2LmRpcmVjdENoaWxkcmVuKSkge3JldHVybn0KCQlmb3IgKGNvbnN0IGNoaWxkIG9mIGRpdi5kaXJlY3RDaGlsZHJlbikgewoJCQlwcm9wYWdhdGVfcGFyZW50KGNoaWxkLCBwYXJlbnQgPz8gZGl2KQoJCX0KCX0KCgkvLyBSZXR1cm5zIHRydWUgaWYgdGhlIGN1cnJlbnQgaGlkZGVuL2NvbGxhcHNlZCB0b2Mgc3RhdGUgaXMgZGlmZmVyZW50IGZyb20gdGhlIG9uZSBzYXZlZCBpbiB0aGUgZmlsZSB3aXRoaW4gY2VsbCBtZXRhZGF0YQoJZnVuY3Rpb24gc3RhdGVEaWZmZXJzRmlsZShzdGF0ZSkgewoJCWZvciAoY29uc3QgW2lkLCBzdF0gb2YgXy5lbnRyaWVzKHN0YXRlKSkgewoJCQlpZiAoaGFzX2NlbGxfYXR0cmlidXRlKGlkLCAndG9jLWhpZGRlbicpICE9IHN0LmhpZGRlbikgeyByZXR1cm4gdHJ1ZSB9CgkJCWlmIChoYXNfY2VsbF9hdHRyaWJ1dGUoaWQsICd0b2MtY29sbGFwc2VkJykgIT0gc3QuY29sbGFwc2VkKSB7IHJldHVybiB0cnVlIH0KCQl9CgkJcmV0dXJuIGZhbHNlCgl9CgoJZnVuY3Rpb24gc2V0X3N0YXRlKGRpdiwgc3RhdGUsIHZhbHVlLCBpbml0ID0gZmFsc2UpIHsKCQlkaXYuY2xhc3NMaXN0LnRvZ2dsZShzdGF0ZSwgdmFsdWUpCgkJaWYgKCFpbml0KSB7CgkJCXdpbmRvdy50b2Nfc3RhdGVbZ2V0X2xpbmtfaWQoZGl2KV1bc3RhdGVdID0gdmFsdWUKCQkJdG9jLmNsYXNzTGlzdC50b2dnbGUoJ2ZpbGUtc3RhdGUtZGlmZmVycycsIHN0YXRlRGlmZmVyc0ZpbGUod2luZG93LnRvY19zdGF0ZSkpCgkJfQoJCWlmIChfLmlzRW1wdHkoZGl2LmRpcmVjdENoaWxkcmVuKSkge3JldHVybn0KCQlmb3IgKGNvbnN0IGNoaWxkIG9mIGRpdi5kaXJlY3RDaGlsZHJlbikgewoJCQlwcm9wYWdhdGVfc3RhdGUoY2hpbGQsIHN0YXRlKQoJCX0KCX0KCWZ1bmN0aW9uIHByb3BhZ2F0ZV9zdGF0ZShkaXYsIHN0YXRlKSB7CgkJbGV0IG5ld19zdGF0ZSA9IGBwYXJlbnQtJHtzdGF0ZX1gCgkJZGl2LmNsYXNzTGlzdC50b2dnbGUobmV3X3N0YXRlLCBmYWxzZSkKCQkvLyBDaGVjayB0aGUgcGFyZW50cyBmb3IgdGhlIHN0YXRlCgkJZm9yIChjb25zdCBwYXJlbnQgb2YgZGl2LmFsbFBhcmVudHMpIHsKCQkJaWYgKHBhcmVudC5jbGFzc0xpc3QuY29udGFpbnMoc3RhdGUpKSB7CgkJCQlkaXYuY2xhc3NMaXN0LnRvZ2dsZShuZXdfc3RhdGUsIHRydWUpCgkJCQlicmVhawoJCQl9CgkJfQoJCWlmIChfLmlzRW1wdHkoZGl2LmRpcmVjdENoaWxkcmVuKSkge3JldHVybn0KCQlmb3IgKGNvbnN0IGNoaWxkIG9mIGRpdi5kaXJlY3RDaGlsZHJlbikgewoJCQlwcm9wYWdhdGVfc3RhdGUoY2hpbGQsIHN0YXRlKQoJCX0KCX0KCWNvbnN0IGZsb2F0aW5nX3VpID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9AZmxvYXRpbmctdWkvZG9tJykKCS8vIHdpbmRvdy5mbG9hdGluZ191aSA9IGZsb2F0aW5nX3VpCglmdW5jdGlvbiBhZGRfbm90ZWJvb2tfYXR0cmlidXRlcyhhdHRycykgewoJCXBsdXRvX2FjdGlvbnMudXBkYXRlX25vdGVib29rKChub3RlYm9vaykgPT4gewoJCQlsZXQgbWQgPSBub3RlYm9vay5tZXRhZGF0YQoJCQltZFsiY3VzdG9tX2F0dHJzIl0gPSBfLnVuaW9uKG1kWyJjdXN0b21fYXR0cnMiXSwgYXR0cnMpCgkJfSkKCQlsZXQgbm90ZWJvb2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdwbHV0by1ub3RlYm9vaycpCgkJZm9yIChsZXQgYXR0ciBvZiBhdHRycykgewoJCQlub3RlYm9vay50b2dnbGVBdHRyaWJ1dGUoYXR0ciwgdHJ1ZSkKCQl9Cgl9CgoJZnVuY3Rpb24gcmVtb3ZlX25vdGVib29rX2F0dHJpYnV0ZXMoYXR0cnMpIHsKCQlwbHV0b19hY3Rpb25zLnVwZGF0ZV9ub3RlYm9vaygobm90ZWJvb2spID0+IHsKCQkJbGV0IG1kID0gbm90ZWJvb2subWV0YWRhdGEKCQkJbGV0IGFmdGVyID0gXy5kaWZmZXJlbmNlKG1kWyJjdXN0b21fYXR0cnMiXSwgYXR0cnMpCgkJCWlmIChfLmlzRW1wdHkoYWZ0ZXIpKSB7CgkJCQlkZWxldGUgbWRbImN1c3RvbV9hdHRycyJdCgkJCX0gZWxzZSB7CgkJCQltZFsiY3VzdG9tX2F0dHJzIl0gPSBhZnRlcgoJCQl9CgkJfSkKCQlsZXQgbm90ZWJvb2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdwbHV0by1ub3RlYm9vaycpCgkJZm9yIChsZXQgYXR0ciBvZiBhdHRycykgewoJCQlub3RlYm9vay50b2dnbGVBdHRyaWJ1dGUoYXR0ciwgZmFsc2UpCgkJfQoJfQoKCWZ1bmN0aW9uIHRvZ2dsZV9ub3RlYm9va19hdHRyaWJ1dGUoYXR0ciwgZm9yY2U9J3RvZ2dsZScpIHsKCQlwbHV0b19hY3Rpb25zLnVwZGF0ZV9ub3RlYm9vaygobm90ZWJvb2spID0+IHsKCQkJbGV0IG1kID0gbm90ZWJvb2subWV0YWRhdGEKCQkJbGV0IGYgPSBmb3JjZSA9PSAndG9nZ2xlJyA/IF8ueG9yIDogZm9yY2UgPyBfLnVuaW9uIDogXy5kaWZmZXJlbmNlCgkJCWxldCBhZnRlciA9IGYobWRbImN1c3RvbV9hdHRycyJdLCBbYXR0cl0pCgkJCWlmIChfLmlzRW1wdHkoYWZ0ZXIpKSB7CgkJCQlkZWxldGUgbWRbImN1c3RvbV9hdHRycyJdCgkJCX0gZWxzZSB7CgkJCQltZFsiY3VzdG9tX2F0dHJzIl0gPSBhZnRlcgoJCQl9CgkJfSkKCQlsZXQgbm90ZWJvb2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdwbHV0by1ub3RlYm9vaycpCgkJZm9yY2UgPT0gJ3RvZ2dsZScgPyBub3RlYm9vay50b2dnbGVBdHRyaWJ1dGUoYXR0cikgOiBub3RlYm9vay50b2dnbGVBdHRyaWJ1dGUoYXR0ciwgZm9yY2UpCgl9CgoJaWYgKGZvcmNlX2hpZGVfZW5hYmxlZCkgewoJIAl0b2dnbGVfbm90ZWJvb2tfYXR0cmlidXRlKCdoaWRlLWVuYWJsZWQnLHRydWUpCgl9CglmdW5jdGlvbiBoYXNfY2VsbF9hdHRyaWJ1dGUoY2VsbF9pZCwgYXR0cikgewoJCWNvbnN0IG1kID0gZWRpdG9yX3N0YXRlLm5vdGVib29rLmNlbGxfaW5wdXRzW2NlbGxfaWRdLm1ldGFkYXRhCgkJcmV0dXJuIF8uaW5jbHVkZXMobWRbImN1c3RvbV9hdHRycyJdLCBhdHRyKQoJfQoJCglmdW5jdGlvbiBhZGRfY2VsbF9hdHRyaWJ1dGVzKGNlbGxfaWQsIGF0dHJzKSB7CgkJcGx1dG9fYWN0aW9ucy51cGRhdGVfbm90ZWJvb2soKG5vdGVib29rKSA9PiB7CgkJCWxldCBtZCA9IG5vdGVib29rLmNlbGxfaW5wdXRzW2NlbGxfaWRdLm1ldGFkYXRhCgkJCW1kWyJjdXN0b21fYXR0cnMiXSA9IF8udW5pb24obWRbImN1c3RvbV9hdHRycyJdLCBhdHRycykKCQl9KQoJCWxldCBjZWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2VsbF9pZCkKCQlmb3IgKGxldCBhdHRyIG9mIGF0dHJzKSB7CgkJCWNlbGwudG9nZ2xlQXR0cmlidXRlKGF0dHIsIHRydWUpCgkJfQoJfQoKCWZ1bmN0aW9uIHJlbW92ZV9jZWxsX2F0dHJpYnV0ZXMoY2VsbF9pZCwgYXR0cnMpIHsKCQlwbHV0b19hY3Rpb25zLnVwZGF0ZV9ub3RlYm9vaygobm90ZWJvb2spID0+IHsKCQkJbGV0IG1kID0gbm90ZWJvb2suY2VsbF9pbnB1dHNbY2VsbF9pZF0ubWV0YWRhdGEKCQkJbGV0IGFmdGVyID0gXy5kaWZmZXJlbmNlKG1kWyJjdXN0b21fYXR0cnMiXSwgYXR0cnMpCgkJCWlmIChfLmlzRW1wdHkoYWZ0ZXIpKSB7CgkJCQlkZWxldGUgbWRbImN1c3RvbV9hdHRycyJdCgkJCX0gZWxzZSB7CgkJCQltZFsiY3VzdG9tX2F0dHJzIl0gPSBhZnRlcgoJCQl9CgkJfSkKCQlsZXQgY2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNlbGxfaWQpCgkJZm9yIChsZXQgYXR0ciBvZiBhdHRycykgewoJCQljZWxsLnRvZ2dsZUF0dHJpYnV0ZShhdHRyLCBmYWxzZSkKCQl9Cgl9CgoJZnVuY3Rpb24gdG9nZ2xlX2NlbGxfYXR0cmlidXRlKGNlbGxfaWQsIGF0dHIsIGZvcmNlPSd0b2dnbGUnKSB7CgkJcGx1dG9fYWN0aW9ucy51cGRhdGVfbm90ZWJvb2soKG5vdGVib29rKSA9PiB7CgkJCWxldCBtZCA9IG5vdGVib29rLmNlbGxfaW5wdXRzW2NlbGxfaWRdLm1ldGFkYXRhCgkJCWxldCBmID0gZm9yY2UgPT0gJ3RvZ2dsZScgPyBfLnhvciA6IGZvcmNlID8gXy51bmlvbiA6IF8uZGlmZmVyZW5jZQoJCQlsZXQgYWZ0ZXIgPSBmKG1kWyJjdXN0b21fYXR0cnMiXSwgW2F0dHJdKQoJCQlpZiAoXy5pc0VtcHR5KGFmdGVyKSkgewoJCQkJZGVsZXRlIG1kWyJjdXN0b21fYXR0cnMiXQoJCQl9IGVsc2UgewoJCQkJbWRbImN1c3RvbV9hdHRycyJdID0gYWZ0ZXIKCQkJfQoJCX0pCgkJbGV0IGNlbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjZWxsX2lkKQoJCWZvcmNlID09ICd0b2dnbGUnID8gY2VsbC50b2dnbGVBdHRyaWJ1dGUoYXR0cikgOiBjZWxsLnRvZ2dsZUF0dHJpYnV0ZShhdHRyLCBmb3JjZSkKCX0KCS8vIEZvciBlYWNoIGZyb20gYW5kIHRvLCB3ZSBoYXZlIHRvIHNwZWNpZnkgYHBsdXRvLWNlbGxbaWRdYCBpbiB0aGUgcGFydCBiZWZvcmUgdGhlIGNvbW0gYW5kIGp1c3QgYFtpZF1gIGluIHRoZSBwYXJ0IGFmdGVyIHRoZSBjb21tYSB0byBlbnN1cmUgdGhlIHNwZWNpZmljaXR5IG9mIHRoZSB0d28gY29tbWEtc2VwYXJhdGVkIHNlbGVjdG9ycyBpcyB0aGUgc2FtZSAodGhlIHBhcnQgYWZ0ZXIgdGhlIGNvbW1hIGhhcyB0aGUgYWRkaXRpb24gb2YgYH4gcGx1dG8tY2VsbGAsIHNvIGl0IGhhcyBpbmhlcmVudGx5ICsxIGVsZW1lbnQgc3BlY2lmaWNpdHkpCglmdW5jdGlvbiBoaWRlX2Zyb21fdG9fc3RyaW5nKGZyb21faWQsIHRvX2lkKSB7CgkJaWYgKF8uaXNFbXB0eShmcm9tX2lkKSAmJiBfLmlzRW1wdHkodG9faWQpKSB7cmV0dXJuICcnfQoJCQoJCWNvbnN0IGZyb21fcHJlc2VsZWN0b3IgPSBfLmlzRW1wdHkoZnJvbV9pZCkgPyAnJyA6IGBwbHV0by1jZWxsW2lkPScke2Zyb21faWR9J10sIHBsdXRvLW5vdGVib29rW2hpZGUtZW5hYmxlZF0gW2lkPScke2Zyb21faWR9J10gfiBgCgkJY29uc3QgdG9fc3R5bGUgPSBfLmlzRW1wdHkodG9faWQpID8gJycgOiBgcGx1dG8tbm90ZWJvb2tbaGlkZS1lbmFibGVkXSBwbHV0by1jZWxsW2lkPScke3RvX2lkfSddLCBwbHV0by1ub3RlYm9va1toaWRlLWVuYWJsZWRdIFtpZD0nJHt0b19pZH0nXSB+IHBsdXRvLWNlbGwgewoJCWRpc3BsYXk6IGJsb2NrOwoJfQoJIGAKCQljb25zdCBzdHlsZV9zdHJpbmcgPSAJYHBsdXRvLW5vdGVib29rW2hpZGUtZW5hYmxlZF0gJHtmcm9tX3ByZXNlbGVjdG9yfXBsdXRvLWNlbGwgewoJCWRpc3BsYXk6IG5vbmU7Cgl9Cgkke3RvX3N0eWxlfQogYAoJCXJldHVybiBzdHlsZV9zdHJpbmcKCQkvL3JldHVybiBodG1sYDxzdHlsZT4ke3N0eWxlX3N0cmluZ308L3N0eWxlPmAKCX0KCglmdW5jdGlvbiBoaWRlX2Zyb21fdG9fbGlzdF9zdHJpbmcodmVjdG9yKSB7CgkJbGV0IG91dCA9IGBgCgkJZm9yIChjb25zdCBsaW1zIG9mIHZlY3RvcikgewoJCQljb25zdCBmcm9tID0gbGltc1swXQoJCQljb25zdCB0byA9IGxpbXNbMV0KCQkJCgkJCW91dCA9IGAke291dH0JJHtoaWRlX2Zyb21fdG9fc3RyaW5nKGZyb20sdG8pfWAKCQl9CgkJb3V0ID0gYCR7b3V0fQlwbHV0by1jZWxsW2Fsd2F5cy1zaG93XSB7CiAgCQkJZGlzcGxheTogYmxvY2sgIWltcG9ydGFudDsKICAJCX0KICBgCgkJcmV0dXJuIG91dAoJfQoJZnVuY3Rpb24gaGlkZV9mcm9tX3RvX2xpc3QodmVjdG9yKSB7CgkJY29uc3Qgc3RyID0gaGlkZV9mcm9tX3RvX2xpc3Rfc3RyaW5nKHZlY3RvcikKCQlyZXR1cm4gaHRtbGA8c3R5bGU+JHtzdHJ9PC9zdHlsZT5gCgl9CglmdW5jdGlvbiBoaWRlX2xpc3Rfc3R5bGUodmVjdG9yKSB7CgkJbGV0IHN0eWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hpZGUtY2VsbHMtc3R5bGUnKQoJCWlmIChzdHlsZSA9PSBudWxsKSB7CiAgCQkJc3R5bGUgPSBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGh0bWxgPHN0eWxlIGlkPSdoaWRlLWNlbGxzLXN0eWxlJz48L3N0eWxlPmApCgkJfQoJCXN0eWxlLmlubmVySFRNTCA9IGhpZGVfZnJvbV90b19saXN0X3N0cmluZyh2ZWN0b3IpCgl9CglmdW5jdGlvbiBzYXZlX3RvX2ZpbGUoKSB7CgkJY29uc3Qgc3RhdGUgPSB3aW5kb3cudG9jX3N0YXRlCgkJZm9yIChjb25zdCBbayx2XSBvZiBPYmplY3QuZW50cmllcyhzdGF0ZSkpIHsKCQkJdG9nZ2xlX2NlbGxfYXR0cmlidXRlKGssICd0b2MtaGlkZGVuJywgdi5oaWRkZW4pCQoJCQl0b2dnbGVfY2VsbF9hdHRyaWJ1dGUoaywgJ3RvYy1jb2xsYXBzZWQnLCB2LmNvbGxhcHNlZCkJCgkJfQoJCXNldFRpbWVvdXQoKCkgPT4gewoJCQl0b2MuY2xhc3NMaXN0LnRvZ2dsZSgnZmlsZS1zdGF0ZS1kaWZmZXJzJywgc3RhdGVEaWZmZXJzRmlsZShzdGF0ZSkpCgkJfSwgNTAwKQoJfQoJY29uc3QgaGVhZGVyID0gdG9jLnF1ZXJ5U2VsZWN0b3IoJ2hlYWRlcicpCgljb25zdCBoZWFkZXJfY29udGFpbmVyID0gaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGh0bWxgPHNwYW4gY2xhc3M9J3RvYy1oZWFkZXItY29udGFpbmVyJz5gKQoJCgkKCWNvbnN0IG5vdGVib29rX2hpZGVfaWNvbiA9IGhlYWRlcl9jb250YWluZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdiZWZvcmVlbmQnLCBodG1sYDxzcGFuIGNsYXNzPSd0b2MtaGVhZGVyLWljb24gdG9jLWhlYWRlci1oaWRlJz5gKQoJCgljb25zdCBzYXZlX2ZpbGVfaWNvbiA9IGhlYWRlcl9jb250YWluZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdiZWZvcmVlbmQnLCBodG1sYDxzcGFuIGNsYXNzPSd0b2MtaGVhZGVyLWljb24gdG9jLWhlYWRlci1zYXZlJz5gKQoJc2F2ZV9maWxlX2ljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzYXZlX3RvX2ZpbGUpCgoJaGVhZGVyX2NvbnRhaW5lci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2JlZm9yZWVuZCcsIGh0bWxgPHNwYW4gY2xhc3M9J3RvYy1oZWFkZXItZmlsbGVyJz5gKQoJCgloZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHsKCQlpZiAoZS50YXJnZXQgIT0gaGVhZGVyKSB7cmV0dXJufQoJCXNjcm9sbF90byhjZWxsLCB7YmxvY2s6ICdjZW50ZXInLCBiZWhhdmlvcjogJ3Ntb290aCd9KQoJfSkKCgloZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIChlKSA9PiB7CgkJZmxvYXRpbmdfdWkuY29tcHV0ZVBvc2l0aW9uKGhlYWRlciwgaGVhZGVyX2NvbnRhaW5lciwgewoJCQlwbGFjZW1lbnQ6ICJsZWZ0IiwKCQkJc3RyYXRlZ3k6ICJmaXhlZCIsCgkJfSkudGhlbihwb3MgPT4gewoJCQloZWFkZXJfY29udGFpbmVyLnN0eWxlLnRvcCA9IHBvcy55ICsgInB4IgoJCQkvLyBoZWFkZXJfY29udGFpbmVyLnN0eWxlLmxlZnQgPSBwb3MueCArICJweCIKCQkJLy8gaGVhZGVyX2NvbnRhaW5lci5zdHlsZS5yaWdodCA9IGBjYWxjKDFyZW0gKyBtaW4oODB2dywgMzAwcHgpKWAKCQl9KQoJfSkKCglub3RlYm9va19oaWRlX2ljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewoJCQkvLyBXZSBmaW5kIHRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIHBsdXRvLW5vdGVib29rIGVsZW1lbnQsIHRvIGF2b2lkIG1pc3NpbmcgdGhlIGNlbGwgd2hlbiBVSSBpcyBkaXNhYmxlZAoJCQljb25zdCB7IHggfSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3BsdXRvLW5vdGVib29rJykuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkKCQkJY29uc3QgcmVmID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludCh4KzEsMTAwKS5jbG9zZXN0KCdwbHV0by1jZWxsJykKCQkJY29uc3QgeyB5IH0gPSByZWYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkKCQkJdG9nZ2xlX25vdGVib29rX2F0dHJpYnV0ZSgnaGlkZS1lbmFibGVkJykKCQkJY29uc3QgZHkgPSByZWYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueSAtIHkKCQkJd2luZG93LnNjcm9sbEJ5KDAsIGR5KQoJfSkKY2VsbC50b2dnbGVBdHRyaWJ1dGUoJ2Fsd2F5cy1zaG93JywgdHJ1ZSkKCWZ1bmN0aW9uIHRvZ2dsZV9zdGF0ZShuYW1lKSB7CgkJcmV0dXJuIChlKSA9PiB7CgkJCWUucHJldmVudERlZmF1bHQoKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCWxldCBkaXYgPSBlLnRhcmdldC5jbG9zZXN0KCdkaXYnKQoJCQljb25zdCBuZXdfdmFsID0gIWRpdi5jbGFzc0xpc3QuY29udGFpbnMobmFtZSkKCQkJc2V0X3N0YXRlKGRpdiwgbmFtZSwgbmV3X3ZhbCkKCQl9Cgl9CgoJZnVuY3Rpb24gdXBkYXRlX2hpZGRlbihlKSB7CgkJbGV0IG5ld19oaWRlID0gW10KCQlpZiAoaGlkZV9wcmVhbWJsZSkgewoJCQluZXdfaGlkZS5wdXNoKFsnJywgZ2V0X2xpbmtfaWQodG9jLnF1ZXJ5U2VsZWN0b3IoJ2Rpdi50b2Mtcm93JykpXSkKCQl9CgkJbGV0IHRyYWNraW5nX2hpZGRlbiA9IG51bGwKCQlsZXQgZGl2cyA9IHRvYy5xdWVyeVNlbGVjdG9yQWxsKCdkaXYudG9jLXJvdycpCgkJZm9yIChjb25zdCBkaXYgb2YgZGl2cykgewoJCQlpZiAodHJhY2tpbmdfaGlkZGVuICE9IG51bGwpIHsKCQkJCWNvbnN0IGhpZGRlbiA9IGRpdi5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpIHx8IGRpdi5jbGFzc0xpc3QuY29udGFpbnMoJ3BhcmVudC1oaWRkZW4nKQoJCQkJaWYgKCFoaWRkZW4pIHsKCQkJCQluZXdfaGlkZS5wdXNoKFt0cmFja2luZ19oaWRkZW4sIGdldF9saW5rX2lkKGRpdildKQkKCQkJCQl0cmFja2luZ19oaWRkZW4gPSBudWxsCgkJCQl9CgkJCX0gZWxzZSB7CgkJCQljb25zdCBoaWRkZW4gPSBkaXYuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKQoJCQkJaWYgKGhpZGRlbikgewoJCQkJCXRyYWNraW5nX2hpZGRlbiA9IGdldF9saW5rX2lkKGRpdikKCQkJCX0KCQkJfQoJCX0KCQlpZiAodHJhY2tpbmdfaGlkZGVuICE9IG51bGwpIHsKCQkJCW5ld19oaWRlLnB1c2goW3RyYWNraW5nX2hpZGRlbiwgIiJdKQkKCQl9CgkJaGlkZV9saXN0X3N0eWxlKG5ld19oaWRlKQoJfQoKCS8vIFJlcG9zaXRpb24gdGhlIGhpZGVfY29udGFpbmVyIHVzaW5nIHRoZSBmbG9hdGluZy11aSBsaWJyYXJ5CglmdW5jdGlvbiByZXBvc2l0aW9uVG9vbHRpcChlKSB7CgkJY29uc3QgeyBjb21wdXRlUG9zaXRpb24gfSA9IGZsb2F0aW5nX3VpCgkJY29uc3QgcmVmID0gZS50YXJnZXQKCQljb25zdCB0b29sdGlwID0gcmVmLnF1ZXJ5U2VsZWN0b3IoJy50b2MtaGlkZS1jb250YWluZXInKQoJCWlmIChfLmlzTmlsKHRvb2x0aXApKSB7CgkJCWNvbnNvbGUud2FybigiU29tZXRoaW5nIHdlbnQgd3JvbmcsIG5vIHRvb2x0aXAgZm91bmQiKQoJCQlyZXR1cm4KCQl9CgkJY29tcHV0ZVBvc2l0aW9uKHJlZiwgdG9vbHRpcCwgewoJCQlwbGFjZW1lbnQ6ICJsZWZ0IiwKCQkJc3RyYXRlZ3k6ICJmaXhlZCIsCgkJfSkudGhlbihwb3MgPT4gewoJCQl0b29sdGlwLnN0eWxlLnRvcCA9IHBvcy55ICsgInB4IgoJCX0pCgl9CgkKCWZ1bmN0aW9uIHByb2Nlc3Nfcm93KGRpdiwgaGlzdG9yeSwgb2xkX3N0YXRlLCBuZXdfc3RhdGUpIHsKCgkJLy8gV2UgYWRkIHRoZSBzZXBhcmF0b3IKCQlkaXYuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdiZWZvcmViZWdpbicsIGh0bWxgPGRpdiBjbGFzcz0ndG9jLXJvdy1zZXBhcmF0b3InPjwvZGl2PmApCgkJLy8gSWYgd2UgYXJlIGp1c3QgcHJvY2Vzc2luZyB0aGUgZmlyc3QgZWxlbWVudCAoc28gdGhlIGxhc3Qgcm93KSB3ZSBhbHNvIGFkZCBhIHNlcGFyYXRvciBhdCB0aGUgYm90dG9tCgkJaWYgKF8uaXNFbXB0eShuZXdfc3RhdGUpICYmIF8uZXZlcnkoaGlzdG9yeSwgXy5pc0VtcHR5KSkgewoJCQlkaXYuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmVuZCcsIGh0bWxgPGRpdiBjbGFzcz0ndG9jLXJvdy1zZXBhcmF0b3InPjwvZGl2PmApCgkJfQoKCQkvLyBXZSBhZGQgdGhlIHJlcG9zaXRpb24gZXZlbnQgdG8gdGhlIHJvdwoJCWRpdi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgcmVwb3NpdGlvblRvb2x0aXApCgkJCgkJbGV0IGlkID0gZ2V0X2xpbmtfaWQoZGl2KQoJCWNvbnN0IGEgPSBkaXYucXVlcnlTZWxlY3RvcignYScpCgkJbGV0IG9sZF9mID0gYS5vbmNsaWNrOwoJCWEub25jbGljayA9IChlKSA9PiB7CgkJCWUucHJldmVudERlZmF1bHQoKQoJCQkvLyBXZSBhdm9pZCB0cmlnZ2VyaW5nIHRoZSBjbGljayBpZiBjb21pbmcgb3V0IG9mIGEgZHJhZwoJCQlpZiAodG9jLmNsYXNzTGlzdC5jb250YWlucygncmVjZW50LWRyYWcnKSkgeyByZXR1cm4gfQoJCQlvbGRfZihlKQoJCX0JCQkKCQljb25zdCBsZXZlbCA9IGdldEhlYWRpbmdMZXZlbChkaXYpCgkJaWYgKGxldmVsID4gMSkgewoJCQloaXN0b3J5W2xldmVsXS51bnNoaWZ0KGRpdikKCQl9CgkJLy8gV2UgaXRlcmF0ZSB0aHJvdWdoIHRoZSBoaXN0b3J5IGFuZCBhc3NpZ24gdGhlIGRpcmVjdCBjaGlsZHJlbiBpZiB0aGV5IGV4aXN0LCB3aGlsZSBjbGVhcmluZyBsb3dlciBsZXZlbHMgaGlzdG9yeQoJCWZvciAobGV0IGkgPSA2OyBpID4gbGV2ZWw7IGktLSkgewoJCQlpZiAoXy5pc0VtcHR5KGhpc3RvcnlbaV0pKSB7Y29udGludWV9CgkJCWlmIChkaXYuZGlyZWN0Q2hpbGRyZW4gIT0gdW5kZWZpbmVkKSB7dGhyb3coJ211bHRpcGxlIGxldmVsIHdpdGggY2hpbGRyZW4sIHVuZXhwZWN0ZWQhJyl9CgkJCWRpdi5kaXJlY3RDaGlsZHJlbiA9IGhpc3RvcnlbaV0KCQkJaGlzdG9yeVtpXSA9IFtdIC8vIGVtcHR5IGFycmF5CgkJfQoJCWNvbnN0IGNvbGxhcHNlX3NwYW4gPSBhLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGh0bWxgPHNwYW4gY2xhc3M9J3RvYy1pY29uIHRvYy1jb2xsYXBzZSc+YCkKCQlsZXQgaGlkZV9zdHlsZSA9IGAtLWhlaWdodDogJHthLmNsaWVudEhlaWdodH1weGAKCQljb25zdCBoaWRlX2NvbnRhaW5lciA9IGRpdi5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBodG1sYDxzcGFuIGNsYXNzPSd0b2MtaGlkZS1jb250YWluZXInIHN0eWxlPScke2hpZGVfc3R5bGV9Jz5gKQoJCWNvbnN0IGhpZGVfc3BhbiA9IGhpZGVfY29udGFpbmVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGh0bWxgPHNwYW4gY2xhc3M9J3RvYy1pY29uIHRvYy1oaWRlJz5gKQoJCWhpZGVfc3Bhbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CgkJCXRvZ2dsZV9zdGF0ZSgnaGlkZGVuJykoZSkKCQkJdXBkYXRlX2hpZGRlbihlKQoJCX0pCgkJaWYgKGRpdi5kaXJlY3RDaGlsZHJlbiA9PSB1bmRlZmluZWQpIHsKCQkJY29sbGFwc2Vfc3Bhbi5jbGFzc0xpc3QudG9nZ2xlKCduby1jaGlsZHJlbicsIHRydWUpCgkJfSBlbHNlIHsKCQkJcHJvcGFnYXRlX3BhcmVudChkaXYpCgkJCWNvbGxhcHNlX3NwYW4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVfc3RhdGUoJ2NvbGxhcHNlZCcpKQoJCX0KCQlsZXQgbWQgPSBlZGl0b3Jfc3RhdGUubm90ZWJvb2suY2VsbF9pbnB1dHNbaWRdLm1ldGFkYXRhCgkJbGV0IGNvbGxhcHNlZCA9IG9sZF9zdGF0ZVtpZF0/LmNvbGxhcHNlZCA/PyAgXy5pbmNsdWRlcyhtZFsnY3VzdG9tX2F0dHJzJ10sICd0b2MtY29sbGFwc2VkJykKCQlsZXQgaGlkZGVuID0gb2xkX3N0YXRlW2lkXT8uaGlkZGVuID8/IF8uaW5jbHVkZXMobWRbJ2N1c3RvbV9hdHRycyddLCAndG9jLWhpZGRlbicpCgkJc2V0X3N0YXRlKGRpdiwgJ2NvbGxhcHNlZCcsIGNvbGxhcHNlZCwgdHJ1ZSkKCQlzZXRfc3RhdGUoZGl2LCAnaGlkZGVuJywgaGlkZGVuLCB0cnVlKQoJCW5ld19zdGF0ZVtpZF0gPSB7IGNvbGxhcHNlZCwgaGlkZGVuIH0KCQkKCX0KCgljb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHsKCQljb25zdCByb3dzID0gdG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NlY3Rpb24gZGl2LnRvYy1yb3cnKQoJCWxldCBvbGRfc3RhdGUgPSB3aW5kb3cudG9jX3N0YXRlID8/IHt9CgkJbGV0IG5ld19zdGF0ZSA9IHt9CgkJbGV0IGhpc3RvcnkgPSB7CgkJCTI6IFtdLAoJCQkzOiBbXSwKCQkJNDogW10sCgkJCTU6IFtdLAoJCQk2OiBbXSwKCQl9CgkJZm9yIChjb25zdCByb3cgb2YgWy4uLnJvd3NdLnJldmVyc2UoKSkgewoJCQlwcm9jZXNzX3Jvdyhyb3csIGhpc3RvcnksIG9sZF9zdGF0ZSwgbmV3X3N0YXRlKQoJCX0KCQl3aW5kb3cudG9jX3N0YXRlID0gbmV3X3N0YXRlCgkJdG9jLmNsYXNzTGlzdC50b2dnbGUoJ2ZpbGUtc3RhdGUtZGlmZmVycycsIHN0YXRlRGlmZmVyc0ZpbGUobmV3X3N0YXRlKSkKCQl1cGRhdGVfaGlkZGVuKCkKCX0pCgoJb2JzZXJ2ZXIub2JzZXJ2ZSh0b2MsIHtjaGlsZExpc3Q6IHRydWV9KQoJY29uc3QgeyBkZWZhdWx0OiBpbnRlcmFjdCB9ID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9pbnRlcmFjdGpzJykKCgkvLyBXZSBoYXZlIHRvIGVuYWJsZSBkeW5hbWljRHJvcCB0byBoYXZlIGRyb3B6b25lIHJlY29tcHV0ZWQgb24gZHJhZ21vdmUKCWludGVyYWN0LmR5bmFtaWNEcm9wKHRydWUpCgoJZnVuY3Rpb24gZHJhZ0VuYWJsZXIoZSkgewoJCWlmICghdG9jLmNsYXNzTGlzdC5jb250YWlucygnZHJhZ19lbmFibGVkJykgfHwgZS5rZXkgIT09ICdTaGlmdCcpIHsgcmV0dXJuIHRydWUgfQoJCXN3aXRjaCAoZS50eXBlKSB7CgkJCWNhc2UgImtleWRvd24iOgoJCQkJdG9jLmNsYXNzTGlzdC5hZGQoJ2FsbG93X2FsbF9kcm9wJykKCQkJCWJyZWFrOwoJCQljYXNlICJrZXl1cCI6CgkJCQl0b2MuY2xhc3NMaXN0LnJlbW92ZSgnYWxsb3dfYWxsX2Ryb3AnKQoJCQkJYnJlYWs7CgkJfQoJCXVwZGF0ZUFjdGl2ZVNlcGFyYXRvcigpCgl9CgoJY29uc3Qgd2luZG93X2V2ZW50cyA9IHsKCQlrZXlkb3duOiBkcmFnRW5hYmxlciwKCQlrZXl1cDogZHJhZ0VuYWJsZXIsCgl9CgoJYWRkU2NyaXB0RXZlbnRMaXN0ZW5lcnMod2luZG93LCB3aW5kb3dfZXZlbnRzKQoKCS8vIEludGVyYWN0LmpzIHBhcnQKCglsZXQgYWN0aXZlRHJvcCA9IHVuZGVmaW5lZAoKCWZ1bmN0aW9uIHRhZ0FkamFjZW50U2VwYXJhdG9ycyhlbCwgYWN0aXZlKSB7CgkJY29uc3QgbmV4dCA9IGdldE5leHRTaWJsaW5nKGVsLCAnLnRvYy1yb3ctc2VwYXJhdG9yJykKCQljb25zdCBwcmV2ID0gZ2V0UHJldmlvdXNTaWJsaW5nKGVsLCAnLnRvYy1yb3ctc2VwYXJhdG9yJykKCQlpZiAoYWN0aXZlKSB7CiAgCQkJbmV4dD8uY2xhc3NMaXN0LmFkZCgnbm9zaG93JykKICAJCQlwcmV2Py5jbGFzc0xpc3QuYWRkKCdub3Nob3cnKQoJCX0gZWxzZSB7CiAgCQkJbmV4dD8uY2xhc3NMaXN0LnJlbW92ZSgnbm9zaG93JykKICAJCQlwcmV2Py5jbGFzc0xpc3QucmVtb3ZlKCdub3Nob3cnKQkJCQkKCQl9Cgl9CgoJZnVuY3Rpb24gZ2V0U2VwYXJhdG9yKHN0YXJ0RWxlbWVudCwgYmVsb3csIGFsbG93QWxsLCBoZWFkaW5nTGV2ZWwgPSA4KSB7CgkJbGV0IHNlcGFyYXRvcgoJCWlmIChiZWxvdykgewoJCQljb25zdCBzZWxlY3RvciA9ICcudG9jLXJvdzpub3QoLnBhcmVudC1jb2xsYXBzZWQpJwoJCQljb25zdCBjaGVja2VyRnVuYyA9IGFsbG93QWxsID8gZ2VuZXJhdGVDaGVja2VyKHNlbGVjdG9yKSA6IChlbCkgPT4gewoJCQkJaWYgKCFlbC5tYXRjaGVzKHNlbGVjdG9yKSkgeyByZXR1cm4gZmFsc2UgfQoJCQkJLy8gQ2hlY2sgZm9yIHRoZSByaWdodCBoZWFkaW5nIGxldmVsCgkJCQlmb3IgKGxldCBpID0gaGVhZGluZ0xldmVsOyBpID4gMDsgaS0tKSB7CgkJCQkJY29uc3QgY2wgPSAiSCIgKyBpCgkJCQkJaWYgKGVsLmNsYXNzTGlzdC5jb250YWlucyhjbCkpIHsgcmV0dXJuIHRydWUgfQoJCQkJfQoJCQkJcmV0dXJuIGZhbHNlCgkJCX0KCQkJY29uc3QgdmFsaWRSb3cgPSBnZXROZXh0U2libGluZyhzdGFydEVsZW1lbnQsIGNoZWNrZXJGdW5jKQoJCQkvLyBJZiB0aGUgYWN0aXZlRHJvcCBpcyB0aGUgbGFzdCByb3cgb3IgdGhlIHRoZSBsYXN0IG5vbi1jb2xsYXBzZWQgb25lLCB0aGUgdmFsaWRSb3cgd2lsbCBiZSBgdW5kZWZpbmVkYCwgc28gaW4gdGhhdCBjYXNlIHdlIHRha2UgdGhlIGxhc3Qgc2VwYXJhdG9yCgkJCXNlcGFyYXRvciA9IGdldFByZXZpb3VzU2libGluZyh2YWxpZFJvdywgJy50b2Mtcm93LXNlcGFyYXRvcicpID8/IF8ubGFzdCh0b2MucXVlcnlTZWxlY3RvckFsbCgnLnRvYy1yb3ctc2VwYXJhdG9yJykpCgkJfSBlbHNlIHsKCQkJc2VwYXJhdG9yID0gZ2V0UHJldmlvdXNTaWJsaW5nKHN0YXJ0RWxlbWVudCwgJy50b2Mtcm93LXNlcGFyYXRvcicpCgkJfQoJCXJldHVybiBzZXBhcmF0b3IKCX0KCglmdW5jdGlvbiBnZXRIaWdoZXJQYXJlbnQocm93LCBsZXZlbCkgewoJCWNvbnN0IGN1cnJlbnRMZXZlbCA9IGdldEhlYWRpbmdMZXZlbChyb3cpCgkJaWYgKGN1cnJlbnRMZXZlbCA8PSBsZXZlbCkge3JldHVybiByb3d9CgkJZm9yIChjb25zdCBwYXIgb2Ygcm93LmFsbFBhcmVudHMpIHsKCQkJLy8gUGFyZW50cyBjeWNsZSBmcm9tIGhpZ2hlciBsZXZlbCB0byBsb3dlciBsZXZlbHMKCQkJaWYgKGdldEhlYWRpbmdMZXZlbChwYXIpIDw9IGxldmVsKSB7cmV0dXJuIHBhcn0KCQl9CgkJcmV0dXJuIHJvdwoJfQoJCQoJbGV0IHVuY29sbGFwc2VkID0gW10KCglmdW5jdGlvbiByZUNvbGxhcHNlKHJvdykgewoJCWNvbnN0IHBhcmVudHMgPSByb3c/LmFsbFBhcmVudHMgPz8gW10KCQljb25zdCB0b1JlbW92ZSA9IF8uZGlmZmVyZW5jZSh1bmNvbGxhcHNlZCwgWy4uLnBhcmVudHMsIHJvd10pCgkJZm9yIChjb25zdCBlbCBvZiB0b1JlbW92ZSkgewoJCQkvLyBkZWJ1Z2dlcgoJCQlzZXRfc3RhdGUoZWwsICJjb2xsYXBzZWQiLCB0cnVlKQoJCQlfLnJlbW92ZSh1bmNvbGxhcHNlZCwgeCA9PiB4ID09PSBlbCkKCQl9Cgl9CgoKCWZ1bmN0aW9uIHVwZGF0ZURyb3Bab25lKHJvdykgewoJCWNvbnN0IHByZXYgPSB0b2MucXVlcnlTZWxlY3RvcignLnRvYy1yb3cuYWN0aXZlX2Ryb3AnKQoJCWlmIChfLmlzTmlsKHJvdykgfHwgcHJldiA9PT0gcm93KSB7cmV0dXJufQoJCWlmIChwcmV2Py50aW1lb3V0SWQpIHsKCQkJY2xlYXJUaW1lb3V0KHByZXYudGltZW91dElkKQoJCQlwcmV2LnRpbWVvdXRJZCA9IHVuZGVmaW5lZAoJCX0KCQlwcmV2Py5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmVfZHJvcCcpCgkJcm93LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZV9kcm9wJykKCQlyZUNvbGxhcHNlKHJvdykKCQlpZiAocm93LmNsYXNzTGlzdC5jb250YWlucygnY29sbGFwc2VkJykpIHsKCQkJcm93LnRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewoJCQkJdW5jb2xsYXBzZWQucHVzaChyb3cpCgkJCQlzZXRfc3RhdGUocm93LCAiY29sbGFwc2VkIiwgZmFsc2UpCgkJCQl1cGRhdGVBY3RpdmVTZXBhcmF0b3IoKQoJCQl9LCA1MDApCgkJfQoJCWFjdGl2ZURyb3AgPSByb3cKCX0KCglmdW5jdGlvbiB1cGRhdGVBY3RpdmVTZXBhcmF0b3IoKSB7CgkJY29uc3QgZSA9IHRvYy5sYXN0RHJhZ0V2ZW50CgkJaWYgKF8uaXNOaWwoZSkpIHsgcmV0dXJuIH0KCQljb25zdCBlbEJlbG93ID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChlLmNsaWVudC54LCBlLmNsaWVudC55KQoJCWlmICghZWxCZWxvdy5tYXRjaGVzKCcucGx1dG91aS10b2MgOnNjb3BlJykpIHsKCQkJLy8gV2UgYXJlIG91dCBvZiB0aGUgVG9DLCByZWNvbGxhcHNlIGFuZCByZW1vdmUgYWN0aXZlIHNlcGFyYXRvcgoJCQlyZUNvbGxhcHNlKHVuZGVmaW5lZCkKCQkJdG9jLnF1ZXJ5U2VsZWN0b3IoJy50b2Mtcm93LXNlcGFyYXRvci5hY3RpdmUnKT8uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykKCQkJcmV0dXJuCgkJfQoJCWNvbnN0IHJvd0JlbG93ID0gZ2V0Um93KGVsQmVsb3cpCgkJdXBkYXRlRHJvcFpvbmUocm93QmVsb3cpCgkJaWYgKF8uaXNOaWwoYWN0aXZlRHJvcCkpIHtyZXR1cm59CgkJY29uc3QgYWxsb3dBbGwgPSB0b2MuY2xhc3NMaXN0LmNvbnRhaW5zKCdhbGxvd19hbGxfZHJvcCcpCgkJY29uc3QgaGVhZGluZ0xldmVsID0gZ2V0SGVhZGluZ0xldmVsKHRvYy5kcmFnZ2VkRWxlbWVudCkKCQljb25zdCB7IHksIGhlaWdodCB9ID0gYWN0aXZlRHJvcC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKQoJCWxldCB0aHJlc2hvbGRZID0geSArIGhlaWdodC8yCgkJaWYgKCFhbGxvd0FsbCkgewoJCQkvLyBXZSBvbmx5IGFsbG93IHB1dHRpbmcgdGhlIGRyYWdnZWQgZWxlbWVudCBhYm92ZS9iZWxvdyByb3dzIHdpdGggZXF1YWwgb3IgaGlnaGVyIGhlYWRpbmcgbGV2ZWwKCQkJY29uc3QgY3VycmVudEhlYWRpbmdMZXZlbCA9IGdldEhlYWRpbmdMZXZlbChhY3RpdmVEcm9wKQoJCQlpZiAoY3VycmVudEhlYWRpbmdMZXZlbCA+IGhlYWRpbmdMZXZlbCkgewoJCQkJLy8gV2UgdXBkYXRlIHRoZSB0aHJlc2hvbGQgYmFzZWQgb24gdGhlIHJlbGV2YW50IHBhcmVudAoJCQkJY29uc3QgcGFyID0gZ2V0SGlnaGVyUGFyZW50KGFjdGl2ZURyb3AsIGhlYWRpbmdMZXZlbCkKCQkJCWNvbnN0IHsgeSwgaGVpZ2h0IH0gPSBwYXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkKCQkJCXRocmVzaG9sZFkgPSB5ICsgaGVpZ2h0LzIJCQkJCQkKCQkJfQoJCX0KCQkvLyBDaGVjayBpZiB0aGUgY3VycmVudCBwb3NpdGlvbiBvZiB0aGUgbW91c2UgaXMgYmVsb3cgb3IgYWJvdmUgdGhlIG1pZGRsZSBvZiB0aGUgYWN0aXZlIGRyb3Agem9uZQoJCWNvbnN0IGlzQmVsb3cgPSBlLmNsaWVudC55ID4gdGhyZXNob2xkWQoJCWNvbnN0IG5ld1NlcCA9IGdldFNlcGFyYXRvcihhY3RpdmVEcm9wLCBpc0JlbG93LCBhbGxvd0FsbCwgaGVhZGluZ0xldmVsKQoJCWNvbnN0IGN1cnJlbnRTZXAgPSB0b2MucXVlcnlTZWxlY3RvcignLnRvYy1yb3ctc2VwYXJhdG9yLmFjdGl2ZScpID8/IG5ld1NlcAoJCWlmIChjdXJyZW50U2VwICE9PSBuZXdTZXApIHsKCQkJY3VycmVudFNlcC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKQoJCX0KCQluZXdTZXAuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykKCX0KCgljb25zdCBkcmFnSGFuZGxlcyA9IGludGVyYWN0KCcudG9jLXJvdycpLmRyYWdnYWJsZSh7CgkJY3Vyc29yQ2hlY2tlciAoYWN0aW9uLCBpbnRlcmFjdGFibGUsIGVsZW1lbnQsIGludGVyYWN0aW5nKSB7CgkJCS8vIGNvbnNvbGUubG9nKHthY3Rpb24sIGludGVyYWN0YWJsZSwgZWxlbWVudCwgaW50ZXJhY3Rpbmd9KQoJCQlyZXR1cm4gbnVsbAoJCX0sCgkJbWFudWFsU3RhcnQ6IHRydWUsIC8vIG5lZWRlZCBmb3IgY29uc2lzdGVudCBzdGFydCBhZnRlciBob2xkCgkJbGlzdGVuZXJzOiB7CgkJCXN0YXJ0OiBmdW5jdGlvbiAoZSkgewoJCQkJdG9jLmNsYXNzTGlzdC5hZGQoJ2RyYWdfZW5hYmxlZCcpCgkJCQljb25zdCByb3cgPSBlLnRhcmdldAoJCQkJLy8gY29uc29sZS5sb2coJ3N0YXJ0OiAnLCBlKQoJCQkJdG9jLmxhc3REcmFnRXZlbnQgPSBlCgkJCQlyb3cuY2xhc3NMaXN0LmFkZCgnZHJhZ2dlZCcpCgkJCQl0b2MuZHJhZ2dlZEVsZW1lbnQgPSByb3cKCQkJCXRhZ0FkamFjZW50U2VwYXJhdG9ycyhyb3csIHRydWUpCgkJCX0sCgkJCW1vdmU6IGZ1bmN0aW9uIChlKSB7CgkJCQl0b2MubGFzdERyYWdFdmVudCA9IGUKCQkJCXVwZGF0ZUFjdGl2ZVNlcGFyYXRvcigpCgkJCX0sCgkJCS8vIG1vdmU6IGZ1bmN0aW9uIChlKSB7Y29uc29sZS5sb2coJ21vdmU6ICcsZSl9LAoJCQllbmQ6IGZ1bmN0aW9uIChlKSB7CgkJCQlhY3RpdmVEcm9wID0gdW5kZWZpbmVkCgkJCQllLnByZXZlbnREZWZhdWx0KCkKCQkJCXRvYy5sYXN0RHJhZ0V2ZW50ID0gZQoJCQkJLy8gY29uc29sZS5sb2coJ2VuZDogJywgZSkKCQkJCWNvbnN0IHJvdyA9IGUudGFyZ2V0CgkJCQkvLyBDbGVhbnVwCgkJCQlyb3cuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dlZCcpCgkJCQl0b2MuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ19lbmFibGVkJykJCgkJCQlmb3IgKGNvbnN0IGVsIG9mIHRvYy5xdWVyeVNlbGVjdG9yQWxsKCcuYWN0aXZlX2Ryb3AnKSkgewoJCQkJCWVsLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZV9kcm9wJykKCQkJCX0KCQkJCXJlQ29sbGFwc2UoKQkJCQkKCQkJCXRhZ0FkamFjZW50U2VwYXJhdG9ycyhyb3csIGZhbHNlKQkJCQkKCQkJCXRvYy5jbGFzc0xpc3QucmVtb3ZlKCdhbGxvd19hbGxfZHJvcCcpCgkJCQkvLyBXZSB0ZW1wb3Jhcnkgc2V0IHRoZSByZWNlbnREcmFnIGZsYWcKCQkJCXRvYy5jbGFzc0xpc3QuYWRkKCdyZWNlbnQtZHJhZycpCgkJCQlzZXRUaW1lb3V0KCgpID0+IHsKCQkJCQl0b2MuY2xhc3NMaXN0LnJlbW92ZSgncmVjZW50LWRyYWcnKQoJCQkJfSwgMzAwKQoJCQkJLy8gQ2hlY2sgaWYgdGhlcmUgaXMgYW4gYWN0aXZlIGRyb3B6b25lCgkJCQljb25zdCBkcm9wWm9uZSA9IHRvYy5xdWVyeVNlbGVjdG9yKCcudG9jLXJvdy1zZXBhcmF0b3IuYWN0aXZlJykKCQkJCWlmIChfLmlzTmlsKGRyb3Bab25lKSB8fCBkcm9wWm9uZS5jbGFzc0xpc3QuY29udGFpbnMoJ25vc2hvdycpKSB7cmV0dXJufQoJCQkJZHJvcFpvbmUuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykKCQkJCS8vIFdlIGZpbmQgdGhlIGNlbGwgYWZ0ZXIgdGhlIGFjdGl2ZSBzZXBhcmF0b3IgYW5kIG1vdmUgdGhlIGRyYWdnZWQgcm93IGJlZm9yZSB0aGF0CgkJCQljb25zdCByb3dBZnRlciA9IGdldE5leHRTaWJsaW5nKGRyb3Bab25lKQoJCQkJY29uc3QgY2VsbElkc1RvTW92ZSA9IGdldEJsb2NrSWRzKHJvdykKCQkJCS8vIEZpbmQgdGhlIGluZGV4IG9mIHRoZSBjZWxsIHRoYXQgd2lsbCBzdGF5IGFmdGVyIG91ciBtb3ZlZCBibG9jawoJCQkJY29uc3QgZW5kID0gZWRpdG9yX3N0YXRlLm5vdGVib29rLmNlbGxfb3JkZXIuaW5kZXhPZihnZXRfbGlua19pZChyb3dBZnRlcikpCgkJCQkvLyBJZiB3ZSBnb3QgLTEsIGl0IG1lYW5zIHdlIGhhdmUgdG8gcHV0IHRoZSBjZWxscyBhdCB0aGUgZW5kCgkJCQlwbHV0b19hY3Rpb25zLm1vdmVfcmVtb3RlX2NlbGxzKGNlbGxJZHNUb01vdmUsIGVuZCA8IDAgPyBJbmZpbml0eSA6IGVuZCkKCQkJCXRvYy5kcmFnZ2VkRWxlbWVudCA9IHVuZGVmaW5lZAkJCgkJCX0sCgkJfQoJfSkub24oJ2hvbGQnLGZ1bmN0aW9uIChlKSB7CgkJaWYgKGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKCdkaXNhYmxlX3VpJykpIHsgY29uc29sZS5sb2coJ1VJIGRpc2FibGVkLCBubyBpbnRlcmFjdGlvbiEnKTsgcmV0dXJuIH0KCQllLnByZXZlbnREZWZhdWx0KCkKCQllLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpCgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCS8vIGNvbnNvbGUubG9nKCd0aGlzIGlzIGhvbGQnLCBlKQoJCXZhciBpbnRlcmFjdGlvbiA9IGUuaW50ZXJhY3Rpb24KCgkgICAgaWYgKCFpbnRlcmFjdGlvbi5pbnRlcmFjdGluZygpKSB7CgkgICAgICBpbnRlcmFjdGlvbi5zdGFydCgKCSAgICAgICAgeyBuYW1lOiAnZHJhZycgfSwKCSAgICAgICAgZS5pbnRlcmFjdGFibGUsCgkgICAgICAgIGUuY3VycmVudFRhcmdldCwKCSAgICAgICkKCSAgICB9Cgl9KQoKCS8qICMgSlMgTGlzdGVuZXJzIFBvc3RhbWJsZSBhZGRlZCBieSBQbHV0b0V4dHJhcyAqLwoJLy8gQXNzaWduIHRoZSB2YXJpb3VzIGV2ZW50cyBsaXN0ZW5lcnMgZGVmaW5lZCB3aXRoaW4gdGhlIHNjcmlwdAoJZm9yIChjb25zdCBpdGVtIG9mIF9ldmVudHNfbGlzdGVuZXJzXykgewoJCWNvbnN0IHsgZWxlbWVudCwgbGlzdGVuZXJzIH0gPSBpdGVtCgkJZm9yIChjb25zdCBbbmFtZSwgZnVuY10gb2YgXy5lbnRyaWVzKGxpc3RlbmVycykpIHsKICAJCQllbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgZnVuYykKCQl9Cgl9CgkvKiAjIEpTIExpc3RlbmVycyBQb3N0YW1ibGUgYWRkZWQgYnkgUGx1dG9FeHRyYXMgKi8KCmludmFsaWRhdGlvbi50aGVuKCgpID0+IHsKb2JzZXJ2ZXIuZGlzY29ubmVjdCgpCmRyYWdIYW5kbGVzLnVuc2V0KCkKCS8qICMgSlMgTGlzdGVuZXJzIGludmFsaWRhdGlvbiBhZGRlZCBieSBQbHV0b0V4dHJhcyAqLwoJLy8gUmVtb3ZlIHRoZSBldmVudHMgbGlzdGVuZXJzIGR1cmluZyBpbnZhbGlkYXRpb24KCWZvciAoY29uc3QgaXRlbSBvZiBfZXZlbnRzX2xpc3RlbmVyc18pIHsKCQljb25zdCB7IGVsZW1lbnQsIGxpc3RlbmVycyB9ID0gaXRlbQoJCWZvciAoY29uc3QgW25hbWUsIGZ1bmNdIG9mIF8uZW50cmllcyhsaXN0ZW5lcnMpKSB7CgkJCWVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihuYW1lLCBmdW5jKQoJCX0KCX0KCS8qICMgSlMgTGlzdGVuZXJzIGludmFsaWRhdGlvbiBhZGRlZCBieSBQbHV0b0V4dHJhcyAqLwp9KQo8L3NjcmlwdD4KCjxzdHlsZT4JCgkucGx1dG91aS10b2MgaGVhZGVyIHsKCQljdXJzb3I6IHBvaW50ZXI7Cgl9CglzcGFuLnRvYy1oZWFkZXItY29udGFpbmVyIHsKCQlwb3NpdGlvbjogZml4ZWQ7CgkJZGlzcGxheTogbm9uZTsKCQktLXNpemU6IDI1cHg7CgkJaGVpZ2h0OiBjYWxjKDUxcHggLSAxcmVtKTsKCQlmbGV4LWRpcmVjdGlvbjogcm93LXJldmVyc2U7CgkJcmlnaHQ6IGNhbGMoMXJlbSArIG1pbig4MHZoLCAzMDBweCkpOwoJfQoJLnRvYy1oZWFkZXItaWNvbiB7CgkJbWFyZ2luLXJpZ2h0OiAwLjNyZW07CgkJYWxpZ24tc2VsZjogc3RyZXRjaDsKCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CgkJd2lkdGg6IHZhcigtLXNpemUpOwoJCWJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQljdXJzb3I6IHBvaW50ZXI7Cgl9CgkudG9jLWhlYWRlci1maWxsZXIgewoJCW1hcmdpbjogLjI1cmVtOwoJfQoJaGVhZGVyOmhvdmVyIHNwYW4udG9jLWhlYWRlci1jb250YWluZXIsCglzcGFuLnRvYy1oZWFkZXItY29udGFpbmVyOmhvdmVyIHsKCQlkaXNwbGF5OiBmbGV4OwoJfQoJLnRvYy1oZWFkZXItaGlkZSB7CgkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvZXllLW91dGxpbmUuc3ZnKTsKCQlvcGFjaXR5OiA1MCU7CgkJLS1zaXplOiAxZW07Cgl9CgkudG9jLWhlYWRlci1zYXZlIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9zYXZlLW91dGxpbmUuc3ZnKTsKCQlvcGFjaXR5OiA1MCU7Cgl9CgluYXY6bm90KC5maWxlLXN0YXRlLWRpZmZlcnMpIC50b2MtaGVhZGVyLXNhdmUgewoJCWRpc3BsYXk6IG5vbmU7Cgl9CglwbHV0by1ub3RlYm9va1toaWRlLWVuYWJsZWRdIHNwYW4udG9jLWhlYWRlci1oaWRlIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9leWUtb2ZmLW91dGxpbmUuc3ZnKTsKCX0KPC9zdHlsZT4KCjxzdHlsZT4KCXNwYW4udG9jLWhpZGUtY29udGFpbmVyIHsKCQktLXdpZHRoOiBtaW4oODB2dywgMzAwcHgpOwoJCXBvc2l0aW9uOiBmaXhlZDsKCQlkaXNwbGF5OiBmbGV4OwoJCXJpZ2h0OiBjYWxjKHZhcigtLXdpZHRoKSArIDFyZW0gKyAyMnB4IC0gMTAwcHgpOwoJCWhlaWdodDogdmFyKC0taGVpZ2h0KTsKCQl3aWR0aDogMTAwcHg7CgkJei1pbmRleDogLTE7Cgl9CglzcGFuLnRvYy1oaWRlIHsKCQl2aXNpYmlsaXR5OiBoaWRkZW47CgkJb3BhY2l0eTogNTAlOwoJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V5ZS1vdXRsaW5lLnN2Zyk7CgkJY3Vyc29yOiBwb2ludGVyOwoJfQoJZGl2LnRvYy1yb3cuaGlkZGVuIHNwYW4udG9jLWhpZGUgewoJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V5ZS1vZmYtb3V0bGluZS5zdmcpOwoJfQoJc3Bhbi50b2MtaGlkZS1jb250YWluZXI6aG92ZXIgPiAudG9jLWhpZGUsCglkaXYudG9jLXJvdzpob3ZlciAudG9jLWhpZGUgewoJCXZpc2liaWxpdHk6IHZpc2libGU7Cgl9CglkaXYudG9jLXJvdyBhIHsKCQlkaXNwbGF5OiBmbGV4OwoJfQoJc3Bhbi50b2MtaWNvbiB7CgkJLS1zaXplOiAxN3B4OwoJCWRpc3BsYXk6IGJsb2NrOwoJCWFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQl3aWR0aDogdmFyKC0tc2l6ZSk7CgkJZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCX0KCXNwYW4udG9jLWNvbGxhcHNlIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQltYXJnaW4tcmlnaHQ6IDNweDsKCQltaW4td2lkdGg6IHZhcigtLXNpemUpOwoJfQoJLnBsdXRvdWktdG9jIHNlY3Rpb24gZGl2LnRvYy1yb3cuY29sbGFwc2VkIHNwYW4udG9jLWNvbGxhcHNlIHsKCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCX0KCS5wbHV0b3VpLXRvYyBzZWN0aW9uIGRpdi50b2Mtcm93IGEgc3Bhbi50b2MtY29sbGFwc2Uubm8tY2hpbGRyZW4gewoJCWJhY2tncm91bmQtaW1hZ2U6IG5vbmU7Cgl9CglkaXYudG9jLXJvdy5wYXJlbnQtaGlkZGVuIHsKCQl0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZSBkb3R0ZWQgLjVweDsKCQl0ZXh0LXVuZGVybGluZS1vZmZzZXQ6IDJweDsKCX0KCWRpdi50b2Mtcm93LmhpZGRlbiB7CgkJdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmUgZGFzaGVkIDFweDsKCQl0ZXh0LXVuZGVybGluZS1vZmZzZXQ6IDJweDsKCX0KCS5wbHV0b3VpLXRvYyBkaXYucGFyZW50LWNvbGxhcHNlZCB7CgkJZGlzcGxheTogbm9uZTsKCX0KCXBsdXRvLW5vdGVib29rW2hpZGUtZW5hYmxlZF0gZGl2LnRvYy1yb3cuaGlkZGVuLAoJcGx1dG8tbm90ZWJvb2tbaGlkZS1lbmFibGVkXSBkaXYudG9jLXJvdy5wYXJlbnQtaGlkZGVuIHsKCQlkaXNwbGF5OiBub25lOwoJfQoJLmRyYWdfZW5hYmxlZCAudG9jLXJvdy5kcmFnZ2VkIHsKCQlib3JkZXI6IDJweCBkYXNoZWQgZ3JleTsKCX0KPC9zdHlsZT4KCjxzdHlsZT4KCWRpdi50b2Mtcm93LXNlcGFyYXRvciB7CgkJaGVpZ2h0OiAycHg7CgkJbWFyZ2luOiAzcHggMHB4OwoJCWJhY2tncm91bmQ6ICNhYWE7CgkJZGlzcGxheTogbm9uZTsKCX0KCWRpdi50b2Mtcm93LXNlcGFyYXRvci5hY3RpdmUgewoJCWRpc3BsYXk6IGJsb2NrOwoJfQoJZGl2LnRvYy1yb3ctc2VwYXJhdG9yLmFjdGl2ZS5ub3Nob3cgewoJCWRpc3BsYXk6IG5vbmU7Cgl9Cjwvc3R5bGU+Cgo8c3R5bGU+CgkvKiBUaGlzIHN0eWxlIHBlcm1pdHMgdG8gaGF2ZSBhIGNlbGwgd2hvc2Ugb3V0cHV0IGlzIHN0aWxsIGJlaW5nIHNob3duIHdoZW4KCSAgIHRoZSBjZWxsIGlzIGhpZGRlbi4gVGhpcyBpcyB1c2VmdWwgZm9yIGhhdmluZyBoaWRkZW4gY2VsbHMgdGhhdCBzdGlsbCBhcmUKCSAgIHNlbmRpbmcgSFRNTCBhcyBvdXRwdXQgKGxpa2UgVG9DIGFuZCBCb25kVGFibGUpICovCgkKCXBsdXRvLW5vdGVib29rW2hpZGUtZW5hYmxlZF0gcGx1dG8tY2VsbFthbHdheXMtc2hvdy1vdXRwdXRdIHsKCQlkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OwoJfQoJcGx1dG8tbm90ZWJvb2tbaGlkZS1lbmFibGVkXSBwbHV0by1jZWxsW2Fsd2F5cy1zaG93LW91dHB1dF06bm90KC5jb2RlX2RpZmZlcnMpID4gcGx1dG8taW5wdXQsCglwbHV0by1ub3RlYm9va1toaWRlLWVuYWJsZWRdIHBsdXRvLWNlbGxbYWx3YXlzLXNob3ctb3V0cHV0XTpub3QoLmNvZGVfZGlmZmVycykgPiBwbHV0by1zaG91bGRlciwKCXBsdXRvLW5vdGVib29rW2hpZGUtZW5hYmxlZF0gcGx1dG8tY2VsbFthbHdheXMtc2hvdy1vdXRwdXRdOm5vdCguY29kZV9kaWZmZXJzKSA+IHBsdXRvLXRyYWZmaWNsaWdodCwKCXBsdXRvLW5vdGVib29rW2hpZGUtZW5hYmxlZF0gcGx1dG8tY2VsbFthbHdheXMtc2hvdy1vdXRwdXRdOm5vdCguY29kZV9kaWZmZXJzKSA+IHBsdXRvLXJ1bmFyZWEsCglwbHV0by1ub3RlYm9va1toaWRlLWVuYWJsZWRdIHBsdXRvLWNlbGxbYWx3YXlzLXNob3ctb3V0cHV0XTpub3QoLmNvZGVfZGlmZmVycykgPiBidXR0b24gewoJCWRpc3BsYXk6IG5vbmU7Cgl9CglwbHV0by1ub3RlYm9va1toaWRlLWVuYWJsZWRdIHBsdXRvLWNlbGxbYWx3YXlzLXNob3ctb3V0cHV0XTpub3QoLmNvZGVfZGlmZmVycykgewoJCW1hcmdpbi10b3A6IDBweDsKCX0KPC9zdHlsZT4KCqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVNERcnrBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkNzA3MTc1YTktZDM1Ni00M2NmLTgwMzgtNjIwZWJjNDAxYzkzuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOJxgEbrVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDA4ZDcxMWMwLWUyY2MtNDQ0NC05NGNhLTBjNGMzY2ZlOTAxZoqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHmDqGVsZW1lbnRzk5KhYZKhMap0ZXh0L3BsYWlukqFikqExqnRleHQvcGxhaW6SoWOSoTGqdGV4dC9wbGFpbqR0eXBlqk5hbWVkVHVwbGWob2JqZWN0aWSwMmE5YzE1NmNhNTVlNjdjNaRtaW1l2SFhcHBsaWNhdGlvbi92bmQucGx1dG8udHJlZStvYmplY3Sscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTexvWawcGVyc2lzdF9qc19zdGF0ZcO3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDA4ZDcxMWMwLWUyY2MtNDQ0NC05NGNhLTBjNGMzY2ZlOTAxZrlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lOrVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJGU3ZDY3NjYyLTc3YjMtNDgyYS1iMDMyLThkYjRhZmJjMDFhNoqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHmFpnByZWZpeKNBU0SoZWxlbWVudHOVkqFhkqExqnRleHQvcGxhaW6SoWKSoTaqdGV4dC9wbGFpbpKhY5KiIiKqdGV4dC9wbGFpbpKhZJKiIiKqdGV4dC9wbGFpbpKhZZKiMjCqdGV4dC9wbGFpbqR0eXBlpnN0cnVjdKxwcmVmaXhfc2hvcnSjQVNEqG9iamVjdGlksDQwNGFhMWJlNmYwMzFkOGakbWltZdkhYXBwbGljYXRpb24vdm5kLnBsdXRvLnRyZWUrb2JqZWN0rHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU3sXZTsHBlcnNpc3RfanNfc3RhdGXDt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SRlN2Q2NzY2Mi03N2IzLTQ4MmEtYjAzMi04ZGI0YWZiYzAxYTa5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZTe1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ5NDlhYzFlZi1jNTAyLTRlMjgtODFmZi1mOTliMGQxOWFhMDOKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R5oKRtaW1lqnRleHQvcGxhaW6scm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTJutLewcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDk0OWFjMWVmLWM1MDItNGUyOC04MWZmLWY5OWIwZDE5YWEwM7lkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgrm9b61cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ5ZDIzMzgyYy1jZjM1LTRiMjAtYTQ2Yy0wZjRlMmRlMTdmYzeKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52TA8ZGl2IGNsYXNzPSJtYXJrZG93biI+PGgxPkBCb25kc0xpc3Q8L2gxPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTbOWwOwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDlkMjMzODJjLWNmMzUtNGIyMC1hNDZjLTBmNGUyZGUxN2ZjN7lkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAD0dG1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SRlMmI3OWE1OC1lNjZlLTRkNDAtODY3My00MTg4MjM3NTNiMziKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R5g6hlbGVtZW50c5OSoWGSoTGqdGV4dC9wbGFpbpKhYpKhMap0ZXh0L3BsYWlukqFjkqExqnRleHQvcGxhaW6kdHlwZapOYW1lZFR1cGxlqG9iamVjdGlksDJhOWMxNTZjYTU1ZTY3YzWkbWltZdkhYXBwbGljYXRpb24vdm5kLnBsdXRvLnRyZWUrb2JqZWN0rHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU3sQRssHBlcnNpc3RfanNfc3RhdGXDt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SRlMmI3OWE1OC1lNjZlLTRkNDAtODY3My00MTg4MjM3NTNiMzi5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZTO1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ5NTlhY2I0MC0xZmQ2LTQzZjUtYTFhNi03M2E2Y2VhYWUxZDeKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52gQdPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPkluIHNvbWUgY2FzZXMsIG9uZSBkb2VzIG5vdCB3YW50IHRvIGhhdmUgYSBzaW5nbGUgYm9uZCB3cmFwcGluZyBlaXRoZXIgYSBTdHJ1Y3R1cmUgb3IgYSBOYW1lZFR1cGxlIGJlY2F1c2Ugc2luZ2xlIGluZGVwZW5kZW50IGJvbmRzIGFyZSBtb3JlIGNvbnZlbmllbnQuPC9wPgo8cD48Y29kZT5AQm9uZHNMaXN0PC9jb2RlPiBpcyBhIGNvbnZlbmllbmNlIG1hY3JvIHRvIGNyZWF0ZSBhbiBvYmplY3Qgb2YgdHlwZSA8Y29kZT5Cb25kc0xpc3Q8L2NvZGU+IHdoaWNoIHNpbXBseSBhbGxvdyB0byBhZGQgYSBkZXNjcmlwdGlvbiB0byBzZXBhcmF0ZSBib25kcyBhbmQgZ3JvdXAgdGhlbSBhbGwgdG9nZXRoZXIgaW4gYSB0YWJsZS1saWtlIGZvcm1hdCBlcXVpdmFsZW50IHRvIHRob3NlIG9mIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+LjwvcD4KPGRpdiBjbGFzcz0iYWRtb25pdGlvbiBub3RlIj48cCBjbGFzcz0iYWRtb25pdGlvbi10aXRsZSI+Tm90ZTwvcD48cD5Vbmxpa2UgPGNvZGU+U3RydWN0Qm9uZDwvY29kZT4sIGEgQm9uZHNMaXN0IGlzIGFscmVhZHkgY29tcG9zZWQgb2YgYm9uZCBjcmVhdGVkIHdpdGggPGNvZGU+QGJpbmQ8L2NvZGU+IGFuZCBpdCBqdXN0IGdyb3VwcyB0aGVtIHVwIHdpdGggYSBkZXNjcmlwdGlvbi4gVGhlIG91dHB1dCBvZiA8Y29kZT5AQm9uZHNMaXN0PC9jb2RlPiBpcyBub3Qgc3VwcG9zZWQgdG8gYmUgYm91bmQgdG8gYSB2YXJpYWJsZSB1c2luZyA8Y29kZT5AYmluZDwvY29kZT4uPGJyIC8+VGhlIGJvbmRzIGdyb3VwZWQgaW4gYSBCb25kc0xpc3Qgc3RpbGwgYWN0IGFuZCB1cGRhdGUgaW5kZXBlbmRlbnRseSBmcm9tIG9uZSBhbm90aGVyLjwvcD4KPC9kaXY+CjxwPlNlZSB0aGUgZXhhbXBsZSBiZWxvdyBmb3IgdW5kZXJzdGFuZGluZyB0aGUgc3ludGhheC4gVGhlIGhlYWRlciBvZiBhIEJvbmRzTGlzdCBpcyBzaG93biBpbiBhbiBvcmFuZ2UgYmFja2dyb3VuZCB0byBlYXNpbHkgZGlmZmVyZW50aWF0ZSBpdCBmcm9tIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+LjwvcD4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU204rbsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ5NTlhY2I0MC0xZmQ2LTQzZjUtYTFhNi03M2E2Y2VhYWUxZDe5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AtRATtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkMjA3M2YxMWUtODE5Ni00ZWJjLTkyMmYtNWZhNTg5ZTkxNzk3iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedoBgzxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5UaGUgYWJpbGl0eSB0byBhbHNvIHdyYXAgcHJlLWV4aXN0aW5nIGJvbmRzIGFyb3VuZCBTdHJ1Y3RCb25kcyBpcyBjb252ZW5pZW50IGZvciBvcmdhbml6aW5nIHRoZSB2YXJpb3VzIGJvbmRzIG9uZSBoYXZlIGluIGEgPGNvZGU+Qm9uZHNMaXN0PC9jb2RlPiBvciA8Y29kZT5Cb25kVGFibGU8L2NvZGU+PC9wPgo8cD5BcyBhbiBleGFtcGxlLCBvbmUgY2FuIGNyZWF0ZSBhIDxjb2RlPkJvbmRzTGlzdDwvY29kZT4gY29udGFpbmluZyB0aGUgdHdvIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+IGJvbmRzIGdlbmVyYXRlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoaXMgbm90ZWJvb2sgd2l0aCB0aGUgZm9sbHdpbmcgY29kZS48L3A+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVNw+J17BwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkMjA3M2YxMWUtODE5Ni00ZWJjLTkyMmYtNWZhNTg5ZTkxNzk3uWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAAW2OrVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDcwNWUzMGZlLTc3YTMtNGIwNi04Yjk5LTE4MDcyOTBlZGZmYoqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHmjMTUwpG1pbWWqdGV4dC9wbGFpbqxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVN7FOurBwZXJzaXN0X2pzX3N0YXRlw7doYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkNzA1ZTMwZmUtNzdhMy00YjA2LThiOTktMTgwNzI5MGVkZmZiuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWUutXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkMGRiNTFkMzktN2MwNS00ZTAwLWI5NTEtN2ZlNzc2YThlMGY5iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedpKADxib25kIGRlZj0ibnQiIHVuaXF1ZV9pZD0iSlhISS8xZ1BLN0lZIj48c3RydWN0LWJvbmQgY2xhc3M9J05hbWVkVHVwbGV7KFN5bWJvbCgmcXVvdDsjIzIzNSZxdW90OyksIDphLCA6YiwgOmMpfSc+Cgk8dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGNsYXNzPScnPgoJPHRvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nPk5hbWVkVHVwbGU8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSd2c3RrZG9iZmZyJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdtc2NwZ2RqY2x3JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+RGVzY3JpcHRpb248L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYWl0amxub2llYScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdhaXRqbG5vaWVhJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYWl0amxub2llYSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbXNjcGdkamNsdycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYic+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYicgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYmAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD48c3Ryb25nPkJvbGQ8L3N0cm9uZz4gZmllbGQ8L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdua2d6Zm9wZWFiJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J25rZ3pmb3BlYWInPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJua2d6Zm9wZWFiIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdtc2NwZ2RqY2x3JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdjJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdjJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBjYCI+YzwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdjJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdwc2lyZnlsdm5yJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3BzaXJmeWx2bnInPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJwc2lyZnlsdm5yIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0nbXNjcGdkamNsdyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gIm1zY3BnZGpjbHciCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIE5hbWVkVHVwbGUiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCQkJZmxleDogMTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ndnN0a2RvYmZmcic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInZzdGtkb2JmZnIiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J3B0enR4a3F4a2wnPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgogICAgICAgIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewogICAgY3Vyc29yOiBwb2ludGVyOwogICAgLS1zaXplOiAxNXB4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIGJhY2tncm91bmQ6ICNjNmM2YzY7CiAgICBvdXRsaW5lOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgbWFyZ2luOiAwIDEwcHg7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKICAgIGJhY2tncm91bmQ6ICM0QkQ4NjU7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewogICAgY29udGVudDogJyc7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgdG9wOiAwcHg7CiAgICBsZWZ0OiAwcHg7CiAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgdHJhbnNpdGlvbjogLjFzOwp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewogICAgbGVmdDogdmFyKC0tc2l6ZSkKfQkJCgk8L3N0eWxlPgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSd5aGRnbXNhcmJ1Jz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiTXkgRmFuY3kgTlR1cGxlIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZadudF9ib25ksmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVNh36yrBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkMGRiNTFkMzktN2MwNS00ZTAwLWI5NTEtN2ZlNzc2YThlMGY5uWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOFJU2e7VwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJGNiZmM2ZWVjLTg5OTEtNGE5Yy1hZGEwLTI5NWM4MDUyODU0ZIqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHmgpG1pbWWqdGV4dC9wbGFpbqxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVNEZQTLBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkY2JmYzZlZWMtODk5MS00YTljLWFkYTAtMjk1YzgwNTI4NTRkuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXNKsG1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ0ZDYxMTQyNS1jOGUzLTRiYzMtOTEyYi04YmMwNDY1MzYzYmOKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52iLXPGJvbmRzbGlzdC1jb250YWluZXIgY2xhc3M9J25vLXBvcG91dCc+Cgk8Ym9uZHNsaXN0LWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nY29sbGFwc2UgYm9uZHNsaXN0LWljb24nPjwvc3Bhbj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nIHRpdGxlPSJUaGlzIGxpc3QgY29udGFpbnMgaW5kZXBlbmRlbnQgYm9uZHMiPk15IEdyb3VwIG9mIEJvbmRzPC9zcGFuPgoJCTxzcGFuIGNsYXNzPSd0b2dnbGUgYm9uZHNsaXN0LWljb24nPjwvc3Bhbj4KCTwvYm9uZHNsaXN0LWhlYWRlcj4KCTxib25kc2xpc3QtY29udGVudHM+Cgk8Ym9uZC13aXRoLWRlc2NyaXB0aW9uPgoJPGJvbmQtZGVzY3JpcHRpb24gdGl0bGU9J1RoaXMgYm9uZCBpcyBhc3NpZ25lZCB0byB2YXJpYWJsZSBgZnJlcWAnPgoJCUZyZXF1ZW5jeSBbR0h6XQoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPGJvbmQgZGVmPSJmcmVxIiB1bmlxdWVfaWQ9IjlCdU1pNml0RTNqYiI+CjxzY3JpcHQ+Cgljb25zdCBkM2Zvcm1hdCA9IGF3YWl0IGltcG9ydCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9kMy1mb3JtYXRAMi8rZXNtIikKCgljb25zdCBlbHAgPSBodG1sYAoJPHNwYW4gY2xhc3M9Im51bWJlcl9FZGl0YWJsZSIgc3R5bGU9IgoJdG91Y2gtYWN0aW9uOiBub25lOwoJcGFkZGluZzogMGVtIC4yZW07Cglib3JkZXItcmFkaXVzOiAuM2VtOwoJZm9udC13ZWlnaHQ6IGJvbGQ7Ij48c3BhbiBjb250ZW50RWRpdGFibGU9dHJ1ZT4yMDwvc3Bhbj4gR0h6PC9zcGFuPgoJYAoKCWNvbnN0IGZvcm1hdHRlciA9IHMgPT4gZDNmb3JtYXQuZm9ybWF0KCIiKShzKQoJY29uc3QgZWwgPSBlbHAucXVlcnlTZWxlY3Rvcigic3BhbiIpCgoJbGV0IGxvY2FsVmFsID0gcGFyc2VGbG9hdCgyMCkKCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcigyMCkKCQoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGVscCwidmFsdWUiLHsKCQlnZXQ6ICgpID0+IGxvY2FsVmFsLAoJCXNldDogeCA9PiB7CgkJCWxvY2FsVmFsID0gcGFyc2VGbG9hdCh4KQoJCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoeCkKCQl9Cgl9KQoKCWNvbnN0IGRpc3BhdGNoRXZlbnQgPSAoZSkgPT4gewoJCWlmIChlbC5pbm5lclRleHQgPT09ICIiKSB7CgkJCWVscC52YWx1ZSA9IDIwICAgCgkJfSBlbHNlIHsKCQkJLyogCgkJCVRoZSByZXBsYWNlIGlzIG5lZWRlZCBiZWNhdXNlIGQzLWZvcm1hdCBvdXRwdXRzICctJyBhcyBpbiBVKzIyMTIgKG1hdGggc3ltYm9sKSBidXQgZmFpbHMgdG8gcGFyc2UgbmVnYXRpdmUgbnVtYmVyIGNvcnJlY3RseSBpZiB0aGV5IGhhdmUgdGhhdCBzaWduIGFzIG5lZ2F0aXZlIHNpZ24uIFNvIHdlIGp1c3QgcmVwbGFjZSBpdCB3aXRoIHRoZSBkYXNoIFUrMDAyRCBzaWduIAoJCQkqLwoJCQllbHAudmFsdWUgPSAgZWwuaW5uZXJUZXh0LnJlcGxhY2UoJ+KIkicsICctJykKCQl9CgkJZWxwLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQoJfQoKCS8vIEZ1bmN0aW9uIHRvIGJsdXIgdGhlIGVsZW1lbnQgd2hlbiBwcmVzc2luZyBlbnRlciBpbnN0ZWFkIG9mIGFkZGluZyBhIG5ld2xpbmUKCWNvbnN0IG9uRW50ZXIgPSAoZSkgPT4gewoJCWlmIChlLmtleUNvZGUgPT09IDEzKSB7CgkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCWVsLmJsdXIoKQoJCX0KCX0KCgllbC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsKGUpID0+IHsKCQljb25zb2xlLmxvZyhlKQoJCWUucHJldmVudERlZmF1bHQoKQoJCWUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkKCX0pCgoJZnVuY3Rpb24gc2VsZWN0VGV4dChlbCl7CgkJdmFyIHNlbCwgcmFuZ2U7CgkJaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24gJiYgZG9jdW1lbnQuY3JlYXRlUmFuZ2UpIHsgLy9Ccm93c2VyIGNvbXBhdGliaWxpdHkKCQlzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7CgkJaWYoc2VsLnRvU3RyaW5nKCkgPT0gJycpeyAvL25vIHRleHQgc2VsZWN0aW9uCgkJCXdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CgkJCQlyYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7IC8vcmFuZ2Ugb2JqZWN0CgkJCQlyYW5nZS5zZWxlY3ROb2RlQ29udGVudHMoZWwpOyAvL3NldHMgUmFuZ2UKCQkJCXNlbC5yZW1vdmVBbGxSYW5nZXMoKTsgLy9yZW1vdmUgYWxsIHJhbmdlcyBmcm9tIHNlbGVjdGlvbgoJCQkJc2VsLmFkZFJhbmdlKHJhbmdlKTsvL2FkZCBSYW5nZSB0byBhIFNlbGVjdGlvbi4KCQkJfSwxKTsKCQl9CgkJfWVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikgeyAvL29sZGVyIGllCgkJCXNlbCA9IGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpOwoJCQlpZihzZWwudGV4dCA9PSAnJyl7IC8vbm8gdGV4dCBzZWxlY3Rpb24KCQkJCXJhbmdlID0gZG9jdW1lbnQuYm9keS5jcmVhdGVUZXh0UmFuZ2UoKTsvL0NyZWF0ZXMgVGV4dFJhbmdlIG9iamVjdAoJCQkJcmFuZ2UubW92ZVRvRWxlbWVudFRleHQoZWwpOy8vc2V0cyBSYW5nZQoJCQkJcmFuZ2Uuc2VsZWN0KCk7IC8vbWFrZSBzZWxlY3Rpb24uCgkJCX0KCQl9Cgl9CgoJCgllbC5hZGRFdmVudExpc3RlbmVyKCdmb2N1c291dCcsZGlzcGF0Y2hFdmVudCkKCWVsLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLG9uRW50ZXIpCgllbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsKGUpID0+IGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkpIC8vIG1vZGlmeSB0ZXh0CgllbHAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKSA9PiBzZWxlY3RUZXh0KGVsKSkgLy8gU2VsZWN0IGFsbCB0ZXh0CgoJcmV0dXJuIGVscAoKPC9zY3JpcHQ+CjxzdHlsZT4KCUBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGxpZ2h0KSB7CgkJc3Bhbi5udW1iZXJfRWRpdGFibGUgewoJCQliYWNrZ3JvdW5kOiBoc2woMjA0LCA5NSUsIDg0JSk7CgkJfQoJfQoJQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewoJCXNwYW4ubnVtYmVyX0VkaXRhYmxlIHsKCQkJYmFja2dyb3VuZDogaHNsKDIwNCwgOTUlLCA0MCUpOwoJCX0KCX0KPC9zdHlsZT4KPC9ib25kPgoJPC9ib25kLXZhbHVlPgoJPHN0eWxlPgoJCWJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CiAgZGlzcGxheTogZ3JpZDsKICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAwLjRmcik7CiAgZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwogIGp1c3RpZnktaXRlbXM6IGNlbnRlcjsKfQpib25kdGFibGUtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uLApib25kc2xpc3QtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKICBkaXNwbGF5OiBjb250ZW50czsKfQpib25kLXZhbHVlIGJvbmQgewogIGRpc3BsYXk6IGZsZXg7IC8qIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQgKi8KfQpib25kLXZhbHVlIGlucHV0IHsKICB3aWR0aDogMTAwJTsgLyogTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dCAqLwp9CgoJPC9zdHlsZT4KPC9ib25kLXdpdGgtZGVzY3JpcHRpb24+Cjxib25kLXdpdGgtZGVzY3JpcHRpb24+Cgk8Ym9uZC1kZXNjcmlwdGlvbiB0aXRsZT0nVGhpcyBib25kIGlzIGFzc2lnbmVkIHRvIHZhcmlhYmxlIGBhbHRgJz4KCQk8ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+QWx0aXR1ZGUgPHNwYW4gY2xhc3M9InRleCI+JGgkPC9zcGFuPiAmIzkxO20mIzkzOzwvcD4KPC9kaXY+Cgk8L2JvbmQtZGVzY3JpcHRpb24+Cgk8Ym9uZC12YWx1ZT4KCQk8Ym9uZCBkZWY9ImFsdCIgdW5pcXVlX2lkPSIzRTdJdEt1LzFOJiM0Mzt6Ij48c2NyaXB0PgovLyB3ZWlyZCBpbXBvcnQgdG8gbWFrZSBpdCBmYXN0ZXIuIFRoZSBgYXdhaXQgaW1wb3J0YCBjYW4gc3RpbGwgZGVsYXkgZXhlY3V0aW9uIGJ5IG9uZSBmcmFtZSBpZiBpdCBpcyBhbHJlYWR5IGxvYWRlZC4uLgp3aW5kb3cuZDNmb3JtYXQgPSB3aW5kb3cuZDNmb3JtYXQgPz8gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKY29uc3QgYXJnbWluID0geHMgPT4geHMuaW5kZXhPZihNYXRoLm1pbiguLi54cykpCmNvbnN0IGNsb3Nlc3RfaW5kZXggPSAoeHMsIHkpID0+IGFyZ21pbih4cy5tYXAoeCA9PiBNYXRoLmFicyh4LXkpKSkKCmNvbnN0IHZhbHVlcyA9IFsxMDAsIDExMCwgMTIwLCAxMzAsIDE0MCwgMTUwLCAxNjAsIDE3MCwgMTgwLCAxOTAsIDIwMF0KCmNvbnN0IGVsID0gaHRtbGAKPHNwYW4gdGl0bGU9IkNsaWNrIGFuZCBkcmFnIHRoaXMgbnVtYmVyIGxlZnQgb3IgcmlnaHQhIiBzdHlsZT0iY3Vyc29yOiBjb2wtcmVzaXplOwp0b3VjaC1hY3Rpb246IG5vbmU7CmJhY2tncm91bmQ6IHJnYigyNTIsIDIwOSwgMjA0KTsKY29sb3I6IGJsYWNrOwpwYWRkaW5nOiAwZW0gLjJlbTsKYm9yZGVyLXJhZGl1czogLjNlbTsKZm9udC13ZWlnaHQ6IGJvbGQ7Ij4xNTA8L3NwYW4+CmAKCgoKbGV0IG9sZF94ID0gMApsZXQgb2xkX2luZGV4ID0gMApjb25zdCBpbml0aWFsX2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIDE1MCkKbGV0IGN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4Cgpjb25zdCBmb3JtYXR0ZXIgPSBzID0+ICIiICsgZDNmb3JtYXQuZm9ybWF0KCIiKShzKSArICIiCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGVsLCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlc1tjdXJyZW50X2luZGV4XSwKCXNldDogeCA9PiB7CgkJY3VycmVudF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCB4KQoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCX0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKLy8gaW5pdGlhbCB2YWx1ZQplbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoMTUwKQoKY29uc3Qgb25TY3J1YiA9IChlKSA9PiB7Cgljb25zdCBvZmZzZXQgPSBlLmNsaWVudFggLSBvbGRfeAoJY29uc3QgbmV3X2luZGV4ID0gTWF0aC5taW4odmFsdWVzLmxlbmd0aC0xLCBNYXRoLm1heCgwLCAKCQlNYXRoLnJvdW5kKG9mZnNldC8xMCkgKyBvbGRfaW5kZXgKCSkpCgoJaWYobmV3X2luZGV4ICE9PSBjdXJyZW50X2luZGV4KSB7CgkJY3VycmVudF9pbmRleCA9IG5ld19pbmRleAoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCX0KfQoKY29uc3Qgb25wb2ludGVyZG93biA9IChlKSA9PiB7Cgl3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKQoJb2xkX3ggPSBlLmNsaWVudFgKCW9sZF9pbmRleCA9IGN1cnJlbnRfaW5kZXgKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoKY29uc3Qgb25kYmxjbGljayA9IChlKSA9PiB7CgljdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoKY29uc3Qgb25wb2ludGVydXAgPSAoKSA9PiB7Cgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKCmVsLm9uc2VsZWN0c3RhcnQgPSAoKSA9PiBmYWxzZQoKaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQp9KQoKcmV0dXJuIGVsCgo8L3NjcmlwdD48L2JvbmQ+Cgk8L2JvbmQtdmFsdWU+Cgk8c3R5bGU+CgkJYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKICBkaXNwbGF5OiBncmlkOwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIDAuNGZyKTsKICBncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CiAganVzdGlmeS1pdGVtczogY2VudGVyOwp9CmJvbmR0YWJsZS1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24sCmJvbmRzbGlzdC1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24gewogIGRpc3BsYXk6IGNvbnRlbnRzOwp9CmJvbmQtdmFsdWUgYm9uZCB7CiAgZGlzcGxheTogZmxleDsgLyogTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dCAqLwp9CmJvbmQtdmFsdWUgaW5wdXQgewogIHdpZHRoOiAxMDAlOyAvKiBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0ICovCn0KCgk8L3N0eWxlPgo8L2JvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCQoJPC9ib25kc2xpc3QtY29udGVudHM+Cgk8c2NyaXB0IGlkPSd5ZWd5cGRzZ2lmJz4KCQljb25zdCBjb250YWluZXIgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb250YWluZXIuY29sbGFwc2UgPSAoZm9yY2UpID0+IHsKCQkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcsIGZvcmNlKQoJCX0KCQljb25zdCBjb2xsYXBzZV9idG4gPSBjb250YWluZXIucXVlcnlTZWxlY3Rvcignc3Bhbi5jb2xsYXBzZScpCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gY29udGFpbmVyLmNvbGxhcHNlKCkKCTwvc2NyaXB0PgoJPHN0eWxlPgoJYm9uZHNsaXN0LWhlYWRlciB7CiAgZ3JpZC1jb2x1bW46IDEgLyAtMTsKICBkaXNwbGF5OiBmbGV4OwogIGJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKfQpib25kc2xpc3QtaGVhZGVyOmJlZm9yZSB7CiAgY29udGVudDogIiI7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDFweDsKICBib3R0b206IDBweDsKICBsZWZ0OiAwcHg7CiAgcmlnaHQ6IDBweDsKICB6LWluZGV4OiAtMTsKICBiYWNrZ3JvdW5kOiAjZmZhYzQ1NDA7Cn0KYm9uZHNsaXN0LWNvbnRhaW5lci5uby1wb3BvdXQgPiBib25kc2xpc3QtaGVhZGVyIHsKICBhbGlnbi1zZWxmOiBzdGFydDsKICBwb3NpdGlvbjogc3RpY2t5OwogIHRvcDogMHB4OwogIHBhZGRpbmctdG9wOiAxMnB4OwogIG1hcmdpbi10b3A6IC0xMnB4OwogIHotaW5kZXg6IDEwOwp9CmJvbmRzbGlzdC1jb250ZW50cyB7CiAgZGlzcGxheTogY29udGVudHM7Cn0KYm9uZHNsaXN0LWNvbnRhaW5lci5uby1wb3BvdXQ6YmVmb3JlIHsKICBjb250ZW50OiAiIjsKICBkaXNwbGF5OiBibG9jazsKICBncmlkLWNvbHVtbjogMSAvIC0xOwogIGp1c3RpZnktc2VsZjogY2VudGVyOwogIGJvcmRlci1ib3R0b206IDJweCBzb2xpZDsKICBwYWRkaW5nLXRvcDogNXB4OwogIHdpZHRoOiAxMDAlOwogIGFsaWduLXNlbGY6IHN0YXJ0OwogIHBvc2l0aW9uOiBzdGlja3k7CiAgdG9wOiAwcHg7CiAgYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwogIHotaW5kZXg6IDIwOwp9CmJvbmRzbGlzdC1oZWFkZXIgPiAuYm9uZHNsaXN0LWljb24gewogIC0tc2l6ZTogMTdweDsKICBkaXNwbGF5OiBibG9jazsKICBhbGlnbi1zZWxmOiBzdHJldGNoOwogIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CiAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CiAgd2lkdGg6IHZhcigtLXNpemUpOwogIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7Cn0KYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CiAgY3Vyc29yOiBwb2ludGVyOwp9CmJvbmRzbGlzdC1jb250YWluZXIuY29sbGFwc2VkID4gYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7Cn0KYm9uZHNsaXN0LWhlYWRlciA+IC50b2dnbGUgewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICB3aWR0aDogMzBweDsKICBtYXJnaW46IDAgMTBweDsKfQpib25kc2xpc3QtaGVhZGVyIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBzdHJldGNoOwogIHdpZHRoOiAxMDAlOwp9CmJvbmRzbGlzdC1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewogIHRleHQtYWxpZ246IGNlbnRlcjsKICBmbGV4LWdyb3c6IDE7CiAgZm9udC1zaXplOiAxOHB4OwogIGZvbnQtd2VpZ2h0OiA2MDA7Cn0KYm9uZHNsaXN0LWhlYWRlciA+IC50b2dnbGUgewogIGFsaWduLXNlbGY6IGNlbnRlcjsKfQpib25kc2xpc3QtY29udGFpbmVyLmNvbGxhcHNlZCBib25kc2xpc3QtaGVhZGVyICsgKiB7CiAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50Owp9CmJvbmRzbGlzdC1jb250YWluZXIgewogIGRpc3BsYXk6IGdyaWQ7CiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgMC40ZnIpOwogIGdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKICBqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICByb3ctZ2FwOiA1cHg7Cn0KYm9uZHN0YWJsZS1jb250YWluZXIgYm9uZHNsaXN0LWNvbnRhaW5lciB7CiAgZGlzcGxheTogY29udGVudHM7Cn0KCQkKCTwvc3R5bGU+CjwvYm9uZHNsaXN0LWNvbnRhaW5lcj4KpG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZaJibLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTbxJEawcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDRkNjExNDI1LWM4ZTMtNGJjMy05MTJiLThiYzA0NjUzNjNiY7lkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgnKQr61cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SRiZTJhNzgyMC1lMTk0LTQ0MTAtYjAwZC1hOTMzMmIyMzRhZDaKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R5ozE1MKRtaW1lqnRleHQvcGxhaW6scm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTeyHoqwcGVyc2lzdF9qc19zdGF0ZcO3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJGJlMmE3ODIwLWUxOTQtNDQxMC1iMDBkLWE5MzMyYjIzNGFkNrlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lNbVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDQ2Njk5NWEyLWRmZDQtNDM3NC04MzM5LWJjMDIzMjAzOWIyN4qmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnZNzxkaXYgY2xhc3M9Im1hcmtkb3duIj48aDI+dHJhbnNmb3JtZWRfdmFsdWU8L2gyPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTYyucewcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDQ2Njk5NWEyLWRmZDQtNDM3NC04MzM5LWJjMDIzMjAzOWIyN7lkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAEFFG1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ3ODUzY2M3Zi00ZTU4LTQ0ZDEtOGQzYi1mOGQ0NzQ1NTY0ZTaKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R5sjEuMDMwMzc2ODI2NTI0MzEyNaRtaW1lqnRleHQvcGxhaW6scm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTbNxz+wcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDc4NTNjYzdmLTRlNTgtNDRkMS04ZDNiLWY4ZDQ3NDU1NjRlNrlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzSYUtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkY2RjMGE3YWQtYTNhYy00MjcwLWI3MDctMzViMTkzOWRhMjc2iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9keYWmcHJlZml4o0FTRKhlbGVtZW50c5WSoWGSoTGqdGV4dC9wbGFpbpKhYpKhNqp0ZXh0L3BsYWlukqFjkqIiIqp0ZXh0L3BsYWlukqFkkqIiIqp0ZXh0L3BsYWlukqFlkqIyMKp0ZXh0L3BsYWlupHR5cGWmc3RydWN0rHByZWZpeF9zaG9ydKNBU0Sob2JqZWN0aWSwNDA0YWExYmU2ZjAzMWQ4ZqRtaW1l2SFhcHBsaWNhdGlvbi92bmQucGx1dG8udHJlZStvYmplY3Sscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTew3GqwcGVyc2lzdF9qc19zdGF0ZcO3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJGNkYzBhN2FkLWEzYWMtNDI3MC1iNzA3LTM1YjE5MzlkYTI3NrlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lOrVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDc4NTU4MjZlLWNjYWEtNGMyNy1hMDYwLWY1Y2ViOTI3YmJlOIqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnaPfM8Ym9uZCBkZWY9InRyYW5zZm9ybWVkX3ZhbHVlX2V4YW1wbGUiIHVuaXF1ZV9pZD0iU1hITiYjNDM7LzVqaTVobCI+PHN0cnVjdC1ib25kIGNsYXNzPSdOYW1lZFR1cGxleyhTeW1ib2woJnF1b3Q7IyMyMzQmcXVvdDspLCA6YSwgOmIpfSc+Cgk8dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGNsYXNzPScnPgoJPHRvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nPk5hbWVkVHVwbGU8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSd1eXhmbnp3c3N2JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdyZmRtcXdkamprJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+YTwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd1eWhqYXNkc2NyJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3V5aGphc2RzY3InPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ1eWhqYXNkc2NyIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdyZmRtcXdkamprJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdiJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdiJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBiYCI+YjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdxd21weGVneHZvJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3F3bXB4ZWd4dm8nPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJxd21weGVneHZvIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0ncmZkbXF3ZGpqayc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInJmZG1xd2RqamsiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIE5hbWVkVHVwbGUiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCQkJZmxleDogMTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ndXl4Zm56d3Nzdic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInV5eGZuendzc3YiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J3JjaWJwaHZ5aHknPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgogICAgICAgIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewogICAgY3Vyc29yOiBwb2ludGVyOwogICAgLS1zaXplOiAxNXB4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIGJhY2tncm91bmQ6ICNjNmM2YzY7CiAgICBvdXRsaW5lOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgbWFyZ2luOiAwIDEwcHg7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKICAgIGJhY2tncm91bmQ6ICM0QkQ4NjU7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewogICAgY29udGVudDogJyc7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgdG9wOiAwcHg7CiAgICBsZWZ0OiAwcHg7CiAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgdHJhbnNpdGlvbjogLjFzOwp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewogICAgbGVmdDogdmFyKC0tc2l6ZSkKfQkJCgk8L3N0eWxlPgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSdnZGJuaGdtZnJiJz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiVHJhbnNmb3JtZWQhIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU2RHRUsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ3ODU1ODI2ZS1jY2FhLTRjMjctYTA2MC1mNWNlYjkyN2JiZTi5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4XH/94tXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkZjY1YjMyMzEtZjJiMi00NWRjLWI3MmUtMWFkMzEwNzA4M2ZjiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedk2PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxoMT5TdHJ1Y3RCb25kU2VsZWN0PC9oMT4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU2Rrv9sHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SRmNjViMzIzMS1mMmIyLTQ1ZGMtYjcyZS0xYWQzMTA3MDgzZmO5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4ABAI/tXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkOTAzZmVlNjctNmIyMy00MWRjLWEwM2QtZjEwNDBiNjk2YmU2iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedsAAqkzCTxib25kdGFibGUtY29udGFpbmVyIGtleT0nZmVlYmRjYWRmYicgY2xhc3M9J2NvbGxhcHNlZCc+CgkJPGJvbmR0YWJsZS1oZWFkZXI+CgkJCTxzcGFuIGNsYXNzPSd0YWJsZS1oZWxwIGljb24nPjwvc3Bhbj4KCQkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5NeSBCb25kczwvc3Bhbj4KCQkJPHNwYW4gY2xhc3M9J3RhYmxlLWNvbGxhcHNlIGljb24nPjwvc3Bhbj4KCQk8L2JvbmR0YWJsZS1oZWFkZXI+CgkJPGJvbmR0YWJsZS1jb250ZW50cz4KCQkJPGJvbmQgZGVmPSJhc2QiIHVuaXF1ZV9pZD0iU2xJYmRvNnhHL3lxIj48c3RydWN0LWJvbmQgY2xhc3M9J0FTRCc+Cgk8dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGNsYXNzPScnPgoJPHRvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nPkFTRDwvc3Bhbj4KCQk8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGNsYXNzPSd0b2dnbGUnIGNoZWNrZWQ+Cgk8L3RvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJCTxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2FheWtieGZzZHknIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J29kcGpoaGhhbngnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2EnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2EnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGFgIj48ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+TWFya2Rvd24gZGVzY3JpcHRpb24sIGluY2x1ZGluZyA8c3BhbiBjbGFzcz0idGV4Ij4kTGFUZVgkPC9zcGFuPjwvcD4KPC9kaXY+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2EnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3Zzd2llZGZmaWcnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ndnN3aWVkZmZpZyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInZzd2llZGZmaWciCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J29kcGpoaGhhbngnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2InPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2InIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGJgIj48c3Bhbj5GaWVsZCB3aXRoIDxiPkhUTUw8L2I+IGRlc2NyaXB0aW9uPC9zcGFuPjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdsd2VvanRmbG5yJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c2NyaXB0PgovLyB3ZWlyZCBpbXBvcnQgdG8gbWFrZSBpdCBmYXN0ZXIuIFRoZSBgYXdhaXQgaW1wb3J0YCBjYW4gc3RpbGwgZGVsYXkgZXhlY3V0aW9uIGJ5IG9uZSBmcmFtZSBpZiBpdCBpcyBhbHJlYWR5IGxvYWRlZC4uLgp3aW5kb3cuZDNmb3JtYXQgPSB3aW5kb3cuZDNmb3JtYXQgPz8gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKY29uc3QgYXJnbWluID0geHMgPT4geHMuaW5kZXhPZihNYXRoLm1pbiguLi54cykpCmNvbnN0IGNsb3Nlc3RfaW5kZXggPSAoeHMsIHkpID0+IGFyZ21pbih4cy5tYXAoeCA9PiBNYXRoLmFicyh4LXkpKSkKCmNvbnN0IHZhbHVlcyA9IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMF0KCmNvbnN0IGVsID0gaHRtbGAKPHNwYW4gdGl0bGU9IkNsaWNrIGFuZCBkcmFnIHRoaXMgbnVtYmVyIGxlZnQgb3IgcmlnaHQhIiBzdHlsZT0iY3Vyc29yOiBjb2wtcmVzaXplOwp0b3VjaC1hY3Rpb246IG5vbmU7CmJhY2tncm91bmQ6IHJnYigyNTIsIDIwOSwgMjA0KTsKY29sb3I6IGJsYWNrOwpwYWRkaW5nOiAwZW0gLjJlbTsKYm9yZGVyLXJhZGl1czogLjNlbTsKZm9udC13ZWlnaHQ6IGJvbGQ7Ij42PC9zcGFuPgpgCgoKCmxldCBvbGRfeCA9IDAKbGV0IG9sZF9pbmRleCA9IDAKY29uc3QgaW5pdGlhbF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCA2KQpsZXQgY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCmNvbnN0IGZvcm1hdHRlciA9IHMgPT4gIiIgKyBkM2Zvcm1hdC5mb3JtYXQoIiIpKHMpICsgIiIKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZWwsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzW2N1cnJlbnRfaW5kZXhdLAoJc2V0OiB4ID0+IHsKCQljdXJyZW50X2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIHgpCgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgovLyBpbml0aWFsIHZhbHVlCmVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcig2KQoKY29uc3Qgb25TY3J1YiA9IChlKSA9PiB7Cgljb25zdCBvZmZzZXQgPSBlLmNsaWVudFggLSBvbGRfeAoJY29uc3QgbmV3X2luZGV4ID0gTWF0aC5taW4odmFsdWVzLmxlbmd0aC0xLCBNYXRoLm1heCgwLCAKCQlNYXRoLnJvdW5kKG9mZnNldC8xMCkgKyBvbGRfaW5kZXgKCSkpCgoJaWYobmV3X2luZGV4ICE9PSBjdXJyZW50X2luZGV4KSB7CgkJY3VycmVudF9pbmRleCA9IG5ld19pbmRleAoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCX0KfQoKY29uc3Qgb25wb2ludGVyZG93biA9IChlKSA9PiB7Cgl3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKQoJb2xkX3ggPSBlLmNsaWVudFgKCW9sZF9pbmRleCA9IGN1cnJlbnRfaW5kZXgKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoKY29uc3Qgb25kYmxjbGljayA9IChlKSA9PiB7CgljdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoKY29uc3Qgb25wb2ludGVydXAgPSAoKSA9PiB7Cgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKCmVsLm9uc2VsZWN0c3RhcnQgPSAoKSA9PiBmYWxzZQoKaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQp9KQoKcmV0dXJuIGVsCgo8L3NjcmlwdD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdsd2VvanRmbG5yJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibHdlb2p0ZmxuciIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nb2RwamhoaGFueCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYyc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYycgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgY2AiPk5vcm1hbCBTdHJpbmcgRGVzY3JpcHRpb248L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndW12d2tkcGtsdicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3RleHQnIHZhbHVlPScnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3VtdndrZHBrbHYnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ1bXZ3a2Rwa2x2Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdvZHBqaGhoYW54JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdkJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdkJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBkYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPlRoaXMgZmllbGQgaXMgPGVtPnNwZWNpYWw8L2VtPjwvcD4KPC9kaXY+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2QnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2V3cWxwZnZhdHonIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSd0ZXh0JyB2YWx1ZT0nJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdld3FscGZ2YXR6Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZXdxbHBmdmF0eiIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nb2RwamhoaGFueCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nZSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nZScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgZWAiPmU8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nZSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ncmZ1dW1zdmxjcycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nNicgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3JmdXVtc3ZsY3MnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJyZnV1bXN2bGNzIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0nb2RwamhoaGFueCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gIm9kcGpoaGhhbngiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIEFTRCIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJCQlmbGV4OiAxOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdhYXlrYnhmc2R5Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYWF5a2J4ZnNkeSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0nZHp4eXhodWtwaic+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+CiAgICAgICAgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAtLXNpemU6IDE1cHg7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBhcHBlYXJhbmNlOiBub25lOwogICAgYmFja2dyb3VuZDogI2M2YzZjNjsKICAgIG91dGxpbmU6IG5vbmU7CiAgICBib3JkZXItcmFkaXVzOiBjYWxjKHZhcigtLXNpemUpLzIpOwogICAgYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICBtYXJnaW46IDAgMTBweDsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewogICAgYmFja2dyb3VuZDogIzRCRDg2NTsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CiAgICBjb250ZW50OiAnJzsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB0b3A6IDBweDsKICAgIGxlZnQ6IDBweDsKICAgIGJhY2tncm91bmQ6ICNmZmY7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CiAgICBib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICB0cmFuc2l0aW9uOiAuMXM7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CiAgICBsZWZ0OiB2YXIoLS1zaXplKQp9CQkKCTwvc3R5bGU+CjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoKCTxzY3JpcHQgaWQ9J25qZXZmcXplZXgnPgoJCQoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IHdpZGdldCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCgkJLy8gT3ZlcndyaXRlIHRoZSBkZXNjcmlwdGlvbgoJCWNvbnN0IGRlc2MgPSB3aWRnZXQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLmlubmVySFRNTCA9ICJDdXN0b20gRGVzY3JpcHRpb24iCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CjwvYm9uZD48Ym9uZCBkZWY9Im50IiB1bmlxdWVfaWQ9IkpYSEkvMWdQSzdJWSI+PHN0cnVjdC1ib25kIGNsYXNzPSdOYW1lZFR1cGxleyhTeW1ib2woJnF1b3Q7IyMyMzUmcXVvdDspLCA6YSwgOmIsIDpjKX0nPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBjbGFzcz0nJz4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5OYW1lZFR1cGxlPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndnN0a2RvYmZmcicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbXNjcGdkamNsdycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYWAiPkRlc2NyaXB0aW9uPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2EnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2FpdGpsbm9pZWEnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYWl0amxub2llYSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImFpdGpsbm9pZWEiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J21zY3BnZGpjbHcnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2InPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2InIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGJgIj48ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+PHN0cm9uZz5Cb2xkPC9zdHJvbmc+IGZpZWxkPC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYic+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbmtnemZvcGVhYicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdua2d6Zm9wZWFiJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibmtnemZvcGVhYiIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbXNjcGdkamNsdycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYyc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYycgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgY2AiPmM8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ncHNpcmZ5bHZucicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdwc2lyZnlsdm5yJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAicHNpcmZ5bHZuciIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CjxzY3JpcHQgaWQ9J21zY3BnZGpjbHcnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJtc2NwZ2RqY2x3Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBOYW1lZFR1cGxlIikKCgkJLy8gYWRkIHRoZSBjb2xsYXBzZSBidXR0b24KCQljb25zdCBjb2xsYXBzZV9idG4gPSBodG1sYDxzcGFuIGNsYXNzPSdjb2xsYXBzZSc+YAoJCWhlYWRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBjb2xsYXBzZV9idG4pCgoJCXRyYy5jb2xsYXBzZSA9ICgpID0+IHsKICAJCQl0cmMuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJykKCQl9CgoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IHRyYy5jb2xsYXBzZSgpCgkJCgk8L3NjcmlwdD4KCQk8c3R5bGU+CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQkJCWZsZXg6IDE7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQktLXNpemU6IDE3cHg7CgkJCSAgICBkaXNwbGF5OiBibG9jazsKCQkJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQkJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJCWN1cnNvcjogcG9pbnRlcjsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkID4gdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJZmxleC1ncm93OiAxOwoJCQkJZm9udC1zaXplOiAxOHB4OwoJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyICsgKiB7CgkJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3ZzdGtkb2JmZnInPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ2c3RrZG9iZmZyIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSdwdHp0eGtxeGtsJz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KICAgICAgICB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIC0tc2l6ZTogMTVweDsKICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgIHdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGFwcGVhcmFuY2U6IG5vbmU7CiAgICBiYWNrZ3JvdW5kOiAjYzZjNmM2OwogICAgb3V0bGluZTogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CiAgICBib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIG1hcmdpbjogMCAxMHB4Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CiAgICBiYWNrZ3JvdW5kOiAjNEJEODY1Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKICAgIGNvbnRlbnQ6ICcnOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgd2lkdGg6IHZhcigtLXNpemUpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIHRvcDogMHB4OwogICAgbGVmdDogMHB4OwogICAgYmFja2dyb3VuZDogI2ZmZjsKICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsKICAgIGJveC1zaGFkb3c6IDAgY2FsYyh2YXIoLS1zaXplKS8yMCkgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIHRyYW5zaXRpb246IC4xczsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQ6YmVmb3JlIHsKICAgIGxlZnQ6IHZhcigtLXNpemUpCn0JCQoJPC9zdHlsZT4KPC90b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+CgoJPHNjcmlwdCBpZD0neWhkZ21zYXJidSc+CgkJCgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3Qgd2lkZ2V0ID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkKCQkvLyBPdmVyd3JpdGUgdGhlIGRlc2NyaXB0aW9uCgkJY29uc3QgZGVzYyA9IHdpZGdldC5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2MuaW5uZXJIVE1MID0gIk15IEZhbmN5IE5UdXBsZSIKCQoJCS8vIFNldC1HZXQgYm9uZAoJCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IGdldF9pbnB1dF92YWx1ZSh3aWRnZXQpLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXNldF9pbnB1dF92YWx1ZSh3aWRnZXQsIG5ld3ZhbCkKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJCgkJY29uc3Qgb2xkX29uaW5wdXQgPSB3aWRnZXQub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCXdpZGdldC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoJPC9zY3JpcHQ+Cgk8c3R5bGU+CgkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQlzdHJ1Y3QtYm9uZCB7CiAgCQkJZmxleDogMTsKCQl9Cgk8L3N0eWxlPgoJPC9zdHJ1Y3QtYm9uZD4KPC9ib25kPjxib25kc2xpc3QtY29udGFpbmVyIGNsYXNzPSduby1wb3BvdXQnPgoJPGJvbmRzbGlzdC1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2NvbGxhcHNlIGJvbmRzbGlzdC1pY29uJz48L3NwYW4+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJyB0aXRsZT0iVGhpcyBsaXN0IGNvbnRhaW5zIGluZGVwZW5kZW50IGJvbmRzIj5NeSBHcm91cCBvZiBCb25kczwvc3Bhbj4KCQk8c3BhbiBjbGFzcz0ndG9nZ2xlIGJvbmRzbGlzdC1pY29uJz48L3NwYW4+Cgk8L2JvbmRzbGlzdC1oZWFkZXI+Cgk8Ym9uZHNsaXN0LWNvbnRlbnRzPgoJPGJvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCTxib25kLWRlc2NyaXB0aW9uIHRpdGxlPSdUaGlzIGJvbmQgaXMgYXNzaWduZWQgdG8gdmFyaWFibGUgYGZyZXFgJz4KCQlGcmVxdWVuY3kgW0dIel0KCTwvYm9uZC1kZXNjcmlwdGlvbj4KCTxib25kLXZhbHVlPgoJCTxib25kIGRlZj0iZnJlcSIgdW5pcXVlX2lkPSI5QnVNaTZpdEUzamIiPgo8c2NyaXB0PgoJY29uc3QgZDNmb3JtYXQgPSBhd2FpdCBpbXBvcnQoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZDMtZm9ybWF0QDIvK2VzbSIpCgoJY29uc3QgZWxwID0gaHRtbGAKCTxzcGFuIGNsYXNzPSJudW1iZXJfRWRpdGFibGUiIHN0eWxlPSIKCXRvdWNoLWFjdGlvbjogbm9uZTsKCXBhZGRpbmc6IDBlbSAuMmVtOwoJYm9yZGVyLXJhZGl1czogLjNlbTsKCWZvbnQtd2VpZ2h0OiBib2xkOyI+PHNwYW4gY29udGVudEVkaXRhYmxlPXRydWU+MjA8L3NwYW4+IEdIejwvc3Bhbj4KCWAKCgljb25zdCBmb3JtYXR0ZXIgPSBzID0+IGQzZm9ybWF0LmZvcm1hdCgiIikocykKCWNvbnN0IGVsID0gZWxwLnF1ZXJ5U2VsZWN0b3IoInNwYW4iKQoKCWxldCBsb2NhbFZhbCA9IHBhcnNlRmxvYXQoMjApCgllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoMjApCgkKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShlbHAsInZhbHVlIix7CgkJZ2V0OiAoKSA9PiBsb2NhbFZhbCwKCQlzZXQ6IHggPT4gewoJCQlsb2NhbFZhbCA9IHBhcnNlRmxvYXQoeCkKCQkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKHgpCgkJfQoJfSkKCgljb25zdCBkaXNwYXRjaEV2ZW50ID0gKGUpID0+IHsKCQlpZiAoZWwuaW5uZXJUZXh0ID09PSAiIikgewoJCQllbHAudmFsdWUgPSAyMCAgIAoJCX0gZWxzZSB7CgkJCS8qIAoJCQlUaGUgcmVwbGFjZSBpcyBuZWVkZWQgYmVjYXVzZSBkMy1mb3JtYXQgb3V0cHV0cyAnLScgYXMgaW4gVSsyMjEyIChtYXRoIHN5bWJvbCkgYnV0IGZhaWxzIHRvIHBhcnNlIG5lZ2F0aXZlIG51bWJlciBjb3JyZWN0bHkgaWYgdGhleSBoYXZlIHRoYXQgc2lnbiBhcyBuZWdhdGl2ZSBzaWduLiBTbyB3ZSBqdXN0IHJlcGxhY2UgaXQgd2l0aCB0aGUgZGFzaCBVKzAwMkQgc2lnbiAKCQkJKi8KCQkJZWxwLnZhbHVlID0gIGVsLmlubmVyVGV4dC5yZXBsYWNlKCfiiJInLCAnLScpCgkJfQoJCWVscC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCX0KCgkvLyBGdW5jdGlvbiB0byBibHVyIHRoZSBlbGVtZW50IHdoZW4gcHJlc3NpbmcgZW50ZXIgaW5zdGVhZCBvZiBhZGRpbmcgYSBuZXdsaW5lCgljb25zdCBvbkVudGVyID0gKGUpID0+IHsKCQlpZiAoZS5rZXlDb2RlID09PSAxMykgewoJCWUucHJldmVudERlZmF1bHQoKTsKCQllbC5ibHVyKCkKCQl9Cgl9CgoJZWwuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLChlKSA9PiB7CgkJY29uc29sZS5sb2coZSkKCQllLnByZXZlbnREZWZhdWx0KCkKCQllLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpCgl9KQoKCWZ1bmN0aW9uIHNlbGVjdFRleHQoZWwpewoJCXZhciBzZWwsIHJhbmdlOwoJCWlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uICYmIGRvY3VtZW50LmNyZWF0ZVJhbmdlKSB7IC8vQnJvd3NlciBjb21wYXRpYmlsaXR5CgkJc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpOwoJCWlmKHNlbC50b1N0cmluZygpID09ICcnKXsgLy9ubyB0ZXh0IHNlbGVjdGlvbgoJCQl3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpewoJCQkJcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpOyAvL3JhbmdlIG9iamVjdAoJCQkJcmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKGVsKTsgLy9zZXRzIFJhbmdlCgkJCQlzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7IC8vcmVtb3ZlIGFsbCByYW5nZXMgZnJvbSBzZWxlY3Rpb24KCQkJCXNlbC5hZGRSYW5nZShyYW5nZSk7Ly9hZGQgUmFuZ2UgdG8gYSBTZWxlY3Rpb24uCgkJCX0sMSk7CgkJfQoJCX1lbHNlIGlmIChkb2N1bWVudC5zZWxlY3Rpb24pIHsgLy9vbGRlciBpZQoJCQlzZWwgPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTsKCQkJaWYoc2VsLnRleHQgPT0gJycpeyAvL25vIHRleHQgc2VsZWN0aW9uCgkJCQlyYW5nZSA9IGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7Ly9DcmVhdGVzIFRleHRSYW5nZSBvYmplY3QKCQkJCXJhbmdlLm1vdmVUb0VsZW1lbnRUZXh0KGVsKTsvL3NldHMgUmFuZ2UKCQkJCXJhbmdlLnNlbGVjdCgpOyAvL21ha2Ugc2VsZWN0aW9uLgoJCQl9CgkJfQoJfQoKCQoJZWwuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXNvdXQnLGRpc3BhdGNoRXZlbnQpCgllbC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJyxvbkVudGVyKQoJZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLChlKSA9PiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpKSAvLyBtb2RpZnkgdGV4dAoJZWxwLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywoZSkgPT4gc2VsZWN0VGV4dChlbCkpIC8vIFNlbGVjdCBhbGwgdGV4dAoKCXJldHVybiBlbHAKCjwvc2NyaXB0Pgo8c3R5bGU+CglAbWVkaWEgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBsaWdodCkgewoJCXNwYW4ubnVtYmVyX0VkaXRhYmxlIHsKCQkJYmFja2dyb3VuZDogaHNsKDIwNCwgOTUlLCA4NCUpOwoJCX0KCX0KCUBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspIHsKCQlzcGFuLm51bWJlcl9FZGl0YWJsZSB7CgkJCWJhY2tncm91bmQ6IGhzbCgyMDQsIDk1JSwgNDAlKTsKCQl9Cgl9Cjwvc3R5bGU+CjwvYm9uZD4KCTwvYm9uZC12YWx1ZT4KCTxzdHlsZT4KCQlib25kLXdpdGgtZGVzY3JpcHRpb24gewogIGRpc3BsYXk6IGdyaWQ7CiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgMC40ZnIpOwogIGdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKICBqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7Cn0KYm9uZHRhYmxlLWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiwKYm9uZHNsaXN0LWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CiAgZGlzcGxheTogY29udGVudHM7Cn0KYm9uZC12YWx1ZSBib25kIHsKICBkaXNwbGF5OiBmbGV4OyAvKiBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0ICovCn0KYm9uZC12YWx1ZSBpbnB1dCB7CiAgd2lkdGg6IDEwMCU7IC8qIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQgKi8KfQoKCTwvc3R5bGU+CjwvYm9uZC13aXRoLWRlc2NyaXB0aW9uPgo8Ym9uZC13aXRoLWRlc2NyaXB0aW9uPgoJPGJvbmQtZGVzY3JpcHRpb24gdGl0bGU9J1RoaXMgYm9uZCBpcyBhc3NpZ25lZCB0byB2YXJpYWJsZSBgYWx0YCc+CgkJPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPkFsdGl0dWRlIDxzcGFuIGNsYXNzPSJ0ZXgiPiRoJDwvc3Bhbj4gJiM5MTttJiM5Mzs8L3A+CjwvZGl2PgoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPGJvbmQgZGVmPSJhbHQiIHVuaXF1ZV9pZD0iM0U3SXRLdS8xTiYjNDM7eiI+PHNjcmlwdD4KLy8gd2VpcmQgaW1wb3J0IHRvIG1ha2UgaXQgZmFzdGVyLiBUaGUgYGF3YWl0IGltcG9ydGAgY2FuIHN0aWxsIGRlbGF5IGV4ZWN1dGlvbiBieSBvbmUgZnJhbWUgaWYgaXQgaXMgYWxyZWFkeSBsb2FkZWQuLi4Kd2luZG93LmQzZm9ybWF0ID0gd2luZG93LmQzZm9ybWF0ID8/IGF3YWl0IGltcG9ydCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9kMy1mb3JtYXRAMi8rZXNtIikKCmNvbnN0IGFyZ21pbiA9IHhzID0+IHhzLmluZGV4T2YoTWF0aC5taW4oLi4ueHMpKQpjb25zdCBjbG9zZXN0X2luZGV4ID0gKHhzLCB5KSA9PiBhcmdtaW4oeHMubWFwKHggPT4gTWF0aC5hYnMoeC15KSkpCgpjb25zdCB2YWx1ZXMgPSBbMTAwLCAxMTAsIDEyMCwgMTMwLCAxNDAsIDE1MCwgMTYwLCAxNzAsIDE4MCwgMTkwLCAyMDBdCgpjb25zdCBlbCA9IGh0bWxgCjxzcGFuIHRpdGxlPSJDbGljayBhbmQgZHJhZyB0aGlzIG51bWJlciBsZWZ0IG9yIHJpZ2h0ISIgc3R5bGU9ImN1cnNvcjogY29sLXJlc2l6ZTsKdG91Y2gtYWN0aW9uOiBub25lOwpiYWNrZ3JvdW5kOiByZ2IoMjUyLCAyMDksIDIwNCk7CmNvbG9yOiBibGFjazsKcGFkZGluZzogMGVtIC4yZW07CmJvcmRlci1yYWRpdXM6IC4zZW07CmZvbnQtd2VpZ2h0OiBib2xkOyI+MTUwPC9zcGFuPgpgCgoKCmxldCBvbGRfeCA9IDAKbGV0IG9sZF9pbmRleCA9IDAKY29uc3QgaW5pdGlhbF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCAxNTApCmxldCBjdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoKY29uc3QgZm9ybWF0dGVyID0gcyA9PiAiIiArIGQzZm9ybWF0LmZvcm1hdCgiIikocykgKyAiIgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShlbCwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXNbY3VycmVudF9pbmRleF0sCglzZXQ6IHggPT4gewoJCWN1cnJlbnRfaW5kZXggPSBjbG9zZXN0X2luZGV4KHZhbHVlcywgeCkKCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgl9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCi8vIGluaXRpYWwgdmFsdWUKZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKDE1MCkKCmNvbnN0IG9uU2NydWIgPSAoZSkgPT4gewoJY29uc3Qgb2Zmc2V0ID0gZS5jbGllbnRYIC0gb2xkX3gKCWNvbnN0IG5ld19pbmRleCA9IE1hdGgubWluKHZhbHVlcy5sZW5ndGgtMSwgTWF0aC5tYXgoMCwgCgkJTWF0aC5yb3VuZChvZmZzZXQvMTApICsgb2xkX2luZGV4CgkpKQoKCWlmKG5ld19pbmRleCAhPT0gY3VycmVudF9pbmRleCkgewoJCWN1cnJlbnRfaW5kZXggPSBuZXdfaW5kZXgKCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgkJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCgl9Cn0KCmNvbnN0IG9ucG9pbnRlcmRvd24gPSAoZSkgPT4gewoJd2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KCkKCW9sZF94ID0gZS5jbGllbnRYCglvbGRfaW5kZXggPSBjdXJyZW50X2luZGV4Cgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCmNvbnN0IG9uZGJsY2xpY2sgPSAoZSkgPT4gewoJY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCWVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCmNvbnN0IG9ucG9pbnRlcnVwID0gKCkgPT4gewoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgb25TY3J1YikKfQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgb25wb2ludGVydXApCgplbC5vbnNlbGVjdHN0YXJ0ID0gKCkgPT4gZmFsc2UKCmludmFsaWRhdGlvbi50aGVuKCgpID0+IHsKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKfSkKCnJldHVybiBlbAoKPC9zY3JpcHQ+PC9ib25kPgoJPC9ib25kLXZhbHVlPgoJPHN0eWxlPgoJCWJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CiAgZGlzcGxheTogZ3JpZDsKICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAwLjRmcik7CiAgZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwogIGp1c3RpZnktaXRlbXM6IGNlbnRlcjsKfQpib25kdGFibGUtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uLApib25kc2xpc3QtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKICBkaXNwbGF5OiBjb250ZW50czsKfQpib25kLXZhbHVlIGJvbmQgewogIGRpc3BsYXk6IGZsZXg7IC8qIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQgKi8KfQpib25kLXZhbHVlIGlucHV0IHsKICB3aWR0aDogMTAwJTsgLyogTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dCAqLwp9CgoJPC9zdHlsZT4KPC9ib25kLXdpdGgtZGVzY3JpcHRpb24+CgkKCTwvYm9uZHNsaXN0LWNvbnRlbnRzPgoJPHNjcmlwdCBpZD0neWVneXBkc2dpZic+CgkJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29udGFpbmVyLmNvbGxhcHNlID0gKGZvcmNlKSA9PiB7CgkJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnLCBmb3JjZSkKCQl9CgkJY29uc3QgY29sbGFwc2VfYnRuID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4uY29sbGFwc2UnKQoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IGNvbnRhaW5lci5jb2xsYXBzZSgpCgk8L3NjcmlwdD4KCTxzdHlsZT4KCWJvbmRzbGlzdC1oZWFkZXIgewogIGdyaWQtY29sdW1uOiAxIC8gLTE7CiAgZGlzcGxheTogZmxleDsKICBiYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7Cn0KYm9uZHNsaXN0LWhlYWRlcjpiZWZvcmUgewogIGNvbnRlbnQ6ICIiOwogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAxcHg7CiAgYm90dG9tOiAwcHg7CiAgbGVmdDogMHB4OwogIHJpZ2h0OiAwcHg7CiAgei1pbmRleDogLTE7CiAgYmFja2dyb3VuZDogI2ZmYWM0NTQwOwp9CmJvbmRzbGlzdC1jb250YWluZXIubm8tcG9wb3V0ID4gYm9uZHNsaXN0LWhlYWRlciB7CiAgYWxpZ24tc2VsZjogc3RhcnQ7CiAgcG9zaXRpb246IHN0aWNreTsKICB0b3A6IDBweDsKICBwYWRkaW5nLXRvcDogMTJweDsKICBtYXJnaW4tdG9wOiAtMTJweDsKICB6LWluZGV4OiAxMDsKfQpib25kc2xpc3QtY29udGVudHMgewogIGRpc3BsYXk6IGNvbnRlbnRzOwp9CmJvbmRzbGlzdC1jb250YWluZXIubm8tcG9wb3V0OmJlZm9yZSB7CiAgY29udGVudDogIiI7CiAgZGlzcGxheTogYmxvY2s7CiAgZ3JpZC1jb2x1bW46IDEgLyAtMTsKICBqdXN0aWZ5LXNlbGY6IGNlbnRlcjsKICBib3JkZXItYm90dG9tOiAycHggc29saWQ7CiAgcGFkZGluZy10b3A6IDVweDsKICB3aWR0aDogMTAwJTsKICBhbGlnbi1zZWxmOiBzdGFydDsKICBwb3NpdGlvbjogc3RpY2t5OwogIHRvcDogMHB4OwogIGJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICB6LWluZGV4OiAyMDsKfQpib25kc2xpc3QtaGVhZGVyID4gLmJvbmRzbGlzdC1pY29uIHsKICAtLXNpemU6IDE3cHg7CiAgZGlzcGxheTogYmxvY2s7CiAgYWxpZ24tc2VsZjogc3RyZXRjaDsKICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwogIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CiAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwogIHdpZHRoOiB2YXIoLS1zaXplKTsKICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwp9CmJvbmRzbGlzdC1oZWFkZXIgPiAuY29sbGFwc2UgewogIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwogIGN1cnNvcjogcG9pbnRlcjsKfQpib25kc2xpc3QtY29udGFpbmVyLmNvbGxhcHNlZCA+IGJvbmRzbGlzdC1oZWFkZXIgPiAuY29sbGFwc2UgewogIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwp9CmJvbmRzbGlzdC1oZWFkZXIgPiAudG9nZ2xlIHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgd2lkdGg6IDMwcHg7CiAgbWFyZ2luOiAwIDEwcHg7Cn0KYm9uZHNsaXN0LWhlYWRlciB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogc3RyZXRjaDsKICB3aWR0aDogMTAwJTsKfQpib25kc2xpc3QtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgZmxleC1ncm93OiAxOwogIGZvbnQtc2l6ZTogMThweDsKICBmb250LXdlaWdodDogNjAwOwp9CmJvbmRzbGlzdC1oZWFkZXIgPiAudG9nZ2xlIHsKICBhbGlnbi1zZWxmOiBjZW50ZXI7Cn0KYm9uZHNsaXN0LWNvbnRhaW5lci5jb2xsYXBzZWQgYm9uZHNsaXN0LWhlYWRlciArICogewogIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKfQpib25kc2xpc3QtY29udGFpbmVyIHsKICBkaXNwbGF5OiBncmlkOwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIDAuNGZyKTsKICBncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CiAganVzdGlmeS1pdGVtczogY2VudGVyOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgcm93LWdhcDogNXB4Owp9CmJvbmRzdGFibGUtY29udGFpbmVyIGJvbmRzbGlzdC1jb250YWluZXIgewogIGRpc3BsYXk6IGNvbnRlbnRzOwp9CgkJCgk8L3N0eWxlPgo8L2JvbmRzbGlzdC1jb250YWluZXI+Cjxib25kc2xpc3QtY29udGFpbmVyIGNsYXNzPSduby1wb3BvdXQnPgoJPGJvbmRzbGlzdC1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2NvbGxhcHNlIGJvbmRzbGlzdC1pY29uJz48L3NwYW4+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJyB0aXRsZT0iVGhpcyBsaXN0IGNvbnRhaW5zIGluZGVwZW5kZW50IGJvbmRzIj5Qb3BvdXQgQ29udGFpbmVyPC9zcGFuPgoJCTxzcGFuIGNsYXNzPSd0b2dnbGUgYm9uZHNsaXN0LWljb24nPjwvc3Bhbj4KCTwvYm9uZHNsaXN0LWhlYWRlcj4KCTxib25kc2xpc3QtY29udGVudHM+Cgk8Ym9uZC13aXRoLWRlc2NyaXB0aW9uPgoJPGJvbmQtZGVzY3JpcHRpb24gdGl0bGU9J1RoaXMgYm9uZCBpcyBhc3NpZ25lZCB0byB2YXJpYWJsZSBgYXNkYCc+CgkJU3RydWN0dXJlIEFTRAoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBvcG91dC1jb250YWluZXIga2V5PSdiZXB1aGd2b2hiJz4KCTxwb3BvdXQtaGVhZGVyPjxzcGFuIGNsYXNzPSdwb3BvdXQtaWNvbiBwb3BvdXQnPjwvc3Bhbj48L3BvcG91dC1oZWFkZXI+Cgk8cG9wb3V0LWNvbnRlbnRzPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3J1ZXVmcmlncnMnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxib25kIGRlZj0iYXNkIiB1bmlxdWVfaWQ9IlNsSWJkbzZ4Ry95cSI+PHN0cnVjdC1ib25kIGNsYXNzPSdNYWluLnZhciZxdW90O3dvcmtzcGFjZSMzJnF1b3Q7LkFTRCc+Cgk8dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGNsYXNzPScnPgoJPHRvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nPkFTRDwvc3Bhbj4KCQk8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGNsYXNzPSd0b2dnbGUnIGNoZWNrZWQ+Cgk8L3RvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJCTxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2FheWtieGZzZHknIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J29kcGpoaGhhbngnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2EnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2EnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGFgIj48ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+TWFya2Rvd24gZGVzY3JpcHRpb24sIGluY2x1ZGluZyA8c3BhbiBjbGFzcz0idGV4Ij4kTGFUZVgkPC9zcGFuPjwvcD4KPC9kaXY+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2EnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3Zzd2llZGZmaWcnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ndnN3aWVkZmZpZyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInZzd2llZGZmaWciCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J29kcGpoaGhhbngnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2InPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2InIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGJgIj48c3Bhbj5GaWVsZCB3aXRoIDxiPkhUTUw8L2I+IGRlc2NyaXB0aW9uPC9zcGFuPjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdsd2VvanRmbG5yJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c2NyaXB0PgovLyB3ZWlyZCBpbXBvcnQgdG8gbWFrZSBpdCBmYXN0ZXIuIFRoZSBgYXdhaXQgaW1wb3J0YCBjYW4gc3RpbGwgZGVsYXkgZXhlY3V0aW9uIGJ5IG9uZSBmcmFtZSBpZiBpdCBpcyBhbHJlYWR5IGxvYWRlZC4uLgp3aW5kb3cuZDNmb3JtYXQgPSB3aW5kb3cuZDNmb3JtYXQgPz8gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKY29uc3QgYXJnbWluID0geHMgPT4geHMuaW5kZXhPZihNYXRoLm1pbiguLi54cykpCmNvbnN0IGNsb3Nlc3RfaW5kZXggPSAoeHMsIHkpID0+IGFyZ21pbih4cy5tYXAoeCA9PiBNYXRoLmFicyh4LXkpKSkKCmNvbnN0IHZhbHVlcyA9IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMF0KCmNvbnN0IGVsID0gaHRtbGAKPHNwYW4gdGl0bGU9IkNsaWNrIGFuZCBkcmFnIHRoaXMgbnVtYmVyIGxlZnQgb3IgcmlnaHQhIiBzdHlsZT0iY3Vyc29yOiBjb2wtcmVzaXplOwp0b3VjaC1hY3Rpb246IG5vbmU7CmJhY2tncm91bmQ6IHJnYigyNTIsIDIwOSwgMjA0KTsKY29sb3I6IGJsYWNrOwpwYWRkaW5nOiAwZW0gLjJlbTsKYm9yZGVyLXJhZGl1czogLjNlbTsKZm9udC13ZWlnaHQ6IGJvbGQ7Ij42PC9zcGFuPgpgCgoKCmxldCBvbGRfeCA9IDAKbGV0IG9sZF9pbmRleCA9IDAKY29uc3QgaW5pdGlhbF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCA2KQpsZXQgY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCmNvbnN0IGZvcm1hdHRlciA9IHMgPT4gIiIgKyBkM2Zvcm1hdC5mb3JtYXQoIiIpKHMpICsgIiIKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZWwsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzW2N1cnJlbnRfaW5kZXhdLAoJc2V0OiB4ID0+IHsKCQljdXJyZW50X2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIHgpCgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgovLyBpbml0aWFsIHZhbHVlCmVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcig2KQoKY29uc3Qgb25TY3J1YiA9IChlKSA9PiB7Cgljb25zdCBvZmZzZXQgPSBlLmNsaWVudFggLSBvbGRfeAoJY29uc3QgbmV3X2luZGV4ID0gTWF0aC5taW4odmFsdWVzLmxlbmd0aC0xLCBNYXRoLm1heCgwLCAKCQlNYXRoLnJvdW5kKG9mZnNldC8xMCkgKyBvbGRfaW5kZXgKCSkpCgoJaWYobmV3X2luZGV4ICE9PSBjdXJyZW50X2luZGV4KSB7CgkJY3VycmVudF9pbmRleCA9IG5ld19pbmRleAoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCX0KfQoKY29uc3Qgb25wb2ludGVyZG93biA9IChlKSA9PiB7Cgl3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKQoJb2xkX3ggPSBlLmNsaWVudFgKCW9sZF9pbmRleCA9IGN1cnJlbnRfaW5kZXgKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoKY29uc3Qgb25kYmxjbGljayA9IChlKSA9PiB7CgljdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoKY29uc3Qgb25wb2ludGVydXAgPSAoKSA9PiB7Cgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKCmVsLm9uc2VsZWN0c3RhcnQgPSAoKSA9PiBmYWxzZQoKaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQp9KQoKcmV0dXJuIGVsCgo8L3NjcmlwdD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdsd2VvanRmbG5yJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibHdlb2p0ZmxuciIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nb2RwamhoaGFueCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYyc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYycgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgY2AiPk5vcm1hbCBTdHJpbmcgRGVzY3JpcHRpb248L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndW12d2tkcGtsdicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3RleHQnIHZhbHVlPScnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3VtdndrZHBrbHYnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ1bXZ3a2Rwa2x2Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdvZHBqaGhoYW54JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdkJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdkJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBkYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPlRoaXMgZmllbGQgaXMgPGVtPnNwZWNpYWw8L2VtPjwvcD4KPC9kaXY+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2QnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2V3cWxwZnZhdHonIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSd0ZXh0JyB2YWx1ZT0nJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdld3FscGZ2YXR6Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZXdxbHBmdmF0eiIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nb2RwamhoaGFueCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nZSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nZScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgZWAiPmU8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nZSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ncmZ1dW1zdmxjcycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nNicgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3JmdXVtc3ZsY3MnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJyZnV1bXN2bGNzIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0nb2RwamhoaGFueCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gIm9kcGpoaGhhbngiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIEFTRCIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJCQlmbGV4OiAxOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdhYXlrYnhmc2R5Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYWF5a2J4ZnNkeSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0nZHp4eXhodWtwaic+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+CiAgICAgICAgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAtLXNpemU6IDE1cHg7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBhcHBlYXJhbmNlOiBub25lOwogICAgYmFja2dyb3VuZDogI2M2YzZjNjsKICAgIG91dGxpbmU6IG5vbmU7CiAgICBib3JkZXItcmFkaXVzOiBjYWxjKHZhcigtLXNpemUpLzIpOwogICAgYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICBtYXJnaW46IDAgMTBweDsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewogICAgYmFja2dyb3VuZDogIzRCRDg2NTsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CiAgICBjb250ZW50OiAnJzsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB0b3A6IDBweDsKICAgIGxlZnQ6IDBweDsKICAgIGJhY2tncm91bmQ6ICNmZmY7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CiAgICBib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICB0cmFuc2l0aW9uOiAuMXM7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CiAgICBsZWZ0OiB2YXIoLS1zaXplKQp9CQkKCTwvc3R5bGU+CjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoKCTxzY3JpcHQgaWQ9J25qZXZmcXplZXgnPgoJCQoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IHdpZGdldCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCgkJLy8gT3ZlcndyaXRlIHRoZSBkZXNjcmlwdGlvbgoJCWNvbnN0IGRlc2MgPSB3aWRnZXQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLmlubmVySFRNTCA9ICJDdXN0b20gRGVzY3JpcHRpb24iCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CjwvYm9uZD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvcG9wb3V0LWNvbnRlbnRzPgo8L3BvcG91dC1jb250YWluZXI+CjxzY3JpcHQgaWQ9J2JlcHVoZ3ZvaGInPgoJLy8gTG9hZCB0aGUgZmxvYXRpbmctdWkgYW5kIGludGVyYWN0IGxpYnJhcmllcwoJd2luZG93LmZsb2F0aW5nX3VpID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9AZmxvYXRpbmctdWkvZG9tJykKCgljb25zdCB7IGNvbXB1dGVQb3NpdGlvbiwgYXV0b1BsYWNlbWVudCB9ID0gZmxvYXRpbmdfdWkKCQoJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgljb25zdCBoZWFkZXIgPSBjb250YWluZXIuZmlyc3RFbGVtZW50Q2hpbGQKCWNvbnN0IGNvbnRlbnRzID0gY29udGFpbmVyLmxhc3RFbGVtZW50Q2hpbGQKCgkvLyBMb2FkIHRoZSBpbnRlcmFjdGpzIHBhcnQKCQkvLyBXZSB1c2UgdGhlIGludGVyYWN0anMgbGlicmFyeSB0byBwcm92aWRlIGRyYWcgYW5kIHJlc2l6ZSBoYW5kbGluZyBhY3Jvc3MgZGV2aWNlcwoJY29uc3QgeyBkZWZhdWx0OiBpbnRlcmFjdCB9ID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9pbnRlcmFjdGpzJykKCgljb250ZW50cy5vZmZzZXQgPSBjb250ZW50cy5vZmZzZXQgPz8geyB4OiAwLCB5OiAwfQoJY29uc3Qgc3RhcnRQb3NpdGlvbiA9IHt4OiAwLCB5OiAwfQoJaW50ZXJhY3QoY29udGVudHMucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC5kZXNjcmlwdGlvbiwgYm9uZHNsaXN0LWhlYWRlciAuZGVzY3JpcHRpb24nKSkuZHJhZ2dhYmxlKHsKCQlsaXN0ZW5lcnM6IHsKCQkJc3RhcnQgKGV2ZW50KSB7CgkJCQljb250ZW50cy5vZmZzZXQueSA9IHN0YXJ0UG9zaXRpb24ueSA9IGNvbnRlbnRzLm9mZnNldFRvcAoJCQkJY29udGVudHMub2Zmc2V0LnggPSBzdGFydFBvc2l0aW9uLnggPSBjb250ZW50cy5vZmZzZXRMZWZ0CgkJCX0sCgkJCW1vdmUgKGV2ZW50KSB7CgkJICAgICAgY29udGVudHMub2Zmc2V0LnggKz0gZXZlbnQuZHgKCQkgICAgICBjb250ZW50cy5vZmZzZXQueSArPSBldmVudC5keQoJCQoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLnRvcCA9IGBtaW4oOTV2aCwgJHtjb250ZW50cy5vZmZzZXQueX1weGAKCQkgICAgICBjb250ZW50cy5zdHlsZS5sZWZ0ID0gYG1pbig5NXZ3LCAke2NvbnRlbnRzLm9mZnNldC54fXB4YAoJCSAgICB9LAoJCX0KCX0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gaGVhZGVyIHJlc2V0IHRoZSBwb3NpdGlvbgoJCWNvbnRhaW5lci5wb3BvdXQoKQoJfSkKCWludGVyYWN0KGNvbnRlbnRzKQoJICAucmVzaXphYmxlKHsKCSAgICBlZGdlczogeyB0b3A6IHRydWUsIGxlZnQ6IGZhbHNlLCBib3R0b206IHRydWUsIHJpZ2h0OiB0cnVlIH0sCgkgICAgbGlzdGVuZXJzOiB7CgkgICAgICBtb3ZlOiBmdW5jdGlvbiAoZXZlbnQpIHsJCQoJICAgICAgICBPYmplY3QuYXNzaWduKGV2ZW50LnRhcmdldC5zdHlsZSwgewoJICAgICAgICAgIHdpZHRoOiBgJHtldmVudC5yZWN0LndpZHRofXB4YCwKCSAgICAgICAgICBoZWlnaHQ6IGAke2V2ZW50LnJlY3QuaGVpZ2h0fXB4YCwKCSAgICAgICAgfSkKCSAgICAgIH0KCSAgICB9CgkgIH0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gcmVzaXplIHJlc2V0IHRoZSB3aWR0aAoJCQljb250ZW50cy5zdHlsZS53aWR0aCA9ICcnCgkJICAJY29udGVudHMuc3R5bGUuaGVpZ2h0ID0gJycKCSAgfSkKCgoJZnVuY3Rpb24gcG9zaXRpb25Db250ZW50cygpIHsKCQljb21wdXRlUG9zaXRpb24oaGVhZGVyLCBjb250ZW50cywgewoJCQlzdHJhdGVneTogImZpeGVkIiwKCQkJbWlkZGxld2FyZTogW2F1dG9QbGFjZW1lbnQoKV0sCgkJfSkudGhlbigocG9zKSA9PiB7CgkJCWNvbnRlbnRzLnN0eWxlLmxlZnQgPSBwb3MueCArICJweCIKCQkJY29udGVudHMuc3R5bGUudG9wID0gcG9zLnkgKyAicHgiCgkJfSkKCX0KCgljb250YWluZXIucG9wb3V0ID0gKGZvcmNlID0gdW5kZWZpbmVkKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ3BvcHBlZCcsIGZvcmNlKQoJCXBvc2l0aW9uQ29udGVudHMoKQoJfQoKCWhlYWRlci5vbmNsaWNrID0gKGUpID0+IHtjb250YWluZXIucG9wb3V0KCl9CgoJY29udGVudHMub25tb3VzZWVudGVyID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb250ZW50cy1ob3ZlcicsIHRydWUpCgljb250ZW50cy5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgZmFsc2UpCgoJaGVhZGVyLm9ubW91c2VlbnRlciA9IChlKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIHRydWUpCgkJY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygncG9wcGVkJykgPyBudWxsIDogcG9zaXRpb25Db250ZW50cygpCgl9CgloZWFkZXIub25tb3VzZWxlYXZlID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItaG92ZXInLCBmYWxzZSkKPC9zY3JpcHQ+CjxzdHlsZT4KCXBvcG91dC1oZWFkZXIgewogICAgZGlzcGxheTogZmxleDsKICAgIGJvcmRlcjogM3B4IGRhc2hlZCB0cmFuc3BhcmVudDsKICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKfQpwb3BvdXQtY29udGVudHMgewogICAgZGlzcGxheTogbm9uZTsKICAgIHdpZHRoOiA0MDBweDsKICAgIGJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICAgIGJvcmRlcjogM3B4IHNvbGlkIHZhcigtLW92ZXJsYXktYnV0dG9uLWJvcmRlcik7CiAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgcGFkZGluZzogOHB4Owp9CnBvcG91dC1jb250YWluZXIucG9wcGVkID4gcG9wb3V0LWNvbnRlbnRzLApwb3BvdXQtY29udGFpbmVyLmhlYWRlci1ob3ZlciA+IHBvcG91dC1jb250ZW50cyB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgIHotaW5kZXg6IDUwMDsKfQpwb3BvdXQtY29udGFpbmVyLmNvbnRlbnRzLWhvdmVyID4gcG9wb3V0LWhlYWRlciB7CiAgICBib3JkZXItY29sb3I6IHZhcigtLXBsdXRvLWxvZ3Mtd2Fybi1hY2NlbnQtY29sb3IpOwp9Ci5wb3BvdXQtaWNvbiB7CiAgICAtLXNpemU6IDIwcHg7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CiAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKICAgIG1pbi1oZWlnaHQ6IHZhcigtLXNpemUpOwogICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKfQoucG9wb3V0LWljb24ucG9wb3V0IHsJCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9leHBhbmQuc3ZnKTsKfQpwb3BvdXQtY29udGFpbmVyLnBvcHBlZCAucG9wb3V0IHsKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NvbnRyYWN0LnN2Zyk7Cn0KcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKICAgIHRvdWNoLWFjdGlvbjogbm9uZTsKICAgIHVzZXItc2VsZWN0OiBub25lOwp9Cjwvc3R5bGU+CjxzY3JpcHQgaWQ9J3J1ZXVmcmlncnMnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJydWV1ZnJpZ3JzIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+Cgk8L2JvbmQtdmFsdWU+Cgk8c3R5bGU+CgkJYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKICBkaXNwbGF5OiBncmlkOwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIDAuNGZyKTsKICBncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CiAganVzdGlmeS1pdGVtczogY2VudGVyOwp9CmJvbmR0YWJsZS1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24sCmJvbmRzbGlzdC1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24gewogIGRpc3BsYXk6IGNvbnRlbnRzOwp9CmJvbmQtdmFsdWUgYm9uZCB7CiAgZGlzcGxheTogZmxleDsgLyogTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dCAqLwp9CmJvbmQtdmFsdWUgaW5wdXQgewogIHdpZHRoOiAxMDAlOyAvKiBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0ICovCn0KCgk8L3N0eWxlPgo8L2JvbmQtd2l0aC1kZXNjcmlwdGlvbj4KPGJvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCTxib25kLWRlc2NyaXB0aW9uIHRpdGxlPSdUaGlzIGJvbmQgaXMgYXNzaWduZWQgdG8gdmFyaWFibGUgYG50YCc+CgkJTmFtZWRUdXBsZQoJPC9ib25kLWRlc2NyaXB0aW9uPgoJPGJvbmQtdmFsdWU+CgkJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBvcG91dC1jb250YWluZXIga2V5PSdwenNkZ3NoZWd0Jz4KCTxwb3BvdXQtaGVhZGVyPjxzcGFuIGNsYXNzPSdwb3BvdXQtaWNvbiBwb3BvdXQnPjwvc3Bhbj48L3BvcG91dC1oZWFkZXI+Cgk8cG9wb3V0LWNvbnRlbnRzPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2J1Z2VzaGpodnMnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxib25kIGRlZj0ibnQiIHVuaXF1ZV9pZD0iSlhISS8xZ1BLN0lZIj48c3RydWN0LWJvbmQgY2xhc3M9J05hbWVkVHVwbGV7KFN5bWJvbCgmcXVvdDsjIzIzNSZxdW90OyksIDphLCA6YiwgOmMpfSc+Cgk8dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGNsYXNzPScnPgoJPHRvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nPk5hbWVkVHVwbGU8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSd2c3RrZG9iZmZyJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdtc2NwZ2RqY2x3JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+RGVzY3JpcHRpb248L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYWl0amxub2llYScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdhaXRqbG5vaWVhJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYWl0amxub2llYSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbXNjcGdkamNsdycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYic+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYicgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYmAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD48c3Ryb25nPkJvbGQ8L3N0cm9uZz4gZmllbGQ8L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdua2d6Zm9wZWFiJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J25rZ3pmb3BlYWInPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJua2d6Zm9wZWFiIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdtc2NwZ2RqY2x3JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdjJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdjJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBjYCI+YzwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdjJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdwc2lyZnlsdm5yJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3BzaXJmeWx2bnInPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJwc2lyZnlsdm5yIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0nbXNjcGdkamNsdyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gIm1zY3BnZGpjbHciCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIE5hbWVkVHVwbGUiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCQkJZmxleDogMTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ndnN0a2RvYmZmcic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInZzdGtkb2JmZnIiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J3B0enR4a3F4a2wnPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgogICAgICAgIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewogICAgY3Vyc29yOiBwb2ludGVyOwogICAgLS1zaXplOiAxNXB4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIGJhY2tncm91bmQ6ICNjNmM2YzY7CiAgICBvdXRsaW5lOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgbWFyZ2luOiAwIDEwcHg7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKICAgIGJhY2tncm91bmQ6ICM0QkQ4NjU7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewogICAgY29udGVudDogJyc7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgdG9wOiAwcHg7CiAgICBsZWZ0OiAwcHg7CiAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgdHJhbnNpdGlvbjogLjFzOwp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewogICAgbGVmdDogdmFyKC0tc2l6ZSkKfQkJCgk8L3N0eWxlPgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSd5aGRnbXNhcmJ1Jz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiTXkgRmFuY3kgTlR1cGxlIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L3BvcG91dC1jb250ZW50cz4KPC9wb3BvdXQtY29udGFpbmVyPgo8c2NyaXB0IGlkPSdwenNkZ3NoZWd0Jz4KCS8vIExvYWQgdGhlIGZsb2F0aW5nLXVpIGFuZCBpbnRlcmFjdCBsaWJyYXJpZXMKCXdpbmRvdy5mbG9hdGluZ191aSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvQGZsb2F0aW5nLXVpL2RvbScpCgoJY29uc3QgeyBjb21wdXRlUG9zaXRpb24sIGF1dG9QbGFjZW1lbnQgfSA9IGZsb2F0aW5nX3VpCgkKCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJY29uc3QgaGVhZGVyID0gY29udGFpbmVyLmZpcnN0RWxlbWVudENoaWxkCgljb25zdCBjb250ZW50cyA9IGNvbnRhaW5lci5sYXN0RWxlbWVudENoaWxkCgoJLy8gTG9hZCB0aGUgaW50ZXJhY3RqcyBwYXJ0CgkJLy8gV2UgdXNlIHRoZSBpbnRlcmFjdGpzIGxpYnJhcnkgdG8gcHJvdmlkZSBkcmFnIGFuZCByZXNpemUgaGFuZGxpbmcgYWNyb3NzIGRldmljZXMKCWNvbnN0IHsgZGVmYXVsdDogaW50ZXJhY3QgfSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvaW50ZXJhY3RqcycpCgoJY29udGVudHMub2Zmc2V0ID0gY29udGVudHMub2Zmc2V0ID8/IHsgeDogMCwgeTogMH0KCWNvbnN0IHN0YXJ0UG9zaXRpb24gPSB7eDogMCwgeTogMH0KCWludGVyYWN0KGNvbnRlbnRzLnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAuZGVzY3JpcHRpb24sIGJvbmRzbGlzdC1oZWFkZXIgLmRlc2NyaXB0aW9uJykpLmRyYWdnYWJsZSh7CgkJbGlzdGVuZXJzOiB7CgkJCXN0YXJ0IChldmVudCkgewoJCQkJY29udGVudHMub2Zmc2V0LnkgPSBzdGFydFBvc2l0aW9uLnkgPSBjb250ZW50cy5vZmZzZXRUb3AKCQkJCWNvbnRlbnRzLm9mZnNldC54ID0gc3RhcnRQb3NpdGlvbi54ID0gY29udGVudHMub2Zmc2V0TGVmdAoJCQl9LAoJCQltb3ZlIChldmVudCkgewoJCSAgICAgIGNvbnRlbnRzLm9mZnNldC54ICs9IGV2ZW50LmR4CgkJICAgICAgY29udGVudHMub2Zmc2V0LnkgKz0gZXZlbnQuZHkKCQkKCQkgICAgICBjb250ZW50cy5zdHlsZS50b3AgPSBgbWluKDk1dmgsICR7Y29udGVudHMub2Zmc2V0Lnl9cHhgCgkJICAgICAgY29udGVudHMuc3R5bGUubGVmdCA9IGBtaW4oOTV2dywgJHtjb250ZW50cy5vZmZzZXQueH1weGAKCQkgICAgfSwKCQl9Cgl9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIGhlYWRlciByZXNldCB0aGUgcG9zaXRpb24KCQljb250YWluZXIucG9wb3V0KCkKCX0pCglpbnRlcmFjdChjb250ZW50cykKCSAgLnJlc2l6YWJsZSh7CgkgICAgZWRnZXM6IHsgdG9wOiB0cnVlLCBsZWZ0OiBmYWxzZSwgYm90dG9tOiB0cnVlLCByaWdodDogdHJ1ZSB9LAoJICAgIGxpc3RlbmVyczogewoJICAgICAgbW92ZTogZnVuY3Rpb24gKGV2ZW50KSB7CQkKCSAgICAgICAgT2JqZWN0LmFzc2lnbihldmVudC50YXJnZXQuc3R5bGUsIHsKCSAgICAgICAgICB3aWR0aDogYCR7ZXZlbnQucmVjdC53aWR0aH1weGAsCgkgICAgICAgICAgaGVpZ2h0OiBgJHtldmVudC5yZWN0LmhlaWdodH1weGAsCgkgICAgICAgIH0pCgkgICAgICB9CgkgICAgfQoJICB9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIHJlc2l6ZSByZXNldCB0aGUgd2lkdGgKCQkJY29udGVudHMuc3R5bGUud2lkdGggPSAnJwoJCSAgCWNvbnRlbnRzLnN0eWxlLmhlaWdodCA9ICcnCgkgIH0pCgoKCWZ1bmN0aW9uIHBvc2l0aW9uQ29udGVudHMoKSB7CgkJY29tcHV0ZVBvc2l0aW9uKGhlYWRlciwgY29udGVudHMsIHsKCQkJc3RyYXRlZ3k6ICJmaXhlZCIsCgkJCW1pZGRsZXdhcmU6IFthdXRvUGxhY2VtZW50KCldLAoJCX0pLnRoZW4oKHBvcykgPT4gewoJCQljb250ZW50cy5zdHlsZS5sZWZ0ID0gcG9zLnggKyAicHgiCgkJCWNvbnRlbnRzLnN0eWxlLnRvcCA9IHBvcy55ICsgInB4IgoJCX0pCgl9CgoJY29udGFpbmVyLnBvcG91dCA9IChmb3JjZSA9IHVuZGVmaW5lZCkgPT4gewoJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdwb3BwZWQnLCBmb3JjZSkKCQlwb3NpdGlvbkNvbnRlbnRzKCkKCX0KCgloZWFkZXIub25jbGljayA9IChlKSA9PiB7Y29udGFpbmVyLnBvcG91dCgpfQoKCWNvbnRlbnRzLm9ubW91c2VlbnRlciA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29udGVudHMtaG92ZXInLCB0cnVlKQoJY29udGVudHMub25tb3VzZWxlYXZlID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb250ZW50cy1ob3ZlcicsIGZhbHNlKQoKCWhlYWRlci5vbm1vdXNlZW50ZXIgPSAoZSkgPT4gewoJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItaG92ZXInLCB0cnVlKQoJCWNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHBlZCcpID8gbnVsbCA6IHBvc2l0aW9uQ29udGVudHMoKQoJfQoJaGVhZGVyLm9ubW91c2VsZWF2ZSA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLWhvdmVyJywgZmFsc2UpCjwvc2NyaXB0Pgo8c3R5bGU+Cglwb3BvdXQtaGVhZGVyIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBib3JkZXI6IDNweCBkYXNoZWQgdHJhbnNwYXJlbnQ7CiAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7Cn0KcG9wb3V0LWNvbnRlbnRzIHsKICAgIGRpc3BsYXk6IG5vbmU7CiAgICB3aWR0aDogNDAwcHg7CiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CiAgICBib3JkZXI6IDNweCBzb2xpZCB2YXIoLS1vdmVybGF5LWJ1dHRvbi1ib3JkZXIpOwogICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgIHBhZGRpbmc6IDhweDsKfQpwb3BvdXQtY29udGFpbmVyLnBvcHBlZCA+IHBvcG91dC1jb250ZW50cywKcG9wb3V0LWNvbnRhaW5lci5oZWFkZXItaG92ZXIgPiBwb3BvdXQtY29udGVudHMgewogICAgZGlzcGxheTogYmxvY2s7CiAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICB6LWluZGV4OiA1MDA7Cn0KcG9wb3V0LWNvbnRhaW5lci5jb250ZW50cy1ob3ZlciA+IHBvcG91dC1oZWFkZXIgewogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1wbHV0by1sb2dzLXdhcm4tYWNjZW50LWNvbG9yKTsKfQoucG9wb3V0LWljb24gewogICAgLS1zaXplOiAyMHB4OwogICAgZGlzcGxheTogYmxvY2s7CiAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwogICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CiAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CiAgICBtaW4taGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7Cn0KLnBvcG91dC1pY29uLnBvcG91dCB7CQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvZXhwYW5kLnN2Zyk7Cn0KcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgLnBvcG91dCB7CiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jb250cmFjdC5zdmcpOwp9CnBvcG91dC1jb250YWluZXIucG9wcGVkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CiAgICB0b3VjaC1hY3Rpb246IG5vbmU7CiAgICB1c2VyLXNlbGVjdDogbm9uZTsKfQo8L3N0eWxlPgo8c2NyaXB0IGlkPSdidWdlc2hqaHZzJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYnVnZXNoamh2cyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPgoJPC9ib25kLXZhbHVlPgoJPHN0eWxlPgoJCWJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CiAgZGlzcGxheTogZ3JpZDsKICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAwLjRmcik7CiAgZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwogIGp1c3RpZnktaXRlbXM6IGNlbnRlcjsKfQpib25kdGFibGUtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uLApib25kc2xpc3QtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKICBkaXNwbGF5OiBjb250ZW50czsKfQpib25kLXZhbHVlIGJvbmQgewogIGRpc3BsYXk6IGZsZXg7IC8qIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQgKi8KfQpib25kLXZhbHVlIGlucHV0IHsKICB3aWR0aDogMTAwJTsgLyogTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dCAqLwp9CgoJPC9zdHlsZT4KPC9ib25kLXdpdGgtZGVzY3JpcHRpb24+Cjxib25kLXdpdGgtZGVzY3JpcHRpb24+Cgk8Ym9uZC1kZXNjcmlwdGlvbiB0aXRsZT0nVGhpcyBib25kIGlzIGFzc2lnbmVkIHRvIHZhcmlhYmxlIGBzYnNgJz4KCQlTdHJ1Y3RCb25kU2VsZWN0Cgk8L2JvbmQtZGVzY3JpcHRpb24+Cgk8Ym9uZC12YWx1ZT4KCQk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cG9wb3V0LWNvbnRhaW5lciBrZXk9J3JidW5sdWFpbXInPgoJPHBvcG91dC1oZWFkZXI+PHNwYW4gY2xhc3M9J3BvcG91dC1pY29uIHBvcG91dCc+PC9zcGFuPjwvcG9wb3V0LWhlYWRlcj4KCTxwb3BvdXQtY29udGVudHM+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0naXJjZnV4a3N2dCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGJvbmQgZGVmPSJzYnMiIHVuaXF1ZV9pZD0iWE9TZFovRTMvUlNMIj48dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGNsYXNzPSdzdHJ1Y3Rib25kLXNlbGVjdCc+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+U3RydWN0Qm9uZFNlbGVjdDwvc3Bhbj4KCQk8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGNsYXNzPSd0b2dnbGUnIGNoZWNrZWQ+Cgk8L3RvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJCTxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3pwc2NjeXJuY3UnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzdHJ1Y3Rib25kLXNlbGVjdD4KICAgIDxzcGFuIGNsYXNzPSJzZWxlY3RvciI+CiAgICAgICAgPHNwYW4gY2xhc3M9ImRlc2NyaXB0aW9uIj5PcHRpb25zOjwvc3Bhbj4KICAgICAgICA8c2VsZWN0PjxvcHRpb24gdmFsdWU9J3B1aXNlbGVjdC0xJz5jb3MoYXJnKTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9J3B1aXNlbGVjdC0yJyBzZWxlY3RlZD0nJz5hdGFuKHkseCk8L29wdGlvbj48L3NlbGVjdD4KICAgIDwvc3Bhbj4KICAgIDxzdHJ1Y3QtYm9uZCBjbGFzcz0nTmFtZWRUdXBsZXsoU3ltYm9sKCZxdW90OyMjMjM2JnF1b3Q7KSwgOmFyZyl9Jz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgY2xhc3M9Jyc+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+TmFtZWRUdXBsZTwvc3Bhbj4KCQk8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGNsYXNzPSd0b2dnbGUnIGNoZWNrZWQ+Cgk8L3RvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJCTxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2JkaHZjaHd4cm8nIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2Ricm9vcHRweWInIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2FyZyc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYXJnJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhcmdgIj5hcmc8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYXJnJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd5dWdldWZrcW1rJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMDAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd5dWdldWZrcW1rJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAieXVnZXVma3FtayIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CjxzY3JpcHQgaWQ9J2Ricm9vcHRweWInPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJkYnJvb3B0cHliIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBOYW1lZFR1cGxlIikKCgkJLy8gYWRkIHRoZSBjb2xsYXBzZSBidXR0b24KCQljb25zdCBjb2xsYXBzZV9idG4gPSBodG1sYDxzcGFuIGNsYXNzPSdjb2xsYXBzZSc+YAoJCWhlYWRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBjb2xsYXBzZV9idG4pCgoJCXRyYy5jb2xsYXBzZSA9ICgpID0+IHsKICAJCQl0cmMuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJykKCQl9CgoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IHRyYy5jb2xsYXBzZSgpCgkJCgk8L3NjcmlwdD4KCQk8c3R5bGU+CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQkJCWZsZXg6IDE7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQktLXNpemU6IDE3cHg7CgkJCSAgICBkaXNwbGF5OiBibG9jazsKCQkJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQkJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJCWN1cnNvcjogcG9pbnRlcjsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkID4gdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJZmxleC1ncm93OiAxOwoJCQkJZm9udC1zaXplOiAxOHB4OwoJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyICsgKiB7CgkJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2JkaHZjaHd4cm8nPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJiZGh2Y2h3eHJvIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSd5Z3hjdWZ6amN3Jz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KICAgICAgICB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIC0tc2l6ZTogMTVweDsKICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgIHdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGFwcGVhcmFuY2U6IG5vbmU7CiAgICBiYWNrZ3JvdW5kOiAjYzZjNmM2OwogICAgb3V0bGluZTogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CiAgICBib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIG1hcmdpbjogMCAxMHB4Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CiAgICBiYWNrZ3JvdW5kOiAjNEJEODY1Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKICAgIGNvbnRlbnQ6ICcnOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgd2lkdGg6IHZhcigtLXNpemUpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIHRvcDogMHB4OwogICAgbGVmdDogMHB4OwogICAgYmFja2dyb3VuZDogI2ZmZjsKICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsKICAgIGJveC1zaGFkb3c6IDAgY2FsYyh2YXIoLS1zaXplKS8yMCkgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIHRyYW5zaXRpb246IC4xczsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQ6YmVmb3JlIHsKICAgIGxlZnQ6IHZhcigtLXNpemUpCn0JCQoJPC9zdHlsZT4KPC90b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+CgoJPHNjcmlwdCBpZD0nZnd6aXhjampyYic+CgkJCgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3Qgd2lkZ2V0ID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkKCQkvLyBPdmVyd3JpdGUgdGhlIGRlc2NyaXB0aW9uCgkJY29uc3QgZGVzYyA9IHdpZGdldC5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2MuaW5uZXJIVE1MID0gImNvcyhhcmcpIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8c3RydWN0LWJvbmQgY2xhc3M9J05hbWVkVHVwbGV7KFN5bWJvbCgmcXVvdDsjIzIzNyZxdW90OyksIDp4LCA6eSl9Jz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgY2xhc3M9Jyc+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+TmFtZWRUdXBsZTwvc3Bhbj4KCQk8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGNsYXNzPSd0b2dnbGUnIGNoZWNrZWQ+Cgk8L3RvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJCTxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3hiaHZudW91YmcnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2x1ZmdsenpxdHInIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J3gnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J3gnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYHhgIj54PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J3gnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2Z4cGJhbGZsbXMnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwMScgdmFsdWU9JzMxJz48c2NyaXB0PgoJCQkJCWNvbnN0IGlucHV0X2VsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJCQkJY29uc3Qgb3V0cHV0X2VsID0gY3VycmVudFNjcmlwdC5uZXh0RWxlbWVudFNpYmxpbmcKCQkJCQljb25zdCBkaXNwbGF5cyA9IFsiMC4wIiwgIjAuMSIsICIwLjIiLCAiMC4zIiwgIjAuNCIsICIwLjUiLCAiMC42IiwgIjAuNyIsICIwLjgiLCAiMC45IiwgIjEuMCIsICIxLjEiLCAiMS4yIiwgIjEuMyIsICIxLjQiLCAiMS41IiwgIjEuNiIsICIxLjciLCAiMS44IiwgIjEuOSIsICIyLjAiLCAiMi4xIiwgIjIuMiIsICIyLjMiLCAiMi40IiwgIjIuNSIsICIyLjYiLCAiMi43IiwgIjIuOCIsICIyLjkiLCAiMy4wIiwgIjMuMSIsICIzLjIiLCAiMy4zIiwgIjMuNCIsICIzLjUiLCAiMy42IiwgIjMuNyIsICIzLjgiLCAiMy45IiwgIjQuMCIsICI0LjEiLCAiNC4yIiwgIjQuMyIsICI0LjQiLCAiNC41IiwgIjQuNiIsICI0LjciLCAiNC44IiwgIjQuOSIsICI1LjAiLCAiNS4xIiwgIjUuMiIsICI1LjMiLCAiNS40IiwgIjUuNSIsICI1LjYiLCAiNS43IiwgIjUuOCIsICI1LjkiLCAiNi4wIiwgIjYuMSIsICI2LjIiLCAiNi4zIiwgIjYuNCIsICI2LjUiLCAiNi42IiwgIjYuNyIsICI2LjgiLCAiNi45IiwgIjcuMCIsICI3LjEiLCAiNy4yIiwgIjcuMyIsICI3LjQiLCAiNy41IiwgIjcuNiIsICI3LjciLCAiNy44IiwgIjcuOSIsICI4LjAiLCAiOC4xIiwgIjguMiIsICI4LjMiLCAiOC40IiwgIjguNSIsICI4LjYiLCAiOC43IiwgIjguOCIsICI4LjkiLCAiOS4wIiwgIjkuMSIsICI5LjIiLCAiOS4zIiwgIjkuNCIsICI5LjUiLCAiOS42IiwgIjkuNyIsICI5LjgiLCAiOS45IiwgIjEwLjAiXQoKCQkJCQlsZXQgdXBkYXRlX291dHB1dCA9ICgpID0+IHsKCQkJCQkJb3V0cHV0X2VsLnZhbHVlID0gZGlzcGxheXNbaW5wdXRfZWwudmFsdWVBc051bWJlciAtIDFdCgkJCQkJfQoJCQkJCQoJCQkJCWlucHV0X2VsLmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgdXBkYXRlX291dHB1dCkKCQkJCQkvLyBXZSBhbHNvIHBvbGwgZm9yIGNoYW5nZXMgYmVjYXVzZSB0aGUgYGlucHV0X2VsLnZhbHVlYCBjYW4gY2hhbmdlIGZyb20gdGhlIG91dHNpZGUsIGUuZy4gaHR0cHM6Ly9naXRodWIuY29tL0p1bGlhUGx1dG8vUGx1dG9VSS5qbC9pc3N1ZXMvMjc3CgkJCQkJbGV0IGlkID0gc2V0SW50ZXJ2YWwodXBkYXRlX291dHB1dCwgMjAwKQoJCQkJCWludmFsaWRhdGlvbi50aGVuKCgpID0+IHsKCQkJCQkJY2xlYXJJbnRlcnZhbChpZCkKCQkJCQkJaW5wdXRfZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCB1cGRhdGVfb3V0cHV0KQoJCQkJCX0pCgkJCQkJPC9zY3JpcHQ+PG91dHB1dCBzdHlsZT0nCgkJCQkJCWZvbnQtZmFtaWx5OiBzeXN0ZW0tdWk7CiAgICAJCQkJCWZvbnQtc2l6ZTogMTVweDsKICAgIAkJCQkJbWFyZ2luLWxlZnQ6IDNweDsKICAgIAkJCQkJdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC00cHgpOwogICAgCQkJCQlkaXNwbGF5OiBpbmxpbmUtYmxvY2s7Jz4zLjA8L291dHB1dD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdmeHBiYWxmbG1zJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZnhwYmFsZmxtcyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHVmZ2x6enF0cicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0neSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0neScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgeWAiPnk8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0neSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0na2V3Z3d2dXRjZicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAxJyB2YWx1ZT0nNTEnPjxzY3JpcHQ+CgkJCQkJY29uc3QgaW5wdXRfZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQkJCQljb25zdCBvdXRwdXRfZWwgPSBjdXJyZW50U2NyaXB0Lm5leHRFbGVtZW50U2libGluZwoJCQkJCWNvbnN0IGRpc3BsYXlzID0gWyIwLjAiLCAiMC4xIiwgIjAuMiIsICIwLjMiLCAiMC40IiwgIjAuNSIsICIwLjYiLCAiMC43IiwgIjAuOCIsICIwLjkiLCAiMS4wIiwgIjEuMSIsICIxLjIiLCAiMS4zIiwgIjEuNCIsICIxLjUiLCAiMS42IiwgIjEuNyIsICIxLjgiLCAiMS45IiwgIjIuMCIsICIyLjEiLCAiMi4yIiwgIjIuMyIsICIyLjQiLCAiMi41IiwgIjIuNiIsICIyLjciLCAiMi44IiwgIjIuOSIsICIzLjAiLCAiMy4xIiwgIjMuMiIsICIzLjMiLCAiMy40IiwgIjMuNSIsICIzLjYiLCAiMy43IiwgIjMuOCIsICIzLjkiLCAiNC4wIiwgIjQuMSIsICI0LjIiLCAiNC4zIiwgIjQuNCIsICI0LjUiLCAiNC42IiwgIjQuNyIsICI0LjgiLCAiNC45IiwgIjUuMCIsICI1LjEiLCAiNS4yIiwgIjUuMyIsICI1LjQiLCAiNS41IiwgIjUuNiIsICI1LjciLCAiNS44IiwgIjUuOSIsICI2LjAiLCAiNi4xIiwgIjYuMiIsICI2LjMiLCAiNi40IiwgIjYuNSIsICI2LjYiLCAiNi43IiwgIjYuOCIsICI2LjkiLCAiNy4wIiwgIjcuMSIsICI3LjIiLCAiNy4zIiwgIjcuNCIsICI3LjUiLCAiNy42IiwgIjcuNyIsICI3LjgiLCAiNy45IiwgIjguMCIsICI4LjEiLCAiOC4yIiwgIjguMyIsICI4LjQiLCAiOC41IiwgIjguNiIsICI4LjciLCAiOC44IiwgIjguOSIsICI5LjAiLCAiOS4xIiwgIjkuMiIsICI5LjMiLCAiOS40IiwgIjkuNSIsICI5LjYiLCAiOS43IiwgIjkuOCIsICI5LjkiLCAiMTAuMCJdCgoJCQkJCWxldCB1cGRhdGVfb3V0cHV0ID0gKCkgPT4gewoJCQkJCQlvdXRwdXRfZWwudmFsdWUgPSBkaXNwbGF5c1tpbnB1dF9lbC52YWx1ZUFzTnVtYmVyIC0gMV0KCQkJCQl9CgkJCQkJCgkJCQkJaW5wdXRfZWwuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCB1cGRhdGVfb3V0cHV0KQoJCQkJCS8vIFdlIGFsc28gcG9sbCBmb3IgY2hhbmdlcyBiZWNhdXNlIHRoZSBgaW5wdXRfZWwudmFsdWVgIGNhbiBjaGFuZ2UgZnJvbSB0aGUgb3V0c2lkZSwgZS5nLiBodHRwczovL2dpdGh1Yi5jb20vSnVsaWFQbHV0by9QbHV0b1VJLmpsL2lzc3Vlcy8yNzcKCQkJCQlsZXQgaWQgPSBzZXRJbnRlcnZhbCh1cGRhdGVfb3V0cHV0LCAyMDApCgkJCQkJaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJCQkJCQljbGVhckludGVydmFsKGlkKQoJCQkJCQlpbnB1dF9lbC5yZW1vdmVFdmVudExpc3RlbmVyKCJpbnB1dCIsIHVwZGF0ZV9vdXRwdXQpCgkJCQkJfSkKCQkJCQk8L3NjcmlwdD48b3V0cHV0IHN0eWxlPScKCQkJCQkJZm9udC1mYW1pbHk6IHN5c3RlbS11aTsKICAgIAkJCQkJZm9udC1zaXplOiAxNXB4OwogICAgCQkJCQltYXJnaW4tbGVmdDogM3B4OwogICAgCQkJCQl0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTRweCk7CiAgICAJCQkJCWRpc3BsYXk6IGlubGluZS1ibG9jazsnPjUuMDwvb3V0cHV0PjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2tld2d3dnV0Y2YnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJrZXdnd3Z1dGNmIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0nbHVmZ2x6enF0cic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImx1ZmdsenpxdHIiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIE5hbWVkVHVwbGUiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCQkJZmxleDogMTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0neGJodm51b3ViZyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInhiaHZudW91YmciCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J2F1dHN6Y2xtbWUnPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgogICAgICAgIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewogICAgY3Vyc29yOiBwb2ludGVyOwogICAgLS1zaXplOiAxNXB4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIGJhY2tncm91bmQ6ICNjNmM2YzY7CiAgICBvdXRsaW5lOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgbWFyZ2luOiAwIDEwcHg7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKICAgIGJhY2tncm91bmQ6ICM0QkQ4NjU7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewogICAgY29udGVudDogJyc7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgdG9wOiAwcHg7CiAgICBsZWZ0OiAwcHg7CiAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgdHJhbnNpdGlvbjogLjFzOwp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewogICAgbGVmdDogdmFyKC0tc2l6ZSkKfQkJCgk8L3N0eWxlPgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSdvZ2FyYWNieGNrJz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiYXRhbih5LHgpIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgoKICAgIDxzY3JpcHQ+CiAgICAgICAgY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CiAgICAgICAgY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KICAgICAgICBjb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwogICAgICAgIAogICAgICAgIC8vIFRoaXMgaXMgdGhlIGVsZW1lbnQgb2YgdGhlIHNlbGVjdCBkcm9wZG93bgogICAgICAgIGNvbnN0IHNlbGVjdCA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCJzZWxlY3QiKQoKICAgICAgICAvLyBUaGlzIHdpbGwgaG9sZCB0aGUgY3VycmVudGx5IHNlbGVjdGVkIHN0cnVjdGJvbmQgZWxlbWVudAogICAgICAgIGxldCBzZWxlY3RlZAoKICAgICAgICBjb25zdCB1cGRhdGUgPSAoKSA9PiB7CiAgICAgICAgICAgIHBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldF9zZWxlY3RfdmFsdWUoKSB7CiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZ2V0X2lucHV0X3ZhbHVlKHNlbGVjdCkKICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHZhbHVlLnN1YnN0cmluZygxMCkpCiAgICAgICAgfQoKICAgICAgICBjb25zdCBjaGFuZ2Vfc2VsZWN0aW9uID0gKHZhbHVlLCB0cmlnZ2VyX2V2ZW50ID0gdHJ1ZSkgPT4gewogICAgICAgICAgICBzZXRfaW5wdXRfdmFsdWUoc2VsZWN0LCBgcHVpc2VsZWN0LSR7dmFsdWV9YCkKICAgICAgICAgICAgY29uc3QgYm9uZHMgPSBwYXJlbnQucXVlcnlTZWxlY3RvckFsbCgic3RydWN0LWJvbmQiKQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJvbmRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoaSAhPSB2YWx1ZSAtIDEpIHsKICAgICAgICAgICAgICAgICAgICBib25kc1tpXS5jbGFzc0xpc3QudG9nZ2xlKCJoaWRkZW4iLCB0cnVlKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBib25kc1tpXS5jbGFzc0xpc3QudG9nZ2xlKCJoaWRkZW4iLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZCA9IGJvbmRzW2ldCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRyaWdnZXJfZXZlbnQpIHsKICAgICAgICAgICAgICAgIHVwZGF0ZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNoYW5nZV9zZWxlY3Rpb24oZ2V0X3NlbGVjdF92YWx1ZSgpLCBmYWxzZSkKCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgInZhbHVlIiwgewogICAgICAgICAgICBnZXQ6ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZ2V0X3NlbGVjdF92YWx1ZSgpCiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGdldF9pbnB1dF92YWx1ZShzZWxlY3RlZCkKICAgICAgICAgICAgICAgIHJldHVybiBbaW5kZXgsIHZhbHVlXQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXQ6IChuZXd2YWwpID0+IHsKICAgICAgICAgICAgICAgIGNoYW5nZV9zZWxlY3Rpb24obmV3dmFsWzBdLCBmYWxzZSkKICAgICAgICAgICAgICAgIHNldF9pbnB1dF92YWx1ZShzZWxlY3RlZCwgbmV3dmFsWzFdKQogICAgICAgICAgICB9LAogICAgICAgIH0pCgogICAgICAgIC8vIFdlIGFkZCBhIGxpc3RlbmVyIHRoYXQgZXh0cmFjdCB0aGUgZm9yd2FyZCB0aGUgaW5wdXQgZXZlbnQgaW4gY2FzZSB0aGUgdGFyZ2V0IG9mIHRoZSBldmVudCBpcyB0aGUgc2VsZWN0ZWQgYm9uZAogICAgICAgIGZvciAobGV0IGJvbmQgb2YgcGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoInN0cnVjdC1ib25kIikpIHsKICAgICAgICAgICAgYm9uZC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpCiAgICAgICAgICAgICAgICBpZiAoYm9uZCA9PSBzZWxlY3RlZCkgewogICAgICAgICAgICAgICAgICAgIHVwZGF0ZSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQoKICAgICAgICBzZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCAoZSkgPT4gewogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpCiAgICAgICAgICAgIGNoYW5nZV9zZWxlY3Rpb24oZ2V0X3NlbGVjdF92YWx1ZSgpKQogICAgICAgIH0pCiAgICA8L3NjcmlwdD4KICAgIDxzdHlsZT4KICAgICAgICBzdHJ1Y3Rib25kLXNlbGVjdCB0b2dnbGVyZWFjdGl2ZS1jb250YWluZXI6Zmlyc3Qtb2YtdHlwZS5uby1wb3BvdXQ6YmVmb3JlIHsKICBkaXNwbGF5OiBub25lOwp9CgpzdHJ1Y3Rib25kLXNlbGVjdCA+IHN0cnVjdC1ib25kLmhpZGRlbiB7CiAgZGlzcGxheTogbm9uZTsKfQoKc3RydWN0Ym9uZC1zZWxlY3QsCnN0cnVjdGJvbmQtc2VsZWN0ID4gc3RydWN0LWJvbmQsCnN0cnVjdGJvbmQtc2VsZWN0IHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciB7CiAgZGlzcGxheTogY29udGVudHM7Cn0KCnN0cnVjdGJvbmQtc2VsZWN0ID4gLnNlbGVjdG9yIHsKICBkaXNwbGF5OiBjb250ZW50czsKfQoKc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3IgLmRlc2NyaXB0aW9uIHsKICBjb2xvcjogdmFyKC0tcGx1dG8tb3V0cHV0LWNvbG9yLCAjNDA0MDQwKTsKfQoKc3RydWN0Ym9uZC1zZWxlY3QgPnN0cnVjdC1ib25kPnRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj50b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewogIGRpc3BsYXk6IG5vbmU7Cn0KCnN0cnVjdGJvbmQtc2VsZWN0ID4gLnNlbGVjdG9yIHNlbGVjdCB7CiAgICBwYWRkaW5nOiA2cHggMTJweDsKICAgIGJvcmRlcjogMnB4IHNvbGlkICNlN2U3ZTc7CiAgICBib3JkZXItcmFkaXVzOiA2cHg7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CiAgICBjb2xvcjogdmFyKC0tcGx1dG8tb3V0cHV0LWNvbG9yLCAjNDA0MDQwKTsKICAgIGZvbnQtZmFtaWx5OiBpbmhlcml0OwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgb3V0bGluZTogbm9uZTsKICAgIHRyYW5zaXRpb246IGJvcmRlci1jb2xvciAwLjJzOwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgCiAgICAvKiBTaXplIGNvbnN0cmFpbnRzICovCiAgICBtYXgtd2lkdGg6IDUwcHg7IAogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgIAogICAgLyogQ3VzdG9tIGFycm93IHN0eWxpbmcgKi8KICAgIGFwcGVhcmFuY2U6IG5vbmU7CiAgICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7CiAgICAtbW96LWFwcGVhcmFuY2U6IG5vbmU7CiAgICAvKiBMaWdodCBtb2RlIGFycm93IC0gIzQwNDA0MCAqLwogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJkYXRhOmltYWdlL3N2Zyt4bWw7Y2hhcnNldD1VVEYtOCwlM2NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgMjQgMjQnIGZpbGw9J25vbmUnIHN0cm9rZT0nJTIzNDA0MDQwJyBzdHJva2Utd2lkdGg9JzInIHN0cm9rZS1saW5lY2FwPSdyb3VuZCcgc3Ryb2tlLWxpbmVqb2luPSdyb3VuZCclM2UlM2Nwb2x5bGluZSBwb2ludHM9JzYgOSAxMiAxNSAxOCA5JyUzZSUzYy9wb2x5bGluZSUzZSUzYy9zdmclM2UiKTsKICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiByaWdodCA4cHggY2VudGVyOwogICAgYmFja2dyb3VuZC1zaXplOiAxNnB4OwogICAgcGFkZGluZy1yaWdodDogMzJweDsKICAgIG1pbi13aWR0aDogMTIwcHg7Cn0KCnN0cnVjdGJvbmQtc2VsZWN0ID4gLnNlbGVjdG9yIHNlbGVjdDpob3ZlciB7CiAgICBib3JkZXItY29sb3I6ICNkMGQwZDA7Cn0KCnN0cnVjdGJvbmQtc2VsZWN0ID4gLnNlbGVjdG9yIHNlbGVjdDpmb2N1cyB7CiAgICBib3JkZXItY29sb3I6ICNjMGMwYzA7Cn0KCkBtZWRpYSAocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspIHsKICAgIHN0cnVjdGJvbmQtc2VsZWN0ID4gLnNlbGVjdG9yIHNlbGVjdCB7CiAgICAgICAgYm9yZGVyLWNvbG9yOiAjN2Q3ZDdkOwogICAgICAgIGNvbG9yOiB2YXIoLS1wbHV0by1vdXRwdXQtY29sb3IsICNjNGM0YzQpOwogICAgICAgIC8qIERhcmsgbW9kZSBhcnJvdyAtICNjNGM0YzQgKi8KICAgICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoImRhdGE6aW1hZ2Uvc3ZnK3htbDtjaGFyc2V0PVVURi04LCUzY3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCcgZmlsbD0nbm9uZScgc3Ryb2tlPSclMjNjNGM0YzQnIHN0cm9rZS13aWR0aD0nMicgc3Ryb2tlLWxpbmVjYXA9J3JvdW5kJyBzdHJva2UtbGluZWpvaW49J3JvdW5kJyUzZSUzY3BvbHlsaW5lIHBvaW50cz0nNiA5IDEyIDE1IDE4IDknJTNlJTNjL3BvbHlsaW5lJTNlJTNjL3N2ZyUzZSIpOwogICAgfQogICAgCiAgICBzdHJ1Y3Rib25kLXNlbGVjdCA+IC5zZWxlY3RvciBzZWxlY3Q6aG92ZXIgewogICAgICAgIGJvcmRlci1jb2xvcjogIzhhOGE4YTsKICAgIH0KICAgIAogICAgc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3Igc2VsZWN0OmZvY3VzIHsKICAgICAgICBib3JkZXItY29sb3I6ICM3ZDdkN2Q7CiAgICB9Cn0KCi8qIEFkZCBzdHlsaW5nIGZvciBkcm9wZG93biBvcHRpb25zICovCnN0cnVjdGJvbmQtc2VsZWN0ID4gLnNlbGVjdG9yIHNlbGVjdCBvcHRpb24gewogICAgdGV4dC1hbGlnbjogY2VudGVyOwp9Cgp0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuc3RydWN0Ym9uZC1zZWxlY3QgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyOmJlZm9yZSB7CiAgY29udGVudDogIiI7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDFweDsKICBib3R0b206IDBweDsKICBsZWZ0OiAwcHg7CiAgcmlnaHQ6IDBweDsKICB6LWluZGV4OiAtMTsKICBiYWNrZ3JvdW5kOiAjYzhlZGQ1OyAgCn0KCnRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5zdHJ1Y3Rib25kLXNlbGVjdCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICB6LWluZGV4OiAxMDsKfQoKQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewogIHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5zdHJ1Y3Rib25kLXNlbGVjdCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXI6YmVmb3JlIHsKICAgIGJhY2tncm91bmQ6ICMyNjU4MmU7ICAKICB9Cn0KICAgIDwvc3R5bGU+Cjwvc3RydWN0Ym9uZC1zZWxlY3Q+CjwvcGwtY29tYmluZWQtY2hpbGQ+CgkJCgk8c2NyaXB0PgoJCWNvbnN0IHRyYyA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgndG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyJykKCQljb25zdCBoZWFkZXIgPSB0cmMuZmlyc3RFbGVtZW50Q2hpbGQKCQljb25zdCBkZXNjID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgIlVzZSB0aGUgc2VsZWN0b3IgdG8gY2hvb3NlIHdoaWNoIFN0cnVjdEJvbmQgdG8gZGlzcGxheSBhbmQgdXNlLiIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJCQlmbGV4OiAxOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd6cHNjY3lybmN1Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAienBzY2N5cm5jdSIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0ndXpld3Blbnpmbyc+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+CiAgICAgICAgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAtLXNpemU6IDE1cHg7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBhcHBlYXJhbmNlOiBub25lOwogICAgYmFja2dyb3VuZDogI2M2YzZjNjsKICAgIG91dGxpbmU6IG5vbmU7CiAgICBib3JkZXItcmFkaXVzOiBjYWxjKHZhcigtLXNpemUpLzIpOwogICAgYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICBtYXJnaW46IDAgMTBweDsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewogICAgYmFja2dyb3VuZDogIzRCRDg2NTsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CiAgICBjb250ZW50OiAnJzsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB0b3A6IDBweDsKICAgIGxlZnQ6IDBweDsKICAgIGJhY2tncm91bmQ6ICNmZmY7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CiAgICBib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICB0cmFuc2l0aW9uOiAuMXM7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CiAgICBsZWZ0OiB2YXIoLS1zaXplKQp9CQkKCTwvc3R5bGU+CjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgo8L2JvbmQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L3BvcG91dC1jb250ZW50cz4KPC9wb3BvdXQtY29udGFpbmVyPgo8c2NyaXB0IGlkPSdyYnVubHVhaW1yJz4KCS8vIExvYWQgdGhlIGZsb2F0aW5nLXVpIGFuZCBpbnRlcmFjdCBsaWJyYXJpZXMKCXdpbmRvdy5mbG9hdGluZ191aSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvQGZsb2F0aW5nLXVpL2RvbScpCgoJY29uc3QgeyBjb21wdXRlUG9zaXRpb24sIGF1dG9QbGFjZW1lbnQgfSA9IGZsb2F0aW5nX3VpCgkKCWNvbnN0IGNvbnRhaW5lciA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJY29uc3QgaGVhZGVyID0gY29udGFpbmVyLmZpcnN0RWxlbWVudENoaWxkCgljb25zdCBjb250ZW50cyA9IGNvbnRhaW5lci5sYXN0RWxlbWVudENoaWxkCgoJLy8gTG9hZCB0aGUgaW50ZXJhY3RqcyBwYXJ0CgkJLy8gV2UgdXNlIHRoZSBpbnRlcmFjdGpzIGxpYnJhcnkgdG8gcHJvdmlkZSBkcmFnIGFuZCByZXNpemUgaGFuZGxpbmcgYWNyb3NzIGRldmljZXMKCWNvbnN0IHsgZGVmYXVsdDogaW50ZXJhY3QgfSA9IGF3YWl0IGltcG9ydCgnaHR0cHM6Ly9lc20uc2gvaW50ZXJhY3RqcycpCgoJY29udGVudHMub2Zmc2V0ID0gY29udGVudHMub2Zmc2V0ID8/IHsgeDogMCwgeTogMH0KCWNvbnN0IHN0YXJ0UG9zaXRpb24gPSB7eDogMCwgeTogMH0KCWludGVyYWN0KGNvbnRlbnRzLnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAuZGVzY3JpcHRpb24sIGJvbmRzbGlzdC1oZWFkZXIgLmRlc2NyaXB0aW9uJykpLmRyYWdnYWJsZSh7CgkJbGlzdGVuZXJzOiB7CgkJCXN0YXJ0IChldmVudCkgewoJCQkJY29udGVudHMub2Zmc2V0LnkgPSBzdGFydFBvc2l0aW9uLnkgPSBjb250ZW50cy5vZmZzZXRUb3AKCQkJCWNvbnRlbnRzLm9mZnNldC54ID0gc3RhcnRQb3NpdGlvbi54ID0gY29udGVudHMub2Zmc2V0TGVmdAoJCQl9LAoJCQltb3ZlIChldmVudCkgewoJCSAgICAgIGNvbnRlbnRzLm9mZnNldC54ICs9IGV2ZW50LmR4CgkJICAgICAgY29udGVudHMub2Zmc2V0LnkgKz0gZXZlbnQuZHkKCQkKCQkgICAgICBjb250ZW50cy5zdHlsZS50b3AgPSBgbWluKDk1dmgsICR7Y29udGVudHMub2Zmc2V0Lnl9cHhgCgkJICAgICAgY29udGVudHMuc3R5bGUubGVmdCA9IGBtaW4oOTV2dywgJHtjb250ZW50cy5vZmZzZXQueH1weGAKCQkgICAgfSwKCQl9Cgl9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIGhlYWRlciByZXNldCB0aGUgcG9zaXRpb24KCQljb250YWluZXIucG9wb3V0KCkKCX0pCglpbnRlcmFjdChjb250ZW50cykKCSAgLnJlc2l6YWJsZSh7CgkgICAgZWRnZXM6IHsgdG9wOiB0cnVlLCBsZWZ0OiBmYWxzZSwgYm90dG9tOiB0cnVlLCByaWdodDogdHJ1ZSB9LAoJICAgIGxpc3RlbmVyczogewoJICAgICAgbW92ZTogZnVuY3Rpb24gKGV2ZW50KSB7CQkKCSAgICAgICAgT2JqZWN0LmFzc2lnbihldmVudC50YXJnZXQuc3R5bGUsIHsKCSAgICAgICAgICB3aWR0aDogYCR7ZXZlbnQucmVjdC53aWR0aH1weGAsCgkgICAgICAgICAgaGVpZ2h0OiBgJHtldmVudC5yZWN0LmhlaWdodH1weGAsCgkgICAgICAgIH0pCgkgICAgICB9CgkgICAgfQoJICB9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIHJlc2l6ZSByZXNldCB0aGUgd2lkdGgKCQkJY29udGVudHMuc3R5bGUud2lkdGggPSAnJwoJCSAgCWNvbnRlbnRzLnN0eWxlLmhlaWdodCA9ICcnCgkgIH0pCgoKCWZ1bmN0aW9uIHBvc2l0aW9uQ29udGVudHMoKSB7CgkJY29tcHV0ZVBvc2l0aW9uKGhlYWRlciwgY29udGVudHMsIHsKCQkJc3RyYXRlZ3k6ICJmaXhlZCIsCgkJCW1pZGRsZXdhcmU6IFthdXRvUGxhY2VtZW50KCldLAoJCX0pLnRoZW4oKHBvcykgPT4gewoJCQljb250ZW50cy5zdHlsZS5sZWZ0ID0gcG9zLnggKyAicHgiCgkJCWNvbnRlbnRzLnN0eWxlLnRvcCA9IHBvcy55ICsgInB4IgoJCX0pCgl9CgoJY29udGFpbmVyLnBvcG91dCA9IChmb3JjZSA9IHVuZGVmaW5lZCkgPT4gewoJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdwb3BwZWQnLCBmb3JjZSkKCQlwb3NpdGlvbkNvbnRlbnRzKCkKCX0KCgloZWFkZXIub25jbGljayA9IChlKSA9PiB7Y29udGFpbmVyLnBvcG91dCgpfQoKCWNvbnRlbnRzLm9ubW91c2VlbnRlciA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29udGVudHMtaG92ZXInLCB0cnVlKQoJY29udGVudHMub25tb3VzZWxlYXZlID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb250ZW50cy1ob3ZlcicsIGZhbHNlKQoKCWhlYWRlci5vbm1vdXNlZW50ZXIgPSAoZSkgPT4gewoJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItaG92ZXInLCB0cnVlKQoJCWNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHBlZCcpID8gbnVsbCA6IHBvc2l0aW9uQ29udGVudHMoKQoJfQoJaGVhZGVyLm9ubW91c2VsZWF2ZSA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLWhvdmVyJywgZmFsc2UpCjwvc2NyaXB0Pgo8c3R5bGU+Cglwb3BvdXQtaGVhZGVyIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBib3JkZXI6IDNweCBkYXNoZWQgdHJhbnNwYXJlbnQ7CiAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7Cn0KcG9wb3V0LWNvbnRlbnRzIHsKICAgIGRpc3BsYXk6IG5vbmU7CiAgICB3aWR0aDogNDAwcHg7CiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CiAgICBib3JkZXI6IDNweCBzb2xpZCB2YXIoLS1vdmVybGF5LWJ1dHRvbi1ib3JkZXIpOwogICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgIHBhZGRpbmc6IDhweDsKfQpwb3BvdXQtY29udGFpbmVyLnBvcHBlZCA+IHBvcG91dC1jb250ZW50cywKcG9wb3V0LWNvbnRhaW5lci5oZWFkZXItaG92ZXIgPiBwb3BvdXQtY29udGVudHMgewogICAgZGlzcGxheTogYmxvY2s7CiAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICB6LWluZGV4OiA1MDA7Cn0KcG9wb3V0LWNvbnRhaW5lci5jb250ZW50cy1ob3ZlciA+IHBvcG91dC1oZWFkZXIgewogICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1wbHV0by1sb2dzLXdhcm4tYWNjZW50LWNvbG9yKTsKfQoucG9wb3V0LWljb24gewogICAgLS1zaXplOiAyMHB4OwogICAgZGlzcGxheTogYmxvY2s7CiAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwogICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CiAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CiAgICBtaW4taGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7Cn0KLnBvcG91dC1pY29uLnBvcG91dCB7CQogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvZXhwYW5kLnN2Zyk7Cn0KcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgLnBvcG91dCB7CiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jb250cmFjdC5zdmcpOwp9CnBvcG91dC1jb250YWluZXIucG9wcGVkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CiAgICB0b3VjaC1hY3Rpb246IG5vbmU7CiAgICB1c2VyLXNlbGVjdDogbm9uZTsKfQo8L3N0eWxlPgo8c2NyaXB0IGlkPSdpcmNmdXhrc3Z0Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiaXJjZnV4a3N2dCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPgoJPC9ib25kLXZhbHVlPgoJPHN0eWxlPgoJCWJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CiAgZGlzcGxheTogZ3JpZDsKICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAwLjRmcik7CiAgZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwogIGp1c3RpZnktaXRlbXM6IGNlbnRlcjsKfQpib25kdGFibGUtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uLApib25kc2xpc3QtY29udGVudHMgYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKICBkaXNwbGF5OiBjb250ZW50czsKfQpib25kLXZhbHVlIGJvbmQgewogIGRpc3BsYXk6IGZsZXg7IC8qIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQgKi8KfQpib25kLXZhbHVlIGlucHV0IHsKICB3aWR0aDogMTAwJTsgLyogTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dCAqLwp9CgoJPC9zdHlsZT4KPC9ib25kLXdpdGgtZGVzY3JpcHRpb24+CgkKCTwvYm9uZHNsaXN0LWNvbnRlbnRzPgoJPHNjcmlwdCBpZD0ncWtrdXp6bG5nYyc+CgkJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29udGFpbmVyLmNvbGxhcHNlID0gKGZvcmNlKSA9PiB7CgkJCWNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnLCBmb3JjZSkKCQl9CgkJY29uc3QgY29sbGFwc2VfYnRuID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4uY29sbGFwc2UnKQoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IGNvbnRhaW5lci5jb2xsYXBzZSgpCgk8L3NjcmlwdD4KCTxzdHlsZT4KCWJvbmRzbGlzdC1oZWFkZXIgewogIGdyaWQtY29sdW1uOiAxIC8gLTE7CiAgZGlzcGxheTogZmxleDsKICBiYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7Cn0KYm9uZHNsaXN0LWhlYWRlcjpiZWZvcmUgewogIGNvbnRlbnQ6ICIiOwogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAxcHg7CiAgYm90dG9tOiAwcHg7CiAgbGVmdDogMHB4OwogIHJpZ2h0OiAwcHg7CiAgei1pbmRleDogLTE7CiAgYmFja2dyb3VuZDogI2ZmYWM0NTQwOwp9CmJvbmRzbGlzdC1jb250YWluZXIubm8tcG9wb3V0ID4gYm9uZHNsaXN0LWhlYWRlciB7CiAgYWxpZ24tc2VsZjogc3RhcnQ7CiAgcG9zaXRpb246IHN0aWNreTsKICB0b3A6IDBweDsKICBwYWRkaW5nLXRvcDogMTJweDsKICBtYXJnaW4tdG9wOiAtMTJweDsKICB6LWluZGV4OiAxMDsKfQpib25kc2xpc3QtY29udGVudHMgewogIGRpc3BsYXk6IGNvbnRlbnRzOwp9CmJvbmRzbGlzdC1jb250YWluZXIubm8tcG9wb3V0OmJlZm9yZSB7CiAgY29udGVudDogIiI7CiAgZGlzcGxheTogYmxvY2s7CiAgZ3JpZC1jb2x1bW46IDEgLyAtMTsKICBqdXN0aWZ5LXNlbGY6IGNlbnRlcjsKICBib3JkZXItYm90dG9tOiAycHggc29saWQ7CiAgcGFkZGluZy10b3A6IDVweDsKICB3aWR0aDogMTAwJTsKICBhbGlnbi1zZWxmOiBzdGFydDsKICBwb3NpdGlvbjogc3RpY2t5OwogIHRvcDogMHB4OwogIGJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICB6LWluZGV4OiAyMDsKfQpib25kc2xpc3QtaGVhZGVyID4gLmJvbmRzbGlzdC1pY29uIHsKICAtLXNpemU6IDE3cHg7CiAgZGlzcGxheTogYmxvY2s7CiAgYWxpZ24tc2VsZjogc3RyZXRjaDsKICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwogIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CiAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwogIHdpZHRoOiB2YXIoLS1zaXplKTsKICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwp9CmJvbmRzbGlzdC1oZWFkZXIgPiAuY29sbGFwc2UgewogIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwogIGN1cnNvcjogcG9pbnRlcjsKfQpib25kc2xpc3QtY29udGFpbmVyLmNvbGxhcHNlZCA+IGJvbmRzbGlzdC1oZWFkZXIgPiAuY29sbGFwc2UgewogIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwp9CmJvbmRzbGlzdC1oZWFkZXIgPiAudG9nZ2xlIHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgd2lkdGg6IDMwcHg7CiAgbWFyZ2luOiAwIDEwcHg7Cn0KYm9uZHNsaXN0LWhlYWRlciB7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogc3RyZXRjaDsKICB3aWR0aDogMTAwJTsKfQpib25kc2xpc3QtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgZmxleC1ncm93OiAxOwogIGZvbnQtc2l6ZTogMThweDsKICBmb250LXdlaWdodDogNjAwOwp9CmJvbmRzbGlzdC1oZWFkZXIgPiAudG9nZ2xlIHsKICBhbGlnbi1zZWxmOiBjZW50ZXI7Cn0KYm9uZHNsaXN0LWNvbnRhaW5lci5jb2xsYXBzZWQgYm9uZHNsaXN0LWhlYWRlciArICogewogIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKfQpib25kc2xpc3QtY29udGFpbmVyIHsKICBkaXNwbGF5OiBncmlkOwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIDAuNGZyKTsKICBncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CiAganVzdGlmeS1pdGVtczogY2VudGVyOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgcm93LWdhcDogNXB4Owp9CmJvbmRzdGFibGUtY29udGFpbmVyIGJvbmRzbGlzdC1jb250YWluZXIgewogIGRpc3BsYXk6IGNvbnRlbnRzOwp9CgkJCgk8L3N0eWxlPgo8L2JvbmRzbGlzdC1jb250YWluZXI+CgoJCTwvYm9uZHRhYmxlLWNvbnRlbnRzPgoJPC9ib25kdGFibGUtY29udGFpbmVyPgoJPHNjcmlwdCBpZD0nZmVlYmRjYWRmYic+CgkJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvbmR0YWJsZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IGNvbnRhaW5lci5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGNvbnRlbnRzID0gY29udGFpbmVyLmxhc3RFbGVtZW50Q2hpbGQKCgkJY29uc3QgY2VsbCA9IGNvbnRhaW5lci5jbG9zZXN0KCdwbHV0by1jZWxsJykKCiAgICAgICAgLy8gVGhpcyBpcyBvbmx5IHVzZWQgdG8gbGV2ZXJhZ2UgdGhlIHBsdXRvIGpzIGZ1bmN0aW9uYWxpdHkgZm9yIHBlcnNpc3RlbmN5IGluIEpTCiAgICAgICAgY29uc3QgcmV0dXJuX2VsZW1lbnQgPSB0aGlzID8/IGh0bWxgPHNwYW4gY2xhc3M9J3NjcmlwdC1yZXR1cm4nPjwvc3Bhbj5gCgogICAgICAgIGlmIChyZXR1cm5fZWxlbWVudC5jb2xsYXBzZWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm5fZWxlbWVudC5jb2xsYXBzZWQgPSB1bmRlZmluZWQgPz8gZmFsc2UKICAgICAgICB9CgoJCWNvbnN0IGhlbHBfYnRuID0gaGVhZGVyLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaGVhZGVyLmxhc3RFbGVtZW50Q2hpbGQKCgkJY29udGFpbmVyLmNvbGxhcHNlID0gKGZvcmNlKSA9PiB7CiAgICAgICAgICAgIHJldHVybl9lbGVtZW50LmNvbGxhcHNlZCA9IGZvcmNlID8/ICFyZXR1cm5fZWxlbWVudC5jb2xsYXBzZWQKCQkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcsIHJldHVybl9lbGVtZW50LmNvbGxhcHNlZCkKCQl9CiAgICAgICAgLy8gRm9yY2UgdGhlIGluaXRpYWwgc3RhdHVzCiAgICAgICAgY29udGFpbmVyLmNvbGxhcHNlKHJldHVybl9lbGVtZW50LmNvbGxhcHNlZCkKCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSBlID0+IGNvbnRhaW5lci5jb2xsYXBzZSgpCgoJCS8vIExvYWQgdGhlIGludGVyYWN0IHNjcmlwdAoJCQkvLyBXZSB1c2UgdGhlIGludGVyYWN0anMgbGlicmFyeSB0byBwcm92aWRlIGRyYWcgYW5kIHJlc2l6ZSBoYW5kbGluZyBhY3Jvc3MgZGV2aWNlcwoJY29uc3QgeyBkZWZhdWx0OiBpbnRlcmFjdCB9ID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9pbnRlcmFjdGpzJykKCgljb250YWluZXIub2Zmc2V0ID0gY29udGFpbmVyLm9mZnNldCA/PyB7IHg6IDAsIHk6IDB9Cgljb25zdCBzdGFydFBvc2l0aW9uID0ge3g6IDAsIHk6IDB9CglpbnRlcmFjdChjb250YWluZXIucXVlcnlTZWxlY3RvcignYm9uZHRhYmxlLWhlYWRlciAuZGVzY3JpcHRpb24nKSkuZHJhZ2dhYmxlKHsKCQlsaXN0ZW5lcnM6IHsKCQkJc3RhcnQgKGV2ZW50KSB7CgkJCQljb250YWluZXIub2Zmc2V0LnkgPSBzdGFydFBvc2l0aW9uLnkgPSBjb250YWluZXIub2Zmc2V0VG9wCgkJCQljb250YWluZXIub2Zmc2V0LnggPSBzdGFydFBvc2l0aW9uLnggPSBjb250YWluZXIub2Zmc2V0TGVmdAoJCQl9LAoJCQltb3ZlIChldmVudCkgewoJCSAgICAgIGNvbnRhaW5lci5vZmZzZXQueCArPSBldmVudC5keAoJCSAgICAgIGNvbnRhaW5lci5vZmZzZXQueSArPSBldmVudC5keQoJCQoJCSAgICAgIGNvbnRhaW5lci5zdHlsZS50b3AgPSBgbWluKDk1dmgsICR7Y29udGFpbmVyLm9mZnNldC55fXB4YAoJCSAgICAgIGNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gYG1pbig5NXZ3LCAke2NvbnRhaW5lci5vZmZzZXQueH1weGAKCQkgICAgfSwKCQl9Cgl9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIGhlYWRlciByZXNldCB0aGUgcG9zaXRpb24KCQljb250YWluZXIuc3R5bGUudG9wID0gJycKCQljb250YWluZXIuc3R5bGUubGVmdCA9ICcnCgl9KQoJaW50ZXJhY3QoY29udGFpbmVyKQoJICAucmVzaXphYmxlKHsKCQlpZ25vcmVGcm9tOiAncG9wb3V0LWNvbnRhaW5lcicsCgkgICAgZWRnZXM6IHsgdG9wOiB0cnVlLCBsZWZ0OiBmYWxzZSwgYm90dG9tOiB0cnVlLCByaWdodDogdHJ1ZSB9LAoJICAgIGxpc3RlbmVyczogewoJICAgICAgbW92ZTogZnVuY3Rpb24gKGV2ZW50KSB7CQkKCSAgICAgICAgT2JqZWN0LmFzc2lnbihldmVudC50YXJnZXQuc3R5bGUsIHsKCSAgICAgICAgICB3aWR0aDogYCR7ZXZlbnQucmVjdC53aWR0aH1weGAsCgkgICAgICAgICAgaGVpZ2h0OiBgJHtldmVudC5yZWN0LmhlaWdodH1weGAsCgkJCSAgbWF4SGVpZ2h0OiAnbm9uZScsCgkgICAgICAgIH0pCgkgICAgICB9CgkgICAgfQoJICB9KS5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CgkJICAvLyBEb3VibGUtdGFwIG9uIHJlc2l6ZSByZXNldCB0aGUgd2lkdGgKCQkJY29udGFpbmVyLnN0eWxlLndpZHRoID0gJycKCQkgIAljb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gJycKCQkgIAljb250YWluZXIuc3R5bGUubWF4SGVpZ2h0ID0gJycKCSAgfSkKCgoJCS8vIE5vdyB3ZSBhc3NpZ24gYSBzcGVjaWZpYyBjbGFzcyB0byBhbGwgdG9nZ2xlLWNvbnRhaW5lciB0aGF0IGFyZSBkaXJlY3QgY2hpbGRyZW4KCQlmb3IgKGNvbnN0IHRyIG9mIGNvbnRlbnRzLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpKSB7CgkJCXRyLmNsb3Nlc3QoJ3BvcG91dC1jb250YWluZXInKSA/PyB0ci5jbGFzc0xpc3QudG9nZ2xlKCduby1wb3BvdXQnLCB0cnVlKQoJCX0KCQkvLyBXZSBhbHNvIGZsYWcgdGhlIGZpcnN0IHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBpbiB0aGUgdGFibGUKCQljb250ZW50cy5maXJzdEVsZW1lbnRDaGlsZC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIubm8tcG9wb3V0Jyk/LmNsYXNzTGlzdC50b2dnbGUoJ2ZpcnN0Jyx0cnVlKQoKCQkvLyBDbGljayB0byBnbyB0byBkZWZpbml0aW9uCgkJY29udGFpbmVyLmp1bXBUb0NlbGwgPSAoKSA9PiB7CgkJCWNlbGwuc2Nyb2xsSW50b1ZpZXcoKQoJCX0KCQloZWxwX2J0bi5vbmNsaWNrID0gY29udGFpbmVyLmp1bXBUb0NlbGwKCiAgICAgICAgcmV0dXJuIHJldHVybl9lbGVtZW50Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCWJvbmR0YWJsZS1jb250YWluZXIgewogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICB0b3A6IDUwcHg7CiAgICBsZWZ0OiAxMHB4OwogICAgYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwogICAgYm9yZGVyOiAzcHggc29saWQgI2U3ZTdlNzsKICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICBwYWRkaW5nLWxlZnQ6IDhweDsKICAgIHBhZGRpbmctdG9wOiA4cHg7CiAgICB6LWluZGV4OiA2MDA7CiAgICB3aWR0aDogNDAwcHg7CiAgICBtYXgtaGVpZ2h0OiA2MDBweDsKICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAzMDBtcyBjdWJpYy1iZXppZXIoMC4xOCwgMC44OSwgMC40NSwgMS4xMik7Cn0KYm9uZHRhYmxlLWNvbnRhaW5lcjpub3QoLmNvbGxhcHNlZCkgPiAqIHsKICAgIHBhZGRpbmctcmlnaHQ6IDhweDsKfQpib25kdGFibGUtY29udGVudHMgewogICAgZGlzcGxheTogZ3JpZDsKICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwogICAgZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwogICAganVzdGlmeS1pdGVtczogY2VudGVyOwogICAgcGFkZGluZy1ib3R0b206IDhweDsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICByb3ctZ2FwOiA1cHg7CiAgICBvdmVyZmxvdzogYXV0bzsKfQpib25kdGFibGUtY29udGVudHMgdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLm5vLXBvcG91dCwKYm9uZHRhYmxlLWNvbnRlbnRzID4gKiwgCmJvbmR0YWJsZS1jb250ZW50cyBzdHJ1Y3QtYm9uZCB7CiAgICBkaXNwbGF5OiBjb250ZW50cwp9CnRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5uby1wb3BvdXQ6YmVmb3JlIHsKICAgIGNvbnRlbnQ6ICcnOwogICAgZGlzcGxheTogYmxvY2s7CiAgICBncmlkLWNvbHVtbjogMSAvIC0xOwogICAganVzdGlmeS1zZWxmOiBjZW50ZXI7CiAgICBib3JkZXItYm90dG9tOiAycHggc29saWQ7CiAgICBwYWRkaW5nLXRvcDogNXB4OwogICAgd2lkdGg6IDEwMCU7CiAgICBhbGlnbi1zZWxmOiBzdGFydDsKICAgIHBvc2l0aW9uOiBzdGlja3k7CiAgICB0b3A6IDBweDsKICAgIGJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICAgIHotaW5kZXg6IDIwOwp9CnRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5uby1wb3BvdXQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewogICAgYWxpZ24tc2VsZjogc3RhcnQ7CiAgICBwb3NpdGlvbjogc3RpY2t5OwogICAgdG9wOiAwcHg7CiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1vdmVybGF5LWJ1dHRvbi1iZyk7CiAgICBwYWRkaW5nLXRvcDogMTJweDsKICAgIG1hcmdpbi10b3A6IC0xMnB4OwogICAgei1pbmRleDogMTA7Cn0KYm9uZHRhYmxlLWhlYWRlciB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAganVzdGlmeS1pdGVtczogc3RyZXRjaDsKfQpib25kdGFibGUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKICAgIGZsZXgtZ3JvdzogMTsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIGZvbnQtc2l6ZTogMjBweDsKICAgIGZvbnQtd2VpZ2h0OiA4MDA7CiAgICB0b3VjaC1hY3Rpb246IG5vbmU7CiAgICB1c2VyLXNlbGVjdDogbm9uZTsKfQpib25kdGFibGUtaGVhZGVyID4gLmljb24gewogICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKICAgIGN1cnNvcjogcG9pbnRlcjsKfQpib25kdGFibGUtaGVhZGVyIC50YWJsZS1jb2xsYXBzZSB7CiAgICAtLXNpemU6IDIzcHg7CiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvYXJyb3ctYmFjay5zdmciKTsKfQpib25kdGFibGUtY29udGFpbmVyLmNvbGxhcHNlZCAudGFibGUtY29sbGFwc2UgewogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL29wdGlvbnMtb3V0bGluZS5zdmciKTsKICAgIG1hcmdpbi1yaWdodDogMHB4Owp9CmJvbmR0YWJsZS1jb250YWluZXIuY29sbGFwc2VkIC50YWJsZS1jb2xsYXBzZTpob3ZlciB7CiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvYXJyb3ctZm9yd2FyZC5zdmciKTsKfQpib25kdGFibGUtY29udGFpbmVyLmNvbGxhcHNlZCB7CiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoY2FsYygtMTAwJSArIDM1cHgpKTsKICAgIGhlaWdodDogYXV0byAhaW1wb3J0YW50OwogICAgbGVmdDogMHB4ICFpbXBvcnRhbnQ7CiAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgcGFkZGluZzogNXB4Owp9CmJvbmR0YWJsZS1jb250YWluZXIuY29sbGFwc2VkIGJvbmR0YWJsZS1jb250ZW50cywKYm9uZHRhYmxlLWNvbnRhaW5lci5jb2xsYXBzZWQgc2VwYXJhdG9yIHsKICAgIGRpc3BsYXk6IG5vbmU7Cn0KQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewogICAgYm9uZHRhYmxlLWNvbnRhaW5lciB7CiAgICAgICAgYm9yZGVyLWNvbG9yOiAjN2Q3ZDdkOwogICAgfQp9Cjwvc3R5bGU+CgoJpG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU3ODshsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ5MDNmZWU2Ny02YjIzLTQxZGMtYTAzZC1mMTA0MGI2OTZiZTa5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AAZaCtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkOWUzNjAxZjUtZWZjMi00NGU5LTgzZDgtNWI2NWNlN2U5Y2NmiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedpqEDxib25kIGRlZj0iYXNkIiB1bmlxdWVfaWQ9IlNsSWJkbzZ4Ry95cSI+PHN0cnVjdC1ib25kIGNsYXNzPSdBU0QnPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBjbGFzcz0nJz4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5BU0Q8L3NwYW4+CgkJPGlucHV0IHR5cGU9J2NoZWNrYm94JyBjbGFzcz0ndG9nZ2xlJyBjaGVja2VkPgoJPC90b2dnbGVyZWFjdGl2ZS1oZWFkZXI+Cgk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCQk8cGwtY29tYmluZWQtY2hpbGQga2V5PSdhYXlrYnhmc2R5JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdvZHBqaGhoYW54JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdhJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBhYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPk1hcmtkb3duIGRlc2NyaXB0aW9uLCBpbmNsdWRpbmcgPHNwYW4gY2xhc3M9InRleCI+JExhVGVYJDwvc3Bhbj48L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd2c3dpZWRmZmlnJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3Zzd2llZGZmaWcnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ2c3dpZWRmZmlnIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdvZHBqaGhoYW54JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdiJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdiJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBiYCI+PHNwYW4+RmllbGQgd2l0aCA8Yj5IVE1MPC9iPiBkZXNjcmlwdGlvbjwvc3Bhbj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYic+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHdlb2p0Zmxucicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNjcmlwdD4KLy8gd2VpcmQgaW1wb3J0IHRvIG1ha2UgaXQgZmFzdGVyLiBUaGUgYGF3YWl0IGltcG9ydGAgY2FuIHN0aWxsIGRlbGF5IGV4ZWN1dGlvbiBieSBvbmUgZnJhbWUgaWYgaXQgaXMgYWxyZWFkeSBsb2FkZWQuLi4Kd2luZG93LmQzZm9ybWF0ID0gd2luZG93LmQzZm9ybWF0ID8/IGF3YWl0IGltcG9ydCgiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9kMy1mb3JtYXRAMi8rZXNtIikKCmNvbnN0IGFyZ21pbiA9IHhzID0+IHhzLmluZGV4T2YoTWF0aC5taW4oLi4ueHMpKQpjb25zdCBjbG9zZXN0X2luZGV4ID0gKHhzLCB5KSA9PiBhcmdtaW4oeHMubWFwKHggPT4gTWF0aC5hYnMoeC15KSkpCgpjb25zdCB2YWx1ZXMgPSBbMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgMTBdCgpjb25zdCBlbCA9IGh0bWxgCjxzcGFuIHRpdGxlPSJDbGljayBhbmQgZHJhZyB0aGlzIG51bWJlciBsZWZ0IG9yIHJpZ2h0ISIgc3R5bGU9ImN1cnNvcjogY29sLXJlc2l6ZTsKdG91Y2gtYWN0aW9uOiBub25lOwpiYWNrZ3JvdW5kOiByZ2IoMjUyLCAyMDksIDIwNCk7CmNvbG9yOiBibGFjazsKcGFkZGluZzogMGVtIC4yZW07CmJvcmRlci1yYWRpdXM6IC4zZW07CmZvbnQtd2VpZ2h0OiBib2xkOyI+Njwvc3Bhbj4KYAoKCgpsZXQgb2xkX3ggPSAwCmxldCBvbGRfaW5kZXggPSAwCmNvbnN0IGluaXRpYWxfaW5kZXggPSBjbG9zZXN0X2luZGV4KHZhbHVlcywgNikKbGV0IGN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4Cgpjb25zdCBmb3JtYXR0ZXIgPSBzID0+ICIiICsgZDNmb3JtYXQuZm9ybWF0KCIiKShzKSArICIiCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGVsLCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlc1tjdXJyZW50X2luZGV4XSwKCXNldDogeCA9PiB7CgkJY3VycmVudF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCB4KQoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCX0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKLy8gaW5pdGlhbCB2YWx1ZQplbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoNikKCmNvbnN0IG9uU2NydWIgPSAoZSkgPT4gewoJY29uc3Qgb2Zmc2V0ID0gZS5jbGllbnRYIC0gb2xkX3gKCWNvbnN0IG5ld19pbmRleCA9IE1hdGgubWluKHZhbHVlcy5sZW5ndGgtMSwgTWF0aC5tYXgoMCwgCgkJTWF0aC5yb3VuZChvZmZzZXQvMTApICsgb2xkX2luZGV4CgkpKQoKCWlmKG5ld19pbmRleCAhPT0gY3VycmVudF9pbmRleCkgewoJCWN1cnJlbnRfaW5kZXggPSBuZXdfaW5kZXgKCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgkJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCgl9Cn0KCmNvbnN0IG9ucG9pbnRlcmRvd24gPSAoZSkgPT4gewoJd2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KCkKCW9sZF94ID0gZS5jbGllbnRYCglvbGRfaW5kZXggPSBjdXJyZW50X2luZGV4Cgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCmNvbnN0IG9uZGJsY2xpY2sgPSAoZSkgPT4gewoJY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCWVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQp9CmVsLmFkZEV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCmNvbnN0IG9ucG9pbnRlcnVwID0gKCkgPT4gewoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgb25TY3J1YikKfQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgb25wb2ludGVydXApCgplbC5vbnNlbGVjdHN0YXJ0ID0gKCkgPT4gZmFsc2UKCmludmFsaWRhdGlvbi50aGVuKCgpID0+IHsKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgb25wb2ludGVyZG93bikKCWVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImRibGNsaWNrIiwgb25kYmxjbGljaykKCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKfSkKCnJldHVybiBlbAoKPC9zY3JpcHQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nbHdlb2p0Zmxucic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImx3ZW9qdGZsbnIiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J29kcGpoaGhhbngnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2MnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2MnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGNgIj5Ob3JtYWwgU3RyaW5nIERlc2NyaXB0aW9uPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2MnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3VtdndrZHBrbHYnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSd0ZXh0JyB2YWx1ZT0nJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd1bXZ3a2Rwa2x2Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAidW12d2tkcGtsdiIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nb2RwamhoaGFueCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nZCc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nZCcgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgZGAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5UaGlzIGZpZWxkIGlzIDxlbT5zcGVjaWFsPC9lbT48L3A+CjwvZGl2PjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdkJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdld3FscGZ2YXR6JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ndGV4dCcgdmFsdWU9Jyc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nZXdxbHBmdmF0eic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImV3cWxwZnZhdHoiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J29kcGpoaGhhbngnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2UnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2UnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGVgIj5lPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2UnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3JmdXVtc3ZsY3MnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzYnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdyZnV1bXN2bGNzJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAicmZ1dW1zdmxjcyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CjxzY3JpcHQgaWQ9J29kcGpoaGhhbngnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJvZHBqaGhoYW54Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBBU0QiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCQkJZmxleDogMTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYWF5a2J4ZnNkeSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImFheWtieGZzZHkiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J2R6eHl4aHVrcGonPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgogICAgICAgIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewogICAgY3Vyc29yOiBwb2ludGVyOwogICAgLS1zaXplOiAxNXB4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIGJhY2tncm91bmQ6ICNjNmM2YzY7CiAgICBvdXRsaW5lOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgbWFyZ2luOiAwIDEwcHg7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKICAgIGJhY2tncm91bmQ6ICM0QkQ4NjU7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewogICAgY29udGVudDogJyc7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgdG9wOiAwcHg7CiAgICBsZWZ0OiAwcHg7CiAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgdHJhbnNpdGlvbjogLjFzOwp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewogICAgbGVmdDogdmFyKC0tc2l6ZSkKfQkJCgk8L3N0eWxlPgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSduamV2ZnF6ZWV4Jz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiQ3VzdG9tIERlc2NyaXB0aW9uIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L2JvbmQ+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU1PqpxsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ5ZTM2MDFmNS1lZmMyLTQ0ZTktODNkOC01YjY1Y2U3ZTljY2a5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc6fYfhjtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkMDNlOWQ3NWUtZTZjOS00MTk5LTkzM2ItMmJlMzA2ZGFmOTc4iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9keYWmcHJlZml4o0FTRKhlbGVtZW50c5WSoWGSoTGqdGV4dC9wbGFpbpKhYpKhNqp0ZXh0L3BsYWlukqFjkqIiIqp0ZXh0L3BsYWlukqFkkqIiIqp0ZXh0L3BsYWlukqFlkqIyMKp0ZXh0L3BsYWlupHR5cGWmc3RydWN0rHByZWZpeF9zaG9ydKNBU0Sob2JqZWN0aWSwNDA0YWExYmU2ZjAzMWQ4ZqRtaW1l2SFhcHBsaWNhdGlvbi92bmQucGx1dG8udHJlZStvYmplY3Sscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTex4c6wcGVyc2lzdF9qc19zdGF0ZcO3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDAzZTlkNzVlLWU2YzktNDE5OS05MzNiLTJiZTMwNmRhZjk3OLlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lNLVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDA2NWJhZDczLTVmYTgtNDQ5Ni1iYTMzLTllNjY5NDBiNTgwNoqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHmFpnByZWZpeKNMT0yoZWxlbWVudHOSkqFhkqExqnRleHQvcGxhaW6SoWKSoTaqdGV4dC9wbGFpbqR0eXBlpnN0cnVjdKxwcmVmaXhfc2hvcnSjTE9MqG9iamVjdGlksGQ3NzA1MDcyM2JlMDkzNTOkbWltZdkhYXBwbGljYXRpb24vdm5kLnBsdXRvLnRyZWUrb2JqZWN0rHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU3DvNasHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQwNjViYWQ3My01ZmE4LTQ0OTYtYmEzMy05ZTY2OTQwYjU4MDa5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc0oL7VwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDI2ZDExNjAwLTI4MjctNGUwOC05MTk1LTEwOWM4YThiZGRjM4qmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHmmMi4wZTEwpG1pbWWqdGV4dC9wbGFpbqxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVN7IAqLBwZXJzaXN0X2pzX3N0YXRlw7doYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkMjZkMTE2MDAtMjgyNy00ZTA4LTkxOTUtMTA5YzhhOGJkZGMzuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWU3tXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkYTg5OTUyMjQtODNjNi00ZjgyLWI1YTUtODdhNmY4NmZjN2EwiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedoB0zxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5HZW5lcmF0aW5nIGF1dG9tYXRpYyB3aWRnZXRzIGZvciBjdXN0b20gc3RydWN0cyBpcyBxdWl0ZSBzdHJhaWdodGZvcndhcmQgd2l0aCB0aGUgYWlkIG9mIHRoZSA8Y29kZT5AZmllbGRkYXRhPC9jb2RlPiBtYWNybyBhbmQgdGhlIDxjb2RlPlN0cnVjdEJvbmQ8L2NvZGU+IHR5cGUuPC9wPgo8cD5UaGUgdG9wLWxlZnQgYXJyb3cgY2FuIGJlIHVzZWQgdG8gc2hvdy1oaWRlIHRoZSBmaWVsZCBlbGVtZW50cyAmIzQwO3VzZWZ1bCBpbnNpZGUgYSA8Y29kZT5Cb25kVGFibGU8L2NvZGU+LCBzaG93biBiZWxvdyYjNDE7LCB3aGlsZSB0aGUgZ3JlZW4gdG9nZ2xlIG9uIHRoZSB0b3AtcmlnaHQgY2FuIGJlIHVzZWQgdG8gZGlzYWJsZSB0ZW1wb3JhcmlseSB0aGUgc3luY2ggYmV0d2VlbiB0aGUgSlMgd2lkZ2V0cyBhbmQgdGhlIGJvbmQgdmFsdWVzIGluIFBsdXRvLjwvcD4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU0SgJxsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SRhODk5NTIyNC04M2M2LTRmODItYjVhNS04N2E2Zjg2ZmM3YTC5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4ABXL6tXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkZmU4OTFiNGUtZjQ0MC00ODIzLWI0M2ItNzI1NzJmNmE2YzEyiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedk6PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxoMj5EZWZhdWx0IFR5cGUgV2lkZ2V0czwvaDI+CjwvZGl2PqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVNVs4LrBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkZmU4OTFiNGUtZjQ0MC00ODIzLWI0M2ItNzI1NzJmNmE2YzEyuWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOAAQ58bVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDlkNDQ1NWFmLTk2ZjEtNDZkNy1hNGYzLTQzNDQ5NWIxMWM4YYqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnZLjxkaXYgY2xhc3M9Im1hcmtkb3duIj48aDE+UGFja2FnZXM8L2gxPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTPZLIiwcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDlkNDQ1NWFmLTk2ZjEtNDZkNy1hNGYzLTQzNDQ5NWIxMWM4YblkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAIagK1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ3OWJlYmE4OC05MzJmLTQxNDctYjNhMC1kODIxZWYxYmMxZTKKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52gOYPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPlRoZSBzdHJ1Y3R1cmVzIGFib3ZlIGNhbiBhbHNvIGJlIHVzZWQgbmVzdGVkIHdpdGhpbiBvbmUgYW5vdGhlci4gVG8gZmFjaWxpdGF0ZSBhY2Nlc3NpbmcgbmVzdGVkIHN0cnVjdHVyZXMsIG9uZSBjYW4gdXNlIHRoZSA8Y29kZT5Qb3BvdXQ8L2NvZGU+IHR5cGUuPC9wPgo8cD5JbiBpdHMgc2ltcGxlIGZvcm0sIHlvdSBjYW4gZ2l2ZSBhbiBpbnN0YW5jZSBvZiBhIFN0cnVjdEJvbmQsIGEgYm9uZCB3cmFwcGluZyBhIFN0cnVjdEJvbmQgb3IgYSBCb25kc0xpc3QgYXMgaW5wdXQgdG8gUG9wb3V0IHRvIGNyZWF0ZSBhIHRhYmxlIHRoYXQgaXMgaGlkZGVuIGJlaGluZCBhIHBvcHVwIHdpbmRvdy4gSWYgYW4gaW5zdGFuY2UgcHJlc2VudCwgYnV0IHlvdSB3YW50IGEgY3VzdG9tIHR5cGUgZm9yIHdoaWNoIHlvdSBoYXZlIGRlZmluZWQgY3VzdG9tIGJvbmRzIGFuZCBkZXNjcmlwdGlvbnMgd2l0aCA8Y29kZT5AZmllbGRkYXRhPC9jb2RlPiB0byBhcHBlYXIgYXMgcG9wb3V0LCB5b3UgY2FuIHVzZSB0aGUgZnVuY3Rpb24gPGNvZGU+cG9wb3V0d3JhcCYjNDA7VFlQRSYjNDE7PC9jb2RlPiB0byBnZW5lcmF0ZSBhIHNtYWxsIGljb24gd2hpY2ggaGlkZXMgYSBwb3B1cCBjb250YWluaW5nIHRoZSA8Y29kZT5TdHJ1Y3RCb25kPC9jb2RlPiBvZiB0aGUgcHJvdmlkZWQgdHlwZSA8Y29kZT5UWVBFPC9jb2RlPi48L3A+CjxwPlRoZSBTdHJ1Y3RCb25kIHRhYmxlIGFwcGVhcnMgb24gaG92ZXIgdXBvbiB0aGUgaWNvbiwgY2FuIGJlIG1hZGUgZml4ZWQgYnkgY2xpY2tpbmcgb24gdGhlIGljb24gYW5kIGNhbiB0aGVuIGJlIG1vdmVkIGFyb3VuZCBvciByZXNpemVkLiBBIGRvdWJsZSBjbGljayBvbiB0aGUgaGVhZGVyIG9mIHRoZSBwb3BvdXQgaGlkZXMgaXQgYWdhaW46PC9wPgo8L2Rpdj6kbWltZal0ZXh0L2h0bWyscm9vdGFzc2lnbmVlwLJsYXN0X3J1bl90aW1lc3RhbXDLQdoBlTbziHawcGVyc2lzdF9qc19zdGF0ZcK3aGFzX3BsdXRvX2hvb2tfZmVhdHVyZXPCp2NlbGxfaWTZJDc5YmViYTg4LTkzMmYtNDE0Ny1iM2EwLWQ4MjFlZjFiYzFlMrlkZXBlbmRzX29uX2Rpc2FibGVkX2NlbGxzwqdydW50aW1lzgAG1ba1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQxZDU1NzNlZS04NzJlLTRkZmItYTc4NS0xYWM5ZTgzNmFkOTiKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R5oTKkbWltZap0ZXh0L3BsYWlurHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU2Rnc+sHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQxZDU1NzNlZS04NzJlLTRkZmItYTc4NS0xYWM5ZTgzNmFkOTi5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc0qJ7VwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDg2YTgwMjI4LWY0OTUtNDNlOC1iMWQ0LWM5M2I3YjUyYzhkOIqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnae8I8Ym9uZCBkZWY9ImJvaCIgdW5pcXVlX2lkPSJ1bUs0cDg1SnZjY1AiPjxzdHJ1Y3QtYm9uZCBjbGFzcz0nQk9IJz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgY2xhc3M9Jyc+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+Qk9IPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYXVha2Jnc2xzdCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYndlb2FtZ2J4aycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nbWFoJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdtYWgnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYG1haGAiPm1haDwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdtYWgnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3N5eWJlbWthaHEnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwb3BvdXQtY29udGFpbmVyIGtleT0namRuYnF2YXlrZSc+Cgk8cG9wb3V0LWhlYWRlcj48c3BhbiBjbGFzcz0ncG9wb3V0LWljb24gcG9wb3V0Jz48L3NwYW4+PC9wb3BvdXQtaGVhZGVyPgoJPHBvcG91dC1jb250ZW50cz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdnaHdmb2hqam1uJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3RydWN0LWJvbmQgY2xhc3M9J01haW4udmFyJnF1b3Q7d29ya3NwYWNlIzMmcXVvdDsuTUFIJz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgY2xhc3M9Jyc+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+TUFIPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZ2NlZ3hibnJuZCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZ2J4d2R4bmhyYScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYWAiPmE8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZm1oYmduZHRsdycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdmbWhiZ25kdGx3Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiZm1oYmduZHRsdyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CjxzY3JpcHQgaWQ9J2dieHdkeG5ocmEnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJnYnh3ZHhuaHJhIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBNQUgiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCQkJZmxleDogMTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nZ2NlZ3hibnJuZCc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImdjZWd4Ym5ybmQiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J3N1eG5vandtdWonPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgogICAgICAgIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewogICAgY3Vyc29yOiBwb2ludGVyOwogICAgLS1zaXplOiAxNXB4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIGJhY2tncm91bmQ6ICNjNmM2YzY7CiAgICBvdXRsaW5lOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgbWFyZ2luOiAwIDEwcHg7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKICAgIGJhY2tncm91bmQ6ICM0QkQ4NjU7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewogICAgY29udGVudDogJyc7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgdG9wOiAwcHg7CiAgICBsZWZ0OiAwcHg7CiAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgdHJhbnNpdGlvbjogLjFzOwp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewogICAgbGVmdDogdmFyKC0tc2l6ZSkKfQkJCgk8L3N0eWxlPgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSd4bmlveHhnb3ZpJz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiTUFIIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L3BsLWNvbWJpbmVkLWNoaWxkPjwvcG9wb3V0LWNvbnRlbnRzPgo8L3BvcG91dC1jb250YWluZXI+CjxzY3JpcHQgaWQ9J2pkbmJxdmF5a2UnPgoJLy8gTG9hZCB0aGUgZmxvYXRpbmctdWkgYW5kIGludGVyYWN0IGxpYnJhcmllcwoJd2luZG93LmZsb2F0aW5nX3VpID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9AZmxvYXRpbmctdWkvZG9tJykKCgljb25zdCB7IGNvbXB1dGVQb3NpdGlvbiwgYXV0b1BsYWNlbWVudCB9ID0gZmxvYXRpbmdfdWkKCQoJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgljb25zdCBoZWFkZXIgPSBjb250YWluZXIuZmlyc3RFbGVtZW50Q2hpbGQKCWNvbnN0IGNvbnRlbnRzID0gY29udGFpbmVyLmxhc3RFbGVtZW50Q2hpbGQKCgkvLyBMb2FkIHRoZSBpbnRlcmFjdGpzIHBhcnQKCQkvLyBXZSB1c2UgdGhlIGludGVyYWN0anMgbGlicmFyeSB0byBwcm92aWRlIGRyYWcgYW5kIHJlc2l6ZSBoYW5kbGluZyBhY3Jvc3MgZGV2aWNlcwoJY29uc3QgeyBkZWZhdWx0OiBpbnRlcmFjdCB9ID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9pbnRlcmFjdGpzJykKCgljb250ZW50cy5vZmZzZXQgPSBjb250ZW50cy5vZmZzZXQgPz8geyB4OiAwLCB5OiAwfQoJY29uc3Qgc3RhcnRQb3NpdGlvbiA9IHt4OiAwLCB5OiAwfQoJaW50ZXJhY3QoY29udGVudHMucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC5kZXNjcmlwdGlvbiwgYm9uZHNsaXN0LWhlYWRlciAuZGVzY3JpcHRpb24nKSkuZHJhZ2dhYmxlKHsKCQlsaXN0ZW5lcnM6IHsKCQkJc3RhcnQgKGV2ZW50KSB7CgkJCQljb250ZW50cy5vZmZzZXQueSA9IHN0YXJ0UG9zaXRpb24ueSA9IGNvbnRlbnRzLm9mZnNldFRvcAoJCQkJY29udGVudHMub2Zmc2V0LnggPSBzdGFydFBvc2l0aW9uLnggPSBjb250ZW50cy5vZmZzZXRMZWZ0CgkJCX0sCgkJCW1vdmUgKGV2ZW50KSB7CgkJICAgICAgY29udGVudHMub2Zmc2V0LnggKz0gZXZlbnQuZHgKCQkgICAgICBjb250ZW50cy5vZmZzZXQueSArPSBldmVudC5keQoJCQoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLnRvcCA9IGBtaW4oOTV2aCwgJHtjb250ZW50cy5vZmZzZXQueX1weGAKCQkgICAgICBjb250ZW50cy5zdHlsZS5sZWZ0ID0gYG1pbig5NXZ3LCAke2NvbnRlbnRzLm9mZnNldC54fXB4YAoJCSAgICB9LAoJCX0KCX0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gaGVhZGVyIHJlc2V0IHRoZSBwb3NpdGlvbgoJCWNvbnRhaW5lci5wb3BvdXQoKQoJfSkKCWludGVyYWN0KGNvbnRlbnRzKQoJICAucmVzaXphYmxlKHsKCSAgICBlZGdlczogeyB0b3A6IHRydWUsIGxlZnQ6IGZhbHNlLCBib3R0b206IHRydWUsIHJpZ2h0OiB0cnVlIH0sCgkgICAgbGlzdGVuZXJzOiB7CgkgICAgICBtb3ZlOiBmdW5jdGlvbiAoZXZlbnQpIHsJCQoJICAgICAgICBPYmplY3QuYXNzaWduKGV2ZW50LnRhcmdldC5zdHlsZSwgewoJICAgICAgICAgIHdpZHRoOiBgJHtldmVudC5yZWN0LndpZHRofXB4YCwKCSAgICAgICAgICBoZWlnaHQ6IGAke2V2ZW50LnJlY3QuaGVpZ2h0fXB4YCwKCSAgICAgICAgfSkKCSAgICAgIH0KCSAgICB9CgkgIH0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gcmVzaXplIHJlc2V0IHRoZSB3aWR0aAoJCQljb250ZW50cy5zdHlsZS53aWR0aCA9ICcnCgkJICAJY29udGVudHMuc3R5bGUuaGVpZ2h0ID0gJycKCSAgfSkKCgoJZnVuY3Rpb24gcG9zaXRpb25Db250ZW50cygpIHsKCQljb21wdXRlUG9zaXRpb24oaGVhZGVyLCBjb250ZW50cywgewoJCQlzdHJhdGVneTogImZpeGVkIiwKCQkJbWlkZGxld2FyZTogW2F1dG9QbGFjZW1lbnQoKV0sCgkJfSkudGhlbigocG9zKSA9PiB7CgkJCWNvbnRlbnRzLnN0eWxlLmxlZnQgPSBwb3MueCArICJweCIKCQkJY29udGVudHMuc3R5bGUudG9wID0gcG9zLnkgKyAicHgiCgkJfSkKCX0KCgljb250YWluZXIucG9wb3V0ID0gKGZvcmNlID0gdW5kZWZpbmVkKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ3BvcHBlZCcsIGZvcmNlKQoJCXBvc2l0aW9uQ29udGVudHMoKQoJfQoKCWhlYWRlci5vbmNsaWNrID0gKGUpID0+IHtjb250YWluZXIucG9wb3V0KCl9CgoJY29udGVudHMub25tb3VzZWVudGVyID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb250ZW50cy1ob3ZlcicsIHRydWUpCgljb250ZW50cy5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgZmFsc2UpCgoJaGVhZGVyLm9ubW91c2VlbnRlciA9IChlKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIHRydWUpCgkJY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygncG9wcGVkJykgPyBudWxsIDogcG9zaXRpb25Db250ZW50cygpCgl9CgloZWFkZXIub25tb3VzZWxlYXZlID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItaG92ZXInLCBmYWxzZSkKPC9zY3JpcHQ+CjxzdHlsZT4KCXBvcG91dC1oZWFkZXIgewogICAgZGlzcGxheTogZmxleDsKICAgIGJvcmRlcjogM3B4IGRhc2hlZCB0cmFuc3BhcmVudDsKICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKfQpwb3BvdXQtY29udGVudHMgewogICAgZGlzcGxheTogbm9uZTsKICAgIHdpZHRoOiA0MDBweDsKICAgIGJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICAgIGJvcmRlcjogM3B4IHNvbGlkIHZhcigtLW92ZXJsYXktYnV0dG9uLWJvcmRlcik7CiAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgcGFkZGluZzogOHB4Owp9CnBvcG91dC1jb250YWluZXIucG9wcGVkID4gcG9wb3V0LWNvbnRlbnRzLApwb3BvdXQtY29udGFpbmVyLmhlYWRlci1ob3ZlciA+IHBvcG91dC1jb250ZW50cyB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgIHotaW5kZXg6IDUwMDsKfQpwb3BvdXQtY29udGFpbmVyLmNvbnRlbnRzLWhvdmVyID4gcG9wb3V0LWhlYWRlciB7CiAgICBib3JkZXItY29sb3I6IHZhcigtLXBsdXRvLWxvZ3Mtd2Fybi1hY2NlbnQtY29sb3IpOwp9Ci5wb3BvdXQtaWNvbiB7CiAgICAtLXNpemU6IDIwcHg7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CiAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKICAgIG1pbi1oZWlnaHQ6IHZhcigtLXNpemUpOwogICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKfQoucG9wb3V0LWljb24ucG9wb3V0IHsJCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9leHBhbmQuc3ZnKTsKfQpwb3BvdXQtY29udGFpbmVyLnBvcHBlZCAucG9wb3V0IHsKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NvbnRyYWN0LnN2Zyk7Cn0KcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKICAgIHRvdWNoLWFjdGlvbjogbm9uZTsKICAgIHVzZXItc2VsZWN0OiBub25lOwp9Cjwvc3R5bGU+CjxzY3JpcHQgaWQ9J2dod2ZvaGpqbW4nPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJnaHdmb2hqam1uIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nc3l5YmVta2FocSc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInN5eWJlbWthaHEiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdid2VvYW1nYnhrJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAiYndlb2FtZ2J4ayIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CgkJCgk8c2NyaXB0PgoJCWNvbnN0IHRyYyA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgndG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyJykKCQljb25zdCBoZWFkZXIgPSB0cmMuZmlyc3RFbGVtZW50Q2hpbGQKCQljb25zdCBkZXNjID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgIlRoaXMgZ2VuZXJhdGVzIGEgc3RydWN0IG9mIHR5cGUgQk9IIikKCgkJLy8gYWRkIHRoZSBjb2xsYXBzZSBidXR0b24KCQljb25zdCBjb2xsYXBzZV9idG4gPSBodG1sYDxzcGFuIGNsYXNzPSdjb2xsYXBzZSc+YAoJCWhlYWRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBjb2xsYXBzZV9idG4pCgoJCXRyYy5jb2xsYXBzZSA9ICgpID0+IHsKICAJCQl0cmMuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJykKCQl9CgoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IHRyYy5jb2xsYXBzZSgpCgkJCgk8L3NjcmlwdD4KCQk8c3R5bGU+CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQkJCWZsZXg6IDE7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQktLXNpemU6IDE3cHg7CgkJCSAgICBkaXNwbGF5OiBibG9jazsKCQkJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQkJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJCWN1cnNvcjogcG9pbnRlcjsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkID4gdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJZmxleC1ncm93OiAxOwoJCQkJZm9udC1zaXplOiAxOHB4OwoJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyICsgKiB7CgkJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2F1YWtiZ3Nsc3QnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhdWFrYmdzbHN0Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSdvaHdxdm5kZWlnJz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KICAgICAgICB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIC0tc2l6ZTogMTVweDsKICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgIHdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGFwcGVhcmFuY2U6IG5vbmU7CiAgICBiYWNrZ3JvdW5kOiAjYzZjNmM2OwogICAgb3V0bGluZTogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CiAgICBib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIG1hcmdpbjogMCAxMHB4Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CiAgICBiYWNrZ3JvdW5kOiAjNEJEODY1Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKICAgIGNvbnRlbnQ6ICcnOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgd2lkdGg6IHZhcigtLXNpemUpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIHRvcDogMHB4OwogICAgbGVmdDogMHB4OwogICAgYmFja2dyb3VuZDogI2ZmZjsKICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsKICAgIGJveC1zaGFkb3c6IDAgY2FsYyh2YXIoLS1zaXplKS8yMCkgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIHRyYW5zaXRpb246IC4xczsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQ6YmVmb3JlIHsKICAgIGxlZnQ6IHZhcigtLXNpemUpCn0JCQoJPC9zdHlsZT4KPC90b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+CgoJPHNjcmlwdCBpZD0nc3ljaHdkcm1saSc+CgkJCgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3Qgd2lkZ2V0ID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkKCQkvLyBPdmVyd3JpdGUgdGhlIGRlc2NyaXB0aW9uCgkJY29uc3QgZGVzYyA9IHdpZGdldC5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2MuaW5uZXJIVE1MID0gIkJPSCIKCQoJCS8vIFNldC1HZXQgYm9uZAoJCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IGdldF9pbnB1dF92YWx1ZSh3aWRnZXQpLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXNldF9pbnB1dF92YWx1ZSh3aWRnZXQsIG5ld3ZhbCkKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJCgkJY29uc3Qgb2xkX29uaW5wdXQgPSB3aWRnZXQub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCXdpZGdldC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoJPC9zY3JpcHQ+Cgk8c3R5bGU+CgkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQlzdHJ1Y3QtYm9uZCB7CiAgCQkJZmxleDogMTsKCQl9Cgk8L3N0eWxlPgoJPC9zdHJ1Y3QtYm9uZD4KPC9ib25kPqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVNYN3JbBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkODZhODAyMjgtZjQ5NS00M2U4LWIxZDQtYzkzYjdiNTJjOGQ4uWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOJ3ko9rVwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMLZJDNhMDY2YmY0LTM0NjYtNDY5ZS05MGQwLTZiMTRiZTNlZDhkNYqmcXVldWVkwqRsb2dzkKdydW5uaW5nwqZvdXRwdXSGpGJvZHnZLzxkaXYgY2xhc3M9Im1hcmtkb3duIj48aDE+Qm9uZFRhYmxlPC9oMT4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU3JiUxsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQzYTA2NmJmNC0zNDY2LTQ2OWUtOTBkMC02YjE0YmUzZWQ4ZDW5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AA668tXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkODExY2Y3OGItZTg3MC00NWJiLTkxNzMtODlhM2IzZDQ5NWY1iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedsAAbrXPGJvbmRzbGlzdC1jb250YWluZXIgY2xhc3M9J25vLXBvcG91dCc+Cgk8Ym9uZHNsaXN0LWhlYWRlcj4KCQk8c3BhbiBjbGFzcz0nY29sbGFwc2UgYm9uZHNsaXN0LWljb24nPjwvc3Bhbj4KCQk8c3BhbiBjbGFzcz0nZGVzY3JpcHRpb24nIHRpdGxlPSJUaGlzIGxpc3QgY29udGFpbnMgaW5kZXBlbmRlbnQgYm9uZHMiPlBvcG91dCBDb250YWluZXI8L3NwYW4+CgkJPHNwYW4gY2xhc3M9J3RvZ2dsZSBib25kc2xpc3QtaWNvbic+PC9zcGFuPgoJPC9ib25kc2xpc3QtaGVhZGVyPgoJPGJvbmRzbGlzdC1jb250ZW50cz4KCTxib25kLXdpdGgtZGVzY3JpcHRpb24+Cgk8Ym9uZC1kZXNjcmlwdGlvbiB0aXRsZT0nVGhpcyBib25kIGlzIGFzc2lnbmVkIHRvIHZhcmlhYmxlIGBhc2RgJz4KCQlTdHJ1Y3R1cmUgQVNECgk8L2JvbmQtZGVzY3JpcHRpb24+Cgk8Ym9uZC12YWx1ZT4KCQk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cG9wb3V0LWNvbnRhaW5lciBrZXk9J2JlcHVoZ3ZvaGInPgoJPHBvcG91dC1oZWFkZXI+PHNwYW4gY2xhc3M9J3BvcG91dC1pY29uIHBvcG91dCc+PC9zcGFuPjwvcG9wb3V0LWhlYWRlcj4KCTxwb3BvdXQtY29udGVudHM+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbXhrcHl1eWdnYycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGJvbmQgZGVmPSJhc2QiIHVuaXF1ZV9pZD0iU2xJYmRvNnhHL3lxIj48c3RydWN0LWJvbmQgY2xhc3M9J01haW4udmFyJnF1b3Q7d29ya3NwYWNlIzMmcXVvdDsuQVNEJz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgY2xhc3M9Jyc+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+QVNEPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYWF5a2J4ZnNkeScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nb2RwamhoaGFueCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYWAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5NYXJrZG93biBkZXNjcmlwdGlvbiwgaW5jbHVkaW5nIDxzcGFuIGNsYXNzPSJ0ZXgiPiRMYVRlWCQ8L3NwYW4+PC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nYSc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndnN3aWVkZmZpZycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAnIHZhbHVlPScxJz48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd2c3dpZWRmZmlnJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAidnN3aWVkZmZpZyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nb2RwamhoaGFueCcgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYic+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYicgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYmAiPjxzcGFuPkZpZWxkIHdpdGggPGI+SFRNTDwvYj4gZGVzY3JpcHRpb248L3NwYW4+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2InPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2x3ZW9qdGZsbnInIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzY3JpcHQ+Ci8vIHdlaXJkIGltcG9ydCB0byBtYWtlIGl0IGZhc3Rlci4gVGhlIGBhd2FpdCBpbXBvcnRgIGNhbiBzdGlsbCBkZWxheSBleGVjdXRpb24gYnkgb25lIGZyYW1lIGlmIGl0IGlzIGFscmVhZHkgbG9hZGVkLi4uCndpbmRvdy5kM2Zvcm1hdCA9IHdpbmRvdy5kM2Zvcm1hdCA/PyBhd2FpdCBpbXBvcnQoImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZDMtZm9ybWF0QDIvK2VzbSIpCgpjb25zdCBhcmdtaW4gPSB4cyA9PiB4cy5pbmRleE9mKE1hdGgubWluKC4uLnhzKSkKY29uc3QgY2xvc2VzdF9pbmRleCA9ICh4cywgeSkgPT4gYXJnbWluKHhzLm1hcCh4ID0+IE1hdGguYWJzKHgteSkpKQoKY29uc3QgdmFsdWVzID0gWzEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwXQoKY29uc3QgZWwgPSBodG1sYAo8c3BhbiB0aXRsZT0iQ2xpY2sgYW5kIGRyYWcgdGhpcyBudW1iZXIgbGVmdCBvciByaWdodCEiIHN0eWxlPSJjdXJzb3I6IGNvbC1yZXNpemU7CnRvdWNoLWFjdGlvbjogbm9uZTsKYmFja2dyb3VuZDogcmdiKDI1MiwgMjA5LCAyMDQpOwpjb2xvcjogYmxhY2s7CnBhZGRpbmc6IDBlbSAuMmVtOwpib3JkZXItcmFkaXVzOiAuM2VtOwpmb250LXdlaWdodDogYm9sZDsiPjY8L3NwYW4+CmAKCgoKbGV0IG9sZF94ID0gMApsZXQgb2xkX2luZGV4ID0gMApjb25zdCBpbml0aWFsX2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIDYpCmxldCBjdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoKY29uc3QgZm9ybWF0dGVyID0gcyA9PiAiIiArIGQzZm9ybWF0LmZvcm1hdCgiIikocykgKyAiIgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShlbCwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXNbY3VycmVudF9pbmRleF0sCglzZXQ6IHggPT4gewoJCWN1cnJlbnRfaW5kZXggPSBjbG9zZXN0X2luZGV4KHZhbHVlcywgeCkKCQllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgl9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCi8vIGluaXRpYWwgdmFsdWUKZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKDYpCgpjb25zdCBvblNjcnViID0gKGUpID0+IHsKCWNvbnN0IG9mZnNldCA9IGUuY2xpZW50WCAtIG9sZF94Cgljb25zdCBuZXdfaW5kZXggPSBNYXRoLm1pbih2YWx1ZXMubGVuZ3RoLTEsIE1hdGgubWF4KDAsIAoJCU1hdGgucm91bmQob2Zmc2V0LzEwKSArIG9sZF9pbmRleAoJKSkKCglpZihuZXdfaW5kZXggIT09IGN1cnJlbnRfaW5kZXgpIHsKCQljdXJyZW50X2luZGV4ID0gbmV3X2luZGV4CgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJCWVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQoJfQp9Cgpjb25zdCBvbnBvaW50ZXJkb3duID0gKGUpID0+IHsKCXdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSgpCglvbGRfeCA9IGUuY2xpZW50WAoJb2xkX2luZGV4ID0gY3VycmVudF9pbmRleAoJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJtb3ZlIiwgb25TY3J1YikKfQplbC5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIG9ucG9pbnRlcmRvd24pCgpjb25zdCBvbmRibGNsaWNrID0gKGUpID0+IHsKCWN1cnJlbnRfaW5kZXggPSBpbml0aWFsX2luZGV4CgllbC5pbm5lclRleHQgPSBmb3JtYXR0ZXIoZWwudmFsdWUpCgllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKfQplbC5hZGRFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIG9uZGJsY2xpY2spCgpjb25zdCBvbnBvaW50ZXJ1cCA9ICgpID0+IHsKCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0Kd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQoKZWwub25zZWxlY3RzdGFydCA9ICgpID0+IGZhbHNlCgppbnZhbGlkYXRpb24udGhlbigoKSA9PiB7CgllbC5yZW1vdmVFdmVudExpc3RlbmVyKCJwb2ludGVyZG93biIsIG9ucG9pbnRlcmRvd24pCgllbC5yZW1vdmVFdmVudExpc3RlbmVyKCJkYmxjbGljayIsIG9uZGJsY2xpY2spCgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcnVwIiwgb25wb2ludGVydXApCn0pCgpyZXR1cm4gZWwKCjwvc2NyaXB0PjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2x3ZW9qdGZsbnInPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJsd2VvanRmbG5yIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdvZHBqaGhoYW54JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdjJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdjJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBjYCI+Tm9ybWFsIFN0cmluZyBEZXNjcmlwdGlvbjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdjJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSd1bXZ3a2Rwa2x2JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ndGV4dCcgdmFsdWU9Jyc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ndW12d2tkcGtsdic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInVtdndrZHBrbHYiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J29kcGpoaGhhbngnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2QnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2QnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGRgIj48ZGl2IGNsYXNzPSJtYXJrZG93biI+PHA+VGhpcyBmaWVsZCBpcyA8ZW0+c3BlY2lhbDwvZW0+PC9wPgo8L2Rpdj48L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0nZCc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZXdxbHBmdmF0eicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3RleHQnIHZhbHVlPScnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2V3cWxwZnZhdHonPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJld3FscGZ2YXR6Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdvZHBqaGhoYW54JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdlJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdlJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBlYCI+ZTwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdlJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdyZnV1bXN2bGNzJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PSc2JyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ncmZ1dW1zdmxjcyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInJmdXVtc3ZsY3MiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdvZHBqaGhoYW54Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAib2RwamhoaGFueCIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CgkJCgk8c2NyaXB0PgoJCWNvbnN0IHRyYyA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgndG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyJykKCQljb25zdCBoZWFkZXIgPSB0cmMuZmlyc3RFbGVtZW50Q2hpbGQKCQljb25zdCBkZXNjID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgIlRoaXMgZ2VuZXJhdGVzIGEgc3RydWN0IG9mIHR5cGUgQVNEIikKCgkJLy8gYWRkIHRoZSBjb2xsYXBzZSBidXR0b24KCQljb25zdCBjb2xsYXBzZV9idG4gPSBodG1sYDxzcGFuIGNsYXNzPSdjb2xsYXBzZSc+YAoJCWhlYWRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBjb2xsYXBzZV9idG4pCgoJCXRyYy5jb2xsYXBzZSA9ICgpID0+IHsKICAJCQl0cmMuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJykKCQl9CgoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IHRyYy5jb2xsYXBzZSgpCgkJCgk8L3NjcmlwdD4KCQk8c3R5bGU+CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQkJCWZsZXg6IDE7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQktLXNpemU6IDE3cHg7CgkJCSAgICBkaXNwbGF5OiBibG9jazsKCQkJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQkJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJCWN1cnNvcjogcG9pbnRlcjsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkID4gdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJZmxleC1ncm93OiAxOwoJCQkJZm9udC1zaXplOiAxOHB4OwoJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyICsgKiB7CgkJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2FheWtieGZzZHknPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhYXlrYnhmc2R5Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSdkenh5eGh1a3BqJz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KICAgICAgICB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIC0tc2l6ZTogMTVweDsKICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgIHdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGFwcGVhcmFuY2U6IG5vbmU7CiAgICBiYWNrZ3JvdW5kOiAjYzZjNmM2OwogICAgb3V0bGluZTogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CiAgICBib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIG1hcmdpbjogMCAxMHB4Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CiAgICBiYWNrZ3JvdW5kOiAjNEJEODY1Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKICAgIGNvbnRlbnQ6ICcnOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgd2lkdGg6IHZhcigtLXNpemUpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIHRvcDogMHB4OwogICAgbGVmdDogMHB4OwogICAgYmFja2dyb3VuZDogI2ZmZjsKICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsKICAgIGJveC1zaGFkb3c6IDAgY2FsYyh2YXIoLS1zaXplKS8yMCkgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIHRyYW5zaXRpb246IC4xczsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQ6YmVmb3JlIHsKICAgIGxlZnQ6IHZhcigtLXNpemUpCn0JCQoJPC9zdHlsZT4KPC90b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+CgoJPHNjcmlwdCBpZD0nbmpldmZxemVleCc+CgkJCgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3Qgd2lkZ2V0ID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkKCQkvLyBPdmVyd3JpdGUgdGhlIGRlc2NyaXB0aW9uCgkJY29uc3QgZGVzYyA9IHdpZGdldC5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2MuaW5uZXJIVE1MID0gIkN1c3RvbSBEZXNjcmlwdGlvbiIKCQoJCS8vIFNldC1HZXQgYm9uZAoJCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IGdldF9pbnB1dF92YWx1ZSh3aWRnZXQpLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXNldF9pbnB1dF92YWx1ZSh3aWRnZXQsIG5ld3ZhbCkKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJCgkJY29uc3Qgb2xkX29uaW5wdXQgPSB3aWRnZXQub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCXdpZGdldC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoJPC9zY3JpcHQ+Cgk8c3R5bGU+CgkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQlzdHJ1Y3QtYm9uZCB7CiAgCQkJZmxleDogMTsKCQl9Cgk8L3N0eWxlPgoJPC9zdHJ1Y3QtYm9uZD4KPC9ib25kPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9wb3BvdXQtY29udGVudHM+CjwvcG9wb3V0LWNvbnRhaW5lcj4KPHNjcmlwdCBpZD0nYmVwdWhndm9oYic+CgkvLyBMb2FkIHRoZSBmbG9hdGluZy11aSBhbmQgaW50ZXJhY3QgbGlicmFyaWVzCgl3aW5kb3cuZmxvYXRpbmdfdWkgPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL0BmbG9hdGluZy11aS9kb20nKQoKCWNvbnN0IHsgY29tcHV0ZVBvc2l0aW9uLCBhdXRvUGxhY2VtZW50IH0gPSBmbG9hdGluZ191aQoJCgljb25zdCBjb250YWluZXIgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCWNvbnN0IGhlYWRlciA9IGNvbnRhaW5lci5maXJzdEVsZW1lbnRDaGlsZAoJY29uc3QgY29udGVudHMgPSBjb250YWluZXIubGFzdEVsZW1lbnRDaGlsZAoKCS8vIExvYWQgdGhlIGludGVyYWN0anMgcGFydAoJCS8vIFdlIHVzZSB0aGUgaW50ZXJhY3RqcyBsaWJyYXJ5IHRvIHByb3ZpZGUgZHJhZyBhbmQgcmVzaXplIGhhbmRsaW5nIGFjcm9zcyBkZXZpY2VzCgljb25zdCB7IGRlZmF1bHQ6IGludGVyYWN0IH0gPSBhd2FpdCBpbXBvcnQoJ2h0dHBzOi8vZXNtLnNoL2ludGVyYWN0anMnKQoKCWNvbnRlbnRzLm9mZnNldCA9IGNvbnRlbnRzLm9mZnNldCA/PyB7IHg6IDAsIHk6IDB9Cgljb25zdCBzdGFydFBvc2l0aW9uID0ge3g6IDAsIHk6IDB9CglpbnRlcmFjdChjb250ZW50cy5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLmRlc2NyaXB0aW9uLCBib25kc2xpc3QtaGVhZGVyIC5kZXNjcmlwdGlvbicpKS5kcmFnZ2FibGUoewoJCWxpc3RlbmVyczogewoJCQlzdGFydCAoZXZlbnQpIHsKCQkJCWNvbnRlbnRzLm9mZnNldC55ID0gc3RhcnRQb3NpdGlvbi55ID0gY29udGVudHMub2Zmc2V0VG9wCgkJCQljb250ZW50cy5vZmZzZXQueCA9IHN0YXJ0UG9zaXRpb24ueCA9IGNvbnRlbnRzLm9mZnNldExlZnQKCQkJfSwKCQkJbW92ZSAoZXZlbnQpIHsKCQkgICAgICBjb250ZW50cy5vZmZzZXQueCArPSBldmVudC5keAoJCSAgICAgIGNvbnRlbnRzLm9mZnNldC55ICs9IGV2ZW50LmR5CgkJCgkJICAgICAgY29udGVudHMuc3R5bGUudG9wID0gYG1pbig5NXZoLCAke2NvbnRlbnRzLm9mZnNldC55fXB4YAoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLmxlZnQgPSBgbWluKDk1dncsICR7Y29udGVudHMub2Zmc2V0Lnh9cHhgCgkJICAgIH0sCgkJfQoJfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiBoZWFkZXIgcmVzZXQgdGhlIHBvc2l0aW9uCgkJY29udGFpbmVyLnBvcG91dCgpCgl9KQoJaW50ZXJhY3QoY29udGVudHMpCgkgIC5yZXNpemFibGUoewoJICAgIGVkZ2VzOiB7IHRvcDogdHJ1ZSwgbGVmdDogZmFsc2UsIGJvdHRvbTogdHJ1ZSwgcmlnaHQ6IHRydWUgfSwKCSAgICBsaXN0ZW5lcnM6IHsKCSAgICAgIG1vdmU6IGZ1bmN0aW9uIChldmVudCkgewkJCgkgICAgICAgIE9iamVjdC5hc3NpZ24oZXZlbnQudGFyZ2V0LnN0eWxlLCB7CgkgICAgICAgICAgd2lkdGg6IGAke2V2ZW50LnJlY3Qud2lkdGh9cHhgLAoJICAgICAgICAgIGhlaWdodDogYCR7ZXZlbnQucmVjdC5oZWlnaHR9cHhgLAoJICAgICAgICB9KQoJICAgICAgfQoJICAgIH0KCSAgfSkub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uIChldmVudCkgewoJCSAgLy8gRG91YmxlLXRhcCBvbiByZXNpemUgcmVzZXQgdGhlIHdpZHRoCgkJCWNvbnRlbnRzLnN0eWxlLndpZHRoID0gJycKCQkgIAljb250ZW50cy5zdHlsZS5oZWlnaHQgPSAnJwoJICB9KQoKCglmdW5jdGlvbiBwb3NpdGlvbkNvbnRlbnRzKCkgewoJCWNvbXB1dGVQb3NpdGlvbihoZWFkZXIsIGNvbnRlbnRzLCB7CgkJCXN0cmF0ZWd5OiAiZml4ZWQiLAoJCQltaWRkbGV3YXJlOiBbYXV0b1BsYWNlbWVudCgpXSwKCQl9KS50aGVuKChwb3MpID0+IHsKCQkJY29udGVudHMuc3R5bGUubGVmdCA9IHBvcy54ICsgInB4IgoJCQljb250ZW50cy5zdHlsZS50b3AgPSBwb3MueSArICJweCIKCQl9KQoJfQoKCWNvbnRhaW5lci5wb3BvdXQgPSAoZm9yY2UgPSB1bmRlZmluZWQpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgncG9wcGVkJywgZm9yY2UpCgkJcG9zaXRpb25Db250ZW50cygpCgl9CgoJaGVhZGVyLm9uY2xpY2sgPSAoZSkgPT4ge2NvbnRhaW5lci5wb3BvdXQoKX0KCgljb250ZW50cy5vbm1vdXNlZW50ZXIgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgdHJ1ZSkKCWNvbnRlbnRzLm9ubW91c2VsZWF2ZSA9IChlKSA9PiBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY29udGVudHMtaG92ZXInLCBmYWxzZSkKCgloZWFkZXIub25tb3VzZWVudGVyID0gKGUpID0+IHsKCQljb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGVhZGVyLWhvdmVyJywgdHJ1ZSkKCQljb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdwb3BwZWQnKSA/IG51bGwgOiBwb3NpdGlvbkNvbnRlbnRzKCkKCX0KCWhlYWRlci5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIGZhbHNlKQo8L3NjcmlwdD4KPHN0eWxlPgoJcG9wb3V0LWhlYWRlciB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYm9yZGVyOiAzcHggZGFzaGVkIHRyYW5zcGFyZW50OwogICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwp9CnBvcG91dC1jb250ZW50cyB7CiAgICBkaXNwbGF5OiBub25lOwogICAgd2lkdGg6IDQwMHB4OwogICAgYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwogICAgYm9yZGVyOiAzcHggc29saWQgdmFyKC0tb3ZlcmxheS1idXR0b24tYm9yZGVyKTsKICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICBwYWRkaW5nOiA4cHg7Cn0KcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgPiBwb3BvdXQtY29udGVudHMsCnBvcG91dC1jb250YWluZXIuaGVhZGVyLWhvdmVyID4gcG9wb3V0LWNvbnRlbnRzIHsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgcG9zaXRpb246IGZpeGVkOwogICAgei1pbmRleDogNTAwOwp9CnBvcG91dC1jb250YWluZXIuY29udGVudHMtaG92ZXIgPiBwb3BvdXQtaGVhZGVyIHsKICAgIGJvcmRlci1jb2xvcjogdmFyKC0tcGx1dG8tbG9ncy13YXJuLWFjY2VudC1jb2xvcik7Cn0KLnBvcG91dC1pY29uIHsKICAgIC0tc2l6ZTogMjBweDsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CiAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwogICAgd2lkdGg6IHZhcigtLXNpemUpOwogICAgbWluLWhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwp9Ci5wb3BvdXQtaWNvbi5wb3BvdXQgewkKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2V4cGFuZC5zdmcpOwp9CnBvcG91dC1jb250YWluZXIucG9wcGVkIC5wb3BvdXQgewogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY29udHJhY3Quc3ZnKTsKfQpwb3BvdXQtY29udGFpbmVyLnBvcHBlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewogICAgdG91Y2gtYWN0aW9uOiBub25lOwogICAgdXNlci1zZWxlY3Q6IG5vbmU7Cn0KPC9zdHlsZT4KPHNjcmlwdCBpZD0nbXhrcHl1eWdnYyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gIm14a3B5dXlnZ2MiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj4KCTwvYm9uZC12YWx1ZT4KCTxzdHlsZT4KCQlib25kLXdpdGgtZGVzY3JpcHRpb24gewogIGRpc3BsYXk6IGdyaWQ7CiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgMC40ZnIpOwogIGdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKICBqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7Cn0KYm9uZHRhYmxlLWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiwKYm9uZHNsaXN0LWNvbnRlbnRzIGJvbmQtd2l0aC1kZXNjcmlwdGlvbiB7CiAgZGlzcGxheTogY29udGVudHM7Cn0KYm9uZC12YWx1ZSBib25kIHsKICBkaXNwbGF5OiBmbGV4OyAvKiBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0ICovCn0KYm9uZC12YWx1ZSBpbnB1dCB7CiAgd2lkdGg6IDEwMCU7IC8qIE5lZWRlZCBmb3IgY29uc2lzdGVudCBzaXppbmcgKHdpZHRoKSBvZiB0aGUgaW5wdXQgKi8KfQoKCTwvc3R5bGU+CjwvYm9uZC13aXRoLWRlc2NyaXB0aW9uPgo8Ym9uZC13aXRoLWRlc2NyaXB0aW9uPgoJPGJvbmQtZGVzY3JpcHRpb24gdGl0bGU9J1RoaXMgYm9uZCBpcyBhc3NpZ25lZCB0byB2YXJpYWJsZSBgbnRgJz4KCQlOYW1lZFR1cGxlCgk8L2JvbmQtZGVzY3JpcHRpb24+Cgk8Ym9uZC12YWx1ZT4KCQk8c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48cG9wb3V0LWNvbnRhaW5lciBrZXk9J3B6c2Rnc2hlZ3QnPgoJPHBvcG91dC1oZWFkZXI+PHNwYW4gY2xhc3M9J3BvcG91dC1pY29uIHBvcG91dCc+PC9zcGFuPjwvcG9wb3V0LWhlYWRlcj4KCTxwb3BvdXQtY29udGVudHM+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZGNsbXBjYXB4Zicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGJvbmQgZGVmPSJudCIgdW5pcXVlX2lkPSJKWEhJLzFnUEs3SVkiPjxzdHJ1Y3QtYm9uZCBjbGFzcz0nTmFtZWRUdXBsZXsoU3ltYm9sKCZxdW90OyMjMjM1JnF1b3Q7KSwgOmEsIDpiLCA6Yyl9Jz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgY2xhc3M9Jyc+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+TmFtZWRUdXBsZTwvc3Bhbj4KCQk8aW5wdXQgdHlwZT0nY2hlY2tib3gnIGNsYXNzPSd0b2dnbGUnIGNoZWNrZWQ+Cgk8L3RvZ2dsZXJlYWN0aXZlLWhlYWRlcj4KCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJCTxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3ZzdGtkb2JmZnInIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J21zY3BnZGpjbHcnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2EnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2EnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGFgIj5EZXNjcmlwdGlvbjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdhaXRqbG5vaWVhJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2FpdGpsbm9pZWEnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhaXRqbG5vaWVhIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdtc2NwZ2RqY2x3JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSdiJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdiJyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGBiYCI+PGRpdiBjbGFzcz0ibWFya2Rvd24iPjxwPjxzdHJvbmc+Qm9sZDwvc3Ryb25nPiBmaWVsZDwvcD4KPC9kaXY+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2InPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J25rZ3pmb3BlYWInIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nbmtnemZvcGVhYic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gIm5rZ3pmb3BlYWIiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J21zY3BnZGpjbHcnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2MnPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2MnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGNgIj5jPC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2MnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3BzaXJmeWx2bnInIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ncHNpcmZ5bHZucic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInBzaXJmeWx2bnIiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdtc2NwZ2RqY2x3Jz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibXNjcGdkamNsdyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CgkJCgk8c2NyaXB0PgoJCWNvbnN0IHRyYyA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgndG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyJykKCQljb25zdCBoZWFkZXIgPSB0cmMuZmlyc3RFbGVtZW50Q2hpbGQKCQljb25zdCBkZXNjID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgIlRoaXMgZ2VuZXJhdGVzIGEgc3RydWN0IG9mIHR5cGUgTmFtZWRUdXBsZSIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJCQlmbGV4OiAxOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd2c3RrZG9iZmZyJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAidnN0a2RvYmZmciIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0ncHR6dHhrcXhrbCc+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+CiAgICAgICAgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAtLXNpemU6IDE1cHg7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBhcHBlYXJhbmNlOiBub25lOwogICAgYmFja2dyb3VuZDogI2M2YzZjNjsKICAgIG91dGxpbmU6IG5vbmU7CiAgICBib3JkZXItcmFkaXVzOiBjYWxjKHZhcigtLXNpemUpLzIpOwogICAgYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICBtYXJnaW46IDAgMTBweDsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewogICAgYmFja2dyb3VuZDogIzRCRDg2NTsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CiAgICBjb250ZW50OiAnJzsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB0b3A6IDBweDsKICAgIGxlZnQ6IDBweDsKICAgIGJhY2tncm91bmQ6ICNmZmY7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CiAgICBib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICB0cmFuc2l0aW9uOiAuMXM7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CiAgICBsZWZ0OiB2YXIoLS1zaXplKQp9CQkKCTwvc3R5bGU+CjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoKCTxzY3JpcHQgaWQ9J3loZGdtc2FyYnUnPgoJCQoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IHdpZGdldCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCgkJLy8gT3ZlcndyaXRlIHRoZSBkZXNjcmlwdGlvbgoJCWNvbnN0IGRlc2MgPSB3aWRnZXQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLmlubmVySFRNTCA9ICJNeSBGYW5jeSBOVHVwbGUiCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CjwvYm9uZD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvcG9wb3V0LWNvbnRlbnRzPgo8L3BvcG91dC1jb250YWluZXI+CjxzY3JpcHQgaWQ9J3B6c2Rnc2hlZ3QnPgoJLy8gTG9hZCB0aGUgZmxvYXRpbmctdWkgYW5kIGludGVyYWN0IGxpYnJhcmllcwoJd2luZG93LmZsb2F0aW5nX3VpID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9AZmxvYXRpbmctdWkvZG9tJykKCgljb25zdCB7IGNvbXB1dGVQb3NpdGlvbiwgYXV0b1BsYWNlbWVudCB9ID0gZmxvYXRpbmdfdWkKCQoJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgljb25zdCBoZWFkZXIgPSBjb250YWluZXIuZmlyc3RFbGVtZW50Q2hpbGQKCWNvbnN0IGNvbnRlbnRzID0gY29udGFpbmVyLmxhc3RFbGVtZW50Q2hpbGQKCgkvLyBMb2FkIHRoZSBpbnRlcmFjdGpzIHBhcnQKCQkvLyBXZSB1c2UgdGhlIGludGVyYWN0anMgbGlicmFyeSB0byBwcm92aWRlIGRyYWcgYW5kIHJlc2l6ZSBoYW5kbGluZyBhY3Jvc3MgZGV2aWNlcwoJY29uc3QgeyBkZWZhdWx0OiBpbnRlcmFjdCB9ID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9pbnRlcmFjdGpzJykKCgljb250ZW50cy5vZmZzZXQgPSBjb250ZW50cy5vZmZzZXQgPz8geyB4OiAwLCB5OiAwfQoJY29uc3Qgc3RhcnRQb3NpdGlvbiA9IHt4OiAwLCB5OiAwfQoJaW50ZXJhY3QoY29udGVudHMucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC5kZXNjcmlwdGlvbiwgYm9uZHNsaXN0LWhlYWRlciAuZGVzY3JpcHRpb24nKSkuZHJhZ2dhYmxlKHsKCQlsaXN0ZW5lcnM6IHsKCQkJc3RhcnQgKGV2ZW50KSB7CgkJCQljb250ZW50cy5vZmZzZXQueSA9IHN0YXJ0UG9zaXRpb24ueSA9IGNvbnRlbnRzLm9mZnNldFRvcAoJCQkJY29udGVudHMub2Zmc2V0LnggPSBzdGFydFBvc2l0aW9uLnggPSBjb250ZW50cy5vZmZzZXRMZWZ0CgkJCX0sCgkJCW1vdmUgKGV2ZW50KSB7CgkJICAgICAgY29udGVudHMub2Zmc2V0LnggKz0gZXZlbnQuZHgKCQkgICAgICBjb250ZW50cy5vZmZzZXQueSArPSBldmVudC5keQoJCQoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLnRvcCA9IGBtaW4oOTV2aCwgJHtjb250ZW50cy5vZmZzZXQueX1weGAKCQkgICAgICBjb250ZW50cy5zdHlsZS5sZWZ0ID0gYG1pbig5NXZ3LCAke2NvbnRlbnRzLm9mZnNldC54fXB4YAoJCSAgICB9LAoJCX0KCX0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gaGVhZGVyIHJlc2V0IHRoZSBwb3NpdGlvbgoJCWNvbnRhaW5lci5wb3BvdXQoKQoJfSkKCWludGVyYWN0KGNvbnRlbnRzKQoJICAucmVzaXphYmxlKHsKCSAgICBlZGdlczogeyB0b3A6IHRydWUsIGxlZnQ6IGZhbHNlLCBib3R0b206IHRydWUsIHJpZ2h0OiB0cnVlIH0sCgkgICAgbGlzdGVuZXJzOiB7CgkgICAgICBtb3ZlOiBmdW5jdGlvbiAoZXZlbnQpIHsJCQoJICAgICAgICBPYmplY3QuYXNzaWduKGV2ZW50LnRhcmdldC5zdHlsZSwgewoJICAgICAgICAgIHdpZHRoOiBgJHtldmVudC5yZWN0LndpZHRofXB4YCwKCSAgICAgICAgICBoZWlnaHQ6IGAke2V2ZW50LnJlY3QuaGVpZ2h0fXB4YCwKCSAgICAgICAgfSkKCSAgICAgIH0KCSAgICB9CgkgIH0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gcmVzaXplIHJlc2V0IHRoZSB3aWR0aAoJCQljb250ZW50cy5zdHlsZS53aWR0aCA9ICcnCgkJICAJY29udGVudHMuc3R5bGUuaGVpZ2h0ID0gJycKCSAgfSkKCgoJZnVuY3Rpb24gcG9zaXRpb25Db250ZW50cygpIHsKCQljb21wdXRlUG9zaXRpb24oaGVhZGVyLCBjb250ZW50cywgewoJCQlzdHJhdGVneTogImZpeGVkIiwKCQkJbWlkZGxld2FyZTogW2F1dG9QbGFjZW1lbnQoKV0sCgkJfSkudGhlbigocG9zKSA9PiB7CgkJCWNvbnRlbnRzLnN0eWxlLmxlZnQgPSBwb3MueCArICJweCIKCQkJY29udGVudHMuc3R5bGUudG9wID0gcG9zLnkgKyAicHgiCgkJfSkKCX0KCgljb250YWluZXIucG9wb3V0ID0gKGZvcmNlID0gdW5kZWZpbmVkKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ3BvcHBlZCcsIGZvcmNlKQoJCXBvc2l0aW9uQ29udGVudHMoKQoJfQoKCWhlYWRlci5vbmNsaWNrID0gKGUpID0+IHtjb250YWluZXIucG9wb3V0KCl9CgoJY29udGVudHMub25tb3VzZWVudGVyID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb250ZW50cy1ob3ZlcicsIHRydWUpCgljb250ZW50cy5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgZmFsc2UpCgoJaGVhZGVyLm9ubW91c2VlbnRlciA9IChlKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIHRydWUpCgkJY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygncG9wcGVkJykgPyBudWxsIDogcG9zaXRpb25Db250ZW50cygpCgl9CgloZWFkZXIub25tb3VzZWxlYXZlID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItaG92ZXInLCBmYWxzZSkKPC9zY3JpcHQ+CjxzdHlsZT4KCXBvcG91dC1oZWFkZXIgewogICAgZGlzcGxheTogZmxleDsKICAgIGJvcmRlcjogM3B4IGRhc2hlZCB0cmFuc3BhcmVudDsKICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKfQpwb3BvdXQtY29udGVudHMgewogICAgZGlzcGxheTogbm9uZTsKICAgIHdpZHRoOiA0MDBweDsKICAgIGJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICAgIGJvcmRlcjogM3B4IHNvbGlkIHZhcigtLW92ZXJsYXktYnV0dG9uLWJvcmRlcik7CiAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgcGFkZGluZzogOHB4Owp9CnBvcG91dC1jb250YWluZXIucG9wcGVkID4gcG9wb3V0LWNvbnRlbnRzLApwb3BvdXQtY29udGFpbmVyLmhlYWRlci1ob3ZlciA+IHBvcG91dC1jb250ZW50cyB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgIHotaW5kZXg6IDUwMDsKfQpwb3BvdXQtY29udGFpbmVyLmNvbnRlbnRzLWhvdmVyID4gcG9wb3V0LWhlYWRlciB7CiAgICBib3JkZXItY29sb3I6IHZhcigtLXBsdXRvLWxvZ3Mtd2Fybi1hY2NlbnQtY29sb3IpOwp9Ci5wb3BvdXQtaWNvbiB7CiAgICAtLXNpemU6IDIwcHg7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CiAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKICAgIG1pbi1oZWlnaHQ6IHZhcigtLXNpemUpOwogICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKfQoucG9wb3V0LWljb24ucG9wb3V0IHsJCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9leHBhbmQuc3ZnKTsKfQpwb3BvdXQtY29udGFpbmVyLnBvcHBlZCAucG9wb3V0IHsKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NvbnRyYWN0LnN2Zyk7Cn0KcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKICAgIHRvdWNoLWFjdGlvbjogbm9uZTsKICAgIHVzZXItc2VsZWN0OiBub25lOwp9Cjwvc3R5bGU+CjxzY3JpcHQgaWQ9J2RjbG1wY2FweGYnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJkY2xtcGNhcHhmIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+Cgk8L2JvbmQtdmFsdWU+Cgk8c3R5bGU+CgkJYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKICBkaXNwbGF5OiBncmlkOwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIDAuNGZyKTsKICBncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CiAganVzdGlmeS1pdGVtczogY2VudGVyOwp9CmJvbmR0YWJsZS1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24sCmJvbmRzbGlzdC1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24gewogIGRpc3BsYXk6IGNvbnRlbnRzOwp9CmJvbmQtdmFsdWUgYm9uZCB7CiAgZGlzcGxheTogZmxleDsgLyogTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dCAqLwp9CmJvbmQtdmFsdWUgaW5wdXQgewogIHdpZHRoOiAxMDAlOyAvKiBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0ICovCn0KCgk8L3N0eWxlPgo8L2JvbmQtd2l0aC1kZXNjcmlwdGlvbj4KPGJvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCTxib25kLWRlc2NyaXB0aW9uIHRpdGxlPSdUaGlzIGJvbmQgaXMgYXNzaWduZWQgdG8gdmFyaWFibGUgYHNic2AnPgoJCVN0cnVjdEJvbmRTZWxlY3QKCTwvYm9uZC1kZXNjcmlwdGlvbj4KCTxib25kLXZhbHVlPgoJCTxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwb3BvdXQtY29udGFpbmVyIGtleT0ncmJ1bmx1YWltcic+Cgk8cG9wb3V0LWhlYWRlcj48c3BhbiBjbGFzcz0ncG9wb3V0LWljb24gcG9wb3V0Jz48L3NwYW4+PC9wb3BvdXQtaGVhZGVyPgoJPHBvcG91dC1jb250ZW50cz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdiZXBrdmN3d2Z6JyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48Ym9uZCBkZWY9InNicyIgdW5pcXVlX2lkPSJYT1NkWi9FMy9SU0wiPjx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgY2xhc3M9J3N0cnVjdGJvbmQtc2VsZWN0Jz4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5TdHJ1Y3RCb25kU2VsZWN0PC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ndGp0aHd6dmJ2ZScgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHN0cnVjdGJvbmQtc2VsZWN0PgogICAgPHNwYW4gY2xhc3M9InNlbGVjdG9yIj4KICAgICAgICA8c3BhbiBjbGFzcz0iZGVzY3JpcHRpb24iPk9wdGlvbnM6PC9zcGFuPgogICAgICAgIDxzZWxlY3Q+PG9wdGlvbiB2YWx1ZT0ncHVpc2VsZWN0LTEnPmNvcyhhcmcpPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0ncHVpc2VsZWN0LTInIHNlbGVjdGVkPScnPmF0YW4oeSx4KTwvb3B0aW9uPjwvc2VsZWN0PgogICAgPC9zcGFuPgogICAgPHN0cnVjdC1ib25kIGNsYXNzPSdOYW1lZFR1cGxleyhTeW1ib2woJnF1b3Q7IyMyMzYmcXVvdDspLCA6YXJnKX0nPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBjbGFzcz0nJz4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5OYW1lZFR1cGxlPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYmRodmNod3hybycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZGJyb29wdHB5Yicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYXJnJz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSdhcmcnIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGFyZ2AiPmFyZzwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdhcmcnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J3l1Z2V1ZmtxbWsnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwMCcgdmFsdWU9JzEnPjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3l1Z2V1ZmtxbWsnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ5dWdldWZrcW1rIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KPHNjcmlwdCBpZD0nZGJyb29wdHB5Yic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImRicm9vcHRweWIiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgoJCQoJPHNjcmlwdD4KCQljb25zdCB0cmMgPSBjdXJyZW50U2NyaXB0LmNsb3Nlc3QoJ3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcicpCgkJY29uc3QgaGVhZGVyID0gdHJjLmZpcnN0RWxlbWVudENoaWxkCgkJY29uc3QgZGVzYyA9IGhlYWRlci5xdWVyeVNlbGVjdG9yKCcuZGVzY3JpcHRpb24nKQoJCWRlc2Muc2V0QXR0cmlidXRlKCd0aXRsZScsICJUaGlzIGdlbmVyYXRlcyBhIHN0cnVjdCBvZiB0eXBlIE5hbWVkVHVwbGUiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCQkJZmxleDogMTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYmRodmNod3hybyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImJkaHZjaHd4cm8iCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J3lneGN1ZnpqY3cnPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgogICAgICAgIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewogICAgY3Vyc29yOiBwb2ludGVyOwogICAgLS1zaXplOiAxNXB4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIGJhY2tncm91bmQ6ICNjNmM2YzY7CiAgICBvdXRsaW5lOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgbWFyZ2luOiAwIDEwcHg7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKICAgIGJhY2tncm91bmQ6ICM0QkQ4NjU7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewogICAgY29udGVudDogJyc7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgdG9wOiAwcHg7CiAgICBsZWZ0OiAwcHg7CiAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgdHJhbnNpdGlvbjogLjFzOwp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewogICAgbGVmdDogdmFyKC0tc2l6ZSkKfQkJCgk8L3N0eWxlPgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSdmd3ppeGNqanJiJz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiY29zKGFyZykiCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CjxzdHJ1Y3QtYm9uZCBjbGFzcz0nTmFtZWRUdXBsZXsoU3ltYm9sKCZxdW90OyMjMjM3JnF1b3Q7KSwgOngsIDp5KX0nPgoJPHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBjbGFzcz0nJz4KCTx0b2dnbGVyZWFjdGl2ZS1oZWFkZXI+CgkJPHNwYW4gY2xhc3M9J2Rlc2NyaXB0aW9uJz5OYW1lZFR1cGxlPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0neGJodm51b3ViZycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nbHVmZ2x6enF0cicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0neCc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0neCcgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgeGAiPng8L2ZpZWxkLWRlc2NyaXB0aW9uPgoJCQk8ZmllbGQtYm9uZCBjbGFzcz0neCc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nZnhwYmFsZmxtcycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PGlucHV0IHR5cGU9J3JhbmdlJyBtaW49JzEnIG1heD0nMTAxJyB2YWx1ZT0nMzEnPjxzY3JpcHQ+CgkJCQkJY29uc3QgaW5wdXRfZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQkJCQljb25zdCBvdXRwdXRfZWwgPSBjdXJyZW50U2NyaXB0Lm5leHRFbGVtZW50U2libGluZwoJCQkJCWNvbnN0IGRpc3BsYXlzID0gWyIwLjAiLCAiMC4xIiwgIjAuMiIsICIwLjMiLCAiMC40IiwgIjAuNSIsICIwLjYiLCAiMC43IiwgIjAuOCIsICIwLjkiLCAiMS4wIiwgIjEuMSIsICIxLjIiLCAiMS4zIiwgIjEuNCIsICIxLjUiLCAiMS42IiwgIjEuNyIsICIxLjgiLCAiMS45IiwgIjIuMCIsICIyLjEiLCAiMi4yIiwgIjIuMyIsICIyLjQiLCAiMi41IiwgIjIuNiIsICIyLjciLCAiMi44IiwgIjIuOSIsICIzLjAiLCAiMy4xIiwgIjMuMiIsICIzLjMiLCAiMy40IiwgIjMuNSIsICIzLjYiLCAiMy43IiwgIjMuOCIsICIzLjkiLCAiNC4wIiwgIjQuMSIsICI0LjIiLCAiNC4zIiwgIjQuNCIsICI0LjUiLCAiNC42IiwgIjQuNyIsICI0LjgiLCAiNC45IiwgIjUuMCIsICI1LjEiLCAiNS4yIiwgIjUuMyIsICI1LjQiLCAiNS41IiwgIjUuNiIsICI1LjciLCAiNS44IiwgIjUuOSIsICI2LjAiLCAiNi4xIiwgIjYuMiIsICI2LjMiLCAiNi40IiwgIjYuNSIsICI2LjYiLCAiNi43IiwgIjYuOCIsICI2LjkiLCAiNy4wIiwgIjcuMSIsICI3LjIiLCAiNy4zIiwgIjcuNCIsICI3LjUiLCAiNy42IiwgIjcuNyIsICI3LjgiLCAiNy45IiwgIjguMCIsICI4LjEiLCAiOC4yIiwgIjguMyIsICI4LjQiLCAiOC41IiwgIjguNiIsICI4LjciLCAiOC44IiwgIjguOSIsICI5LjAiLCAiOS4xIiwgIjkuMiIsICI5LjMiLCAiOS40IiwgIjkuNSIsICI5LjYiLCAiOS43IiwgIjkuOCIsICI5LjkiLCAiMTAuMCJdCgoJCQkJCWxldCB1cGRhdGVfb3V0cHV0ID0gKCkgPT4gewoJCQkJCQlvdXRwdXRfZWwudmFsdWUgPSBkaXNwbGF5c1tpbnB1dF9lbC52YWx1ZUFzTnVtYmVyIC0gMV0KCQkJCQl9CgkJCQkJCgkJCQkJaW5wdXRfZWwuYWRkRXZlbnRMaXN0ZW5lcigiaW5wdXQiLCB1cGRhdGVfb3V0cHV0KQoJCQkJCS8vIFdlIGFsc28gcG9sbCBmb3IgY2hhbmdlcyBiZWNhdXNlIHRoZSBgaW5wdXRfZWwudmFsdWVgIGNhbiBjaGFuZ2UgZnJvbSB0aGUgb3V0c2lkZSwgZS5nLiBodHRwczovL2dpdGh1Yi5jb20vSnVsaWFQbHV0by9QbHV0b1VJLmpsL2lzc3Vlcy8yNzcKCQkJCQlsZXQgaWQgPSBzZXRJbnRlcnZhbCh1cGRhdGVfb3V0cHV0LCAyMDApCgkJCQkJaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJCQkJCQljbGVhckludGVydmFsKGlkKQoJCQkJCQlpbnB1dF9lbC5yZW1vdmVFdmVudExpc3RlbmVyKCJpbnB1dCIsIHVwZGF0ZV9vdXRwdXQpCgkJCQkJfSkKCQkJCQk8L3NjcmlwdD48b3V0cHV0IHN0eWxlPScKCQkJCQkJZm9udC1mYW1pbHk6IHN5c3RlbS11aTsKICAgIAkJCQkJZm9udC1zaXplOiAxNXB4OwogICAgCQkJCQltYXJnaW4tbGVmdDogM3B4OwogICAgCQkJCQl0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTRweCk7CiAgICAJCQkJCWRpc3BsYXk6IGlubGluZS1ibG9jazsnPjMuMDwvb3V0cHV0PjwvcGwtY29tYmluZWQtY2hpbGQ+PC9maWVsZC1ib25kPgoJCTwvZmllbGQtaHRtbD4KCQk8c3R5bGU+CgkJCWZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJLy9wYWRkaW5nOiAycHggNXB4IDEwcHggMHB4OwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJfQoJCQlmaWVsZC1ib25kIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJZmllbGQtYm9uZCBpbnB1dCB7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQogICAJCQlmaWVsZC1kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J2Z4cGJhbGZsbXMnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJmeHBiYWxmbG1zIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD48cGwtY29tYmluZWQtY2hpbGQga2V5PSdsdWZnbHp6cXRyJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3BhbiBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz4JCTxmaWVsZC1odG1sIGNsYXNzPSd5Jz4KCQkJPGZpZWxkLWRlc2NyaXB0aW9uIGNsYXNzPSd5JyB0aXRsZT0iVGhpcyB2YWx1ZSBpcyBhc3NvY2lhdGVkIHRvIGZpZWxkIGB5YCI+eTwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSd5Jz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdrZXdnd3Z1dGNmJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48aW5wdXQgdHlwZT0ncmFuZ2UnIG1pbj0nMScgbWF4PScxMDEnIHZhbHVlPSc1MSc+PHNjcmlwdD4KCQkJCQljb25zdCBpbnB1dF9lbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCQkJCWNvbnN0IG91dHB1dF9lbCA9IGN1cnJlbnRTY3JpcHQubmV4dEVsZW1lbnRTaWJsaW5nCgkJCQkJY29uc3QgZGlzcGxheXMgPSBbIjAuMCIsICIwLjEiLCAiMC4yIiwgIjAuMyIsICIwLjQiLCAiMC41IiwgIjAuNiIsICIwLjciLCAiMC44IiwgIjAuOSIsICIxLjAiLCAiMS4xIiwgIjEuMiIsICIxLjMiLCAiMS40IiwgIjEuNSIsICIxLjYiLCAiMS43IiwgIjEuOCIsICIxLjkiLCAiMi4wIiwgIjIuMSIsICIyLjIiLCAiMi4zIiwgIjIuNCIsICIyLjUiLCAiMi42IiwgIjIuNyIsICIyLjgiLCAiMi45IiwgIjMuMCIsICIzLjEiLCAiMy4yIiwgIjMuMyIsICIzLjQiLCAiMy41IiwgIjMuNiIsICIzLjciLCAiMy44IiwgIjMuOSIsICI0LjAiLCAiNC4xIiwgIjQuMiIsICI0LjMiLCAiNC40IiwgIjQuNSIsICI0LjYiLCAiNC43IiwgIjQuOCIsICI0LjkiLCAiNS4wIiwgIjUuMSIsICI1LjIiLCAiNS4zIiwgIjUuNCIsICI1LjUiLCAiNS42IiwgIjUuNyIsICI1LjgiLCAiNS45IiwgIjYuMCIsICI2LjEiLCAiNi4yIiwgIjYuMyIsICI2LjQiLCAiNi41IiwgIjYuNiIsICI2LjciLCAiNi44IiwgIjYuOSIsICI3LjAiLCAiNy4xIiwgIjcuMiIsICI3LjMiLCAiNy40IiwgIjcuNSIsICI3LjYiLCAiNy43IiwgIjcuOCIsICI3LjkiLCAiOC4wIiwgIjguMSIsICI4LjIiLCAiOC4zIiwgIjguNCIsICI4LjUiLCAiOC42IiwgIjguNyIsICI4LjgiLCAiOC45IiwgIjkuMCIsICI5LjEiLCAiOS4yIiwgIjkuMyIsICI5LjQiLCAiOS41IiwgIjkuNiIsICI5LjciLCAiOS44IiwgIjkuOSIsICIxMC4wIl0KCgkJCQkJbGV0IHVwZGF0ZV9vdXRwdXQgPSAoKSA9PiB7CgkJCQkJCW91dHB1dF9lbC52YWx1ZSA9IGRpc3BsYXlzW2lucHV0X2VsLnZhbHVlQXNOdW1iZXIgLSAxXQoJCQkJCX0KCQkJCQkKCQkJCQlpbnB1dF9lbC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIHVwZGF0ZV9vdXRwdXQpCgkJCQkJLy8gV2UgYWxzbyBwb2xsIGZvciBjaGFuZ2VzIGJlY2F1c2UgdGhlIGBpbnB1dF9lbC52YWx1ZWAgY2FuIGNoYW5nZSBmcm9tIHRoZSBvdXRzaWRlLCBlLmcuIGh0dHBzOi8vZ2l0aHViLmNvbS9KdWxpYVBsdXRvL1BsdXRvVUkuamwvaXNzdWVzLzI3NwoJCQkJCWxldCBpZCA9IHNldEludGVydmFsKHVwZGF0ZV9vdXRwdXQsIDIwMCkKCQkJCQlpbnZhbGlkYXRpb24udGhlbigoKSA9PiB7CgkJCQkJCWNsZWFySW50ZXJ2YWwoaWQpCgkJCQkJCWlucHV0X2VsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImlucHV0IiwgdXBkYXRlX291dHB1dCkKCQkJCQl9KQoJCQkJCTwvc2NyaXB0PjxvdXRwdXQgc3R5bGU9JwoJCQkJCQlmb250LWZhbWlseTogc3lzdGVtLXVpOwogICAgCQkJCQlmb250LXNpemU6IDE1cHg7CiAgICAJCQkJCW1hcmdpbi1sZWZ0OiAzcHg7CiAgICAJCQkJCXRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNHB4KTsKICAgIAkJCQkJZGlzcGxheTogaW5saW5lLWJsb2NrOyc+NS4wPC9vdXRwdXQ+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0na2V3Z3d2dXRjZic+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImtld2d3dnV0Y2YiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPgo8c2NyaXB0IGlkPSdsdWZnbHp6cXRyJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibHVmZ2x6enF0ciIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CgkJCgk8c2NyaXB0PgoJCWNvbnN0IHRyYyA9IGN1cnJlbnRTY3JpcHQuY2xvc2VzdCgndG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyJykKCQljb25zdCBoZWFkZXIgPSB0cmMuZmlyc3RFbGVtZW50Q2hpbGQKCQljb25zdCBkZXNjID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgIlRoaXMgZ2VuZXJhdGVzIGEgc3RydWN0IG9mIHR5cGUgTmFtZWRUdXBsZSIpCgoJCS8vIGFkZCB0aGUgY29sbGFwc2UgYnV0dG9uCgkJY29uc3QgY29sbGFwc2VfYnRuID0gaHRtbGA8c3BhbiBjbGFzcz0nY29sbGFwc2UnPmAKCQloZWFkZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgY29sbGFwc2VfYnRuKQoKCQl0cmMuY29sbGFwc2UgPSAoKSA9PiB7CiAgCQkJdHJjLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcpCgkJfQoKCQljb2xsYXBzZV9idG4ub25jbGljayA9IChlKSA9PiB0cmMuY29sbGFwc2UoKQoJCQoJPC9zY3JpcHQ+CgkJPHN0eWxlPgoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBjb250ZW50czsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgewoJCQkJZGlzcGxheTogZ3JpZDsKCQkJCWdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIC40ZnIpOwoJCQkJZ3JpZC1hdXRvLXJvd3M6IGZpdC1jb250ZW50KDQwcHgpOwoJCQkJanVzdGlmeS1pdGVtczogY2VudGVyOwoJCQkJYWxpZ24taXRlbXM6IGNlbnRlcjsKCQkJCXJvdy1nYXA6IDVweDsKCQkJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJCQlmbGV4OiAxOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlncmlkLWNvbHVtbjogMSAvIC0xOwoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJLS1zaXplOiAxN3B4OwoJCQkgICAgZGlzcGxheTogYmxvY2s7CgkJCSAgICBhbGlnbi1zZWxmOiBzdHJldGNoOwoJCQkgICAgYmFja2dyb3VuZC1zaXplOiB2YXIoLS1zaXplKSB2YXIoLS1zaXplKTsKCQkJICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CgkJCSAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CgkJCSAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CgkJCSAgICBmaWx0ZXI6IHZhcigtLWltYWdlLWZpbHRlcnMpOwoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CgkJCQljdXJzb3I6IHBvaW50ZXI7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCA+IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWZvcndhcmQuc3ZnKTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZGlzcGxheTogZmxleDsKCQkJCWFsaWduLWl0ZW1zOiBzdHJldGNoOwoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJCWZsZXgtZ3JvdzogMTsKCQkJCWZvbnQtc2l6ZTogMThweDsKCQkJCWZvbnQtd2VpZ2h0OiA2MDA7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CgkJCQlhbGlnbi1zZWxmOiBjZW50ZXIKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciArICogewoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSd4Ymh2bnVvdWJnJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAieGJodm51b3ViZyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPgoJPHNjcmlwdCBpZD0nYXV0c3pjbG1tZSc+CgkJY29uc3QgcGFyZW50ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CgkJY29uc3QgZWwgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQljb25zdCB0b2dnbGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC50b2dnbGUnKQoKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgoJCS8vIFdlIHVzZSBjbG9uZSB0byBhdm9pZCBwb2ludGluZyB0byB0aGUgc2FtZSBhcnJheQoJCWxldCBwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoKCQlmdW5jdGlvbiBkaXNwYXRjaCgpIHsKCQkJcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCgkJY29uc3Qgb2xkX29uaW5wdXQgPSBlbC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWlmICh0b2dnbGUuY2hlY2tlZCkge2Rpc3BhdGNoKCl9CgkJfQoKCQl0b2dnbGUub25pbnB1dCA9IGUgPT4gewoJCQlpZiAodG9nZ2xlLmNoZWNrZWQgJiYgIV8uaXNFcXVhbChnZXRfaW5wdXRfdmFsdWUoZWwpLCBwdWJsaWNfdmFsdWUpKSB7CgkJCQlkaXNwYXRjaCgpCgkJCX0KCQkJZS5zdG9wUHJvcGFnYXRpb24oKQoJCX0KCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KHBhcmVudCwgJ3ZhbHVlJywgewoJCQlnZXQ6ICgpID0+IHB1YmxpY192YWx1ZSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlwdWJsaWNfdmFsdWUgPSBuZXd2YWwKCQkJCQoJCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWwpCgkJCQl0b2dnbGUuY2hlY2tlZCA9IHRydWUKCQkJfSwKCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCX0pOwoJPC9zY3JpcHQ+Cgk8c3R5bGU+CiAgICAgICAgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZSB7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAtLXNpemU6IDE1cHg7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB3aWR0aDogY2FsYygyKnZhcigtLXNpemUpKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBhcHBlYXJhbmNlOiBub25lOwogICAgYmFja2dyb3VuZDogI2M2YzZjNjsKICAgIG91dGxpbmU6IG5vbmU7CiAgICBib3JkZXItcmFkaXVzOiBjYWxjKHZhcigtLXNpemUpLzIpOwogICAgYm94LXNoYWRvdzogaW5zZXQgMCAwIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICBtYXJnaW46IDAgMTBweDsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQgewogICAgYmFja2dyb3VuZDogIzRCRDg2NTsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmJlZm9yZSB7CiAgICBjb250ZW50OiAnJzsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKICAgIGhlaWdodDogdmFyKC0tc2l6ZSk7CiAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICB0b3A6IDBweDsKICAgIGxlZnQ6IDBweDsKICAgIGJhY2tncm91bmQ6ICNmZmY7CiAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMSk7CiAgICBib3gtc2hhZG93OiAwIGNhbGModmFyKC0tc2l6ZSkvMjApIGNhbGModmFyKC0tc2l6ZSkvOCkgcmdiYSgwLDAsMCwuMik7CiAgICB0cmFuc2l0aW9uOiAuMXM7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkOmJlZm9yZSB7CiAgICBsZWZ0OiB2YXIoLS1zaXplKQp9CQkKCTwvc3R5bGU+CjwvdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPgoKCTxzY3JpcHQgaWQ9J29nYXJhY2J4Y2snPgoJCQoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IHdpZGdldCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCgkJLy8gT3ZlcndyaXRlIHRoZSBkZXNjcmlwdGlvbgoJCWNvbnN0IGRlc2MgPSB3aWRnZXQucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLmlubmVySFRNTCA9ICJhdGFuKHkseCkiCgkKCQkvLyBTZXQtR2V0IGJvbmQKCQoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBnZXRfaW5wdXRfdmFsdWUod2lkZ2V0KSwKCQkJc2V0OiAobmV3dmFsKSA9PiB7CgkJCQlzZXRfaW5wdXRfdmFsdWUod2lkZ2V0LCBuZXd2YWwpCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCQoJCWNvbnN0IG9sZF9vbmlucHV0ID0gd2lkZ2V0Lm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQl3aWRnZXQub25pbnB1dCA9IChlKSA9PiB7CgkJCW9sZF9vbmlucHV0KGUpCgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQkJcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdpbnB1dCcpKQoJCX0KCTwvc2NyaXB0PgoJPHN0eWxlPgoJCS8qIFRoZSBmbGV4IGJlbG93IGlzIG5lZWRlZCBpbiBzb21lIHdlaXJkIGNhc2VzIHdoZXJlIHRoZSBib25kIGlzIGRpc3BsYXkgZmxleCBhbmQgdGhlIGNoaWxkIGJlY29tZXMgc21hbGwuICovCgkJc3RydWN0LWJvbmQgewogIAkJCWZsZXg6IDE7CgkJfQoJPC9zdHlsZT4KCTwvc3RydWN0LWJvbmQ+CgogICAgPHNjcmlwdD4KICAgICAgICBjb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKICAgICAgICBjb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwogICAgICAgIGNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCiAgICAgICAgCiAgICAgICAgLy8gVGhpcyBpcyB0aGUgZWxlbWVudCBvZiB0aGUgc2VsZWN0IGRyb3Bkb3duCiAgICAgICAgY29uc3Qgc2VsZWN0ID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoInNlbGVjdCIpCgogICAgICAgIC8vIFRoaXMgd2lsbCBob2xkIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgc3RydWN0Ym9uZCBlbGVtZW50CiAgICAgICAgbGV0IHNlbGVjdGVkCgogICAgICAgIGNvbnN0IHVwZGF0ZSA9ICgpID0+IHsKICAgICAgICAgICAgcGFyZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIpKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0X3NlbGVjdF92YWx1ZSgpIHsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBnZXRfaW5wdXRfdmFsdWUoc2VsZWN0KQogICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodmFsdWUuc3Vic3RyaW5nKDEwKSkKICAgICAgICB9CgogICAgICAgIGNvbnN0IGNoYW5nZV9zZWxlY3Rpb24gPSAodmFsdWUsIHRyaWdnZXJfZXZlbnQgPSB0cnVlKSA9PiB7CiAgICAgICAgICAgIHNldF9pbnB1dF92YWx1ZShzZWxlY3QsIGBwdWlzZWxlY3QtJHt2YWx1ZX1gKQogICAgICAgICAgICBjb25zdCBib25kcyA9IHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKCJzdHJ1Y3QtYm9uZCIpCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9uZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChpICE9IHZhbHVlIC0gMSkgewogICAgICAgICAgICAgICAgICAgIGJvbmRzW2ldLmNsYXNzTGlzdC50b2dnbGUoImhpZGRlbiIsIHRydWUpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGJvbmRzW2ldLmNsYXNzTGlzdC50b2dnbGUoImhpZGRlbiIsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gYm9uZHNbaV0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHJpZ2dlcl9ldmVudCkgewogICAgICAgICAgICAgICAgdXBkYXRlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgY2hhbmdlX3NlbGVjdGlvbihnZXRfc2VsZWN0X3ZhbHVlKCksIGZhbHNlKQoKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAidmFsdWUiLCB7CiAgICAgICAgICAgIGdldDogKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBnZXRfc2VsZWN0X3ZhbHVlKCkKICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZ2V0X2lucHV0X3ZhbHVlKHNlbGVjdGVkKQogICAgICAgICAgICAgICAgcmV0dXJuIFtpbmRleCwgdmFsdWVdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldDogKG5ld3ZhbCkgPT4gewogICAgICAgICAgICAgICAgY2hhbmdlX3NlbGVjdGlvbihuZXd2YWxbMF0sIGZhbHNlKQogICAgICAgICAgICAgICAgc2V0X2lucHV0X3ZhbHVlKHNlbGVjdGVkLCBuZXd2YWxbMV0pCiAgICAgICAgICAgIH0sCiAgICAgICAgfSkKCiAgICAgICAgLy8gV2UgYWRkIGEgbGlzdGVuZXIgdGhhdCBleHRyYWN0IHRoZSBmb3J3YXJkIHRoZSBpbnB1dCBldmVudCBpbiBjYXNlIHRoZSB0YXJnZXQgb2YgdGhlIGV2ZW50IGlzIHRoZSBzZWxlY3RlZCBib25kCiAgICAgICAgZm9yIChsZXQgYm9uZCBvZiBwYXJlbnQucXVlcnlTZWxlY3RvckFsbCgic3RydWN0LWJvbmQiKSkgewogICAgICAgICAgICBib25kLmFkZEV2ZW50TGlzdGVuZXIoImlucHV0IiwgKGUpID0+IHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgICAgIGlmIChib25kID09IHNlbGVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CgogICAgICAgIHNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIChlKSA9PiB7CiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgY2hhbmdlX3NlbGVjdGlvbihnZXRfc2VsZWN0X3ZhbHVlKCkpCiAgICAgICAgfSkKICAgIDwvc2NyaXB0PgogICAgPHN0eWxlPgogICAgICAgIHN0cnVjdGJvbmQtc2VsZWN0IHRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcjpmaXJzdC1vZi10eXBlLm5vLXBvcG91dDpiZWZvcmUgewogIGRpc3BsYXk6IG5vbmU7Cn0KCnN0cnVjdGJvbmQtc2VsZWN0ID4gc3RydWN0LWJvbmQuaGlkZGVuIHsKICBkaXNwbGF5OiBub25lOwp9CgpzdHJ1Y3Rib25kLXNlbGVjdCwKc3RydWN0Ym9uZC1zZWxlY3QgPiBzdHJ1Y3QtYm9uZCwKc3RydWN0Ym9uZC1zZWxlY3QgdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKICBkaXNwbGF5OiBjb250ZW50czsKfQoKc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3IgewogIGRpc3BsYXk6IGNvbnRlbnRzOwp9CgpzdHJ1Y3Rib25kLXNlbGVjdCA+IC5zZWxlY3RvciAuZGVzY3JpcHRpb24gewogIGNvbG9yOiB2YXIoLS1wbHV0by1vdXRwdXQtY29sb3IsICM0MDQwNDApOwp9CgpzdHJ1Y3Rib25kLXNlbGVjdCA+c3RydWN0LWJvbmQ+dG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyPnRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CiAgZGlzcGxheTogbm9uZTsKfQoKc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3Igc2VsZWN0IHsKICAgIHBhZGRpbmc6IDZweCAxMnB4OwogICAgYm9yZGVyOiAycHggc29saWQgI2U3ZTdlNzsKICAgIGJvcmRlci1yYWRpdXM6IDZweDsKICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICAgIGNvbG9yOiB2YXIoLS1wbHV0by1vdXRwdXQtY29sb3IsICM0MDQwNDApOwogICAgZm9udC1mYW1pbHk6IGluaGVyaXQ7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICBvdXRsaW5lOiBub25lOwogICAgdHJhbnNpdGlvbjogYm9yZGVyLWNvbG9yIDAuMnM7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAKICAgIC8qIFNpemUgY29uc3RyYWludHMgKi8KICAgIG1heC13aWR0aDogNTBweDsgCiAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgCiAgICAvKiBDdXN0b20gYXJyb3cgc3R5bGluZyAqLwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsKICAgIC1tb3otYXBwZWFyYW5jZTogbm9uZTsKICAgIC8qIExpZ2h0IG1vZGUgYXJyb3cgLSAjNDA0MDQwICovCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoImRhdGE6aW1hZ2Uvc3ZnK3htbDtjaGFyc2V0PVVURi04LCUzY3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCcgZmlsbD0nbm9uZScgc3Ryb2tlPSclMjM0MDQwNDAnIHN0cm9rZS13aWR0aD0nMicgc3Ryb2tlLWxpbmVjYXA9J3JvdW5kJyBzdHJva2UtbGluZWpvaW49J3JvdW5kJyUzZSUzY3BvbHlsaW5lIHBvaW50cz0nNiA5IDEyIDE1IDE4IDknJTNlJTNjL3BvbHlsaW5lJTNlJTNjL3N2ZyUzZSIpOwogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IHJpZ2h0IDhweCBjZW50ZXI7CiAgICBiYWNrZ3JvdW5kLXNpemU6IDE2cHg7CiAgICBwYWRkaW5nLXJpZ2h0OiAzMnB4OwogICAgbWluLXdpZHRoOiAxMjBweDsKfQoKc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3Igc2VsZWN0OmhvdmVyIHsKICAgIGJvcmRlci1jb2xvcjogI2QwZDBkMDsKfQoKc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3Igc2VsZWN0OmZvY3VzIHsKICAgIGJvcmRlci1jb2xvcjogI2MwYzBjMDsKfQoKQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewogICAgc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3Igc2VsZWN0IHsKICAgICAgICBib3JkZXItY29sb3I6ICM3ZDdkN2Q7CiAgICAgICAgY29sb3I6IHZhcigtLXBsdXRvLW91dHB1dC1jb2xvciwgI2M0YzRjNCk7CiAgICAgICAgLyogRGFyayBtb2RlIGFycm93IC0gI2M0YzRjNCAqLwogICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiZGF0YTppbWFnZS9zdmcreG1sO2NoYXJzZXQ9VVRGLTgsJTNjc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDI0IDI0JyBmaWxsPSdub25lJyBzdHJva2U9JyUyM2M0YzRjNCcgc3Ryb2tlLXdpZHRoPScyJyBzdHJva2UtbGluZWNhcD0ncm91bmQnIHN0cm9rZS1saW5lam9pbj0ncm91bmQnJTNlJTNjcG9seWxpbmUgcG9pbnRzPSc2IDkgMTIgMTUgMTggOSclM2UlM2MvcG9seWxpbmUlM2UlM2Mvc3ZnJTNlIik7CiAgICB9CiAgICAKICAgIHN0cnVjdGJvbmQtc2VsZWN0ID4gLnNlbGVjdG9yIHNlbGVjdDpob3ZlciB7CiAgICAgICAgYm9yZGVyLWNvbG9yOiAjOGE4YThhOwogICAgfQogICAgCiAgICBzdHJ1Y3Rib25kLXNlbGVjdCA+IC5zZWxlY3RvciBzZWxlY3Q6Zm9jdXMgewogICAgICAgIGJvcmRlci1jb2xvcjogIzdkN2Q3ZDsKICAgIH0KfQoKLyogQWRkIHN0eWxpbmcgZm9yIGRyb3Bkb3duIG9wdGlvbnMgKi8Kc3RydWN0Ym9uZC1zZWxlY3QgPiAuc2VsZWN0b3Igc2VsZWN0IG9wdGlvbiB7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KCnRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5zdHJ1Y3Rib25kLXNlbGVjdCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXI6YmVmb3JlIHsKICBjb250ZW50OiAiIjsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogMXB4OwogIGJvdHRvbTogMHB4OwogIGxlZnQ6IDBweDsKICByaWdodDogMHB4OwogIHotaW5kZXg6IC0xOwogIGJhY2tncm91bmQ6ICNjOGVkZDU7ICAKfQoKdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLnN0cnVjdGJvbmQtc2VsZWN0IHRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHotaW5kZXg6IDEwOwp9CgpAbWVkaWEgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKSB7CiAgdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLnN0cnVjdGJvbmQtc2VsZWN0IHRvZ2dsZXJlYWN0aXZlLWhlYWRlcjpiZWZvcmUgewogICAgYmFja2dyb3VuZDogIzI2NTgyZTsgIAogIH0KfQogICAgPC9zdHlsZT4KPC9zdHJ1Y3Rib25kLXNlbGVjdD4KPC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVXNlIHRoZSBzZWxlY3RvciB0byBjaG9vc2Ugd2hpY2ggU3RydWN0Qm9uZCB0byBkaXNwbGF5IGFuZCB1c2UuIikKCgkJLy8gYWRkIHRoZSBjb2xsYXBzZSBidXR0b24KCQljb25zdCBjb2xsYXBzZV9idG4gPSBodG1sYDxzcGFuIGNsYXNzPSdjb2xsYXBzZSc+YAoJCWhlYWRlci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBjb2xsYXBzZV9idG4pCgoJCXRyYy5jb2xsYXBzZSA9ICgpID0+IHsKICAJCQl0cmMuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJykKCQl9CgoJCWNvbGxhcHNlX2J0bi5vbmNsaWNrID0gKGUpID0+IHRyYy5jb2xsYXBzZSgpCgkJCgk8L3NjcmlwdD4KCQk8c3R5bGU+CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciBmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGNvbnRlbnRzOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lciB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQkJLyogVGhlIGZsZXggYmVsb3cgaXMgbmVlZGVkIGluIHNvbWUgd2VpcmQgY2FzZXMgd2hlcmUgdGhlIGJvbmQgaXMgZGlzcGxheSBmbGV4IGFuZCB0aGUgY2hpbGQgYmVjb21lcyBzbWFsbC4gKi8KCQkJCWZsZXg6IDE7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWdyaWQtY29sdW1uOiAxIC8gLTE7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5jb2xsYXBzZSB7CgkJCQktLXNpemU6IDE3cHg7CgkJCSAgICBkaXNwbGF5OiBibG9jazsKCQkJICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CgkJCSAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwoJCQkgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKCQkJICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKCQkJICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKCQkJICAgIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7CgkJCQliYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9jaGV2cm9uLWRvd24uc3ZnKTsKCQkJCWN1cnNvcjogcG9pbnRlcjsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIuY29sbGFwc2VkID4gdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZm9yd2FyZC5zdmcpOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQkJYWxpZ24taXRlbXM6IHN0cmV0Y2g7CgkJCQl3aWR0aDogMTAwJTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJZmxleC1ncm93OiAxOwoJCQkJZm9udC1zaXplOiAxOHB4OwoJCQkJZm9udC13ZWlnaHQ6IDYwMDsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKCQkJCWFsaWduLXNlbGY6IGNlbnRlcgoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyICsgKiB7CgkJCQlkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CgkJCX0KCQk8L3N0eWxlPgoJCTxzY3JpcHQgaWQ9J3RqdGh3enZidmUnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJ0anRod3p2YnZlIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+Cgk8c2NyaXB0IGlkPSdhZGtjdHVremF5Jz4KCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCBlbCA9IGN1cnJlbnRTY3JpcHQucHJldmlvdXNFbGVtZW50U2libGluZwoJCWNvbnN0IHRvZ2dsZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgLnRvZ2dsZScpCgoJCWNvbnN0IHNldF9pbnB1dF92YWx1ZSA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkJY29uc3QgZ2V0X2lucHV0X3ZhbHVlID0gZ2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCgkJLy8gV2UgdXNlIGNsb25lIHRvIGF2b2lkIHBvaW50aW5nIHRvIHRoZSBzYW1lIGFycmF5CgkJbGV0IHB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgoJCWZ1bmN0aW9uIGRpc3BhdGNoKCkgewoJCQlwdWJsaWNfdmFsdWUgPSBfLmNsb25lRGVlcChnZXRfaW5wdXRfdmFsdWUoZWwpKQoJCQlwYXJlbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2lucHV0JykpCgkJfQoKCQljb25zdCBvbGRfb25pbnB1dCA9IGVsLm9uaW5wdXQgPz8gZnVuY3Rpb24oZSkge30KCQllbC5vbmlucHV0ID0gKGUpID0+IHsKCQkJb2xkX29uaW5wdXQoZSkKCQkJaWYgKHRvZ2dsZS5jaGVja2VkKSB7ZGlzcGF0Y2goKX0KCQl9CgoJCXRvZ2dsZS5vbmlucHV0ID0gZSA9PiB7CgkJCWlmICh0b2dnbGUuY2hlY2tlZCAmJiAhXy5pc0VxdWFsKGdldF9pbnB1dF92YWx1ZShlbCksIHB1YmxpY192YWx1ZSkpIHsKCQkJCWRpc3BhdGNoKCkKCQkJfQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJfQoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gcHVibGljX3ZhbHVlLAoJCQlzZXQ6IChuZXd2YWwpID0+IHsKCQkJCXB1YmxpY192YWx1ZSA9IG5ld3ZhbAoJCQkJCgkJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbCkKCQkJCXRvZ2dsZS5jaGVja2VkID0gdHJ1ZQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7Cgk8L3NjcmlwdD4KCTxzdHlsZT4KICAgICAgICB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlIHsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIC0tc2l6ZTogMTVweDsKICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgIHdpZHRoOiBjYWxjKDIqdmFyKC0tc2l6ZSkpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGFwcGVhcmFuY2U6IG5vbmU7CiAgICBiYWNrZ3JvdW5kOiAjYzZjNmM2OwogICAgb3V0bGluZTogbm9uZTsKICAgIGJvcmRlci1yYWRpdXM6IGNhbGModmFyKC0tc2l6ZSkvMik7CiAgICBib3gtc2hhZG93OiBpbnNldCAwIDAgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIG1hcmdpbjogMCAxMHB4Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZCB7CiAgICBiYWNrZ3JvdW5kOiAjNEJEODY1Owp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6YmVmb3JlIHsKICAgIGNvbnRlbnQ6ICcnOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgd2lkdGg6IHZhcigtLXNpemUpOwogICAgaGVpZ2h0OiB2YXIoLS1zaXplKTsKICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgIHRvcDogMHB4OwogICAgbGVmdDogMHB4OwogICAgYmFja2dyb3VuZDogI2ZmZjsKICAgIHRyYW5zZm9ybTogc2NhbGUoMS4xKTsKICAgIGJveC1zaGFkb3c6IDAgY2FsYyh2YXIoLS1zaXplKS8yMCkgY2FsYyh2YXIoLS1zaXplKS84KSByZ2JhKDAsMCwwLC4yKTsKICAgIHRyYW5zaXRpb246IC4xczsKfQp0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAudG9nZ2xlOmNoZWNrZWQ6YmVmb3JlIHsKICAgIGxlZnQ6IHZhcigtLXNpemUpCn0JCQoJPC9zdHlsZT4KPC90b2dnbGVyZWFjdGl2ZS1jb250YWluZXI+CjwvYm9uZD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvcG9wb3V0LWNvbnRlbnRzPgo8L3BvcG91dC1jb250YWluZXI+CjxzY3JpcHQgaWQ9J3JidW5sdWFpbXInPgoJLy8gTG9hZCB0aGUgZmxvYXRpbmctdWkgYW5kIGludGVyYWN0IGxpYnJhcmllcwoJd2luZG93LmZsb2F0aW5nX3VpID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9AZmxvYXRpbmctdWkvZG9tJykKCgljb25zdCB7IGNvbXB1dGVQb3NpdGlvbiwgYXV0b1BsYWNlbWVudCB9ID0gZmxvYXRpbmdfdWkKCQoJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgljb25zdCBoZWFkZXIgPSBjb250YWluZXIuZmlyc3RFbGVtZW50Q2hpbGQKCWNvbnN0IGNvbnRlbnRzID0gY29udGFpbmVyLmxhc3RFbGVtZW50Q2hpbGQKCgkvLyBMb2FkIHRoZSBpbnRlcmFjdGpzIHBhcnQKCQkvLyBXZSB1c2UgdGhlIGludGVyYWN0anMgbGlicmFyeSB0byBwcm92aWRlIGRyYWcgYW5kIHJlc2l6ZSBoYW5kbGluZyBhY3Jvc3MgZGV2aWNlcwoJY29uc3QgeyBkZWZhdWx0OiBpbnRlcmFjdCB9ID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9pbnRlcmFjdGpzJykKCgljb250ZW50cy5vZmZzZXQgPSBjb250ZW50cy5vZmZzZXQgPz8geyB4OiAwLCB5OiAwfQoJY29uc3Qgc3RhcnRQb3NpdGlvbiA9IHt4OiAwLCB5OiAwfQoJaW50ZXJhY3QoY29udGVudHMucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC5kZXNjcmlwdGlvbiwgYm9uZHNsaXN0LWhlYWRlciAuZGVzY3JpcHRpb24nKSkuZHJhZ2dhYmxlKHsKCQlsaXN0ZW5lcnM6IHsKCQkJc3RhcnQgKGV2ZW50KSB7CgkJCQljb250ZW50cy5vZmZzZXQueSA9IHN0YXJ0UG9zaXRpb24ueSA9IGNvbnRlbnRzLm9mZnNldFRvcAoJCQkJY29udGVudHMub2Zmc2V0LnggPSBzdGFydFBvc2l0aW9uLnggPSBjb250ZW50cy5vZmZzZXRMZWZ0CgkJCX0sCgkJCW1vdmUgKGV2ZW50KSB7CgkJICAgICAgY29udGVudHMub2Zmc2V0LnggKz0gZXZlbnQuZHgKCQkgICAgICBjb250ZW50cy5vZmZzZXQueSArPSBldmVudC5keQoJCQoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLnRvcCA9IGBtaW4oOTV2aCwgJHtjb250ZW50cy5vZmZzZXQueX1weGAKCQkgICAgICBjb250ZW50cy5zdHlsZS5sZWZ0ID0gYG1pbig5NXZ3LCAke2NvbnRlbnRzLm9mZnNldC54fXB4YAoJCSAgICB9LAoJCX0KCX0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gaGVhZGVyIHJlc2V0IHRoZSBwb3NpdGlvbgoJCWNvbnRhaW5lci5wb3BvdXQoKQoJfSkKCWludGVyYWN0KGNvbnRlbnRzKQoJICAucmVzaXphYmxlKHsKCSAgICBlZGdlczogeyB0b3A6IHRydWUsIGxlZnQ6IGZhbHNlLCBib3R0b206IHRydWUsIHJpZ2h0OiB0cnVlIH0sCgkgICAgbGlzdGVuZXJzOiB7CgkgICAgICBtb3ZlOiBmdW5jdGlvbiAoZXZlbnQpIHsJCQoJICAgICAgICBPYmplY3QuYXNzaWduKGV2ZW50LnRhcmdldC5zdHlsZSwgewoJICAgICAgICAgIHdpZHRoOiBgJHtldmVudC5yZWN0LndpZHRofXB4YCwKCSAgICAgICAgICBoZWlnaHQ6IGAke2V2ZW50LnJlY3QuaGVpZ2h0fXB4YCwKCSAgICAgICAgfSkKCSAgICAgIH0KCSAgICB9CgkgIH0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gcmVzaXplIHJlc2V0IHRoZSB3aWR0aAoJCQljb250ZW50cy5zdHlsZS53aWR0aCA9ICcnCgkJICAJY29udGVudHMuc3R5bGUuaGVpZ2h0ID0gJycKCSAgfSkKCgoJZnVuY3Rpb24gcG9zaXRpb25Db250ZW50cygpIHsKCQljb21wdXRlUG9zaXRpb24oaGVhZGVyLCBjb250ZW50cywgewoJCQlzdHJhdGVneTogImZpeGVkIiwKCQkJbWlkZGxld2FyZTogW2F1dG9QbGFjZW1lbnQoKV0sCgkJfSkudGhlbigocG9zKSA9PiB7CgkJCWNvbnRlbnRzLnN0eWxlLmxlZnQgPSBwb3MueCArICJweCIKCQkJY29udGVudHMuc3R5bGUudG9wID0gcG9zLnkgKyAicHgiCgkJfSkKCX0KCgljb250YWluZXIucG9wb3V0ID0gKGZvcmNlID0gdW5kZWZpbmVkKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ3BvcHBlZCcsIGZvcmNlKQoJCXBvc2l0aW9uQ29udGVudHMoKQoJfQoKCWhlYWRlci5vbmNsaWNrID0gKGUpID0+IHtjb250YWluZXIucG9wb3V0KCl9CgoJY29udGVudHMub25tb3VzZWVudGVyID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb250ZW50cy1ob3ZlcicsIHRydWUpCgljb250ZW50cy5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgZmFsc2UpCgoJaGVhZGVyLm9ubW91c2VlbnRlciA9IChlKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIHRydWUpCgkJY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygncG9wcGVkJykgPyBudWxsIDogcG9zaXRpb25Db250ZW50cygpCgl9CgloZWFkZXIub25tb3VzZWxlYXZlID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItaG92ZXInLCBmYWxzZSkKPC9zY3JpcHQ+CjxzdHlsZT4KCXBvcG91dC1oZWFkZXIgewogICAgZGlzcGxheTogZmxleDsKICAgIGJvcmRlcjogM3B4IGRhc2hlZCB0cmFuc3BhcmVudDsKICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKfQpwb3BvdXQtY29udGVudHMgewogICAgZGlzcGxheTogbm9uZTsKICAgIHdpZHRoOiA0MDBweDsKICAgIGJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICAgIGJvcmRlcjogM3B4IHNvbGlkIHZhcigtLW92ZXJsYXktYnV0dG9uLWJvcmRlcik7CiAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgcGFkZGluZzogOHB4Owp9CnBvcG91dC1jb250YWluZXIucG9wcGVkID4gcG9wb3V0LWNvbnRlbnRzLApwb3BvdXQtY29udGFpbmVyLmhlYWRlci1ob3ZlciA+IHBvcG91dC1jb250ZW50cyB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgIHotaW5kZXg6IDUwMDsKfQpwb3BvdXQtY29udGFpbmVyLmNvbnRlbnRzLWhvdmVyID4gcG9wb3V0LWhlYWRlciB7CiAgICBib3JkZXItY29sb3I6IHZhcigtLXBsdXRvLWxvZ3Mtd2Fybi1hY2NlbnQtY29sb3IpOwp9Ci5wb3BvdXQtaWNvbiB7CiAgICAtLXNpemU6IDIwcHg7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CiAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKICAgIG1pbi1oZWlnaHQ6IHZhcigtLXNpemUpOwogICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKfQoucG9wb3V0LWljb24ucG9wb3V0IHsJCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9leHBhbmQuc3ZnKTsKfQpwb3BvdXQtY29udGFpbmVyLnBvcHBlZCAucG9wb3V0IHsKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NvbnRyYWN0LnN2Zyk7Cn0KcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKICAgIHRvdWNoLWFjdGlvbjogbm9uZTsKICAgIHVzZXItc2VsZWN0OiBub25lOwp9Cjwvc3R5bGU+CjxzY3JpcHQgaWQ9J2JlcGt2Y3d3ZnonPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJiZXBrdmN3d2Z6Igpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+Cgk8L2JvbmQtdmFsdWU+Cgk8c3R5bGU+CgkJYm9uZC13aXRoLWRlc2NyaXB0aW9uIHsKICBkaXNwbGF5OiBncmlkOwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIG1pbm1heChtaW4oNTBweCwgMTAwJSksIDAuNGZyKTsKICBncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CiAganVzdGlmeS1pdGVtczogY2VudGVyOwp9CmJvbmR0YWJsZS1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24sCmJvbmRzbGlzdC1jb250ZW50cyBib25kLXdpdGgtZGVzY3JpcHRpb24gewogIGRpc3BsYXk6IGNvbnRlbnRzOwp9CmJvbmQtdmFsdWUgYm9uZCB7CiAgZGlzcGxheTogZmxleDsgLyogTmVlZGVkIGZvciBjb25zaXN0ZW50IHNpemluZyAod2lkdGgpIG9mIHRoZSBpbnB1dCAqLwp9CmJvbmQtdmFsdWUgaW5wdXQgewogIHdpZHRoOiAxMDAlOyAvKiBOZWVkZWQgZm9yIGNvbnNpc3RlbnQgc2l6aW5nICh3aWR0aCkgb2YgdGhlIGlucHV0ICovCn0KCgk8L3N0eWxlPgo8L2JvbmQtd2l0aC1kZXNjcmlwdGlvbj4KCQoJPC9ib25kc2xpc3QtY29udGVudHM+Cgk8c2NyaXB0IGlkPSdxa2t1enpsbmdjJz4KCQljb25zdCBjb250YWluZXIgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb250YWluZXIuY29sbGFwc2UgPSAoZm9yY2UpID0+IHsKCQkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbGxhcHNlZCcsIGZvcmNlKQoJCX0KCQljb25zdCBjb2xsYXBzZV9idG4gPSBjb250YWluZXIucXVlcnlTZWxlY3Rvcignc3Bhbi5jb2xsYXBzZScpCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gY29udGFpbmVyLmNvbGxhcHNlKCkKCTwvc2NyaXB0PgoJPHN0eWxlPgoJYm9uZHNsaXN0LWhlYWRlciB7CiAgZ3JpZC1jb2x1bW46IDEgLyAtMTsKICBkaXNwbGF5OiBmbGV4OwogIGJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKfQpib25kc2xpc3QtaGVhZGVyOmJlZm9yZSB7CiAgY29udGVudDogIiI7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDFweDsKICBib3R0b206IDBweDsKICBsZWZ0OiAwcHg7CiAgcmlnaHQ6IDBweDsKICB6LWluZGV4OiAtMTsKICBiYWNrZ3JvdW5kOiAjZmZhYzQ1NDA7Cn0KYm9uZHNsaXN0LWNvbnRhaW5lci5uby1wb3BvdXQgPiBib25kc2xpc3QtaGVhZGVyIHsKICBhbGlnbi1zZWxmOiBzdGFydDsKICBwb3NpdGlvbjogc3RpY2t5OwogIHRvcDogMHB4OwogIHBhZGRpbmctdG9wOiAxMnB4OwogIG1hcmdpbi10b3A6IC0xMnB4OwogIHotaW5kZXg6IDEwOwp9CmJvbmRzbGlzdC1jb250ZW50cyB7CiAgZGlzcGxheTogY29udGVudHM7Cn0KYm9uZHNsaXN0LWNvbnRhaW5lci5uby1wb3BvdXQ6YmVmb3JlIHsKICBjb250ZW50OiAiIjsKICBkaXNwbGF5OiBibG9jazsKICBncmlkLWNvbHVtbjogMSAvIC0xOwogIGp1c3RpZnktc2VsZjogY2VudGVyOwogIGJvcmRlci1ib3R0b206IDJweCBzb2xpZDsKICBwYWRkaW5nLXRvcDogNXB4OwogIHdpZHRoOiAxMDAlOwogIGFsaWduLXNlbGY6IHN0YXJ0OwogIHBvc2l0aW9uOiBzdGlja3k7CiAgdG9wOiAwcHg7CiAgYmFja2dyb3VuZDogdmFyKC0tb3ZlcmxheS1idXR0b24tYmcpOwogIHotaW5kZXg6IDIwOwp9CmJvbmRzbGlzdC1oZWFkZXIgPiAuYm9uZHNsaXN0LWljb24gewogIC0tc2l6ZTogMTdweDsKICBkaXNwbGF5OiBibG9jazsKICBhbGlnbi1zZWxmOiBzdHJldGNoOwogIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CiAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CiAgd2lkdGg6IHZhcigtLXNpemUpOwogIGZpbHRlcjogdmFyKC0taW1hZ2UtZmlsdGVycyk7Cn0KYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1kb3duLnN2Zyk7CiAgY3Vyc29yOiBwb2ludGVyOwp9CmJvbmRzbGlzdC1jb250YWluZXIuY29sbGFwc2VkID4gYm9uZHNsaXN0LWhlYWRlciA+IC5jb2xsYXBzZSB7CiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7Cn0KYm9uZHNsaXN0LWhlYWRlciA+IC50b2dnbGUgewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICB3aWR0aDogMzBweDsKICBtYXJnaW46IDAgMTBweDsKfQpib25kc2xpc3QtaGVhZGVyIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBzdHJldGNoOwogIHdpZHRoOiAxMDAlOwp9CmJvbmRzbGlzdC1oZWFkZXIgPiAuZGVzY3JpcHRpb24gewogIHRleHQtYWxpZ246IGNlbnRlcjsKICBmbGV4LWdyb3c6IDE7CiAgZm9udC1zaXplOiAxOHB4OwogIGZvbnQtd2VpZ2h0OiA2MDA7Cn0KYm9uZHNsaXN0LWhlYWRlciA+IC50b2dnbGUgewogIGFsaWduLXNlbGY6IGNlbnRlcjsKfQpib25kc2xpc3QtY29udGFpbmVyLmNvbGxhcHNlZCBib25kc2xpc3QtaGVhZGVyICsgKiB7CiAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50Owp9CmJvbmRzbGlzdC1jb250YWluZXIgewogIGRpc3BsYXk6IGdyaWQ7CiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgMC40ZnIpOwogIGdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKICBqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICByb3ctZ2FwOiA1cHg7Cn0KYm9uZHN0YWJsZS1jb250YWluZXIgYm9uZHNsaXN0LWNvbnRhaW5lciB7CiAgZGlzcGxheTogY29udGVudHM7Cn0KCQkKCTwvc3R5bGU+CjwvYm9uZHNsaXN0LWNvbnRhaW5lcj4KpG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZaNibGOybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU3I+hgsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ4MTFjZjc4Yi1lODcwLTQ1YmItOTE3My04OWEzYjNkNDk1ZjW5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4CZ7IZtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkNjNkNmMyZGYtYTQxMS00MDdjLWFmMTEtNGY1ZDA5ZmJiMzIyiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9keaCkbWltZap0ZXh0L3BsYWlurHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU29BVysHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ2M2Q2YzJkZi1hNDExLTQwN2MtYWYxMS00ZjVkMDlmYmIzMjK5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4v6evEtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkNDg0Mzk4M2MtZGY2NC00Yjk0LTg2MzQtN2ExMGQ5NDIzYTcwiqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9kedkwPGRpdiBjbGFzcz0ibWFya2Rvd24iPjxoMT5TdHJ1Y3RCb25kPC9oMT4KPC9kaXY+pG1pbWWpdGV4dC9odG1srHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU0RomxsHBlcnNpc3RfanNfc3RhdGXCt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SQ0ODQzOTgzYy1kZjY0LTRiOTQtODYzNC03YTEwZDk0MjNhNzC5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZc4AA+vOtXB1Ymxpc2hlZF9vYmplY3Rfa2V5c5C4ZGVwZW5kc19vbl9za2lwcGVkX2NlbGxzwqdlcnJvcmVkwtkkYTU0OTBhNmItZGMxMS00MmI3LTg3ZTAtZDM4ODcwZmM1NWU0iqZxdWV1ZWTCpGxvZ3OQp3J1bm5pbmfCpm91dHB1dIakYm9keaYyLjBlMTCkbWltZap0ZXh0L3BsYWlurHJvb3Rhc3NpZ25lZcCybGFzdF9ydW5fdGltZXN0YW1wy0HaAZU3sSv+sHBlcnNpc3RfanNfc3RhdGXDt2hhc19wbHV0b19ob29rX2ZlYXR1cmVzwqdjZWxsX2lk2SRhNTQ5MGE2Yi1kYzExLTQyYjctODdlMC1kMzg4NzBmYzU1ZTS5ZGVwZW5kc19vbl9kaXNhYmxlZF9jZWxsc8KncnVudGltZS+1cHVibGlzaGVkX29iamVjdF9rZXlzkLhkZXBlbmRzX29uX3NraXBwZWRfY2VsbHPCp2Vycm9yZWTC2SQ2MzMwMjlhZi04Y2FjLTQyNmUtYjM1Yy1jOWZiMzkzOGI3ODSKpnF1ZXVlZMKkbG9nc5CncnVubmluZ8Kmb3V0cHV0hqRib2R52l6ZPGJvbmQgZGVmPSJsb2xfcG9wIiB1bmlxdWVfaWQ9Inp6aUgmIzQzO2Yybm05OEQiPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxwb3BvdXQtY29udGFpbmVyIGtleT0nanJid3VqYmFuaCc+Cgk8cG9wb3V0LWhlYWRlcj48c3BhbiBjbGFzcz0ncG9wb3V0LWljb24gcG9wb3V0Jz48L3NwYW4+PC9wb3BvdXQtaGVhZGVyPgoJPHBvcG91dC1jb250ZW50cz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdhaWxtbmJoemZoJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c3RydWN0LWJvbmQgY2xhc3M9J01haW4udmFyJnF1b3Q7d29ya3NwYWNlIzMmcXVvdDsuTE9MJz4KCTx0b2dnbGVyZWFjdGl2ZS1jb250YWluZXIgY2xhc3M9Jyc+Cgk8dG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJCTxzcGFuIGNsYXNzPSdkZXNjcmlwdGlvbic+TE9MPC9zcGFuPgoJCTxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2xhc3M9J3RvZ2dsZScgY2hlY2tlZD4KCTwvdG9nZ2xlcmVhY3RpdmUtaGVhZGVyPgoJPHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQkJPHBsLWNvbWJpbmVkLWNoaWxkIGtleT0ncWplcnd1aG1sdycgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHBsLWNvbWJpbmVkLWNoaWxkIGtleT0nYXBobGpiZnl6Zicgc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+PHNwYW4gc3R5bGU9J2Rpc3BsYXk6IGNvbnRlbnRzOyc+CQk8ZmllbGQtaHRtbCBjbGFzcz0nYSc+CgkJCTxmaWVsZC1kZXNjcmlwdGlvbiBjbGFzcz0nYScgdGl0bGU9IlRoaXMgdmFsdWUgaXMgYXNzb2NpYXRlZCB0byBmaWVsZCBgYWAiPjxkaXYgY2xhc3M9Im1hcmtkb3duIj48cD5Xb25kZXImIzMzOzwvcD4KPC9kaXY+PC9maWVsZC1kZXNjcmlwdGlvbj4KCQkJPGZpZWxkLWJvbmQgY2xhc3M9J2EnPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2JyY2pqdnZzbHMnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxpbnB1dCB0eXBlPSdyYW5nZScgbWluPScxJyBtYXg9JzEwJyB2YWx1ZT0nMSc+PC9wbC1jb21iaW5lZC1jaGlsZD48L2ZpZWxkLWJvbmQ+CgkJPC9maWVsZC1odG1sPgoJCTxzdHlsZT4KCQkJZmllbGQtaHRtbCB7CgkJCQlkaXNwbGF5OiBncmlkOwoJCQkJZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgbWlubWF4KG1pbig1MHB4LCAxMDAlKSwgLjRmcik7CgkJCQlncmlkLWF1dG8tcm93czogZml0LWNvbnRlbnQoNDBweCk7CgkJCQlqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7CgkJCQkvL3BhZGRpbmc6IDJweCA1cHggMTBweCAwcHg7CgkJCQlhbGlnbi1pdGVtczogY2VudGVyOwoJCQkJcm93LWdhcDogNXB4OwoJCQl9CgkJCWZpZWxkLWJvbmQgewoJCQkJZGlzcGxheTogZmxleDsKCQkJfQoJCQlmaWVsZC1ib25kIGlucHV0IHsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CiAgIAkJCWZpZWxkLWRlc2NyaXB0aW9uIHsKCQkJCXRleHQtYWxpZ246IGNlbnRlcjsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0nYnJjamp2dnNscyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gImJyY2pqdnZzbHMiCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj48L3BsLWNvbWJpbmVkLWNoaWxkPjxwbC1jb21iaW5lZC1jaGlsZCBrZXk9J2FwaGxqYmZ5emYnIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPjxzcGFuIHN0eWxlPSdkaXNwbGF5OiBjb250ZW50czsnPgkJPGZpZWxkLWh0bWwgY2xhc3M9J2InPgoJCQk8ZmllbGQtZGVzY3JpcHRpb24gY2xhc3M9J2InIHRpdGxlPSJUaGlzIHZhbHVlIGlzIGFzc29jaWF0ZWQgdG8gZmllbGQgYGJgIj48c3Bhbj5GaWVsZCBCPC9zcGFuPjwvZmllbGQtZGVzY3JpcHRpb24+CgkJCTxmaWVsZC1ib25kIGNsYXNzPSdiJz48cGwtY29tYmluZWQtY2hpbGQga2V5PSdua3dveHZra2pvJyBzdHlsZT0nZGlzcGxheTogY29udGVudHM7Jz48c2NyaXB0PgovLyB3ZWlyZCBpbXBvcnQgdG8gbWFrZSBpdCBmYXN0ZXIuIFRoZSBgYXdhaXQgaW1wb3J0YCBjYW4gc3RpbGwgZGVsYXkgZXhlY3V0aW9uIGJ5IG9uZSBmcmFtZSBpZiBpdCBpcyBhbHJlYWR5IGxvYWRlZC4uLgp3aW5kb3cuZDNmb3JtYXQgPSB3aW5kb3cuZDNmb3JtYXQgPz8gYXdhaXQgaW1wb3J0KCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcm1hdEAyLytlc20iKQoKY29uc3QgYXJnbWluID0geHMgPT4geHMuaW5kZXhPZihNYXRoLm1pbiguLi54cykpCmNvbnN0IGNsb3Nlc3RfaW5kZXggPSAoeHMsIHkpID0+IGFyZ21pbih4cy5tYXAoeCA9PiBNYXRoLmFicyh4LXkpKSkKCmNvbnN0IHZhbHVlcyA9IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMF0KCmNvbnN0IGVsID0gaHRtbGAKPHNwYW4gdGl0bGU9IkNsaWNrIGFuZCBkcmFnIHRoaXMgbnVtYmVyIGxlZnQgb3IgcmlnaHQhIiBzdHlsZT0iY3Vyc29yOiBjb2wtcmVzaXplOwp0b3VjaC1hY3Rpb246IG5vbmU7CmJhY2tncm91bmQ6IHJnYigyNTIsIDIwOSwgMjA0KTsKY29sb3I6IGJsYWNrOwpwYWRkaW5nOiAwZW0gLjJlbTsKYm9yZGVyLXJhZGl1czogLjNlbTsKZm9udC13ZWlnaHQ6IGJvbGQ7Ij42PC9zcGFuPgpgCgoKCmxldCBvbGRfeCA9IDAKbGV0IG9sZF9pbmRleCA9IDAKY29uc3QgaW5pdGlhbF9pbmRleCA9IGNsb3Nlc3RfaW5kZXgodmFsdWVzLCA2KQpsZXQgY3VycmVudF9pbmRleCA9IGluaXRpYWxfaW5kZXgKCmNvbnN0IGZvcm1hdHRlciA9IHMgPT4gIiIgKyBkM2Zvcm1hdC5mb3JtYXQoIiIpKHMpICsgIiIKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZWwsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzW2N1cnJlbnRfaW5kZXhdLAoJc2V0OiB4ID0+IHsKCQljdXJyZW50X2luZGV4ID0gY2xvc2VzdF9pbmRleCh2YWx1ZXMsIHgpCgkJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7CgovLyBpbml0aWFsIHZhbHVlCmVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcig2KQoKY29uc3Qgb25TY3J1YiA9IChlKSA9PiB7Cgljb25zdCBvZmZzZXQgPSBlLmNsaWVudFggLSBvbGRfeAoJY29uc3QgbmV3X2luZGV4ID0gTWF0aC5taW4odmFsdWVzLmxlbmd0aC0xLCBNYXRoLm1heCgwLCAKCQlNYXRoLnJvdW5kKG9mZnNldC8xMCkgKyBvbGRfaW5kZXgKCSkpCgoJaWYobmV3X2luZGV4ICE9PSBjdXJyZW50X2luZGV4KSB7CgkJY3VycmVudF9pbmRleCA9IG5ld19pbmRleAoJCWVsLmlubmVyVGV4dCA9IGZvcm1hdHRlcihlbC52YWx1ZSkKCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiKSkKCX0KfQoKY29uc3Qgb25wb2ludGVyZG93biA9IChlKSA9PiB7Cgl3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHkoKQoJb2xkX3ggPSBlLmNsaWVudFgKCW9sZF9pbmRleCA9IGN1cnJlbnRfaW5kZXgKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVybW92ZSIsIG9uU2NydWIpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoKY29uc3Qgb25kYmxjbGljayA9IChlKSA9PiB7CgljdXJyZW50X2luZGV4ID0gaW5pdGlhbF9pbmRleAoJZWwuaW5uZXJUZXh0ID0gZm9ybWF0dGVyKGVsLnZhbHVlKQoJZWwuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0IikpCn0KZWwuYWRkRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoKY29uc3Qgb25wb2ludGVydXAgPSAoKSA9PiB7Cgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcm1vdmUiLCBvblNjcnViKQp9CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBvbnBvaW50ZXJ1cCkKCmVsLm9uc2VsZWN0c3RhcnQgPSAoKSA9PiBmYWxzZQoKaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gewoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigicG9pbnRlcmRvd24iLCBvbnBvaW50ZXJkb3duKQoJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGJsY2xpY2siLCBvbmRibGNsaWNrKQoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvaW50ZXJ1cCIsIG9ucG9pbnRlcnVwKQp9KQoKcmV0dXJuIGVsCgo8L3NjcmlwdD48L3BsLWNvbWJpbmVkLWNoaWxkPjwvZmllbGQtYm9uZD4KCQk8L2ZpZWxkLWh0bWw+CgkJPHN0eWxlPgoJCQlmaWVsZC1odG1sIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCS8vcGFkZGluZzogMnB4IDVweCAxMHB4IDBweDsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCX0KCQkJZmllbGQtYm9uZCB7CgkJCQlkaXNwbGF5OiBmbGV4OwoJCQl9CgkJCWZpZWxkLWJvbmQgaW5wdXQgewoJCQkJd2lkdGg6IDEwMCU7CgkJCX0KICAgCQkJZmllbGQtZGVzY3JpcHRpb24gewoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQl9CgkJPC9zdHlsZT4KCQk8c2NyaXB0IGlkPSdua3dveHZra2pvJz4KY29uc3QgZGl2ID0gY3VycmVudFNjcmlwdC5wYXJlbnRFbGVtZW50CmxldCBrZXkgPSAibmt3b3h2a2tqbyIKY29uc3QgaW5wdXRzID0gZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoYHBsLWNvbWJpbmVkLWNoaWxkW2tleT0nJHtrZXl9J10gPiAqOmZpcnN0LWNoaWxkYCkKCmNvbnN0IHZhbHVlcyA9IEFycmF5KGlucHV0cy5sZW5ndGgpCgppbnB1dHMuZm9yRWFjaChhc3luYyAoZWwsaSkgPT4gewoJZWwub25pbnB1dCA9IChlKSA9PiB7CgkJZS5zdG9wUHJvcGFnYXRpb24oKQoJfQoJY29uc3QgZ2VuID0gR2VuZXJhdG9ycy5pbnB1dChlbCkKCXdoaWxlKHRydWUpIHsKCQl2YWx1ZXNbaV0gPSBhd2FpdCBnZW4ubmV4dCgpLnZhbHVlCgkJZGl2LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCJpbnB1dCIsIHt9KSkKCX0KfSkKCgpsZXQgc2V0X2lucHV0X3ZhbHVlID0gKCgpID0+IHsKCWxldCByZXN1bHQgPSBudWxsCgl0cnkgewoJcmVzdWx0ID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KfSBjYXRjaCAoZSkgewoJcmVzdWx0ID0gKChpbnB1dCwgbmV3X3ZhbHVlKSA9PiB7CgkvLyBmYWxsYmFjayBpbiBjYXNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mb25zcC9QbHV0by5qbC9wdWxsLzE3NTUgaXMgbm90IGF2YWlsYWJsZQogICAgaWYgKG5ld192YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgICAgICByZXR1cm4KICAgIH0KICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICBzd2l0Y2ggKGlucHV0LnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICBjYXNlICJudW1iZXIiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc051bWJlciAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc051bWJlciA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZGF0ZSI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzRGF0ZSA9PSBudWxsIHx8IE51bWJlcihpbnB1dC52YWx1ZUFzRGF0ZSkgIT09IE51bWJlcihuZXdfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWVBc0RhdGUgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImNoZWNrYm94IjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LmNoZWNrZWQgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImZpbGUiOiB7CiAgICAgICAgICAgICAgICAvLyBDYW4ndCBzZXQgZmlsZXMgOigKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIEhUTUxTZWxlY3RFbGVtZW50ICYmIGlucHV0Lm11bHRpcGxlKSB7CiAgICAgICAgZm9yIChsZXQgb3B0aW9uIG9mIEFycmF5LmZyb20oaW5wdXQub3B0aW9ucykpIHsKICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gbmV3X3ZhbHVlLmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICAvL0B0cy1pZ25vcmUKICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgLy9AdHMtaWdub3JlCiAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdfdmFsdWUKICAgIH0KfSkKfQpyZXR1cm4gcmVzdWx0Cn0pKCkKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZGl2LCAndmFsdWUnLCB7CglnZXQ6ICgpID0+IHZhbHVlcywKCXNldDogKG5ld3ZhbHMpID0+IHsKCQlpZighbmV3dmFscykgewoJCQlyZXR1cm4KCQl9CgkJaW5wdXRzLmZvckVhY2goKGVsLCBpKSA9PiB7CgkJCXZhbHVlc1tpXSA9IG5ld3ZhbHNbaV0KCQkJc2V0X2lucHV0X3ZhbHVlKGVsLCBuZXd2YWxzW2ldKQoJCX0pCn0sCgljb25maWd1cmFibGU6IHRydWUsCn0pOwoKPC9zY3JpcHQ+PC9zcGFuPjwvcGwtY29tYmluZWQtY2hpbGQ+CjxzY3JpcHQgaWQ9J2FwaGxqYmZ5emYnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhcGhsamJmeXpmIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9wbC1jb21iaW5lZC1jaGlsZD4KCQkKCTxzY3JpcHQ+CgkJY29uc3QgdHJjID0gY3VycmVudFNjcmlwdC5jbG9zZXN0KCd0b2dnbGVyZWFjdGl2ZS1jb250YWluZXInKQoJCWNvbnN0IGhlYWRlciA9IHRyYy5maXJzdEVsZW1lbnRDaGlsZAoJCWNvbnN0IGRlc2MgPSBoZWFkZXIucXVlcnlTZWxlY3RvcignLmRlc2NyaXB0aW9uJykKCQlkZXNjLnNldEF0dHJpYnV0ZSgndGl0bGUnLCAiVGhpcyBnZW5lcmF0ZXMgYSBzdHJ1Y3Qgb2YgdHlwZSBMT0wiKQoKCQkvLyBhZGQgdGhlIGNvbGxhcHNlIGJ1dHRvbgoJCWNvbnN0IGNvbGxhcHNlX2J0biA9IGh0bWxgPHNwYW4gY2xhc3M9J2NvbGxhcHNlJz5gCgkJaGVhZGVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIGNvbGxhcHNlX2J0bikKCgkJdHJjLmNvbGxhcHNlID0gKCkgPT4gewogIAkJCXRyYy5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKQoJCX0KCgkJY29sbGFwc2VfYnRuLm9uY2xpY2sgPSAoZSkgPT4gdHJjLmNvbGxhcHNlKCkKCQkKCTwvc2NyaXB0PgoJCTxzdHlsZT4KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIGZpZWxkLWh0bWwgewoJCQkJZGlzcGxheTogY29udGVudHM7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyIHsKCQkJCWRpc3BsYXk6IGdyaWQ7CgkJCQlncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciBtaW5tYXgobWluKDUwcHgsIDEwMCUpLCAuNGZyKTsKCQkJCWdyaWQtYXV0by1yb3dzOiBmaXQtY29udGVudCg0MHB4KTsKCQkJCWp1c3RpZnktaXRlbXM6IGNlbnRlcjsKCQkJCWFsaWduLWl0ZW1zOiBjZW50ZXI7CgkJCQlyb3ctZ2FwOiA1cHg7CgkJCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCQkJZmxleDogMTsKCQkJfQoJCQl0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgewoJCQkJZ3JpZC1jb2x1bW46IDEgLyAtMTsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmNvbGxhcHNlIHsKCQkJCS0tc2l6ZTogMTdweDsKCQkJICAgIGRpc3BsYXk6IGJsb2NrOwoJCQkgICAgYWxpZ24tc2VsZjogc3RyZXRjaDsKCQkJICAgIGJhY2tncm91bmQtc2l6ZTogdmFyKC0tc2l6ZSkgdmFyKC0tc2l6ZSk7CgkJCSAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwoJCQkgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwoJCQkgICAgd2lkdGg6IHZhcigtLXNpemUpOwoJCQkgICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKCQkJCWJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NoZXZyb24tZG93bi5zdmcpOwoJCQkJY3Vyc29yOiBwb2ludGVyOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lci5jb2xsYXBzZWQgPiB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgPiAuY29sbGFwc2UgewoJCQkJYmFja2dyb3VuZC1pbWFnZTogdXJsKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9pb25pYy10ZWFtL2lvbmljb25zQDUuNS4xL3NyYy9zdmcvY2hldnJvbi1mb3J3YXJkLnN2Zyk7CgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtaGVhZGVyIHsKCQkJCWRpc3BsYXk6IGZsZXg7CgkJCQlhbGlnbi1pdGVtczogc3RyZXRjaDsKCQkJCXdpZHRoOiAxMDAlOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC5kZXNjcmlwdGlvbiB7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQlmbGV4LWdyb3c6IDE7CgkJCQlmb250LXNpemU6IDE4cHg7CgkJCQlmb250LXdlaWdodDogNjAwOwoJCQl9CgkJCXRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewoJCQkJYWxpZ24tc2VsZjogY2VudGVyCgkJCX0KCQkJdG9nZ2xlcmVhY3RpdmUtY29udGFpbmVyLmNvbGxhcHNlZCB0b2dnbGVyZWFjdGl2ZS1oZWFkZXIgKyAqIHsKCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKCQkJfQoJCTwvc3R5bGU+CgkJPHNjcmlwdCBpZD0ncWplcnd1aG1sdyc+CmNvbnN0IGRpdiA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudApsZXQga2V5ID0gInFqZXJ3dWhtbHciCmNvbnN0IGlucHV0cyA9IGRpdi5xdWVyeVNlbGVjdG9yQWxsKGBwbC1jb21iaW5lZC1jaGlsZFtrZXk9JyR7a2V5fSddID4gKjpmaXJzdC1jaGlsZGApCgpjb25zdCB2YWx1ZXMgPSBBcnJheShpbnB1dHMubGVuZ3RoKQoKaW5wdXRzLmZvckVhY2goYXN5bmMgKGVsLGkpID0+IHsKCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCX0KCWNvbnN0IGdlbiA9IEdlbmVyYXRvcnMuaW5wdXQoZWwpCgl3aGlsZSh0cnVlKSB7CgkJdmFsdWVzW2ldID0gYXdhaXQgZ2VuLm5leHQoKS52YWx1ZQoJCWRpdi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgiaW5wdXQiLCB7fSkpCgl9Cn0pCgoKbGV0IHNldF9pbnB1dF92YWx1ZSA9ICgoKSA9PiB7CglsZXQgcmVzdWx0ID0gbnVsbAoJdHJ5IHsKCXJlc3VsdCA9IHNldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCn0gY2F0Y2ggKGUpIHsKCXJlc3VsdCA9ICgoaW5wdXQsIG5ld192YWx1ZSkgPT4gewoJLy8gZmFsbGJhY2sgaW4gY2FzZSBodHRwczovL2dpdGh1Yi5jb20vZm9uc3AvUGx1dG8uamwvcHVsbC8xNzU1IGlzIG5vdCBhdmFpbGFibGUKICAgIGlmIChuZXdfdmFsdWUgPT0gbnVsbCkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgc3dpdGNoIChpbnB1dC50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNOdW1iZXIgIT09IG5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNOdW1iZXIgPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImRhdGUiOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQudmFsdWVBc0RhdGUgPT0gbnVsbCB8fCBOdW1iZXIoaW5wdXQudmFsdWVBc0RhdGUpICE9PSBOdW1iZXIobmV3X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlQXNEYXRlID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJjaGVja2JveCI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC5jaGVja2VkICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJmaWxlIjogewogICAgICAgICAgICAgICAgLy8gQ2FuJ3Qgc2V0IGZpbGVzIDooCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBIVE1MU2VsZWN0RWxlbWVudCAmJiBpbnB1dC5tdWx0aXBsZSkgewogICAgICAgIGZvciAobGV0IG9wdGlvbiBvZiBBcnJheS5mcm9tKGlucHV0Lm9wdGlvbnMpKSB7CiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG5ld192YWx1ZS5pbmNsdWRlcyhvcHRpb24udmFsdWUpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgfQogICAgLy9AdHMtaWdub3JlCiAgICBpZiAoaW5wdXQudmFsdWUgIT09IG5ld192YWx1ZSkgewogICAgICAgIC8vQHRzLWlnbm9yZQogICAgICAgIGlucHV0LnZhbHVlID0gbmV3X3ZhbHVlCiAgICB9Cn0pCn0KcmV0dXJuIHJlc3VsdAp9KSgpCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGRpdiwgJ3ZhbHVlJywgewoJZ2V0OiAoKSA9PiB2YWx1ZXMsCglzZXQ6IChuZXd2YWxzKSA9PiB7CgkJaWYoIW5ld3ZhbHMpIHsKCQkJcmV0dXJuCgkJfQoJCWlucHV0cy5mb3JFYWNoKChlbCwgaSkgPT4gewoJCQl2YWx1ZXNbaV0gPSBuZXd2YWxzW2ldCgkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsc1tpXSkKCQl9KQp9LAoJY29uZmlndXJhYmxlOiB0cnVlLAp9KTsKCjwvc2NyaXB0Pjwvc3Bhbj4KCTxzY3JpcHQgaWQ9J3p6d3J6YXptcmEnPgoJCWNvbnN0IHBhcmVudCA9IGN1cnJlbnRTY3JpcHQucGFyZW50RWxlbWVudAoJCWNvbnN0IGVsID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgkJY29uc3QgdG9nZ2xlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ3RvZ2dsZXJlYWN0aXZlLWhlYWRlciAudG9nZ2xlJykKCgkJY29uc3Qgc2V0X2lucHV0X3ZhbHVlID0gc2V0Qm91bmRFbGVtZW50VmFsdWVMaWtlUGx1dG8KCQljb25zdCBnZXRfaW5wdXRfdmFsdWUgPSBnZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoKCQkvLyBXZSB1c2UgY2xvbmUgdG8gYXZvaWQgcG9pbnRpbmcgdG8gdGhlIHNhbWUgYXJyYXkKCQlsZXQgcHVibGljX3ZhbHVlID0gXy5jbG9uZURlZXAoZ2V0X2lucHV0X3ZhbHVlKGVsKSkKCgkJZnVuY3Rpb24gZGlzcGF0Y2goKSB7CgkJCXB1YmxpY192YWx1ZSA9IF8uY2xvbmVEZWVwKGdldF9pbnB1dF92YWx1ZShlbCkpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9CgoJCWNvbnN0IG9sZF9vbmlucHV0ID0gZWwub25pbnB1dCA/PyBmdW5jdGlvbihlKSB7fQoJCWVsLm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQlpZiAodG9nZ2xlLmNoZWNrZWQpIHtkaXNwYXRjaCgpfQoJCX0KCgkJdG9nZ2xlLm9uaW5wdXQgPSBlID0+IHsKCQkJaWYgKHRvZ2dsZS5jaGVja2VkICYmICFfLmlzRXF1YWwoZ2V0X2lucHV0X3ZhbHVlKGVsKSwgcHVibGljX3ZhbHVlKSkgewoJCQkJZGlzcGF0Y2goKQoJCQl9CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCkKCQl9CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShwYXJlbnQsICd2YWx1ZScsIHsKCQkJZ2V0OiAoKSA9PiBwdWJsaWNfdmFsdWUsCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJcHVibGljX3ZhbHVlID0gbmV3dmFsCgkJCQkKCQkJCXNldF9pbnB1dF92YWx1ZShlbCwgbmV3dmFsKQoJCQkJdG9nZ2xlLmNoZWNrZWQgPSB0cnVlCgkJCX0sCgkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQl9KTsKCTwvc2NyaXB0PgoJPHN0eWxlPgogICAgICAgIHRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGUgewogICAgY3Vyc29yOiBwb2ludGVyOwogICAgLS1zaXplOiAxNXB4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgd2lkdGg6IGNhbGMoMip2YXIoLS1zaXplKSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYXBwZWFyYW5jZTogbm9uZTsKICAgIGJhY2tncm91bmQ6ICNjNmM2YzY7CiAgICBvdXRsaW5lOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogY2FsYyh2YXIoLS1zaXplKS8yKTsKICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMCBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgbWFyZ2luOiAwIDEwcHg7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpjaGVja2VkIHsKICAgIGJhY2tncm91bmQ6ICM0QkQ4NjU7Cn0KdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLnRvZ2dsZTpiZWZvcmUgewogICAgY29udGVudDogJyc7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB3aWR0aDogdmFyKC0tc2l6ZSk7CiAgICBoZWlnaHQ6IHZhcigtLXNpemUpOwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgdG9wOiAwcHg7CiAgICBsZWZ0OiAwcHg7CiAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOwogICAgYm94LXNoYWRvdzogMCBjYWxjKHZhcigtLXNpemUpLzIwKSBjYWxjKHZhcigtLXNpemUpLzgpIHJnYmEoMCwwLDAsLjIpOwogICAgdHJhbnNpdGlvbjogLjFzOwp9CnRvZ2dsZXJlYWN0aXZlLWhlYWRlciA+IC50b2dnbGU6Y2hlY2tlZDpiZWZvcmUgewogICAgbGVmdDogdmFyKC0tc2l6ZSkKfQkJCgk8L3N0eWxlPgo8L3RvZ2dsZXJlYWN0aXZlLWNvbnRhaW5lcj4KCgk8c2NyaXB0IGlkPSdib2h2a2hid2NvJz4KCQkKCQljb25zdCBwYXJlbnQgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKCQljb25zdCB3aWRnZXQgPSBjdXJyZW50U2NyaXB0LnByZXZpb3VzRWxlbWVudFNpYmxpbmcKCQoJCS8vIE92ZXJ3cml0ZSB0aGUgZGVzY3JpcHRpb24KCQljb25zdCBkZXNjID0gd2lkZ2V0LnF1ZXJ5U2VsZWN0b3IoJy5kZXNjcmlwdGlvbicpCgkJZGVzYy5pbm5lckhUTUwgPSAiTE9MIgoJCgkJLy8gU2V0LUdldCBib25kCgkKCQljb25zdCBzZXRfaW5wdXRfdmFsdWUgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwoJCWNvbnN0IGdldF9pbnB1dF92YWx1ZSA9IGdldEJvdW5kRWxlbWVudFZhbHVlTGlrZVBsdXRvCgkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkocGFyZW50LCAndmFsdWUnLCB7CgkJCWdldDogKCkgPT4gZ2V0X2lucHV0X3ZhbHVlKHdpZGdldCksCgkJCXNldDogKG5ld3ZhbCkgPT4gewoJCQkJc2V0X2lucHV0X3ZhbHVlKHdpZGdldCwgbmV3dmFsKQoJCQl9LAoJCQljb25maWd1cmFibGU6IHRydWUsCgkJfSk7CgkKCQljb25zdCBvbGRfb25pbnB1dCA9IHdpZGdldC5vbmlucHV0ID8/IGZ1bmN0aW9uKGUpIHt9CgkJd2lkZ2V0Lm9uaW5wdXQgPSAoZSkgPT4gewoJCQlvbGRfb25pbnB1dChlKQoJCQllLnN0b3BQcm9wYWdhdGlvbigpCgkJCXBhcmVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSkKCQl9Cgk8L3NjcmlwdD4KCTxzdHlsZT4KCQkvKiBUaGUgZmxleCBiZWxvdyBpcyBuZWVkZWQgaW4gc29tZSB3ZWlyZCBjYXNlcyB3aGVyZSB0aGUgYm9uZCBpcyBkaXNwbGF5IGZsZXggYW5kIHRoZSBjaGlsZCBiZWNvbWVzIHNtYWxsLiAqLwoJCXN0cnVjdC1ib25kIHsKICAJCQlmbGV4OiAxOwoJCX0KCTwvc3R5bGU+Cgk8L3N0cnVjdC1ib25kPgo8L3BsLWNvbWJpbmVkLWNoaWxkPjwvcG9wb3V0LWNvbnRlbnRzPgo8L3BvcG91dC1jb250YWluZXI+CjxzY3JpcHQgaWQ9J2pyYnd1amJhbmgnPgoJLy8gTG9hZCB0aGUgZmxvYXRpbmctdWkgYW5kIGludGVyYWN0IGxpYnJhcmllcwoJd2luZG93LmZsb2F0aW5nX3VpID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9AZmxvYXRpbmctdWkvZG9tJykKCgljb25zdCB7IGNvbXB1dGVQb3NpdGlvbiwgYXV0b1BsYWNlbWVudCB9ID0gZmxvYXRpbmdfdWkKCQoJY29uc3QgY29udGFpbmVyID0gY3VycmVudFNjcmlwdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nCgljb25zdCBoZWFkZXIgPSBjb250YWluZXIuZmlyc3RFbGVtZW50Q2hpbGQKCWNvbnN0IGNvbnRlbnRzID0gY29udGFpbmVyLmxhc3RFbGVtZW50Q2hpbGQKCgkvLyBMb2FkIHRoZSBpbnRlcmFjdGpzIHBhcnQKCQkvLyBXZSB1c2UgdGhlIGludGVyYWN0anMgbGlicmFyeSB0byBwcm92aWRlIGRyYWcgYW5kIHJlc2l6ZSBoYW5kbGluZyBhY3Jvc3MgZGV2aWNlcwoJY29uc3QgeyBkZWZhdWx0OiBpbnRlcmFjdCB9ID0gYXdhaXQgaW1wb3J0KCdodHRwczovL2VzbS5zaC9pbnRlcmFjdGpzJykKCgljb250ZW50cy5vZmZzZXQgPSBjb250ZW50cy5vZmZzZXQgPz8geyB4OiAwLCB5OiAwfQoJY29uc3Qgc3RhcnRQb3NpdGlvbiA9IHt4OiAwLCB5OiAwfQoJaW50ZXJhY3QoY29udGVudHMucXVlcnlTZWxlY3RvcigndG9nZ2xlcmVhY3RpdmUtaGVhZGVyIC5kZXNjcmlwdGlvbiwgYm9uZHNsaXN0LWhlYWRlciAuZGVzY3JpcHRpb24nKSkuZHJhZ2dhYmxlKHsKCQlsaXN0ZW5lcnM6IHsKCQkJc3RhcnQgKGV2ZW50KSB7CgkJCQljb250ZW50cy5vZmZzZXQueSA9IHN0YXJ0UG9zaXRpb24ueSA9IGNvbnRlbnRzLm9mZnNldFRvcAoJCQkJY29udGVudHMub2Zmc2V0LnggPSBzdGFydFBvc2l0aW9uLnggPSBjb250ZW50cy5vZmZzZXRMZWZ0CgkJCX0sCgkJCW1vdmUgKGV2ZW50KSB7CgkJICAgICAgY29udGVudHMub2Zmc2V0LnggKz0gZXZlbnQuZHgKCQkgICAgICBjb250ZW50cy5vZmZzZXQueSArPSBldmVudC5keQoJCQoJCSAgICAgIGNvbnRlbnRzLnN0eWxlLnRvcCA9IGBtaW4oOTV2aCwgJHtjb250ZW50cy5vZmZzZXQueX1weGAKCQkgICAgICBjb250ZW50cy5zdHlsZS5sZWZ0ID0gYG1pbig5NXZ3LCAke2NvbnRlbnRzLm9mZnNldC54fXB4YAoJCSAgICB9LAoJCX0KCX0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gaGVhZGVyIHJlc2V0IHRoZSBwb3NpdGlvbgoJCWNvbnRhaW5lci5wb3BvdXQoKQoJfSkKCWludGVyYWN0KGNvbnRlbnRzKQoJICAucmVzaXphYmxlKHsKCSAgICBlZGdlczogeyB0b3A6IHRydWUsIGxlZnQ6IGZhbHNlLCBib3R0b206IHRydWUsIHJpZ2h0OiB0cnVlIH0sCgkgICAgbGlzdGVuZXJzOiB7CgkgICAgICBtb3ZlOiBmdW5jdGlvbiAoZXZlbnQpIHsJCQoJICAgICAgICBPYmplY3QuYXNzaWduKGV2ZW50LnRhcmdldC5zdHlsZSwgewoJICAgICAgICAgIHdpZHRoOiBgJHtldmVudC5yZWN0LndpZHRofXB4YCwKCSAgICAgICAgICBoZWlnaHQ6IGAke2V2ZW50LnJlY3QuaGVpZ2h0fXB4YCwKCSAgICAgICAgfSkKCSAgICAgIH0KCSAgICB9CgkgIH0pLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCQkgIC8vIERvdWJsZS10YXAgb24gcmVzaXplIHJlc2V0IHRoZSB3aWR0aAoJCQljb250ZW50cy5zdHlsZS53aWR0aCA9ICcnCgkJICAJY29udGVudHMuc3R5bGUuaGVpZ2h0ID0gJycKCSAgfSkKCgoJZnVuY3Rpb24gcG9zaXRpb25Db250ZW50cygpIHsKCQljb21wdXRlUG9zaXRpb24oaGVhZGVyLCBjb250ZW50cywgewoJCQlzdHJhdGVneTogImZpeGVkIiwKCQkJbWlkZGxld2FyZTogW2F1dG9QbGFjZW1lbnQoKV0sCgkJfSkudGhlbigocG9zKSA9PiB7CgkJCWNvbnRlbnRzLnN0eWxlLmxlZnQgPSBwb3MueCArICJweCIKCQkJY29udGVudHMuc3R5bGUudG9wID0gcG9zLnkgKyAicHgiCgkJfSkKCX0KCgljb250YWluZXIucG9wb3V0ID0gKGZvcmNlID0gdW5kZWZpbmVkKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ3BvcHBlZCcsIGZvcmNlKQoJCXBvc2l0aW9uQ29udGVudHMoKQoJfQoKCWhlYWRlci5vbmNsaWNrID0gKGUpID0+IHtjb250YWluZXIucG9wb3V0KCl9CgoJY29udGVudHMub25tb3VzZWVudGVyID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjb250ZW50cy1ob3ZlcicsIHRydWUpCgljb250ZW50cy5vbm1vdXNlbGVhdmUgPSAoZSkgPT4gY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2NvbnRlbnRzLWhvdmVyJywgZmFsc2UpCgoJaGVhZGVyLm9ubW91c2VlbnRlciA9IChlKSA9PiB7CgkJY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hlYWRlci1ob3ZlcicsIHRydWUpCgkJY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygncG9wcGVkJykgPyBudWxsIDogcG9zaXRpb25Db250ZW50cygpCgl9CgloZWFkZXIub25tb3VzZWxlYXZlID0gKGUpID0+IGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoZWFkZXItaG92ZXInLCBmYWxzZSkKPC9zY3JpcHQ+CjxzdHlsZT4KCXBvcG91dC1oZWFkZXIgewogICAgZGlzcGxheTogZmxleDsKICAgIGJvcmRlcjogM3B4IGRhc2hlZCB0cmFuc3BhcmVudDsKICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKfQpwb3BvdXQtY29udGVudHMgewogICAgZGlzcGxheTogbm9uZTsKICAgIHdpZHRoOiA0MDBweDsKICAgIGJhY2tncm91bmQ6IHZhcigtLW92ZXJsYXktYnV0dG9uLWJnKTsKICAgIGJvcmRlcjogM3B4IHNvbGlkIHZhcigtLW92ZXJsYXktYnV0dG9uLWJvcmRlcik7CiAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgcGFkZGluZzogOHB4Owp9CnBvcG91dC1jb250YWluZXIucG9wcGVkID4gcG9wb3V0LWNvbnRlbnRzLApwb3BvdXQtY29udGFpbmVyLmhlYWRlci1ob3ZlciA+IHBvcG91dC1jb250ZW50cyB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgIHotaW5kZXg6IDUwMDsKfQpwb3BvdXQtY29udGFpbmVyLmNvbnRlbnRzLWhvdmVyID4gcG9wb3V0LWhlYWRlciB7CiAgICBib3JkZXItY29sb3I6IHZhcigtLXBsdXRvLWxvZ3Mtd2Fybi1hY2NlbnQtY29sb3IpOwp9Ci5wb3BvdXQtaWNvbiB7CiAgICAtLXNpemU6IDIwcHg7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGFsaWduLXNlbGY6IHN0cmV0Y2g7CiAgICBiYWNrZ3JvdW5kLXNpemU6IHZhcigtLXNpemUpIHZhcigtLXNpemUpOwogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsKICAgIHdpZHRoOiB2YXIoLS1zaXplKTsKICAgIG1pbi1oZWlnaHQ6IHZhcigtLXNpemUpOwogICAgZmlsdGVyOiB2YXIoLS1pbWFnZS1maWx0ZXJzKTsKfQoucG9wb3V0LWljb24ucG9wb3V0IHsJCiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL2lvbmljLXRlYW0vaW9uaWNvbnNANS41LjEvc3JjL3N2Zy9leHBhbmQuc3ZnKTsKfQpwb3BvdXQtY29udGFpbmVyLnBvcHBlZCAucG9wb3V0IHsKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvaW9uaWMtdGVhbS9pb25pY29uc0A1LjUuMS9zcmMvc3ZnL2NvbnRyYWN0LnN2Zyk7Cn0KcG9wb3V0LWNvbnRhaW5lci5wb3BwZWQgdG9nZ2xlcmVhY3RpdmUtaGVhZGVyID4gLmRlc2NyaXB0aW9uIHsKICAgIHRvdWNoLWFjdGlvbjogbm9uZTsKICAgIHVzZXItc2VsZWN0OiBub25lOwp9Cjwvc3R5bGU+CjxzY3JpcHQgaWQ9J2FpbG1uYmh6ZmgnPgpjb25zdCBkaXYgPSBjdXJyZW50U2NyaXB0LnBhcmVudEVsZW1lbnQKbGV0IGtleSA9ICJhaWxtbmJoemZoIgpjb25zdCBpbnB1dHMgPSBkaXYucXVlcnlTZWxlY3RvckFsbChgcGwtY29tYmluZWQtY2hpbGRba2V5PScke2tleX0nXSA+ICo6Zmlyc3QtY2hpbGRgKQoKY29uc3QgdmFsdWVzID0gQXJyYXkoaW5wdXRzLmxlbmd0aCkKCmlucHV0cy5mb3JFYWNoKGFzeW5jIChlbCxpKSA9PiB7CgllbC5vbmlucHV0ID0gKGUpID0+IHsKCQllLnN0b3BQcm9wYWdhdGlvbigpCgl9Cgljb25zdCBnZW4gPSBHZW5lcmF0b3JzLmlucHV0KGVsKQoJd2hpbGUodHJ1ZSkgewoJCXZhbHVlc1tpXSA9IGF3YWl0IGdlbi5uZXh0KCkudmFsdWUKCQlkaXYuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoImlucHV0Iiwge30pKQoJfQp9KQoKCmxldCBzZXRfaW5wdXRfdmFsdWUgPSAoKCkgPT4gewoJbGV0IHJlc3VsdCA9IG51bGwKCXRyeSB7CglyZXN1bHQgPSBzZXRCb3VuZEVsZW1lbnRWYWx1ZUxpa2VQbHV0bwp9IGNhdGNoIChlKSB7CglyZXN1bHQgPSAoKGlucHV0LCBuZXdfdmFsdWUpID0+IHsKCS8vIGZhbGxiYWNrIGluIGNhc2UgaHR0cHM6Ly9naXRodWIuY29tL2ZvbnNwL1BsdXRvLmpsL3B1bGwvMTc1NSBpcyBub3QgYXZhaWxhYmxlCiAgICBpZiAobmV3X3ZhbHVlID09IG51bGwpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIHN3aXRjaCAoaW5wdXQudHlwZSkgewogICAgICAgICAgICBjYXNlICJyYW5nZSI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6IHsKICAgICAgICAgICAgICAgIGlmIChpbnB1dC52YWx1ZUFzTnVtYmVyICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzTnVtYmVyID0gbmV3X3ZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJkYXRlIjogewogICAgICAgICAgICAgICAgaWYgKGlucHV0LnZhbHVlQXNEYXRlID09IG51bGwgfHwgTnVtYmVyKGlucHV0LnZhbHVlQXNEYXRlKSAhPT0gTnVtYmVyKG5ld192YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZUFzRGF0ZSA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiY2hlY2tib3giOiB7CiAgICAgICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAhPT0gbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2hlY2tlZCA9IG5ld192YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAiZmlsZSI6IHsKICAgICAgICAgICAgICAgIC8vIENhbid0IHNldCBmaWxlcyA6KAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGlucHV0IGluc3RhbmNlb2YgSFRNTFNlbGVjdEVsZW1lbnQgJiYgaW5wdXQubXVsdGlwbGUpIHsKICAgICAgICBmb3IgKGxldCBvcHRpb24gb2YgQXJyYXkuZnJvbShpbnB1dC5vcHRpb25zKSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBuZXdfdmFsdWUuaW5jbHVkZXMob3B0aW9uLnZhbHVlKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgIH0KICAgIC8vQHRzLWlnbm9yZQogICAgaWYgKGlucHV0LnZhbHVlICE9PSBuZXdfdmFsdWUpIHsKICAgICAgICAvL0B0cy1pZ25vcmUKICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld192YWx1ZQogICAgfQp9KQp9CnJldHVybiByZXN1bHQKfSkoKQoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkaXYsICd2YWx1ZScsIHsKCWdldDogKCkgPT4gdmFsdWVzLAoJc2V0OiAobmV3dmFscykgPT4gewoJCWlmKCFuZXd2YWxzKSB7CgkJCXJldHVybgoJCX0KCQlpbnB1dHMuZm9yRWFjaCgoZWwsIGkpID0+IHsKCQkJdmFsdWVzW2ldID0gbmV3dmFsc1tpXQoJCQlzZXRfaW5wdXRfdmFsdWUoZWwsIG5ld3ZhbHNbaV0pCgkJfSkKfSwKCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKfSk7Cgo8L3NjcmlwdD48L3NwYW4+PC9ib25kPqRtaW1lqXRleHQvaHRtbKxyb290YXNzaWduZWXAsmxhc3RfcnVuX3RpbWVzdGFtcMtB2gGVNwUi4rBwZXJzaXN0X2pzX3N0YXRlwrdoYXNfcGx1dG9faG9va19mZWF0dXJlc8KnY2VsbF9pZNkkNjMzMDI5YWYtOGNhYy00MjZlLWIzNWMtYzlmYjM5MzhiNzg0uWRlcGVuZHNfb25fZGlzYWJsZWRfY2VsbHPCp3J1bnRpbWXOCUyr77VwdWJsaXNoZWRfb2JqZWN0X2tleXOQuGRlcGVuZHNfb25fc2tpcHBlZF9jZWxsc8KnZXJyb3JlZMKrc3RhdHVzX3RyZWWFpG5hbWWobm90ZWJvb2uoc3VidGFza3OEpnNhdmluZ4WkbmFtZaZzYXZpbmeoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HaAZU0dRKyp3N1Y2Nlc3PDqnN0YXJ0ZWRfYXTLQdoBlTR05UOpd29ya3NwYWNlhaRuYW1lqXdvcmtzcGFjZahzdWJ0YXNrc4KsaW5pdF9wcm9jZXNzhaRuYW1lrGluaXRfcHJvY2Vzc6hzdWJ0YXNrc4ShNIWkbmFtZaE0qHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2gGVMhH09adzdWNjZXNzw6pzdGFydGVkX2F0y0HaAZUx0aaDoTGFpG5hbWWhMahzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdoBlTHLSSOnc3VjY2Vzc8Oqc3RhcnRlZF9hdMtB2gGVMbrCIqEyhaRuYW1loTKoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HaAZUxy150p3N1Y2Nlc3PDqnN0YXJ0ZWRfYXTLQdoBlTHLSVqhM4WkbmFtZaEzqHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2gGVMdGmN6dzdWNjZXNzw6pzdGFydGVkX2F0y0HaAZUxy16iq2ZpbmlzaGVkX2F0y0HaAZUyEhiPp3N1Y2Nlc3PDqnN0YXJ0ZWRfYXTLQdoBlTG6wfSuY3JlYXRlX3Byb2Nlc3OFpG5hbWWuY3JlYXRlX3Byb2Nlc3Ooc3VidGFza3OC2SFMb2FkaW5nIG5vdGVib29rIGJvb3QgZW52aXJvbm1lbnSFpG5hbWXZIUxvYWRpbmcgbm90ZWJvb2sgYm9vdCBlbnZpcm9ubWVudKhzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdoBlTG6ks2nc3VjY2Vzc8Oqc3RhcnRlZF9hdMtB2gGVMGszwrBTdGFydGluZyBwcm9jZXNzhaRuYW1lsFN0YXJ0aW5nIHByb2Nlc3Ooc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HaAZUwaxEfp3N1Y2Nlc3PDqnN0YXJ0ZWRfYXTLQdoBlTAYw9erZmluaXNoZWRfYXTLQdoBlTG6ksWnc3VjY2Vzc8Oqc3RhcnRlZF9hdMtB2gGVMBjDratmaW5pc2hlZF9hdMtB2gGVMhIYoKdzdWNjZXNzw6pzdGFydGVkX2F0y0HaAZUwGMN+o3BrZ4WkbmFtZaNwa2eoc3VidGFza3OErGluc3RhbnRpYXRlMYWkbmFtZaxpbnN0YW50aWF0ZTGoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HaAZUwFYxMp3N1Y2Nlc3PDqnN0YXJ0ZWRfYXTLQdoBlTAValmoYW5hbHlzaXOFpG5hbWWoYW5hbHlzaXOoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HaAZUwE/znp3N1Y2Nlc3PDqnN0YXJ0ZWRfYXTLQdoBlTAT7qaqcHJlY29tcGlsZYWkbmFtZapwcmVjb21waWxlqHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2gGVMWnWAqdzdWNjZXNzw6pzdGFydGVkX2F0y0HaAZUwGbbhp3Jlc29sdmWFpG5hbWWncmVzb2x2ZahzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdoBlTAZtqKnc3VjY2Vzc8Oqc3RhcnRlZF9hdMtB2gGVMBWMYatmaW5pc2hlZF9hdMtB2gGVMWoBbadzdWNjZXNzw6pzdGFydGVkX2F0y0HaAZUwE+6eo3J1boWkbmFtZaNydW6oc3VidGFza3OCsHJlc29sdmVfdG9wb2xvZ3mFpG5hbWWwcmVzb2x2ZV90b3BvbG9neahzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdoBlTewXFOnc3VjY2Vzc8Oqc3RhcnRlZF9hdMtB2gGVN7BMOKhldmFsdWF0ZYWkbmFtZahldmFsdWF0ZahzdWJ0YXNrc4qhM4WkbmFtZaEzqHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2gGVN7EsZ6dzdWNjZXNzw6pzdGFydGVkX2F0y0HaAZU3sQUdoTSFpG5hbWWhNKhzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdoBlTexTw6nc3VjY2Vzc8Oqc3RhcnRlZF9hdMtB2gGVN7EspaExhaRuYW1loTGoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HaAZU3sNzwp3N1Y2Nlc3PDqnN0YXJ0ZWRfYXTLQdoBlTewsYGiMTCFpG5hbWWiMTCoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HaAZU3sh69p3N1Y2Nlc3PDqnN0YXJ0ZWRfYXTLQdoBlTeyAQyhMoWkbmFtZaEyqHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2gGVN7EE3qdzdWNjZXNzw6pzdGFydGVkX2F0y0HaAZU3sN1qoTaFpG5hbWWhNqhzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdoBlTexmSSnc3VjY2Vzc8Oqc3RhcnRlZF9hdMtB2gGVN7F27qE3haRuYW1loTeoc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HaAZU3sb2yp3N1Y2Nlc3PDqnN0YXJ0ZWRfYXTLQdoBlTexmVKhNYWkbmFtZaE1qHN1YnRhc2tzgKtmaW5pc2hlZF9hdMtB2gGVN7F2o6dzdWNjZXNzw6pzdGFydGVkX2F0y0HaAZU3sU9AoTmFpG5hbWWhOahzdWJ0YXNrc4CrZmluaXNoZWRfYXTLQdoBlTeyAN6nc3VjY2Vzc8Oqc3RhcnRlZF9hdMtB2gGVN7HiHqE4haRuYW1loTioc3VidGFza3OAq2ZpbmlzaGVkX2F0y0HaAZU3seIAp3N1Y2Nlc3PDqnN0YXJ0ZWRfYXTLQdoBlTexvdyrZmluaXNoZWRfYXTLQdoBlTeyHuKnc3VjY2Vzc8Oqc3RhcnRlZF9hdMtB2gGVN7BcW6tmaW5pc2hlZF9hdMtB2gGVN7Ie3qdzdWNjZXNzw6pzdGFydGVkX2F0y0HaAZU3sEwfq2ZpbmlzaGVkX2F0wKdzdWNjZXNzwKpzdGFydGVkX2F0y0HaAZUvLTgJsWNlbGxfZGVwZW5kZW5jaWVz3gAs2SQ5OTZiNDA4NS0xMTRjLTQ4ZjQtOWY5MC04ZTYzN2YyOWMwNmGEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ5OTZiNDA4NS0xMTRjLTQ4ZjQtOWY5MC04ZTYzN2YyOWMwNmG0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIGibnSR2SQwZGI1MWQzOS03YzA1LTRlMDAtYjk1MS03ZmU3NzZhOGUwZjnZJDhjYzUzY2QyLTkxMTQtNDA2Ny1hYjBiLTM3ZmQ4Y2Q3OTI0MIS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDhjYzUzY2QyLTkxMTQtNDA2Ny1hYjBiLTM3ZmQ4Y2Q3OTI0MLRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJDY3YzA4NjBiLWI0YzEtNDEyZC04NzBhLWE0Y2U0OTg3NDY1ZYS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDY3YzA4NjBiLWI0YzEtNDEyZC04NzBhLWE0Y2U0OTg3NDY1ZbRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJDJlZTdmMjZkLWYzODMtNGU3ZS1hNjlhLThmYjcyNzE3NDY3Y4S0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDJlZTdmMjZkLWYzODMtNGU3ZS1hNjlhLThmYjcyNzE3NDY3Y7Rkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJDMyMTNkOTc3LTdiNjUtNDNiMC1hODgxLTEwZmNjMjUyM2YxNIS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDMyMTNkOTc3LTdiNjUtNDNiMC1hODgxLTEwZmNjMjUyM2YxNLRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJDRjYjEyOGFhLTdhZDgtNGQxNy1iY2VkLTM2ODQ1NzAzZTZhOIS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDRjYjEyOGFhLTdhZDgtNGQxNy1iY2VkLTM2ODQ1NzAzZTZhOLRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJGJkNWVjMDg2LTUxNTYtNGU3Yy1hNzBiLTVjYTlmMDg5YmI0OYS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJGJkNWVjMDg2LTUxNTYtNGU3Yy1hNzBiLTVjYTlmMDg5YmI0ObRkb3duc3RyZWFtX2NlbGxzX21hcIKoc2JzX2JvbmSR2SQ4MTFjZjc4Yi1lODcwLTQ1YmItOTE3My04OWEzYjNkNDk1ZjWjc2JzkdkkNzg1M2NjN2YtNGU1OC00NGQxLThkM2ItZjhkNDc0NTU2NGU2snVwc3RyZWFtX2NlbGxzX21hcI+nQE5UQm9uZJCkYXRhbpCwU3RydWN0Qm9uZFNlbGVjdJDZI1BsdXRvUnVubmVyLlBsdXRvUnVubmVyLmNyZWF0ZV9ib25kkKVlcnJvcpClQGJpbmSQplNsaWRlcpCrUGx1dG9SdW5uZXKQtFBsdXRvUnVubmVyLkJhc2UuZ2V0kKVyYW5nZZCjVmFskKRUeXBlkKNjb3OQu1BsdXRvUnVubmVyLkNvcmUuYXBwbGljYWJsZZCoaGFzZmllbGSQ2SQyMzU4ZjY4Ni0xOTUwLTQwZjktOWQ1Yy1kYWMyZDk4ZjRjMjSEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQyMzU4ZjY4Ni0xOTUwLTQwZjktOWQ1Yy1kYWMyZDk4ZjRjMjS0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIGjYm9okdkkODZhODAyMjgtZjQ5NS00M2U4LWIxZDQtYzkzYjdiNTJjOGQ42SQ0OTUxNjM3NC1mNjI1LTRhODQtYWM1Yy1mOTI0OTdkNDUwMjWEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ0OTUxNjM3NC1mNjI1LTRhODQtYWM1Yy1mOTI0OTdkNDUwMjW0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQ3MDcxNzVhOS1kMzU2LTQzY2YtODAzOC02MjBlYmM0MDFjOTOEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ3MDcxNzVhOS1kMzU2LTQzY2YtODAzOC02MjBlYmM0MDFjOTO0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIG3RXh0ZW5kZWRUYWJsZU9mQ29udGVudHOR2SQ5NDlhYzFlZi1jNTAyLTRlMjgtODFmZi1mOTliMGQxOWFhMDPZJDA4ZDcxMWMwLWUyY2MtNDQ0NC05NGNhLTBjNGMzY2ZlOTAxZoS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDA4ZDcxMWMwLWUyY2MtNDQ0NC05NGNhLTBjNGMzY2ZlOTAxZrRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgaJudJHZJDBkYjUxZDM5LTdjMDUtNGUwMC1iOTUxLTdmZTc3NmE4ZTBmOdkkZTdkNjc2NjItNzdiMy00ODJhLWIwMzItOGRiNGFmYmMwMWE2hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkZTdkNjc2NjItNzdiMy00ODJhLWIwMzItOGRiNGFmYmMwMWE2tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCBo2FzZJHZJDllMzYwMWY1LWVmYzItNDRlOS04M2Q4LTViNjVjZTdlOWNjZtkkOTQ5YWMxZWYtYzUwMi00ZTI4LTgxZmYtZjk5YjBkMTlhYTAzhLRwcmVjZWRlbmNlX2hldXJpc3RpYwenY2VsbF9pZNkkOTQ5YWMxZWYtYzUwMi00ZTI4LTgxZmYtZjk5YjBkMTlhYTAztGRvd25zdHJlYW1fY2VsbHNfbWFwhrBTdHJ1Y3RCb25kTW9kdWxlkLdFeHRlbmRlZFRhYmxlT2ZDb250ZW50c5HZJDcwNzE3NWE5LWQzNTYtNDNjZi04MDM4LTYyMGViYzQwMWM5M6tQbHV0b0V4dHJhc5CnUGx1dG9VSZHZJDRkNjExNDI1LWM4ZTMtNGJjMy05MTJiLThiYzA0NjUzNjNiY7BIeXBlcnRleHRMaXRlcmFsktkkOWUzNjAxZjUtZWZjMi00NGU5LTgzZDgtNWI2NWNlN2U5Y2Nm2SQ2M2Q2YzJkZi1hNDExLTQwN2MtYWYxMS00ZjVkMDlmYmIzMjKoRWRpdGFibGWR2SQ0ZDYxMTQyNS1jOGUzLTRiYzMtOTEyYi04YmMwNDY1MzYzYmOydXBzdHJlYW1fY2VsbHNfbWFwgNkkOWQyMzM4MmMtY2YzNS00YjIwLWE0NmMtMGY0ZTJkZTE3ZmM3hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkOWQyMzM4MmMtY2YzNS00YjIwLWE0NmMtMGY0ZTJkZTE3ZmM3tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCCp0BtZF9zdHKQqGdldGluZGV4kNkkZTJiNzlhNTgtZTY2ZS00ZDQwLTg2NzMtNDE4ODIzNzUzYjM4hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkZTJiNzlhNTgtZTY2ZS00ZDQwLTg2NzMtNDE4ODIzNzUzYjM4tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCBom50kdkkMGRiNTFkMzktN2MwNS00ZTAwLWI5NTEtN2ZlNzc2YThlMGY52SQ5NTlhY2I0MC0xZmQ2LTQzZjUtYTFhNi03M2E2Y2VhYWUxZDeEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ5NTlhY2I0MC0xZmQ2LTQzZjUtYTFhNi03M2E2Y2VhYWUxZDe0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQyMDczZjExZS04MTk2LTRlYmMtOTIyZi01ZmE1ODllOTE3OTeEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQyMDczZjExZS04MTk2LTRlYmMtOTIyZi01ZmE1ODllOTE3OTe0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQ3MDVlMzBmZS03N2EzLTRiMDYtOGI5OS0xODA3MjkwZWRmZmKEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ3MDVlMzBmZS03N2EzLTRiMDYtOGI5OS0xODA3MjkwZWRmZmK0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIGjYWx0kdkkNGQ2MTE0MjUtYzhlMy00YmMzLTkxMmItOGJjMDQ2NTM2M2Jj2SQwZGI1MWQzOS03YzA1LTRlMDAtYjk1MS03ZmU3NzZhOGUwZjmEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQwZGI1MWQzOS03YzA1LTRlMDAtYjk1MS03ZmU3NzZhOGUwZjm0ZG93bnN0cmVhbV9jZWxsc19tYXCCp250X2JvbmSS2SQ4MTFjZjc4Yi1lODcwLTQ1YmItOTE3My04OWEzYjNkNDk1ZjXZJDkwM2ZlZTY3LTZiMjMtNDFkYy1hMDNkLWYxMDQwYjY5NmJlNqJudJPZJGUyYjc5YTU4LWU2NmUtNGQ0MC04NjczLTQxODgyMzc1M2IzONkkOTk2YjQwODUtMTE0Yy00OGY0LTlmOTAtOGU2MzdmMjljMDZh2SQwOGQ3MTFjMC1lMmNjLTQ0NDQtOTRjYS0wYzRjM2NmZTkwMWaydXBzdHJlYW1fY2VsbHNfbWFwj6dAbWRfc3RykK1CYXNlLmdldGluZGV4kKdATlRCb25kkKE6kNkjUGx1dG9SdW5uZXIuUGx1dG9SdW5uZXIuY3JlYXRlX2JvbmSQpWVycm9ykKVAYmluZJCmU2xpZGVykKRCYXNlkKtQbHV0b1J1bm5lcpC0UGx1dG9SdW5uZXIuQmFzZS5nZXSQo1ZhbJCkVHlwZZC7UGx1dG9SdW5uZXIuQ29yZS5hcHBsaWNhYmxlkKhoYXNmaWVsZJDZJGNiZmM2ZWVjLTg5OTEtNGE5Yy1hZGEwLTI5NWM4MDUyODU0ZIS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJGNiZmM2ZWVjLTg5OTEtNGE5Yy1hZGEwLTI5NWM4MDUyODU0ZLRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgNkkNGQ2MTE0MjUtYzhlMy00YmMzLTkxMmItOGJjMDQ2NTM2M2JjhLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkNGQ2MTE0MjUtYzhlMy00YmMzLTkxMmItOGJjMDQ2NTM2M2JjtGRvd25zdHJlYW1fY2VsbHNfbWFwg6NhbHSS2SQ3MDVlMzBmZS03N2EzLTRiMDYtOGI5OS0xODA3MjkwZWRmZmLZJGJlMmE3ODIwLWUxOTQtNDQxMC1iMDBkLWE5MzMyYjIzNGFkNqRmcmVxktkkYTU0OTBhNmItZGMxMS00MmI3LTg3ZTAtZDM4ODcwZmM1NWU02SQyNmQxMTYwMC0yODI3LTRlMDgtOTE5NS0xMDljOGE4YmRkYzOiYmyR2SQ5MDNmZWU2Ny02YjIzLTQxZGMtYTAzZC1mMTA0MGI2OTZiZTaydXBzdHJlYW1fY2VsbHNfbWFwjqdAbWRfc3RykK1CYXNlLmdldGluZGV4kKpAQm9uZHNMaXN0kKE6kNkjUGx1dG9SdW5uZXIuUGx1dG9SdW5uZXIuY3JlYXRlX2JvbmSQp1BsdXRvVUmR2SQ5NDlhYzFlZi1jNTAyLTRlMjgtODFmZi1mOTliMGQxOWFhMDOlQGJpbmSQqEVkaXRhYmxlkdkkOTQ5YWMxZWYtYzUwMi00ZTI4LTgxZmYtZjk5YjBkMTlhYTAzpEJhc2WQq1BsdXRvUnVubmVykLRQbHV0b1J1bm5lci5CYXNlLmdldJChKpC7UGx1dG9SdW5uZXIuQ29yZS5hcHBsaWNhYmxlkKpTY3J1YmJhYmxlkNkkYmUyYTc4MjAtZTE5NC00NDEwLWIwMGQtYTkzMzJiMjM0YWQ2hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkYmUyYTc4MjAtZTE5NC00NDEwLWIwMGQtYTkzMzJiMjM0YWQ2tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCBo2FsdJHZJDRkNjExNDI1LWM4ZTMtNGJjMy05MTJiLThiYzA0NjUzNjNiY9kkNDY2OTk1YTItZGZkNC00Mzc0LTgzMzktYmMwMjMyMDM5YjI3hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkNDY2OTk1YTItZGZkNC00Mzc0LTgzMzktYmMwMjMyMDM5YjI3tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCCp0BtZF9zdHKQqGdldGluZGV4kNkkNzg1M2NjN2YtNGU1OC00NGQxLThkM2ItZjhkNDc0NTU2NGU2hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkNzg1M2NjN2YtNGU1OC00NGQxLThkM2ItZjhkNDc0NTU2NGU2tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCBo3Nic5HZJGJkNWVjMDg2LTUxNTYtNGU3Yy1hNzBiLTVjYTlmMDg5YmI0OdkkY2RjMGE3YWQtYTNhYy00MjcwLWI3MDctMzViMTkzOWRhMjc2hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkY2RjMGE3YWQtYTNhYy00MjcwLWI3MDctMzViMTkzOWRhMjc2tGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCBo2FzZJHZJDllMzYwMWY1LWVmYzItNDRlOS04M2Q4LTViNjVjZTdlOWNjZtkkNzg1NTgyNmUtY2NhYS00YzI3LWEwNjAtZjVjZWI5MjdiYmU4hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkNzg1NTgyNmUtY2NhYS00YzI3LWEwNjAtZjVjZWI5MjdiYmU4tGRvd25zdHJlYW1fY2VsbHNfbWFwgbl0cmFuc2Zvcm1lZF92YWx1ZV9leGFtcGxlkdkkMWQ1NTczZWUtODcyZS00ZGZiLWE3ODUtMWFjOWU4MzZhZDk4snVwc3RyZWFtX2NlbGxzX21hcI2nQE5UQm9uZJChOpDZI1BsdXRvUnVubmVyLlBsdXRvUnVubmVyLmNyZWF0ZV9ib25kkKVlcnJvcpClQGJpbmSQplNsaWRlcpCrUGx1dG9SdW5uZXKQtFBsdXRvUnVubmVyLkJhc2UuZ2V0kKNWYWyQpFR5cGWQoSuQu1BsdXRvUnVubmVyLkNvcmUuYXBwbGljYWJsZZCoaGFzZmllbGSQ2SRmNjViMzIzMS1mMmIyLTQ1ZGMtYjcyZS0xYWQzMTA3MDgzZmOEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SRmNjViMzIzMS1mMmIyLTQ1ZGMtYjcyZS0xYWQzMTA3MDgzZmO0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQ5MDNmZWU2Ny02YjIzLTQxZGMtYTAzZC1mMTA0MGI2OTZiZTaEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ5MDNmZWU2Ny02YjIzLTQxZGMtYTAzZC1mMTA0MGI2OTZiZTa0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIWnbnRfYm9uZJHZJDBkYjUxZDM5LTdjMDUtNGUwMC1iOTUxLTdmZTc3NmE4ZTBmOaNibGOR2SQ4MTFjZjc4Yi1lODcwLTQ1YmItOTE3My04OWEzYjNkNDk1ZjWpQm9uZFRhYmxlkKhhc2RfYm9uZJHZJDllMzYwMWY1LWVmYzItNDRlOS04M2Q4LTViNjVjZTdlOWNjZqJibJHZJDRkNjExNDI1LWM4ZTMtNGJjMy05MTJiLThiYzA0NjUzNjNiY9kkOWUzNjAxZjUtZWZjMi00NGU5LTgzZDgtNWI2NWNlN2U5Y2NmhLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkOWUzNjAxZjUtZWZjMi00NGU5LTgzZDgtNWI2NWNlN2U5Y2NmtGRvd25zdHJlYW1fY2VsbHNfbWFwhqt0eXBlYXNmaWVsZJCpZmllbGRib25kkLBmaWVsZGRlc2NyaXB0aW9ukKNhc2ST2SRjZGMwYTdhZC1hM2FjLTQyNzAtYjcwNy0zNWIxOTM5ZGEyNzbZJGU3ZDY3NjYyLTc3YjMtNDgyYS1iMDMyLThkYjRhZmJjMDFhNtkkMDNlOWQ3NWUtZTZjOS00MTk5LTkzM2ItMmJlMzA2ZGFmOTc4qGFzZF9ib25kktkkODExY2Y3OGItZTg3MC00NWJiLTkxNzMtODlhM2IzZDQ5NWY12SQ5MDNmZWU2Ny02YjIzLTQxZGMtYTAzZC1mMTA0MGI2OTZiZTajQVNEkLJ1cHN0cmVhbV9jZWxsc19tYXDeAB2nQG1kX3N0cpCoaGFzZmllbGSQ2SNQbHV0b1J1bm5lci5QbHV0b1J1bm5lci5jcmVhdGVfYm9uZJCmU3RyaW5nkKRAaHRskKlUZXh0RmllbGSQq1BsdXRvUnVubmVykLRQbHV0b1J1bm5lci5CYXNlLmdldJCqQGZpZWxkZGF0YZC3SHlwZXJ0ZXh0TGl0ZXJhbC5SZXN1bHSQu1BsdXRvUnVubmVyLkNvcmUuYXBwbGljYWJsZZCkQGRvY5CtQmFzZS5nZXRpbmRleJChOpClZXJyb3KQt0h5cGVydGV4dExpdGVyYWwuQnlwYXNzkKpTdHJ1Y3RCb25kkKVAYmluZJC6I19fX3RoaXNfcGx1dG9fbW9kdWxlX25hbWWQq0Jhc2UuQGt3ZGVmkKZTbGlkZXKQpEJhc2WQo1ZhbJCjSW50kLBIeXBlcnRleHRMaXRlcmFskdkkOTQ5YWMxZWYtYzUwMi00ZTI4LTgxZmYtZjk5YjBkMTlhYTAzpFR5cGWQpVVuaW9ukKxAdHlwZWFzZmllbGSQqlNjcnViYmFibGWQ2SQwM2U5ZDc1ZS1lNmM5LTQxOTktOTMzYi0yYmUzMDZkYWY5NziEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQwM2U5ZDc1ZS1lNmM5LTQxOTktOTMzYi0yYmUzMDZkYWY5Nzi0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIGjYXNkkdkkOWUzNjAxZjUtZWZjMi00NGU5LTgzZDgtNWI2NWNlN2U5Y2Nm2SQwNjViYWQ3My01ZmE4LTQ0OTYtYmEzMy05ZTY2OTQwYjU4MDaEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQwNjViYWQ3My01ZmE4LTQ0OTYtYmEzMy05ZTY2OTQwYjU4MDa0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIGnbG9sX3BvcJHZJDYzMzAyOWFmLThjYWMtNDI2ZS1iMzVjLWM5ZmIzOTM4Yjc4NNkkMjZkMTE2MDAtMjgyNy00ZTA4LTkxOTUtMTA5YzhhOGJkZGMzhLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkMjZkMTE2MDAtMjgyNy00ZTA4LTkxOTUtMTA5YzhhOGJkZGMztGRvd25zdHJlYW1fY2VsbHNfbWFwgLJ1cHN0cmVhbV9jZWxsc19tYXCBpGZyZXGR2SQ0ZDYxMTQyNS1jOGUzLTRiYzMtOTEyYi04YmMwNDY1MzYzYmPZJGE4OTk1MjI0LTgzYzYtNGY4Mi1iNWE1LTg3YTZmODZmYzdhMIS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJGE4OTk1MjI0LTgzYzYtNGY4Mi1iNWE1LTg3YTZmODZmYzdhMLRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJGZlODkxYjRlLWY0NDAtNDgyMy1iNDNiLTcyNTcyZjZhNmMxMoS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJGZlODkxYjRlLWY0NDAtNDgyMy1iNDNiLTcyNTcyZjZhNmMxMrRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJDlkNDQ1NWFmLTk2ZjEtNDZkNy1hNGYzLTQzNDQ5NWIxMWM4YYS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDlkNDQ1NWFmLTk2ZjEtNDZkNy1hNGYzLTQzNDQ5NWIxMWM4YbRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJDc5YmViYTg4LTkzMmYtNDE0Ny1iM2EwLWQ4MjFlZjFiYzFlMoS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDc5YmViYTg4LTkzMmYtNDE0Ny1iM2EwLWQ4MjFlZjFiYzFlMrRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgqdAbWRfc3RykKhnZXRpbmRleJDZJDFkNTU3M2VlLTg3MmUtNGRmYi1hNzg1LTFhYzllODM2YWQ5OIS0cHJlY2VkZW5jZV9oZXVyaXN0aWMJp2NlbGxfaWTZJDFkNTU3M2VlLTg3MmUtNGRmYi1hNzg1LTFhYzllODM2YWQ5OLRkb3duc3RyZWFtX2NlbGxzX21hcICydXBzdHJlYW1fY2VsbHNfbWFwgbl0cmFuc2Zvcm1lZF92YWx1ZV9leGFtcGxlkdkkNzg1NTgyNmUtY2NhYS00YzI3LWEwNjAtZjVjZWI5MjdiYmU42SQ4NmE4MDIyOC1mNDk1LTQzZTgtYjFkNC1jOTNiN2I1MmM4ZDiEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ4NmE4MDIyOC1mNDk1LTQzZTgtYjFkNC1jOTNiN2I1MmM4ZDi0ZG93bnN0cmVhbV9jZWxsc19tYXCEo0JPSJCrdHlwZWFzZmllbGSQo01BSJCjYm9okdkkMjM1OGY2ODYtMTk1MC00MGY5LTlkNWMtZGFjMmQ5OGY0YzI0snVwc3RyZWFtX2NlbGxzX21hcI2hOpCqU3RydWN0Qm9uZJDZI1BsdXRvUnVubmVyLlBsdXRvUnVubmVyLmNyZWF0ZV9ib25kkKVAYmluZJCmU2xpZGVykKtQbHV0b1J1bm5lcpC0UGx1dG9SdW5uZXIuQmFzZS5nZXSQpkBrd2RlZpCjSW50kKRUeXBlkK5AcG9wb3V0YXNmaWVsZJCsQHR5cGVhc2ZpZWxkkLtQbHV0b1J1bm5lci5Db3JlLmFwcGxpY2FibGWQ2SQzYTA2NmJmNC0zNDY2LTQ2OWUtOTBkMC02YjE0YmUzZWQ4ZDWEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQzYTA2NmJmNC0zNDY2LTQ2OWUtOTBkMC02YjE0YmUzZWQ4ZDW0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SQ4MTFjZjc4Yi1lODcwLTQ1YmItOTE3My04OWEzYjNkNDk1ZjWEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ4MTFjZjc4Yi1lODcwLTQ1YmItOTE3My04OWEzYjNkNDk1ZjW0ZG93bnN0cmVhbV9jZWxsc19tYXCBo2JsY5HZJDkwM2ZlZTY3LTZiMjMtNDFkYy1hMDNkLWYxMDQwYjY5NmJlNrJ1cHN0cmVhbV9jZWxsc19tYXCFqkBCb25kc0xpc3SQp250X2JvbmSR2SQwZGI1MWQzOS03YzA1LTRlMDAtYjk1MS03ZmU3NzZhOGUwZjmmUG9wb3V0kKhzYnNfYm9uZJHZJGJkNWVjMDg2LTUxNTYtNGU3Yy1hNzBiLTVjYTlmMDg5YmI0Oahhc2RfYm9uZJHZJDllMzYwMWY1LWVmYzItNDRlOS04M2Q4LTViNjVjZTdlOWNjZtkkNjNkNmMyZGYtYTQxMS00MDdjLWFmMTEtNGY1ZDA5ZmJiMzIyhLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkNjNkNmMyZGYtYTQxMS00MDdjLWFmMTEtNGY1ZDA5ZmJiMzIytGRvd25zdHJlYW1fY2VsbHNfbWFwg6lmaWVsZGJvbmSQsGZpZWxkZGVzY3JpcHRpb26Qo0xPTJHZJDYzMzAyOWFmLThjYWMtNDI2ZS1iMzVjLWM5ZmIzOTM4Yjc4NLJ1cHN0cmVhbV9jZWxsc19tYXDeABGnQG1kX3N0cpCtQmFzZS5nZXRpbmRleJChOpCoaGFzZmllbGSQpWVycm9ykLdIeXBlcnRleHRMaXRlcmFsLkJ5cGFzc5CrQmFzZS5Aa3dkZWaQplNsaWRlcpCkQGh0bJCkQmFzZZCqQGZpZWxkZGF0YZCjVmFskKNJbnSQpFR5cGWQsEh5cGVydGV4dExpdGVyYWyR2SQ5NDlhYzFlZi1jNTAyLTRlMjgtODFmZi1mOTliMGQxOWFhMDO3SHlwZXJ0ZXh0TGl0ZXJhbC5SZXN1bHSQqlNjcnViYmFibGWQ2SQ0ODQzOTgzYy1kZjY0LTRiOTQtODYzNC03YTEwZDk0MjNhNzCEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SQ0ODQzOTgzYy1kZjY0LTRiOTQtODYzNC03YTEwZDk0MjNhNzC0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIKnQG1kX3N0cpCoZ2V0aW5kZXiQ2SRhNTQ5MGE2Yi1kYzExLTQyYjctODdlMC1kMzg4NzBmYzU1ZTSEtHByZWNlZGVuY2VfaGV1cmlzdGljCadjZWxsX2lk2SRhNTQ5MGE2Yi1kYzExLTQyYjctODdlMC1kMzg4NzBmYzU1ZTS0ZG93bnN0cmVhbV9jZWxsc19tYXCAsnVwc3RyZWFtX2NlbGxzX21hcIGkZnJlcZHZJDRkNjExNDI1LWM4ZTMtNGJjMy05MTJiLThiYzA0NjUzNjNiY9kkNjMzMDI5YWYtOGNhYy00MjZlLWIzNWMtYzlmYjM5MzhiNzg0hLRwcmVjZWRlbmNlX2hldXJpc3RpYwmnY2VsbF9pZNkkNjMzMDI5YWYtOGNhYy00MjZlLWIzNWMtYzlmYjM5MzhiNzg0tGRvd25zdHJlYW1fY2VsbHNfbWFwgadsb2xfcG9wkdkkMDY1YmFkNzMtNWZhOC00NDk2LWJhMzMtOWU2Njk0MGI1ODA2snVwc3RyZWFtX2NlbGxzX21hcImkQ29yZZCkQmFzZZC3UGx1dG9SdW5uZXIuY3JlYXRlX2JvbmSQq1BsdXRvUnVubmVykKpwb3BvdXR3cmFwkK9Db3JlLmFwcGxpY2FibGWQpUBiaW5kkKhCYXNlLmdldJCjTE9MkdkkNjNkNmMyZGYtYTQxMS00MDdjLWFmMTEtNGY1ZDA5ZmJiMzIytGNlbGxfZXhlY3V0aW9uX29yZGVy3AAs2SQ5NDlhYzFlZi1jNTAyLTRlMjgtODFmZi1mOTliMGQxOWFhMDPZJDlkNDQ1NWFmLTk2ZjEtNDZkNy1hNGYzLTQzNDQ5NWIxMWM4YdkkNzA3MTc1YTktZDM1Ni00M2NmLTgwMzgtNjIwZWJjNDAxYzkz2SRjYmZjNmVlYy04OTkxLTRhOWMtYWRhMC0yOTVjODA1Mjg1NGTZJDQ4NDM5ODNjLWRmNjQtNGI5NC04NjM0LTdhMTBkOTQyM2E3MNkkYTg5OTUyMjQtODNjNi00ZjgyLWI1YTUtODdhNmY4NmZjN2Ew2SQ5ZTM2MDFmNS1lZmMyLTQ0ZTktODNkOC01YjY1Y2U3ZTljY2bZJGNkYzBhN2FkLWEzYWMtNDI3MC1iNzA3LTM1YjE5MzlkYTI3NtkkZmU4OTFiNGUtZjQ0MC00ODIzLWI0M2ItNzI1NzJmNmE2YzEy2SQ4NmE4MDIyOC1mNDk1LTQzZTgtYjFkNC1jOTNiN2I1MmM4ZDjZJDIzNThmNjg2LTE5NTAtNDBmOS05ZDVjLWRhYzJkOThmNGMyNNkkNDk1MTYzNzQtZjYyNS00YTg0LWFjNWMtZjkyNDk3ZDQ1MDI12SQ4Y2M1M2NkMi05MTE0LTQwNjctYWIwYi0zN2ZkOGNkNzkyNDDZJDBkYjUxZDM5LTdjMDUtNGUwMC1iOTUxLTdmZTc3NmE4ZTBmOdkkZTJiNzlhNTgtZTY2ZS00ZDQwLTg2NzMtNDE4ODIzNzUzYjM42SQ0NjY5OTVhMi1kZmQ0LTQzNzQtODMzOS1iYzAyMzIwMzliMjfZJDRjYjEyOGFhLTdhZDgtNGQxNy1iY2VkLTM2ODQ1NzAzZTZhONkkNzg1NTgyNmUtY2NhYS00YzI3LWEwNjAtZjVjZWI5MjdiYmU42SQxZDU1NzNlZS04NzJlLTRkZmItYTc4NS0xYWM5ZTgzNmFkOTjZJGY2NWIzMjMxLWYyYjItNDVkYy1iNzJlLTFhZDMxMDcwODNmY9kkNjdjMDg2MGItYjRjMS00MTJkLTg3MGEtYTRjZTQ5ODc0NjVl2SRiZDVlYzA4Ni01MTU2LTRlN2MtYTcwYi01Y2E5ZjA4OWJiNDnZJDc4NTNjYzdmLTRlNTgtNDRkMS04ZDNiLWY4ZDQ3NDU1NjRlNtkkOWQyMzM4MmMtY2YzNS00YjIwLWE0NmMtMGY0ZTJkZTE3ZmM32SQ5NTlhY2I0MC0xZmQ2LTQzZjUtYTFhNi03M2E2Y2VhYWUxZDfZJDRkNjExNDI1LWM4ZTMtNGJjMy05MTJiLThiYzA0NjUzNjNiY9kkYTU0OTBhNmItZGMxMS00MmI3LTg3ZTAtZDM4ODcwZmM1NWU02SQ3MDVlMzBmZS03N2EzLTRiMDYtOGI5OS0xODA3MjkwZWRmZmLZJDJlZTdmMjZkLWYzODMtNGU3ZS1hNjlhLThmYjcyNzE3NDY3Y9kkNzliZWJhODgtOTMyZi00MTQ3LWIzYTAtZDgyMWVmMWJjMWUy2SQ2M2Q2YzJkZi1hNDExLTQwN2MtYWYxMS00ZjVkMDlmYmIzMjLZJDYzMzAyOWFmLThjYWMtNDI2ZS1iMzVjLWM5ZmIzOTM4Yjc4NNkkMDY1YmFkNzMtNWZhOC00NDk2LWJhMzMtOWU2Njk0MGI1ODA22SQyMDczZjExZS04MTk2LTRlYmMtOTIyZi01ZmE1ODllOTE3OTfZJDgxMWNmNzhiLWU4NzAtNDViYi05MTczLTg5YTNiM2Q0OTVmNdkkZTdkNjc2NjItNzdiMy00ODJhLWIwMzItOGRiNGFmYmMwMWE22SQ5OTZiNDA4NS0xMTRjLTQ4ZjQtOWY5MC04ZTYzN2YyOWMwNmHZJDNhMDY2YmY0LTM0NjYtNDY5ZS05MGQwLTZiMTRiZTNlZDhkNdkkMzIxM2Q5NzctN2I2NS00M2IwLWE4ODEtMTBmY2MyNTIzZjE02SQ5MDNmZWU2Ny02YjIzLTQxZGMtYTAzZC1mMTA0MGI2OTZiZTbZJDA4ZDcxMWMwLWUyY2MtNDQ0NC05NGNhLTBjNGMzY2ZlOTAxZtkkMDNlOWQ3NWUtZTZjOS00MTk5LTkzM2ItMmJlMzA2ZGFmOTc42SQyNmQxMTYwMC0yODI3LTRlMDgtOTE5NS0xMDljOGE4YmRkYzPZJGJlMmE3ODIwLWUxOTQtNDQxMC1iMDBkLWE5MzMyYjIzNGFkNrRsYXN0X2hvdF9yZWxvYWRfdGltZcsAAAAAAAAAAKlzaG9ydHBhdGiydGVzdF9ib25kc3RhYmxlLmpsrnByb2Nlc3Nfc3RhdHVzpXJlYWR5pHBhdGjZSS9ob21lL2FtZW5nYWxpL1JlcG9zL2dpdGh1Yi9taW5lL1BsdXRvRXh0cmFzL25vdGVib29rcy90ZXN0X2JvbmRzdGFibGUuamytcGx1dG9fdmVyc2lvbqd2MC4yMC41rmxhc3Rfc2F2ZV90aW1ly0HaAZU0dOUyqmNlbGxfb3JkZXLcACzZJDlkNDQ1NWFmLTk2ZjEtNDZkNy1hNGYzLTQzNDQ5NWIxMWM4YdkkOTQ5YWMxZWYtYzUwMi00ZTI4LTgxZmYtZjk5YjBkMTlhYTAz2SQ3MDcxNzVhOS1kMzU2LTQzY2YtODAzOC02MjBlYmM0MDFjOTPZJGNiZmM2ZWVjLTg5OTEtNGE5Yy1hZGEwLTI5NWM4MDUyODU0ZNkkNDg0Mzk4M2MtZGY2NC00Yjk0LTg2MzQtN2ExMGQ5NDIzYTcw2SRhODk5NTIyNC04M2M2LTRmODItYjVhNS04N2E2Zjg2ZmM3YTDZJDllMzYwMWY1LWVmYzItNDRlOS04M2Q4LTViNjVjZTdlOWNjZtkkY2RjMGE3YWQtYTNhYy00MjcwLWI3MDctMzViMTkzOWRhMjc22SRmZTg5MWI0ZS1mNDQwLTQ4MjMtYjQzYi03MjU3MmY2YTZjMTLZJDg2YTgwMjI4LWY0OTUtNDNlOC1iMWQ0LWM5M2I3YjUyYzhkONkkMjM1OGY2ODYtMTk1MC00MGY5LTlkNWMtZGFjMmQ5OGY0YzI02SQ0OTUxNjM3NC1mNjI1LTRhODQtYWM1Yy1mOTI0OTdkNDUwMjXZJDhjYzUzY2QyLTkxMTQtNDA2Ny1hYjBiLTM3ZmQ4Y2Q3OTI0MNkkMGRiNTFkMzktN2MwNS00ZTAwLWI5NTEtN2ZlNzc2YThlMGY52SRlMmI3OWE1OC1lNjZlLTRkNDAtODY3My00MTg4MjM3NTNiMzjZJDQ2Njk5NWEyLWRmZDQtNDM3NC04MzM5LWJjMDIzMjAzOWIyN9kkNGNiMTI4YWEtN2FkOC00ZDE3LWJjZWQtMzY4NDU3MDNlNmE42SQ3ODU1ODI2ZS1jY2FhLTRjMjctYTA2MC1mNWNlYjkyN2JiZTjZJDFkNTU3M2VlLTg3MmUtNGRmYi1hNzg1LTFhYzllODM2YWQ5ONkkZjY1YjMyMzEtZjJiMi00NWRjLWI3MmUtMWFkMzEwNzA4M2Zj2SQ2N2MwODYwYi1iNGMxLTQxMmQtODcwYS1hNGNlNDk4NzQ2NWXZJGJkNWVjMDg2LTUxNTYtNGU3Yy1hNzBiLTVjYTlmMDg5YmI0OdkkNzg1M2NjN2YtNGU1OC00NGQxLThkM2ItZjhkNDc0NTU2NGU22SQ5ZDIzMzgyYy1jZjM1LTRiMjAtYTQ2Yy0wZjRlMmRlMTdmYzfZJDk1OWFjYjQwLTFmZDYtNDNmNS1hMWE2LTczYTZjZWFhZTFkN9kkNGQ2MTE0MjUtYzhlMy00YmMzLTkxMmItOGJjMDQ2NTM2M2Jj2SRhNTQ5MGE2Yi1kYzExLTQyYjctODdlMC1kMzg4NzBmYzU1ZTTZJDcwNWUzMGZlLTc3YTMtNGIwNi04Yjk5LTE4MDcyOTBlZGZmYtkkMmVlN2YyNmQtZjM4My00ZTdlLWE2OWEtOGZiNzI3MTc0Njdj2SQ3OWJlYmE4OC05MzJmLTQxNDctYjNhMC1kODIxZWYxYmMxZTLZJDYzZDZjMmRmLWE0MTEtNDA3Yy1hZjExLTRmNWQwOWZiYjMyMtkkNjMzMDI5YWYtOGNhYy00MjZlLWIzNWMtYzlmYjM5MzhiNzg02SQwNjViYWQ3My01ZmE4LTQ0OTYtYmEzMy05ZTY2OTQwYjU4MDbZJDIwNzNmMTFlLTgxOTYtNGViYy05MjJmLTVmYTU4OWU5MTc5N9kkODExY2Y3OGItZTg3MC00NWJiLTkxNzMtODlhM2IzZDQ5NWY12SRlN2Q2NzY2Mi03N2IzLTQ4MmEtYjAzMi04ZGI0YWZiYzAxYTbZJDk5NmI0MDg1LTExNGMtNDhmNC05ZjkwLThlNjM3ZjI5YzA2YdkkM2EwNjZiZjQtMzQ2Ni00NjllLTkwZDAtNmIxNGJlM2VkOGQ12SQzMjEzZDk3Ny03YjY1LTQzYjAtYTg4MS0xMGZjYzI1MjNmMTTZJDkwM2ZlZTY3LTZiMjMtNDFkYy1hMDNkLWYxMDQwYjY5NmJlNtkkMDhkNzExYzAtZTJjYy00NDQ0LTk0Y2EtMGM0YzNjZmU5MDFm2SQwM2U5ZDc1ZS1lNmM5LTQxOTktOTMzYi0yYmUzMDZkYWY5NzjZJDI2ZDExNjAwLTI4MjctNGUwOC05MTk1LTEwOWM4YThiZGRjM9kkYmUyYTc4MjAtZTE5NC00NDEwLWIwMGQtYTkzMzJiMjM0YWQ2sXB1Ymxpc2hlZF9vYmplY3RzgKVuYnBrZ4qvaW5zdGFsbF90aW1lX25zzwAAAAE5KPyVrGluc3RhbnRpYXRlZMOyaW5zdGFsbGVkX3ZlcnNpb25zg6tQbHV0b0V4dHJhc6YwLjcuMTSnUGx1dG9VSaYwLjcuNjKwSHlwZXJ0ZXh0TGl0ZXJhbKUwLjkuNbB0ZXJtaW5hbF9vdXRwdXRzhKpuYnBrZ19zeW5j2gFAChtbMG0bWzFtSW5zdGFudGlhdGluZy4uLhtbMjJtChtbOTBtPT09G1szOW0KChtbMG0bWzFtUmVzb2x2aW5nLi4uG1syMm0KG1s5MG09PT0bWzM5bQobWzMybRtbMW0gIE5vIENoYW5nZXMbWzIybRtbMzltIHRvIGAvdG1wL2psX3c2Y1VTTS9Qcm9qZWN0LnRvbWxgChtbMzJtG1sxbSAgTm8gQ2hhbmdlcxtbMjJtG1szOW0gdG8gYC90bXAvamxfdzZjVVNNL01hbmlmZXN0LnRvbWxgCgobWzBtG1sxbVByZWNvbXBpbGluZy4uLhtbMjJtChtbOTBtPT09G1szOW0KG1szMm0bWzFtICBBY3RpdmF0aW5nG1syMm0bWzM5bSBwcm9qZWN0IGF0IGAvdG1wL2psX3c2Y1VTTWCrUGx1dG9FeHRyYXPaAUAKG1swbRtbMW1JbnN0YW50aWF0aW5nLi4uG1syMm0KG1s5MG09PT0bWzM5bQoKG1swbRtbMW1SZXNvbHZpbmcuLi4bWzIybQobWzkwbT09PRtbMzltChtbMzJtG1sxbSAgTm8gQ2hhbmdlcxtbMjJtG1szOW0gdG8gYC90bXAvamxfdzZjVVNNL1Byb2plY3QudG9tbGAKG1szMm0bWzFtICBObyBDaGFuZ2VzG1syMm0bWzM5bSB0byBgL3RtcC9qbF93NmNVU00vTWFuaWZlc3QudG9tbGAKChtbMG0bWzFtUHJlY29tcGlsaW5nLi4uG1syMm0KG1s5MG09PT0bWzM5bQobWzMybRtbMW0gIEFjdGl2YXRpbmcbWzIybRtbMzltIHByb2plY3QgYXQgYC90bXAvamxfdzZjVVNNYKdQbHV0b1VJ2gFAChtbMG0bWzFtSW5zdGFudGlhdGluZy4uLhtbMjJtChtbOTBtPT09G1szOW0KChtbMG0bWzFtUmVzb2x2aW5nLi4uG1syMm0KG1s5MG09PT0bWzM5bQobWzMybRtbMW0gIE5vIENoYW5nZXMbWzIybRtbMzltIHRvIGAvdG1wL2psX3c2Y1VTTS9Qcm9qZWN0LnRvbWxgChtbMzJtG1sxbSAgTm8gQ2hhbmdlcxtbMjJtG1szOW0gdG8gYC90bXAvamxfdzZjVVNNL01hbmlmZXN0LnRvbWxgCgobWzBtG1sxbVByZWNvbXBpbGluZy4uLhtbMjJtChtbOTBtPT09G1szOW0KG1szMm0bWzFtICBBY3RpdmF0aW5nG1syMm0bWzM5bSBwcm9qZWN0IGF0IGAvdG1wL2psX3c2Y1VTTWCwSHlwZXJ0ZXh0TGl0ZXJhbNoBQAobWzBtG1sxbUluc3RhbnRpYXRpbmcuLi4bWzIybQobWzkwbT09PRtbMzltCgobWzBtG1sxbVJlc29sdmluZy4uLhtbMjJtChtbOTBtPT09G1szOW0KG1szMm0bWzFtICBObyBDaGFuZ2VzG1syMm0bWzM5bSB0byBgL3RtcC9qbF93NmNVU00vUHJvamVjdC50b21sYAobWzMybRtbMW0gIE5vIENoYW5nZXMbWzIybRtbMzltIHRvIGAvdG1wL2psX3c2Y1VTTS9NYW5pZmVzdC50b21sYAoKG1swbRtbMW1QcmVjb21waWxpbmcuLi4bWzIybQobWzkwbT09PRtbMzltChtbMzJtG1sxbSAgQWN0aXZhdGluZxtbMjJtG1szOW0gcHJvamVjdCBhdCBgL3RtcC9qbF93NmNVU01gp2VuYWJsZWTDt3Jlc3RhcnRfcmVjb21tZW5kZWRfbXNnwLRyZXN0YXJ0X3JlcXVpcmVkX21zZ8CtYnVzeV9wYWNrYWdlc5C2d2FpdGluZ19mb3JfcGVybWlzc2lvbsLZLHdhaXRpbmdfZm9yX3Blcm1pc3Npb25fYnV0X3Byb2JhYmx5X2Rpc2FibGVkwqtjZWxsX2lucHV0c94ALNkkOTk2YjQwODUtMTE0Yy00OGY0LTlmOTAtOGU2MzdmMjljMDZhhKdjZWxsX2lk2SQ5OTZiNDA4NS0xMTRjLTQ4ZjQtOWY5MC04ZTYzN2YyOWMwNmGkY29kZaJudKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkOGNjNTNjZDItOTExNC00MDY3LWFiMGItMzdmZDhjZDc5MjQwhKdjZWxsX2lk2SQ4Y2M1M2NkMi05MTE0LTQwNjctYWIwYi0zN2ZkOGNkNzkyNDCkY29kZdoBpW1kIiIiClNvbWV0aW1lcyBjdXN0b20gc3RydWN0cyBhcmUgbm90IG5lZWRlZCBhbmQgaXQgd291bGQgYmUgdXNlZnVsIHRvIGp1c3QgdXNlIHRoZSBzYW1lIG5pY2UgYm9uZCBzdHJ1Y3R1cmUgb2YgYFN0cnVjdEJvbmRgIHRvIHNpbXBseSBjcmVhdGUgYXJiaXRyYXJ5IE5hbWVkVHVwbGVzLiAKClRoaXMgaXMgcG9zc2libGUgd2l0aCB0aGUgY29udmVuaWVuY2UgbWFjcm8gYEBOVEJvbmRgIHdoaWNoIGNhbiBiZSBjYWxsZWQgYXMgc2hvd24gYmVsb3cgdG8gY3JlYXRlIGEgbmljZSBkaXNwbGF5IGZvciBhbiBpbnRlcmFjdGl2ZSBib25kIGNyZWF0aW5nIGFuIGFyYml0cmFyeSBOYW1lZFR1cGxlLgoKVGhlIG1hY3JvIHNpbXBseSBjcmVhdGUgYSBgU3RydWN0Qm9uZGAgd3JhcHBpbmcgdGhlIGRlc2lyZWQgTmFtZWRUdXBsZSB0eXBlLgoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJDY3YzA4NjBiLWI0YzEtNDEyZC04NzBhLWE0Y2U0OTg3NDY1ZYSnY2VsbF9pZNkkNjdjMDg2MGItYjRjMS00MTJkLTg3MGEtYTRjZTQ5ODc0NjVlpGNvZGXaBV1tZCIiIgpTb21ldGltZXMsIG9uZSB3YW50cyB0byBjcmVhdGUgYSBtb3JlIGNvbXBsZXggYmluZGluZyB3aGVyZSB0aGUgbnVtYmVyIG9mIHBhcmFtZXRlcnMgdG8gY29udHJvbCBhIGJvbmQgY2FuIHZhcnkgZGVwZW5kaW5nIG9uIHNvbWUgb3RoZXIgdmFyaWFibGUuIFRoZSBgU3RydWN0Qm9uZFNlbGVjdGAgY2FuIGJlIG9mIGhlbHAgaW4gc29tZSBvZiB0aGVzZSBjYXNlcywgYnkgcHJvdmlkaW5nIGEgd2F5IHRvIHNlbGVjdCBvdXQgb2YgYSBudW1iZXIgb2YgYXJiaXRyYXJ5IGBTdHJ1Y3RCb25kc2AgKHdoaWNoIGluY2x1ZGUgYEBOVEJvbmRgKSBieSB1c2luZyBhIGRyb3Bkb3duIHRvIHNlbGVjdCB0aGUgb25lIHRvIGJlIGRpc3BsYXllZCBhbmQgdXNlZCBmb3IgZ2VuZXJhdGluZyB0aGUgYFN0cnVjdEJvbmRTZWxlY3RgIHdpZGdldCdzIG91dHB1dC4KClRoaXMgc3RydWN0dXJlIGNhbiBiZSBjb25zdHJ1Y3RlZCB3aXRoIGEgdmVjdG9yIG9mIGBTdHJ1Y3RCb25kYCBvciBgdHJhbnNmb3JtZWRfdmFsdWUoZiwgOjpTdHJ1Y3RCb25kKWAgZWxlbWVudHMsIGFuZCB3aWxsIHRha2UgY2FyZSBvZiBnZW5lcmF0aW5nIGFuIGFwcHJvcHJpYXRlIHdpZGdldCB0byBkaXNwbGF5IGFuZCBwcm9jZXNzIG9ubHkgdGhlIHNlbGVjdGVkIG9uZS4KClRoZSBtYWluIHNpZ25hdHVyZSBvZiB0aGUgY29uc3RydWN0b3IgaXMgdGhlIGZvbGxvd2luZzoKYGBganVsaWEKU3RydWN0Qm9uZFNlbGVjdChlbHM6OlZlY3RvcjsgZGVzY3JpcHRpb24gPSAiU3RydWN0Qm9uZFNlbGVjdCIsIGRlZmF1bHRfaWR4ID0gMSwgc2VsZWN0b3JfdGV4dCA9ICJTZWxlY3RvciIpCmBgYAoKVGhlIG5hbWVzIHRvIHNlbGVjdCB1cG9uIHdpbGwgYmUgdGFrZW4gZnJvbSB0aGUgYGRlc2NyaXB0aW9uYCBvZiB0aGUgcHJvdmlkZWQgYFN0cnVjdEJvbmRzYCwgd2hpbGUgdGhlIHRleHQgZGlzcGxheWVkIG5leHQgdG8gdGhlIF9zZWxlY3Rvcl8gd2lsbCBkZWZhdWx0IHRvIGBTZWxlY3RvcmAgYnV0IGNhbiBiZSBjdXN0b21pemVkIHdpdGggdGhlIGBzZWxlY3Rvcl90ZXh0YCBrd2FyZyB0byB0aGUgY29uc3RydWN0b3IuClRoZSBgZGVzY3JpcHRpb25gIGt3YXJnIGNhbiBiZSB1c2VkIHRvIGN1c3RvbWl6ZSB0aGUgdGV4dCBpbiB0aGUgd2lkZ2V0IGNvbnRhaW5lciAoc2ltaWxhciB0byB0aGUgc2FtZSBrd2FyZyBpbiBgU3RydWN0Qm9uZGAgYW5kIHRvIGBATlRCb25kYCkuIEZpbmFsbHksIHRoZSBgZGVmYXVsdF9pZHhgIHNob3VsZCBiZSBhbiBpbnRlZ2VyIGFuZCB3aWxsIHNlbGVjdCB3aGljaCBvZiB0aGUgcHJvdmlkZWQgYFN0cnVjdEJvbmRgcyB3aWxsIGJlIHNlbGVjdGVkIGFzIGRlZmF1bHQgd2hlbiBpbnN0YW50aWF0aW5nIHRoZSB3aWRnZXQuCiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkMmVlN2YyNmQtZjM4My00ZTdlLWE2OWEtOGZiNzI3MTc0NjdjhKdjZWxsX2lk2SQyZWU3ZjI2ZC1mMzgzLTRlN2UtYTY5YS04ZmI3MjcxNzQ2N2OkY29kZbJtZCIiIgojIFBvcG91dAoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJDMyMTNkOTc3LTdiNjUtNDNiMC1hODgxLTEwZmNjMjUyM2YxNISnY2VsbF9pZNkkMzIxM2Q5NzctN2I2NS00M2IwLWE4ODEtMTBmY2MyNTIzZjE0pGNvZGXaAhltZCIiIgpUaGUgZmluYWwgY29udmVuaWVuY2Ugc3RydWN0dXJlIHByb3ZpZGVkIGJ5IHRoaXMgbW9kdWxlIGlzIHRoZSBgQm9uZFRhYmxlYC4gSXQgY2FuIGJlIGNyZWF0ZWQgdG8gZ3JvdXAgYSBsaXN0IG9mIGJvbmRzIGluIGEgZmxvYXRpbmcgdGFibGUgdGhhdCBzdGF5cyBvbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSBub3RlYm9vayAoc2ltaWxhciB0byB0aGUgVGFibGVPZkNvbnRlbnRzIG9mIFBsdXRvVUkpIGFuZCBjYW4gYmUgbW92ZWQgYXJvdW5kIGFuZCByZXNpemVkIG9yIGhpZGRlbiBmb3IgY29udmVuaWVuY2UuCgpUaGUgQm9uZFRhYmxlIGlzIGludGVuZGVkIHRvIGJlIHVzZWQgZWl0aGVyIHdpdGggYm9uZHMgY29udGFpbmluZyBgU3RydWN0Qm9uZGAgb3Igd2l0aCBgQm9uZHNMaXN0YC4gRnV0dXJlIHR5cGVzIHdpdGggc2ltaWxhciBzdHJ1Y3R1cmUgd2lsbCBhbHNvIGJlIGFkZGVkLgoKSGVyZSBpcyBhbiBleGFtcGxlIG9mIGEgYm9uZHRhYmxlIGNvbnRhaW5pbmcgYWxsIHRoZSBleGFtcGxlcyBvZiB0aGlzIG5vdGVib29rLgoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJDRjYjEyOGFhLTdhZDgtNGQxNy1iY2VkLTM2ODQ1NzAzZTZhOISnY2VsbF9pZNkkNGNiMTI4YWEtN2FkOC00ZDE3LWJjZWQtMzY4NDU3MDNlNmE4pGNvZGXaARptZCIiIgpgQE5UQm9uZGAgaXMgYWxzbyBxdWl0ZSB1c2VmdWwgaW4gY29tYmluYXRpb24gd2l0aCBgdHJhbnNmb3JtZWRfdmFsdWVgIGZyb20gYFBsdXRvVUkuRXhwZXJpbWVudGFsYC4gRm9yIHRoaXMgcmVhc29uLCB0aGUgYEBOVEJvbmRgIG1hY3JvIHN1cHBvcnRzIGFuIG9wdGlvbmFsIHRoaXJkIGFyZ3VtZW50IHdoaWNoIHNoYWxsIGJlIGEgZnVuY3Rpb24gdGhhdCB3aGVuIHByb3ZpZGVkIGlzIGRpcmVjdGx5IHVzZWQgdG8gdHJhbnNmb3JtIHRoZSB2YWx1ZSBvZiB0aGUgd2lkZ2V0LgoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJGJkNWVjMDg2LTUxNTYtNGU3Yy1hNzBiLTVjYTlmMDg5YmI0OYSnY2VsbF9pZNkkYmQ1ZWMwODYtNTE1Ni00ZTdjLWE3MGItNWNhOWYwODliYjQ5pGNvZGXaAdNzYnNfYm9uZCA9IEBiaW5kIHNicyBTdHJ1Y3RCb25kU2VsZWN0KFsKCUBOVEJvbmQgImNvcyhhcmcpIiBiZWdpbgoJCWFyZyA9IFNsaWRlcihyYW5nZSgwLDEsMTAwKSkKCWVuZCAobnQgLT4gY29zKG50LmFyZykpICMgV2UgbmVlZCB0byB3cmFwIHRoZSBmdW5jdGlvbiBnaXZlbiB0byBgQE5UQm9uZGAgaW4gKCkgdG8gYXZvaWQgcGFyc2UgcHJvYmxlbXMgd2hlbiBwcm92aWRpbmcgYSBmdW5jdGlvbgoJQE5UQm9uZCAiYXRhbih5LHgpIiBiZWdpbgoJCXggPSBTbGlkZXIocmFuZ2UoMCwxMDsgc3RlcCA9IDAuMSk7IGRlZmF1bHQgPSAzLCBzaG93X3ZhbHVlPXRydWUpCgkJeSA9IFNsaWRlcihyYW5nZSgwLCAxMDsgc3RlcCA9IDAuMSk7IGRlZmF1bHQgPSA1LCBzaG93X3ZhbHVlPXRydWUpCgllbmQgbnQgLT4gYXRhbihudC55LCBudC54KQpdOyBkZWZhdWx0X2lkeCA9IDIsIHNlbGVjdG9yX3RleHQgPSAiT3B0aW9uczoiKahtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkMjM1OGY2ODYtMTk1MC00MGY5LTlkNWMtZGFjMmQ5OGY0YzI0hKdjZWxsX2lk2SQyMzU4ZjY4Ni0xOTUwLTQwZjktOWQ1Yy1kYWMyZDk4ZjRjMjSkY29kZaNib2iobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDQ5NTE2Mzc0LWY2MjUtNGE4NC1hYzVjLWY5MjQ5N2Q0NTAyNYSnY2VsbF9pZNkkNDk1MTYzNzQtZjYyNS00YTg0LWFjNWMtZjkyNDk3ZDQ1MDI1pGNvZGWzbWQiIiIKIyBATlRCb25kCiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkNzA3MTc1YTktZDM1Ni00M2NmLTgwMzgtNjIwZWJjNDAxYzkzhKdjZWxsX2lk2SQ3MDcxNzVhOS1kMzU2LTQzY2YtODAzOC02MjBlYmM0MDFjOTOkY29kZblFeHRlbmRlZFRhYmxlT2ZDb250ZW50cygpqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTC2SQwOGQ3MTFjMC1lMmNjLTQ0NDQtOTRjYS0wYzRjM2NmZTkwMWaEp2NlbGxfaWTZJDA4ZDcxMWMwLWUyY2MtNDQ0NC05NGNhLTBjNGMzY2ZlOTAxZqRjb2Rlom50qG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTC2SRlN2Q2NzY2Mi03N2IzLTQ4MmEtYjAzMi04ZGI0YWZiYzAxYTaEp2NlbGxfaWTZJGU3ZDY3NjYyLTc3YjMtNDgyYS1iMDMyLThkYjRhZmJjMDFhNqRjb2Rlo2FzZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkOTQ5YWMxZWYtYzUwMi00ZTI4LTgxZmYtZjk5YjBkMTlhYTAzhKdjZWxsX2lk2SQ5NDlhYzFlZi1jNTAyLTRlMjgtODFmZi1mOTliMGQxOWFhMDOkY29kZdmgYmVnaW4KCXVzaW5nIFBsdXRvRXh0cmFzLlN0cnVjdEJvbmRNb2R1bGUKICAgIHVzaW5nIFBsdXRvRXh0cmFzCgl1c2luZyBQbHV0b0V4dHJhczogRXh0ZW5kZWRUYWJsZU9mQ29udGVudHMsIEVkaXRhYmxlCgl1c2luZyBIeXBlcnRleHRMaXRlcmFsCgl1c2luZyBQbHV0b1VJCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkOWQyMzM4MmMtY2YzNS00YjIwLWE0NmMtMGY0ZTJkZTE3ZmM3hKdjZWxsX2lk2SQ5ZDIzMzgyYy1jZjM1LTRiMjAtYTQ2Yy0wZjRlMmRlMTdmYzekY29kZbZtZCIiIgojIEBCb25kc0xpc3QKIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SRlMmI3OWE1OC1lNjZlLTRkNDAtODY3My00MTg4MjM3NTNiMziEp2NlbGxfaWTZJGUyYjc5YTU4LWU2NmUtNGQ0MC04NjczLTQxODgyMzc1M2IzOKRjb2Rlom50qG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTC2SQ5NTlhY2I0MC0xZmQ2LTQzZjUtYTFhNi03M2E2Y2VhYWUxZDeEp2NlbGxfaWTZJDk1OWFjYjQwLTFmZDYtNDNmNS1hMWE2LTczYTZjZWFhZTFkN6Rjb2Rl2gNYbWQiIiIKSW4gc29tZSBjYXNlcywgb25lIGRvZXMgbm90IHdhbnQgdG8gaGF2ZSBhIHNpbmdsZSBib25kIHdyYXBwaW5nIGVpdGhlciBhIFN0cnVjdHVyZSBvciBhIE5hbWVkVHVwbGUgYmVjYXVzZSBzaW5nbGUgaW5kZXBlbmRlbnQgYm9uZHMgYXJlIG1vcmUgY29udmVuaWVudC4KCmBAQm9uZHNMaXN0YCBpcyBhIGNvbnZlbmllbmNlIG1hY3JvIHRvIGNyZWF0ZSBhbiBvYmplY3Qgb2YgdHlwZSBgQm9uZHNMaXN0YCB3aGljaCBzaW1wbHkgYWxsb3cgdG8gYWRkIGEgZGVzY3JpcHRpb24gdG8gc2VwYXJhdGUgYm9uZHMgYW5kIGdyb3VwIHRoZW0gYWxsIHRvZ2V0aGVyIGluIGEgdGFibGUtbGlrZSBmb3JtYXQgZXF1aXZhbGVudCB0byB0aG9zZSBvZiBgU3RydWN0Qm9uZGAuCgohISEgbm90ZQoJVW5saWtlIGBTdHJ1Y3RCb25kYCwgYSBCb25kc0xpc3QgaXMgYWxyZWFkeSBjb21wb3NlZCBvZiBib25kIGNyZWF0ZWQgd2l0aCBgQGJpbmRgIGFuZCBpdCBqdXN0IGdyb3VwcyB0aGVtIHVwIHdpdGggYSBkZXNjcmlwdGlvbi4gVGhlIG91dHB1dCBvZiBgQEJvbmRzTGlzdGAgaXMgbm90IHN1cHBvc2VkIHRvIGJlIGJvdW5kIHRvIGEgdmFyaWFibGUgdXNpbmcgYEBiaW5kYC5cCglUaGUgYm9uZHMgZ3JvdXBlZCBpbiBhIEJvbmRzTGlzdCBzdGlsbCBhY3QgYW5kIHVwZGF0ZSBpbmRlcGVuZGVudGx5IGZyb20gb25lIGFub3RoZXIuCgpTZWUgdGhlIGV4YW1wbGUgYmVsb3cgZm9yIHVuZGVyc3RhbmRpbmcgdGhlIHN5bnRoYXguIFRoZSBoZWFkZXIgb2YgYSBCb25kc0xpc3QgaXMgc2hvd24gaW4gYW4gb3JhbmdlIGJhY2tncm91bmQgdG8gZWFzaWx5IGRpZmZlcmVudGlhdGUgaXQgZnJvbSBgU3RydWN0Qm9uZGAuCiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkMjA3M2YxMWUtODE5Ni00ZWJjLTkyMmYtNWZhNTg5ZTkxNzk3hKdjZWxsX2lk2SQyMDczZjExZS04MTk2LTRlYmMtOTIyZi01ZmE1ODllOTE3OTekY29kZdoBN21kIiIiClRoZSBhYmlsaXR5IHRvIGFsc28gd3JhcCBwcmUtZXhpc3RpbmcgYm9uZHMgYXJvdW5kIFN0cnVjdEJvbmRzIGlzIGNvbnZlbmllbnQgZm9yIG9yZ2FuaXppbmcgdGhlIHZhcmlvdXMgYm9uZHMgb25lIGhhdmUgaW4gYSBgQm9uZHNMaXN0YCBvciBgQm9uZFRhYmxlYAoKQXMgYW4gZXhhbXBsZSwgb25lIGNhbiBjcmVhdGUgYSBgQm9uZHNMaXN0YCBjb250YWluaW5nIHRoZSB0d28gYFN0cnVjdEJvbmRgIGJvbmRzIGdlbmVyYXRlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoaXMgbm90ZWJvb2sgd2l0aCB0aGUgZm9sbHdpbmcgY29kZS4KIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SQ3MDVlMzBmZS03N2EzLTRiMDYtOGI5OS0xODA3MjkwZWRmZmKEp2NlbGxfaWTZJDcwNWUzMGZlLTc3YTMtNGIwNi04Yjk5LTE4MDcyOTBlZGZmYqRjb2Rlo2FsdKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkMGRiNTFkMzktN2MwNS00ZTAwLWI5NTEtN2ZlNzc2YThlMGY5hKdjZWxsX2lk2SQwZGI1MWQzOS03YzA1LTRlMDAtYjk1MS03ZmU3NzZhOGUwZjmkY29kZdnHbnRfYm9uZCA9IEBiaW5kIG50IEBOVEJvbmQgIk15IEZhbmN5IE5UdXBsZSIgYmVnaW4KCWEgPSAoIkRlc2NyaXB0aW9uIiwgU2xpZGVyKDE6MTApKQoJYiA9IChtZCIqKkJvbGQqKiBmaWVsZCIsIFNsaWRlcigxOjEwKSkKCWMgPSBTbGlkZXIoMToxMCkgIyBObyBkZXNjcmlwdGlvbiwgZGVmYXVsdHMgdG8gdGhlIG5hbWUgb2YgdGhlIGZpZWxkCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkY2JmYzZlZWMtODk5MS00YTljLWFkYTAtMjk1YzgwNTI4NTRkhKdjZWxsX2lk2SRjYmZjNmVlYy04OTkxLTRhOWMtYWRhMC0yOTVjODA1Mjg1NGSkY29kZdlUIyBodG1sIiIiCiMgPHN0eWxlPgojIG1haW4gewojIAltYXJnaW4tcmlnaHQ6IDM1MHB4ICFpbXBvcnRhbnQ7CiMgfQojIDwvc3R5bGU+CiMgIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTC2SQ0ZDYxMTQyNS1jOGUzLTRiYzMtOTEyYi04YmMwNDY1MzYzYmOEp2NlbGxfaWTZJDRkNjExNDI1LWM4ZTMtNGJjMy05MTJiLThiYzA0NjUzNjNiY6Rjb2Rl2gEzYmwgPSBAQm9uZHNMaXN0ICJNeSBHcm91cCBvZiBCb25kcyIgbGV0IHR2ID0gUGx1dG9VSS5FeHBlcmltZW50YWwudHJhbnNmb3JtZWRfdmFsdWUKCSAjIFdlIHVzZSB0cmFuc2Zvcm1lZF92YWx1ZSB0byB0cmFuc2xhdGUgR0h6IHRvIEh6IGluIHRoZSBib3VuZCB2YXJpYWJsZSBgZnJlcWAKCSJGcmVxdWVuY3kgW0dIel0iID0gQGJpbmQgZnJlcSB0dih4IC0+IHggKiAxZTksIEVkaXRhYmxlKDIwOyBzdWZmaXggPSAiIEdIeiIpKQoJbWQiQWx0aXR1ZGUgYGBoYGAgW21dIiA9IEBiaW5kIGFsdCBTY3J1YmJhYmxlKDEwMDoxMDoyMDApCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkYmUyYTc4MjAtZTE5NC00NDEwLWIwMGQtYTkzMzJiMjM0YWQ2hKdjZWxsX2lk2SRiZTJhNzgyMC1lMTk0LTQ0MTAtYjAwZC1hOTMzMmIyMzRhZDakY29kZaNhbHSobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDQ2Njk5NWEyLWRmZDQtNDM3NC04MzM5LWJjMDIzMjAzOWIyN4SnY2VsbF9pZNkkNDY2OTk1YTItZGZkNC00Mzc0LTgzMzktYmMwMjMyMDM5YjI3pGNvZGW+bWQiIiIKIyMgdHJhbnNmb3JtZWRfdmFsdWUKIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SQ3ODUzY2M3Zi00ZTU4LTQ0ZDEtOGQzYi1mOGQ0NzQ1NTY0ZTaEp2NlbGxfaWTZJDc4NTNjYzdmLTRlNTgtNDRkMS04ZDNiLWY4ZDQ3NDU1NjRlNqRjb2Rlo3Nic6htZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkY2RjMGE3YWQtYTNhYy00MjcwLWI3MDctMzViMTkzOWRhMjc2hKdjZWxsX2lk2SRjZGMwYTdhZC1hM2FjLTQyNzAtYjcwNy0zNWIxOTM5ZGEyNzakY29kZaNhc2SobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDc4NTU4MjZlLWNjYWEtNGMyNy1hMDYwLWY1Y2ViOTI3YmJlOISnY2VsbF9pZNkkNzg1NTgyNmUtY2NhYS00YzI3LWEwNjAtZjVjZWI5MjdiYmU4pGNvZGXZdkBiaW5kIHRyYW5zZm9ybWVkX3ZhbHVlX2V4YW1wbGUgQE5UQm9uZCAiVHJhbnNmb3JtZWQhIiBiZWdpbgoJYSA9IFNsaWRlcigxOjEwKQoJYiA9IFNsaWRlcigxOjEwKQplbmQgbnQgLT4gbnQuYSArIG50LmKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJGY2NWIzMjMxLWYyYjItNDVkYy1iNzJlLTFhZDMxMDcwODNmY4SnY2VsbF9pZNkkZjY1YjMyMzEtZjJiMi00NWRjLWI3MmUtMWFkMzEwNzA4M2ZjpGNvZGW8bWQiIiIKIyBTdHJ1Y3RCb25kU2VsZWN0CiIiIqhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkw9kkOTAzZmVlNjctNmIyMy00MWRjLWEwM2QtZjEwNDBiNjk2YmU2hKdjZWxsX2lk2SQ5MDNmZWU2Ny02YjIzLTQxZGMtYTAzZC1mMTA0MGI2OTZiZTakY29kZdlHQm9uZFRhYmxlKFsKCWFzZF9ib25kLAoJbnRfYm9uZCwKCWJsLAoJYmxjCl07IGRlc2NyaXB0aW9uID0gIk15IEJvbmRzIimobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDllMzYwMWY1LWVmYzItNDRlOS04M2Q4LTViNjVjZTdlOWNjZoSnY2VsbF9pZNkkOWUzNjAxZjUtZWZjMi00NGU5LTgzZDgtNWI2NWNlN2U5Y2NmpGNvZGXaAuNiZWdpbgoiIiIKCXN0cnVjdCBBU0QKIiIiCkJhc2UuQGt3ZGVmIHN0cnVjdCBBU0QKCWE6OkludCAKCWI6OkludAoJYzo6U3RyaW5nCgkiVGhpcyBmaWVsZCBpcyBfc3BlY2lhbF8iCglkOjpTdHJpbmcKCWU6OkludAplbmQKQHR5cGVhc2ZpZWxkIFN0cmluZyA9IFRleHRGaWVsZCgpICMgU3RyaW5nIGZpZWxkcyB3aXRoIG5vIHN0cnVjdC1zcGVjaWZpYyBkZWZhdWx0IHdpbGwgdXNlIHRoaXMgCkBmaWVsZGRhdGEgQVNEIGJlZ2luCglhID0gKG1kIk1hcmtkb3duIGRlc2NyaXB0aW9uLCBpbmNsdWRpbmcgYGBMYVRlWGBgIiwgU2xpZGVyKDE6MTApKQoJYiA9IChAaHRsKCI8c3Bhbj5GaWVsZCB3aXRoIDxiPkhUTUw8L2I+IGRlc2NyaXB0aW9uPC9zcGFuPiIpLCBTY3J1YmJhYmxlKDE6MTApKQoJYyA9ICgiTm9ybWFsIFN0cmluZyBEZXNjcmlwdGlvbiIsIFRleHRGaWVsZCgpKQoJIyBkIGhhcyBubyBBU0Qtc3BlY2lmaWMgY3VzdG9tIGJvbmQsIHNvIGl0IHdpbGwgdXNlIHRoZSBmaWVsZCBkb2NzdHJpbmcgYXMgZGVzY3JpcHRpb24gYW5kIHRoZSBkZWZhdWx0IFN0cmluZyB3aWRnZXQgYXMgd2lkZ2V0CgllID0gU2xpZGVyKDIwOjI1KSAjIE5vIGRlc2NyaXB0aW9uLCBkZWZhdWx0cyB0byB0aGUgZmllbGRuYW1lIGFzIG5vIGRvY3N0cmluZyBpcyBwcmVzZW50CmVuZAphc2RfYm9uZCA9IEBiaW5kIGFzZCBTdHJ1Y3RCb25kKEFTRDsgZGVzY3JpcHRpb24gPSAiQ3VzdG9tIERlc2NyaXB0aW9uIikKZW5kqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTC2SQwM2U5ZDc1ZS1lNmM5LTQxOTktOTMzYi0yYmUzMDZkYWY5NziEp2NlbGxfaWTZJDAzZTlkNzVlLWU2YzktNDE5OS05MzNiLTJiZTMwNmRhZjk3OKRjb2Rlo2FzZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkMDY1YmFkNzMtNWZhOC00NDk2LWJhMzMtOWU2Njk0MGI1ODA2hKdjZWxsX2lk2SQwNjViYWQ3My01ZmE4LTQ0OTYtYmEzMy05ZTY2OTQwYjU4MDakY29kZadsb2xfcG9wqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTC2SQyNmQxMTYwMC0yODI3LTRlMDgtOTE5NS0xMDljOGE4YmRkYzOEp2NlbGxfaWTZJDI2ZDExNjAwLTI4MjctNGUwOC05MTk1LTEwOWM4YThiZGRjM6Rjb2RlpGZyZXGobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJGE4OTk1MjI0LTgzYzYtNGY4Mi1iNWE1LTg3YTZmODZmYzdhMISnY2VsbF9pZNkkYTg5OTUyMjQtODNjNi00ZjgyLWI1YTUtODdhNmY4NmZjN2EwpGNvZGXaAYptZCIiIgpHZW5lcmF0aW5nIGF1dG9tYXRpYyB3aWRnZXRzIGZvciBjdXN0b20gc3RydWN0cyBpcyBxdWl0ZSBzdHJhaWdodGZvcndhcmQgd2l0aCB0aGUgYWlkIG9mIHRoZSBgQGZpZWxkZGF0YWAgbWFjcm8gYW5kIHRoZSBgU3RydWN0Qm9uZGAgdHlwZS4KClRoZSB0b3AtbGVmdCBhcnJvdyBjYW4gYmUgdXNlZCB0byBzaG93LWhpZGUgdGhlIGZpZWxkIGVsZW1lbnRzICh1c2VmdWwgaW5zaWRlIGEgYEJvbmRUYWJsZWAsIHNob3duIGJlbG93KSwgd2hpbGUgdGhlIGdyZWVuIHRvZ2dsZSBvbiB0aGUgdG9wLXJpZ2h0IGNhbiBiZSB1c2VkIHRvIGRpc2FibGUgdGVtcG9yYXJpbHkgdGhlIHN5bmNoIGJldHdlZW4gdGhlIEpTIHdpZGdldHMgYW5kIHRoZSBib25kIHZhbHVlcyBpbiBQbHV0by4KIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SRmZTg5MWI0ZS1mNDQwLTQ4MjMtYjQzYi03MjU3MmY2YTZjMTKEp2NlbGxfaWTZJGZlODkxYjRlLWY0NDAtNDgyMy1iNDNiLTcyNTcyZjZhNmMxMqRjb2Rl2SFtZCIiIgojIyBEZWZhdWx0IFR5cGUgV2lkZ2V0cwoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJDlkNDQ1NWFmLTk2ZjEtNDZkNy1hNGYzLTQzNDQ5NWIxMWM4YYSnY2VsbF9pZNkkOWQ0NDU1YWYtOTZmMS00NmQ3LWE0ZjMtNDM0NDk1YjExYzhhpGNvZGW0bWQiIiIKIyBQYWNrYWdlcwoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJDc5YmViYTg4LTkzMmYtNDE0Ny1iM2EwLWQ4MjFlZjFiYzFlMoSnY2VsbF9pZNkkNzliZWJhODgtOTMyZi00MTQ3LWIzYTAtZDgyMWVmMWJjMWUypGNvZGXaAzNtZCIiIgpUaGUgc3RydWN0dXJlcyBhYm92ZSBjYW4gYWxzbyBiZSB1c2VkIG5lc3RlZCB3aXRoaW4gb25lIGFub3RoZXIuIFRvIGZhY2lsaXRhdGUgYWNjZXNzaW5nIG5lc3RlZCBzdHJ1Y3R1cmVzLCBvbmUgY2FuIHVzZSB0aGUgYFBvcG91dGAgdHlwZS4KCkluIGl0cyBzaW1wbGUgZm9ybSwgeW91IGNhbiBnaXZlIGFuIGluc3RhbmNlIG9mIGEgU3RydWN0Qm9uZCwgYSBib25kIHdyYXBwaW5nIGEgU3RydWN0Qm9uZCBvciBhIEJvbmRzTGlzdCBhcyBpbnB1dCB0byBQb3BvdXQgdG8gY3JlYXRlIGEgdGFibGUgdGhhdCBpcyBoaWRkZW4gYmVoaW5kIGEgcG9wdXAgd2luZG93LgpJZiBhbiBpbnN0YW5jZSBwcmVzZW50LCBidXQgeW91IHdhbnQgYSBjdXN0b20gdHlwZSBmb3Igd2hpY2ggeW91IGhhdmUgZGVmaW5lZCBjdXN0b20gYm9uZHMgYW5kIGRlc2NyaXB0aW9ucyB3aXRoIGBAZmllbGRkYXRhYCB0byBhcHBlYXIgYXMgcG9wb3V0LCB5b3UgY2FuIHVzZSB0aGUgZnVuY3Rpb24gYHBvcG91dHdyYXAoVFlQRSlgIHRvIGdlbmVyYXRlIGEgc21hbGwgaWNvbiB3aGljaCBoaWRlcyBhIHBvcHVwIGNvbnRhaW5pbmcgdGhlIGBTdHJ1Y3RCb25kYCBvZiB0aGUgcHJvdmlkZWQgdHlwZSBgVFlQRWAuCgpUaGUgU3RydWN0Qm9uZCB0YWJsZSBhcHBlYXJzIG9uIGhvdmVyIHVwb24gdGhlIGljb24sIGNhbiBiZSBtYWRlIGZpeGVkIGJ5IGNsaWNraW5nIG9uIHRoZSBpY29uIGFuZCBjYW4gdGhlbiBiZSBtb3ZlZCBhcm91bmQgb3IgcmVzaXplZC4KQSBkb3VibGUgY2xpY2sgb24gdGhlIGhlYWRlciBvZiB0aGUgcG9wb3V0IGhpZGVzIGl0IGFnYWluOgoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJDFkNTU3M2VlLTg3MmUtNGRmYi1hNzg1LTFhYzllODM2YWQ5OISnY2VsbF9pZNkkMWQ1NTczZWUtODcyZS00ZGZiLWE3ODUtMWFjOWU4MzZhZDk4pGNvZGW5dHJhbnNmb3JtZWRfdmFsdWVfZXhhbXBsZahtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkODZhODAyMjgtZjQ5NS00M2U4LWIxZDQtYzkzYjdiNTJjOGQ4hKdjZWxsX2lk2SQ4NmE4MDIyOC1mNDk1LTQzZTgtYjFkNC1jOTNiN2I1MmM4ZDikY29kZdoBPGJlZ2luCglAa3dkZWYgc3RydWN0IE1BSAoJCWE6OkludAoJZW5kCglAa3dkZWYgc3RydWN0IEJPSAoJCW1haDo6TUFICgllbmQKCQoJIyBUaGlzIHdpbGwgbWFrZSB0aGUgZGVmYXVsdCB3aWRnZXQgZm9yIGFuIEludCBhIFNsaWRlcgoJQHR5cGVhc2ZpZWxkIEludCA9IFNsaWRlcigxOjEwKQoJIyBUaGlzIHdpbGwgbWFrZSB0aGUgZGVmYXVsdCB3aWRnZXQgZm9yIGZpZWxkcyBvZiB0eXBlIEFTRCBhIHBvcG91dCB0aGF0IHdyYXBzIGEgU3RydWN0Qm9uZHtBU0R9CglAcG9wb3V0YXNmaWVsZCBNQUgKCQoJQGJpbmQgYm9oIFN0cnVjdEJvbmQoQk9IKQplbmSobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMLZJDNhMDY2YmY0LTM0NjYtNDY5ZS05MGQwLTZiMTRiZTNlZDhkNYSnY2VsbF9pZNkkM2EwNjZiZjQtMzQ2Ni00NjllLTkwZDAtNmIxNGJlM2VkOGQ1pGNvZGW1bWQiIiIKIyBCb25kVGFibGUKIiIiqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTD2SQ4MTFjZjc4Yi1lODcwLTQ1YmItOTE3My04OWEzYjNkNDk1ZjWEp2NlbGxfaWTZJDgxMWNmNzhiLWU4NzAtNDViYi05MTczLTg5YTNiM2Q0OTVmNaRjb2Rl2ZhibGMgPSBAQm9uZHNMaXN0ICJQb3BvdXQgQ29udGFpbmVyIiBiZWdpbgoJIlN0cnVjdHVyZSBBU0QiID0gUG9wb3V0KGFzZF9ib25kKQoJIk5hbWVkVHVwbGUiID0gUG9wb3V0KG50X2JvbmQpCgkiU3RydWN0Qm9uZFNlbGVjdCIgPSBQb3BvdXQoc2JzX2JvbmQpCmVuZKhtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkNjNkNmMyZGYtYTQxMS00MDdjLWFmMTEtNGY1ZDA5ZmJiMzIyhKdjZWxsX2lk2SQ2M2Q2YzJkZi1hNDExLTQwN2MtYWYxMS00ZjVkMDlmYmIzMjKkY29kZdmlYmVnaW4KQmFzZS5Aa3dkZWYgc3RydWN0IExPTAoJYTo6SW50IAoJYjo6SW50CmVuZApAZmllbGRkYXRhIExPTCBiZWdpbgoJYSA9IChtZCJXb25kZXIhIiwgU2xpZGVyKDE6MTApKQoJYiA9IChAaHRsKCI8c3Bhbj5GaWVsZCBCPC9zcGFuPiIpLCBTY3J1YmJhYmxlKDE6MTApKQplbmQKZW5kqG1ldGFkYXRhg6lzaG93X2xvZ3PDqGRpc2FibGVkwq5za2lwX2FzX3NjcmlwdMKrY29kZV9mb2xkZWTC2SQ0ODQzOTgzYy1kZjY0LTRiOTQtODYzNC03YTEwZDk0MjNhNzCEp2NlbGxfaWTZJDQ4NDM5ODNjLWRmNjQtNGI5NC04NjM0LTdhMTBkOTQyM2E3MKRjb2Rltm1kIiIiCiMgU3RydWN0Qm9uZAoiIiKobWV0YWRhdGGDqXNob3dfbG9nc8OoZGlzYWJsZWTCrnNraXBfYXNfc2NyaXB0wqtjb2RlX2ZvbGRlZMPZJGE1NDkwYTZiLWRjMTEtNDJiNy04N2UwLWQzODg3MGZjNTVlNISnY2VsbF9pZNkkYTU0OTBhNmItZGMxMS00MmI3LTg3ZTAtZDM4ODcwZmM1NWU0pGNvZGWkZnJlcahtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwtkkNjMzMDI5YWYtOGNhYy00MjZlLWIzNWMtYzlmYjM5MzhiNzg0hKdjZWxsX2lk2SQ2MzMwMjlhZi04Y2FjLTQyNmUtYjM1Yy1jOWZiMzkzOGI3ODSkY29kZb1AYmluZCBsb2xfcG9wIHBvcG91dHdyYXAoTE9MKahtZXRhZGF0YYOpc2hvd19sb2dzw6hkaXNhYmxlZMKuc2tpcF9hc19zY3JpcHTCq2NvZGVfZm9sZGVkwqtub3RlYm9va19pZNkkMWM1NzkzOTAtMWViYy0xMWYwLTM0ODAtZjFlZTU1MjQ2ODU1q2luX3RlbXBfZGlywqhtZXRhZGF0YYGsY3VzdG9tX2F0dHJzkaxoaWRlLWVuYWJsZWQ=";
window.pluto_preamble_html = undefined;
</script>

<meta name="pluto-insertion-spot-parameters">
<script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/editor.6c5f0499.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/index.11569726.js"></script><link rel="pluto-external-source" id="MathJax-script" href="https://cdn.jsdelivr.net/gh/fonsp/Pluto.jl@0.20.5/frontend-dist/tex-svg-full.f72d1ae1.js" type="text/javascript">
<meta name="pluto-insertion-spot-preload">
</head><body class="loading no-MŒ±Œ∏Jax"> <div style="min-height:100vh;display:flex"> <pluto-editor class="fullscreen"> <progress style="filter:grayscale()" class="delete-me-when-live statefile-fetch-progress" max="100"></progress> </pluto-editor> </div> </body></html>